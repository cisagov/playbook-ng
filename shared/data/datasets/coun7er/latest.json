{
    "id": "coun7er",
    "version": "latest",
    "name": "CISA COUN7ER",
    "url": null,
    "spec_version": "1.0.0",
    "item_type": "Countermeasure",
    "items": [
        {
            "id": "CM0001",
            "name": "Disable Server Message Block (SMB) Protocol",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0001\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling the Server Message Block (SMB) protocol blocks adversary lateral movement to admin shares using SMB.\n\n## Introduction\n\nAdversaries can use the SMB protocol to remotely access administrative and hidden shares (those not mapped to a drive letter).\n\n## Preparation\n\n- Estimate impact on business operations.\n- Conduct risk assessment to understand whether potential disruption outweighs consequences of continued adversary access.\n- Perform a backup of the registry before making any changes.\n\n## Risks\n\nThis countermeasure can break legitimate functionality.\n\nDisabling administrative and hidden shares on Domain Controllers increases this risk. For example, disabling the ADMIN$ share can:\n\n  - Inhibit the ability to use PsExec to remotely interface with endpoints\n  - Disrupt software updates and automated patching for third-party applications\n\nConsider restricting access to shares by implementing an allowlist on the firewall as an alternative.\n\n## Guidance\n\n### Disable Administrative and Hidden Shares\n\nTo mitigate the adversary's ability to write and execute from administrative and hidden shares and help contain an adversary by restricting their ability to remotely access systems, disable administrative or hidden shares from being accessible on endpoints.\n\n### Disable Lanman Server via Services Console\n\nFile, print, and named-pipe sharing over the network can be disabled by opening the Services console (services.msc) on an endpoint, opening the Server service, and selecting disable from the Startup type drop down menu. The service can be likewise paused or stopped via the Server service configuration window.\n\n### Disable Administrative and Hidden Shares via Registry\n\nAdmin and hidden shares can be disabled on endpoints by modifying the value in the registry by setting the AutoShareWks parameter to 0. For workstations, this will be at:\n\n`HKLM\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters DWORD Name = \"AutoShareWks\" Value = \"0\"`\n\nFor servers, admin and hidden shares can be disabled at:\n\n`HKLM\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters DWORD Name = \"AutoShareServer\" Value = \"0\"`\n\nNote that this change will not disable the IPC\\$ share. Although this share is not used for direct file access, it should still be disabled.\n\n### Disable Administrative and Hidden Shares via GPO\n\nCreate a new Group Policy Object (GPO) named \"Disable Administrative and Hidden Shares\" or edit an existing GPO in the Group Policy Management Console. Then mark the following settings as disabled.\n\n- Computer Configuration \\> Policies \\> Administrative Templates \\> MSS(Legacy) \\> MSS(AutoShareServer)\n- Computer Configuration \\> Policies \\> Administrative Templates \\> MSS(Legacy) \\> MSS(AutoShareWks)\n\nAfter establishing this GPO, link it to the appropriate Organizational Unit and apply the the update to all relevant machines.\n\n### Secure Accounts with Access to Hidden and Admin Shares\n\nAccounts with access to hidden and admin shares should be locked down to prevent an adversary from leveraging the privileged accounts to conduct an attack. This includes considering the isolation of TCP 445 between machines or workstation subnets, where risks permit this.\n\n- Administrative privileges should be regularly audited.\n- Leverage Microsoft's Local Administrative Password Solution (LAPS).\n- Accounts with access to admin or hidden shares should have logins configured to use multi-factor authentication (MFA).\n\n## References\n\n- Ransomware Protection and Containment Strategies: Practical Guidance for Endpoint Protection, Hardening, and Containment | <https://cloud.google.com/blog/topics/threat-intelligence/ransomware-protection-and-containment-strategies/>\n- SMB/Windows Admin Shares | <https://redcanary.com/threat-detection-report/techniques/windows-admin-shares/>\n- Remove administrative shares - Windows Server | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/remove-administrative-shares>\n- Administrative shares are missing - Windows Server | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/problems-administrative-shares-missing>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0012",
                "CM0017",
                "CM0019",
                "CM0020",
                "CM0025",
                "CM0052",
                "CM0053",
                "CM0062",
                "CM0098",
                "CM0100",
                "CM0141"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "cloud.google.com",
                    "description": "Ransomware Protection and Containment Strategies: Practical Guidance for Endpoint Protection, Hardening, and Containment",
                    "url": "https://cloud.google.com/blog/topics/threat-intelligence/ransomware-protection-and-containment-strategies/"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "SMB/Windows Admin Shares",
                    "url": "https://redcanary.com/threat-detection-report/techniques/windows-admin-shares/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Remove administrative shares - Windows Server",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/remove-administrative-shares"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Administrative shares are missing - Windows Server",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/problems-administrative-shares-missing"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0002",
            "name": "Enable Email Attachment Filtering and Message Authentication ",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0002\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling email attachment filtering and enabling message authentication restricts adversary initial access using malicious files.\n\n## Introduction\n\nAn email gateway can filter incoming and outgoing email messages based on specified parameters. Email gateways provide a high level of control over what emails are to be filtered out and how. The attachment scanning capability commonly available with email gateways allows organizations to automatically scan email attachments and perform different tasks on them (hash checking, filetype checking, etc.) and then filter them out based on different criteria. Examples of file types typically blocked: .com, .exe, .dll, .ps1, .ps1xml, .msh, .cmd, .bat, .hta, .jar, .ws, .wsc, .rar, .bz2, .gz, .tar, .msi, .msu, .tmp, .iso, .img, .xls, .xlt, .xlm \n\nSender Policy Framework (SPF) serves as an email authentication mechanism that verifies the IP address of the sending server matches the domain name of the sender's email address. Implementing SPF helps to prevent spoofing attacks. Spoofing attacks can increase the likelihood of an authentic looking attachment with a malicious payload reaching an employee's inbox. \n\nDomain Keys Identified Mail (DKIM) provides an additional layer of email authentication that helps to confirm the integrity of messages via digital signatures and can help prevent email tampering that might occur in transit from one location to another. \n\nDomain-based Message Authentication, Reporting, and Conformance (DMARC) is an email authentication protocol that allows control over how an organization's emails should be handled should they fail SPF or DKIM checks, which can help to prevent email spoofing. DMARC can also generate reports on other useful email authentication measures such as Certificate Authorities Authorization (CAA), Authenticated Received Chain (ARC), and the Domain Name System-Based Authentication of Named Entities (DANE).\n\n## Preparation\n\n- Deploy and configure an email gateway. \n- Compile an up-to-date list of suitable or unsuitable file types that you wish the email gateway to either block or allow. \n- Ensure that the appropriate allowlist/denylist that best suits the organization's business needs and security requirements is/are configured and up to date.\n- Ensure that email file attachment hashes are being compared to a reliable and reputable database of known malicious hashes and that any files with a matching hash from the database are blocked. This can be performed either via the email gateway, or a third-party solution that is properly integrated with the email gateway. However, security teams should understand that just because a file's hash doesn't match a previously identified signature, this does not mean the file is verified to be safe as packing and obfuscating malicious files is comparatively easy for threat actors.\n\n## Risks\n\n- This countermeasure can break legitimate functionality. \n- A phased implementation can reveal potential issues involving improper quarantining or blocking. During the first phase, e-mails to be quarantined are flagged and monitored, allowing issues to be identified and resolved. E-mails are quarantined in a subsequent phase.\n\n## Guidance\n\n### Email Gateway Configuration \n\n- Configure an email gateway to filter incoming and outgoing email messages based on specific parameters. \n- Enable the attachment scanning capability to automatically scan email attachments (hash checking, filetype checking, etc.) and filter them based on specified criteria.  If this capability does not exist on your solution, consider supplementing with antivirus integration. \n\n### Anti-Spoofing and Email Authentication Mechanisms \n\n- Implement Sender Policy Framework (SPF) to help prevent spoofing attacks.  Ensure emails with attachments that fail SPF checks are rejected, quarantined, or flagged as suspicious. \n- Ensure email services support Domain Keys Identified Mail (DKIM).  Configure DKIM settings for action if an email fails to pass a DKIM check.   \n- Verify that your email services support Domain-based Message Authentication, Reporting, and Conformance (DMARC) and configure DMARC settings to specify the actions to be taken if an email fails to pass a check. \n\n### User/Employee Training \n\n- Provide education and training to inform users of the risks and best practices associated with email attachments.\n\n## References\n\n- Filtering and blocking email attachments using Trend Micro's Messaging products | <https://success.trendmicro.com/en-US/solution/KA-0003827>\n- Defense Evasion and Phishing Emails | <https://redcanary.com/blog/defense-evasion-and-phishing-emails/>\n- Spearphishing Attachment | <https://redcanary.com/threat-detection-report/techniques/spearphishing-attachment/>\n- Mail flow best practices for Exchange Online, Microsoft 365, and Office 365 (overview) | <https://learn.microsoft.com/en-us/exchange/mail-flow-best-practices/mail-flow-best-practices/>\n- Anti-spoofing protection in EOP | <https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/anti-phishing-protection-spoofing-about/>\n- Strategies to Mitigate Cyber Security Incidents | <https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/strategies-mitigate-cyber-security-incidents/strategies-mitigate-cyber-security-incidents>\n- Configure trusted ARC sealers | <https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/use-arc-exceptions-to-mark-trusted-arc-senders/>\n- What is Certification Authority Authorization? | <https://pkic.org/2013/09/25/what-is-certification-authority-authorization/>\n- Phishing | <https://www.nist.gov/itl/smallbusinesscyber/guidance-topic/phishing>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0023",
                "CM0037",
                "CM0047",
                "CM0113"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "success.trendmicro.com",
                    "description": "Filtering and blocking email attachments using Trend Micro's Messaging products",
                    "url": "https://success.trendmicro.com/en-US/solution/KA-0003827"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Defense Evasion and Phishing Emails",
                    "url": "https://redcanary.com/blog/defense-evasion-and-phishing-emails/"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Spearphishing Attachment",
                    "url": "https://redcanary.com/threat-detection-report/techniques/spearphishing-attachment/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Mail flow best practices for Exchange Online, Microsoft 365, and Office 365 (overview)",
                    "url": "https://learn.microsoft.com/en-us/exchange/mail-flow-best-practices/mail-flow-best-practices/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Anti-spoofing protection in EOP",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/anti-phishing-protection-spoofing-about/"
                },
                {
                    "source_name": "www.cyber.gov.au",
                    "description": "Strategies to Mitigate Cyber Security Incidents",
                    "url": "https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/strategies-mitigate-cyber-security-incidents/strategies-mitigate-cyber-security-incidents"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Configure trusted ARC sealers",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/use-arc-exceptions-to-mark-trusted-arc-senders/"
                },
                {
                    "source_name": "pkic.org",
                    "description": "What is Certification Authority Authorization?",
                    "url": "https://pkic.org/2013/09/25/what-is-certification-authority-authorization/"
                },
                {
                    "source_name": "www.nist.gov",
                    "description": "Phishing",
                    "url": "https://www.nist.gov/itl/smallbusinesscyber/guidance-topic/phishing"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1566.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0003",
            "name": "Configure File and Directory Permissions",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0003\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nConfiguring file and directory permissions blocks adversary privilege escalation using lax permissions.\n\n## Introduction\n\nCritical system files and directories play an integral part in the\nprocesses and functions of a system. The specific files and directories will vary by operating system. Examples include:\n\nWindows: C:\\Windows\\System32\\\\*, C:\\Windows\\system.ini, C:\\config.sy\n\nLinux: /etc/\\*, /sbin/\\*, /bin/\\*, /lib/system/\\*, /boot/\\*\n\nMac: ~/System/\\*, /sbin/\\*, /Library/\\*, /bin/\\*\n\n## Preparation\n\n1. Establish and review the baseline of file permissions.\n2. Ensure access to an operating system-appropriate file permission viewer.\n3. Identify which files you wish to verify the permissions of, which may involve finding/creating a list of critical system files and directories.\n\n## Risks\n\n- Corrupting or deleting critical system files can lead to system failures.\n- Incorrect identification of a malicious permission allows the adversary to continue to operate, while incorrect identification of a legitimate permission can break legitimate functionality. A baseline of legitimate permissions for files can reduce the\nlikelihood of implementation errors.\n\n## Guidance\n\nThe Reference section lists some of the most popular tools for file permission verification and configuration (grouped by operating system). Please consult the associated manuals for usage guidance.\n\n## References\n\n- Center for Internet Security (CIS) Benchmarks | <https://learn.microsoft.com/en-us/compliance/regulatory/offering-CIS-Benchmark>\n- Security baselines | <https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-security-configuration-framework/windows-security-baselines>\n\n### Windows \n\n- Find and open File Explorer | <https://support.microsoft.com/en-us/windows/find-and-open-file-explorer-ef370130-1cca-9dc5-e0df-2f7416fe1cb1>\n- NTFSSecurity 4.2.4 | <https://www.powershellgallery.com/packages/NTFSSecurity/4.2.4>\n- AccessChk v6.15 | <https://learn.microsoft.com/en-us/sysinternals/downloads/accesschk>\n- AccessEnum v1.35 | <https://learn.microsoft.com/en-us/sysinternals/downloads/accessenum>\n- icacls | <https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/icacls>\n- 4670(S): Permissions on an object were changed | <https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4670>\n- Sysinternals Utilities Index | <https://learn.microsoft.com/en-us/sysinternals/downloads/>\n- Description of the Windows File Protection feature | <https://support.microsoft.com/en-us/topic/description-of-the-windows-file-protection-feature-db28f515-6512-63d1-6178-982ed2022ffb>\n- What is the System32 Directory? (and Why You Shouldn't Delete It) | <https://www.howtogeek.com/346997/what-is-the-system32-directory-and-why-you-shouldnt-delete-it/>\n- Use the System File Checker tool to repair missing or corrupted system files | <https://support.microsoft.com/en-us/topic/use-the-system-file-checker-tool-to-repair-missing-or-corrupted-system-files-79aa86cb-ca52-166a-92a3-966e85d4094e>\n- File Integrity Monitoring in Microsoft Defender for Cloud | <https://learn.microsoft.com/en-us/azure/defender-for-cloud/file-integrity-monitoring-overview>\n\n### Linux \n\n- ls(1) - Linux manual page | <https://www.man7.org/linux/man-pages/man1/ls.1.html>\n- stat(2) - Linux manual page | <https://www.man7.org/linux/man-pages/man2/stat.2.html>\n- GNOME/Nautilus | <https://github.com/GNOME/nautilus>\n- Dolphin | <https://userbase.kde.org/Dolphin>\n\n### MacOS \n\n- Organize your files in the Finder on Mac | <https://support.apple.com/guide/mac-help/organize-your-files-in-the-finder-mchlp2605/mac>\n- How to gain access to the System folder on your Mac? | <https://macpaw.com/how-to/access-system-folder-mac>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0022",
                "CM0043",
                "CM0114",
                "CM0121",
                "CM0133"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Center for Internet Security (CIS) Benchmarks",
                    "url": "https://learn.microsoft.com/en-us/compliance/regulatory/offering-CIS-Benchmark"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Security baselines",
                    "url": "https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-security-configuration-framework/windows-security-baselines"
                },
                {
                    "source_name": "support.microsoft.com",
                    "description": "Find and open File Explorer",
                    "url": "https://support.microsoft.com/en-us/windows/find-and-open-file-explorer-ef370130-1cca-9dc5-e0df-2f7416fe1cb1"
                },
                {
                    "source_name": "www.powershellgallery.com",
                    "description": "NTFSSecurity 4.2.4",
                    "url": "https://www.powershellgallery.com/packages/NTFSSecurity/4.2.4"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "AccessChk v6.15",
                    "url": "https://learn.microsoft.com/en-us/sysinternals/downloads/accesschk"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "AccessEnum v1.35",
                    "url": "https://learn.microsoft.com/en-us/sysinternals/downloads/accessenum"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "icacls",
                    "url": "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/icacls"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "4670(S): Permissions on an object were changed",
                    "url": "https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4670"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Sysinternals Utilities Index",
                    "url": "https://learn.microsoft.com/en-us/sysinternals/downloads/"
                },
                {
                    "source_name": "support.microsoft.com",
                    "description": "Description of the Windows File Protection feature",
                    "url": "https://support.microsoft.com/en-us/topic/description-of-the-windows-file-protection-feature-db28f515-6512-63d1-6178-982ed2022ffb"
                },
                {
                    "source_name": "www.howtogeek.com",
                    "description": "What is the System32 Directory? (and Why You Shouldn't Delete It)",
                    "url": "https://www.howtogeek.com/346997/what-is-the-system32-directory-and-why-you-shouldnt-delete-it/"
                },
                {
                    "source_name": "support.microsoft.com",
                    "description": "Use the System File Checker tool to repair missing or corrupted system files",
                    "url": "https://support.microsoft.com/en-us/topic/use-the-system-file-checker-tool-to-repair-missing-or-corrupted-system-files-79aa86cb-ca52-166a-92a3-966e85d4094e"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "File Integrity Monitoring in Microsoft Defender for Cloud",
                    "url": "https://learn.microsoft.com/en-us/azure/defender-for-cloud/file-integrity-monitoring-overview"
                },
                {
                    "source_name": "www.man7.org",
                    "description": "ls(1) - Linux manual page",
                    "url": "https://www.man7.org/linux/man-pages/man1/ls.1.html"
                },
                {
                    "source_name": "www.man7.org",
                    "description": "stat(2) - Linux manual page",
                    "url": "https://www.man7.org/linux/man-pages/man2/stat.2.html"
                },
                {
                    "source_name": "github.com",
                    "description": "GNOME/Nautilus",
                    "url": "https://github.com/GNOME/nautilus"
                },
                {
                    "source_name": "userbase.kde.org",
                    "description": "Dolphin",
                    "url": "https://userbase.kde.org/Dolphin"
                },
                {
                    "source_name": "support.apple.com",
                    "description": "Organize your files in the Finder on Mac",
                    "url": "https://support.apple.com/guide/mac-help/organize-your-files-in-the-finder-mchlp2605/mac"
                },
                {
                    "source_name": "macpaw.com",
                    "description": "How to gain access to the System folder on your Mac?",
                    "url": "https://macpaw.com/how-to/access-system-folder-mac"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1036",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1036.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1036.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1037",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1037.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1037.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1037.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1037.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1048",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1053.006",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1055.009",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1070",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1070.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1070.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1070.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1070.008",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1070.009",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1080",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1218.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1222",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1222.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1222.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1489",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1530",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1543",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1543.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1543.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546.013",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1547.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1547.013",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1548",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1548.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1552",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1552.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1552.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1553.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1556",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562.006",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1563.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1564.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1565",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1565.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1565.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1569",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1569.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1574",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1574.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1574.007",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1574.008",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1574.009",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0004",
            "name": "Enable Windows Defender Exploit Guard (WDEG) Attack Surface Reduction (ASR) Rules",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0004\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling Windows Defender Exploit Guard (WDEG) Attack Surface Reduction (ASR) rules restricts adversary lateral movement and persistence using malicious files and scripts.\n\n## Introduction\n\nASR is a ruleset and subcomponent of WDEG, specifically designed to block processes and activities commonly used by malware to infect computers. ASR rules target specific software behaviors e.g., launching files and scripts, running (obfuscated) scripts, and deviations from typical application behavior.\n\n## Preparation\n\n- Microsoft Defender for Endpoint with real-time and cloud-delivery protection is enabled.\n- Microsoft Defender is the primary anti-virus solution.\n- No Microsoft Defender component is more than two versions old.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\nAssess the status of ASR and identify gaps in coverage. Survey the attack surface management card in the Microsoft 365 Defender portal and determine whether standard and/or other rules are applied, the mode in which they are configured, and any existing exclusions.\n\nMicrosoft recommends beginning by enabling the three standard protection rules: block credential stealing from LSASS, abuse of exploited vulnerable signed drivers, and persistence via WMI event subscription. These three rules can typically be implemented with little impact to business function. ASR can be configured using Microsoft Endpoint Manager, Group Policy, and/or PowerShell Cmdlets.\n\nAdditional rules to consider are listed below.\n\n### Standard Protection Rules\n\nThe minimum set of rules which Microsoft recommends you always enabled, while you are evaluating the impact and configuration needs of the other\nASR rules. These rules typically have minimal-to-no noticeable impact on the end user.\n\n|Rule|Mapped to TTPs|\n|----|--------------|\n|Block abuse of exploited vulnerable signed driver | [T1068](https://attack.mitre.org/techniques/T1068) - Exploitation for Privilege Escalation |\n|Block credential stealing from the Windows local security authority subsystem (lsass.exe) | [T1003.001](https://attack.mitre.org/techniques/T1003/001) - OS Credential Dumping: LSASS Memory |\n|Block persistence through WMI event subscription | [T1546.003](https://attack.mitre.org/techniques/T1546/003) - Event Triggered Execution: WMI Event Subscription |\n\n### Other Rules\n\nRules that require some measure of following the documented deployment steps (Plan \\> Test \\> Enable \\> Operationalize).\n\n|Rule|Mapped to TTPs|\n|----|--------------|\n|Block Adobe Reader from creating child processes | [T1203](https://attack.mitre.org/techniques/T1203) - Exploitation for Client Execution |\n|Block all Office applications from creating child processes | [T1203](https://attack.mitre.org/techniques/T1203) - Exploitation for Client Execution |\n|Block executable content from email client and webmail | [T1566](https://attack.mitre.org/techniques/T1566) - Phishing |\n|Block executable files from running unless they meet a prevalence, age, or trusted list criterion | |\n|Block execution of potentially obfuscated scripts | [T1027](https://attack.mitre.org/techniques/T1027) - Obfuscated Files or Information |\n|Block JavaScript or VBScript from launching downloaded executable content | [T1059.005](https://attack.mitre.org/techniques/T1059/005) - Command and Scripting Interpreter: Visual Basic, [T1059.007](https://attack.mitre.org/techniques/T1059/007) - Command and Scripting Interpreter: JavaScript |\n|Block Office applications from creating executable content | [T1204.002](https://attack.mitre.org/techniques/T1204/002) - User Execution: Malicious File |\n|Block Office applications from injecting code into other processes | [T1055](https://attack.mitre.org/techniques/T1055) - Process Injection, [T1204.002](https://attack.mitre.org/techniques/T1204/002) - User Execution: Malicious File |\n|Block Office communication application from creating child processes | |\n|Block process creations originating from PSExec and WMI commands | [T1569.002](https://attack.mitre.org/techniques/T1569/002) - System Services: Service Execution, [T1047](https://attack.mitre.org/techniques/T1047) - Windows Management Instrumentation |\n|Block untrusted and unsigned processes that run from USB | [T1091](https://attack.mitre.org/techniques/T1091) - Replication Through Removable Media |\n|Block Win32 API calls from Office macros | [T1204.002](https://attack.mitre.org/techniques/T1204/002) - User Execution: Malicious File |\n|Use advanced protection against ransomware | |\n\n### Deployment Modes\n\n-   Audit mode - used to evaluate how ASR rules would affect the organization if enabled\n-   Block mode - prevents execution\n-   Warn mode - warns of execution\n-   Not configured/disabled\n\n#### Exclusions\n\nFiles and folders can be specified for exclusion from ASR rule evaluation. While exclusions may be necessary to ensure normal operations, it is important to note that exclusions could introduce vulnerability and should be carefully evaluated.\n\nA typical implementation process includes the following steps:\n\n### Plan\n\nThe first step in preparing to deploy ASR rules is planning. Key to the planning process is identifying key stakeholders and critical business operations.\n\n-   Identify business units - ASR rollout should be contingent upon distribution and usage of software, shared folders, and scripts\n-   Identify ASR rules champions to assist during rollout, preliminary testing, and implementation\n-   Inventory business apps - understanding applications and processes used across the organization is critical to the success of ASR rule deployment\n-   Define ASR rules reporting and response teams - determine the person/team responsible for gathering reports, with whom to share the reports, and how to escalate identified threats/issues\n-   Determine deployment rings - Leverage deployment rings for phased rollout of ASR rules\n\n### Test\n\nThe second step in preparing to deploy ASR rules is testing. Testing the deployment of ASR rules is critical to ensuring the maximum likelihood of success while minimizing the chance of disrupting regular business operations.\n\n-   Enable ASR rule in audit mode\n-   Review reporting in the Microsoft 365 Defender portal\n-   Assess impact\n-   Define exclusions to deploy ASR rules without negatively impacting operations\n\n### Enable\n\nThis step is intended to be the limited and scalable rollout of the tested ASR rules to the first test ring.\n\n-   Set ASR rule to block or warn\n-   Assess impact from the reporting page in Microsoft 365 Defender portal and seek feedback from the ASR champions\n-   Refine exclusions\n-   Problematic rules should be switched back into audit mode\n\n### Operationalize\n\nAfter the ASR rule is deployed, it is critical to implement processes to\nmonitor and respond to ASR events.\n\n-   Monitor for false positives\n-   Review ASR rule reports regularly to stay abreast of rule-reported events\n-   Engage in ASR rule hunting to proactively inspect events\n\n## References\n\n- Enable attack surface reduction rules | <https://learn.microsoft.com/en-us/defender-endpoint/enable-attack-surface-reduction>\n- Attack surface reduction rules deployment overview | <https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-deployment>\n- Attack surface reduction rules reference | <https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-reference>\n- Plan attack surface reduction rules deployment | <https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-deployment-plan>\n- Test attack surface reduction rules | <https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-deployment-test>\n- Implement attack surface reduction rules | <https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-deployment-implement>\n- Operationalize attack surface reduction rules | <https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-deployment-operationalize>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0002",
                "CM0046",
                "CM0047",
                "CM0054",
                "CM0056",
                "CM0058",
                "CM0087",
                "CM0088",
                "CM0089",
                "CM0090",
                "CM0091",
                "CM0096",
                "CM0097",
                "CM0101",
                "CM0113",
                "CM0115",
                "CM0116",
                "CM0141"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Enable attack surface reduction rules",
                    "url": "https://learn.microsoft.com/en-us/defender-endpoint/enable-attack-surface-reduction"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Attack surface reduction rules deployment overview",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-deployment"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Attack surface reduction rules reference",
                    "url": "https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-reference"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Plan attack surface reduction rules deployment",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-deployment-plan"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Test attack surface reduction rules",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-deployment-test"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Implement attack surface reduction rules",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-deployment-implement"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Operationalize attack surface reduction rules",
                    "url": "https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-deployment-operationalize"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1027",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1047",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1055",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1059.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1059.007",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1068",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1091",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1203",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1204.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1566",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1569.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0005",
            "name": "Monitor or Block Microsoft HTML Application (MSHTA) Utility or Restrict HTML Application (HTA) Network Access",
            "subtype": "Examine, Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0005\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Disable\n* **Status:** Active\n\n## Intended Outcome\n\nMonitoring or blocking the Microsoft HTML Application (MSHTA) utility detects or blocks adversary execution of malicious HTML Application (HTA) programs. Restricting HTA network access blocks adversary defense evasion using proxy execution of malicious HTA programs.\n\n## Introduction\n\nMshta.exe is a Windows utility that provides a host for HTA files to run in. Although it has legitimate uses, attackers can use mshta.exe to run malicious Javascript or VBScript commands.\n\n## Preparation\n\n- Assess the impact to operations if mshta.exe is disabled or restricted.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Disabling mshta.exe may disable legitimate applications that rely on HTML Applications (HTA). Identify any legitimate custom-built applications that might be using HTA.\n\n## Guidance\n\n### Monitor\n\nConfigure the host-based agent to monitor for\n- Process execution\n- Command-line parameter inspection, and/or \n- Process lineage monitoring\n\nTo gain insight into attempts at binary masquerading, consider collecting process metadata. Adversaries have been observed renaming binaries to evade brittle detections.\n- Monitor for network calls from the MSHTA binaries\n- Monitor DLL's (mshta.dll, jscript9.dll)\n\n### Block\n\n#### AppLocker\n\n- Utilize Windows AppLocker to assign a rule to prevent execution of mshta.exe and mshta.dll.\n\n#### Disable Network Access\n\nFirewall rules can be used to disable network access by HTA files. HTA files will still be able to execute, however, threat actors won't be able to use HTA for attacks such as remote file inclusion, remote code execution, or other attacks that require internet access.\n\n## References\n\n- The Malware Hiding in Your Windows System32 Folder: Mshta, HTA, and Ransomware | <https://www.varonis.com/blog/living-off-the-land-lol-with-microsoft-part-ii-mshta-hta-and-ransomware>\n- Applications that can bypass WDAC and how to block them | <https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/microsoft-recommended-block-rules>\n- Mshta | <https://redcanary.com/threat-detection-report/techniques/mshta/>\n- How to execute a Local File using HTML Application? | <https://www.codeproject.com/Articles/113678/How-to-execute-a-Local-File-using-HTML-Application>\n- HTML Application (HTA) - A GUI for your scripts on Windows | <https://medium.com/@anht_59851/html-application-hta-a-gui-for-your-scripting-on-windows-bfaacf2c3bdd>\n- Associate .HTA & various Script File Extensions with Notepad \\#2 | <https://github.com/jymcheong/OpenEDRclient/issues/2>\n- Detect suspicious Mshta usage | <https://github.com/microsoft/Microsoft-365-Defender-Hunting-Queries/blob/master/Execution/detect-suspicious-mshta-usage.md>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0006",
                "CM0007",
                "CM0008",
                "CM0027",
                "CM0028",
                "CM0030",
                "CM0031",
                "CM0032",
                "CM0045",
                "CM0046",
                "CM0056",
                "CM0091",
                "CM0117",
                "CM0127",
                "CM0130",
                "CM0131",
                "CM0132"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.varonis.com",
                    "description": "The Malware Hiding in Your Windows System32 Folder: Mshta, HTA, and Ransomware",
                    "url": "https://www.varonis.com/blog/living-off-the-land-lol-with-microsoft-part-ii-mshta-hta-and-ransomware"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Applications that can bypass WDAC and how to block them",
                    "url": "https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/microsoft-recommended-block-rules"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Mshta",
                    "url": "https://redcanary.com/threat-detection-report/techniques/mshta/"
                },
                {
                    "source_name": "www.codeproject.com",
                    "description": "How to execute a Local File using HTML Application?",
                    "url": "https://www.codeproject.com/Articles/113678/How-to-execute-a-Local-File-using-HTML-Application"
                },
                {
                    "source_name": "medium.com",
                    "description": "HTML Application (HTA) - A GUI for your scripts on Windows",
                    "url": "https://medium.com/@anht_59851/html-application-hta-a-gui-for-your-scripting-on-windows-bfaacf2c3bdd"
                },
                {
                    "source_name": "github.com",
                    "description": "Associate .HTA & various Script File Extensions with Notepad #2",
                    "url": "https://github.com/jymcheong/OpenEDRclient/issues/2"
                },
                {
                    "source_name": "github.com",
                    "description": "Detect suspicious Mshta usage",
                    "url": "https://github.com/microsoft/Microsoft-365-Defender-Hunting-Queries/blob/master/Execution/detect-suspicious-mshta-usage.md"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1218.005",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0006",
            "name": "Disable and Monitor Regasm.exe and Regsvcs.exe Utilities",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0006\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling or monitoring registration utilities blocks or detects adversary defense evasion using proxy execution of code.\n\n## Introduction\n\nRegistration utilities include Regasm.exe (Assembly Registration Tool) and Regsvcs.exe (.NET Services Installation Tool). Regasm.exe reads the metadata within an assembly and adds the necessary entries to the registry, which allows COM clients to create .NET Framework classes transparently.\n\n## Preparation\n\n- Determine necessity of permitting REGASM.exe and REGSVCS.exe in environment.\n- Identify a baseline of behavior of the two programs.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Disabling REGASM.exe and REGSVCS.exe may break some legitimate functionality.\n- An analysis of how REGASM.exe and REGSVCS.exe are legitimately used within an organization's environment can help fine-tune rules and detections.\n\n## Guidance\n\n### Monitor\n\nConfigure the host-based agent to monitor for:\n- Process execution\n- Command-line parameter inspection\n- Process lineage monitoring \n\nTo gain insight into attempts at binary masquerading, consider collecting process metadata Adversaries have been observed renaming binaries to evade brittle detections.\n- Monitor for network calls from registration utility binaries\n- Monitor DLL's\n\n### Block \n\n- Scanning for filenames and hashes associated with REGASM.exe and REGSVCS.exe \n- Auditing command line/PowerShell logs can be useful for detecting usage of these two applications\n- EDR rules can be used to detect and prevent the execution of REGASM.exe and REGSVCS.exe where contextually relevant\n- Configure the host-based agent to block the use of registration utilities and deny them the ability to make network calls\n\n## References\n\n- Threat Hunting for the Most Common MITRE ATT&CK Techniques (Part 4) | <https://medium.com/axon-technologies/threat-hunting-for-the-most-common-mitre-att-ck-techniques-part-4-72e4fc8178bc>\n- Regasm.exe (Assembly Registration Tool) | <https://learn.microsoft.com/en-us/dotnet/framework/tools/regasm-exe-assembly-registration-tool>\n- Regsvcs.exe | <https://lolbas-project.github.io/lolbas/Binaries/Regsvcs/>\n- Agent Tesla: Old RAT Uses New Tricks to Stay on Top | <https://www.sentinelone.com/labs/agent-tesla-old-rat-uses-new-tricks-to-stay-on-top/>\n- metasploit-framework applocker_evasion_regasm_regsvcs.md | <https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/evasion/windows/applocker_evasion_regasm_regsvcs.md>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0005",
                "CM0007",
                "CM0046",
                "CM0091",
                "CM0117",
                "CM0127",
                "CM0130",
                "CM0131",
                "CM0132"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "medium.com",
                    "description": "Threat Hunting for the Most Common MITRE ATT&CK Techniques (Part 4)",
                    "url": "https://medium.com/axon-technologies/threat-hunting-for-the-most-common-mitre-att-ck-techniques-part-4-72e4fc8178bc"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Regasm.exe (Assembly Registration Tool)",
                    "url": "https://learn.microsoft.com/en-us/dotnet/framework/tools/regasm-exe-assembly-registration-tool"
                },
                {
                    "source_name": "lolbas-project.github.io",
                    "description": "Regsvcs.exe",
                    "url": "https://lolbas-project.github.io/lolbas/Binaries/Regsvcs/"
                },
                {
                    "source_name": "www.sentinelone.com",
                    "description": "Agent Tesla: Old RAT Uses New Tricks to Stay on Top",
                    "url": "https://www.sentinelone.com/labs/agent-tesla-old-rat-uses-new-tricks-to-stay-on-top/"
                },
                {
                    "source_name": "github.com",
                    "description": "metasploit-framework applocker_evasion_regasm_regsvcs.md",
                    "url": "https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/evasion/windows/applocker_evasion_regasm_regsvcs.md"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1218.009",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0007",
            "name": "Disable and Monitor Verclsid.exe System Binary",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0007\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling and monitoring the Verclsid.exe system binary blocks or detects adversary defense evasion using proxy execution of code.\n\n## Introduction\n\nVerclsid.exe is known as the Extension CLSID Verification Host and can be used to verify each shell extension before use by Windows Explorer or the Windows Shell (faulty  shell extensions that can cause crashes when used with explorer.exe). However, the tool can be abused to execute malicious component object model (COM) objects.\n\n## Preparation\n\n- Identify a baseline of behavior for Verclsid.exe.\n- Determine necessity of permitting Verclsid.exe in the environment.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Removing Verclsid.exe may result in backward compatibility issues.\n\n## Guidance\n\n### Monitor\n\nConfigure the host-based agent to monitor for:\n- Process execution\n- Command-line parameter inspection\n- Process lineage monitoring\n\nTo gain insight into attempts at binary masquerading, consider collecting process metadata Adversaries have been observed renaming binaries to evade brittle detections.\n- Monitor for network calls from the verclsid.exe binary.\n\n### Block\n\n- Update the Windows Firewall or host-based agent to block network connections from the verclsid.exe binaries\n\n`%SystemRoot%\\system32\\verclsid.exe`\n\n`%SystemRoot%\\syswow64\\verclsid.exe`\n\n## References\n\n- Microsoft Security Bulletin MS06-015 - Critical Vulnerability in Windows Explorer Could Allow Remote Code Execution (908531) | <https://learn.microsoft.com/en-us/security-updates/SecurityBulletins/2006/ms06-015>\n- How my lack of understanding of how processes exit on Windows XP forced a security patch to be recalled | <https://devblogs.microsoft.com/oldnewthing/20070504-00/?p=26983>\n- Verclsid.exe | <https://lolbas-project.github.io/lolbas/Binaries/Verclsid/>\n- The missing verclsid.exe documentation | <https://medium.com/falconforce/the-missing-verclsid-exe-documentation-7080757e9acf>\n- COM IDs & Registry keys in a nutshell | <https://www.codeproject.com/Articles/1265/COM-IDs-Registry-keys-in-a-nutshell>\n- Hancitor | <https://attack.mitre.org/software/S0499/>\n- ReaCOM Verclsid.md | <https://github.com/homjxi0e/ReaCOM/blob/master/Classes/Verclsid.md>\n- Old Phishing Attacks Deploy a New Methodology: Verclsid.exe | <https://redcanary.com/blog/threat-detection/verclsid-exe-threat-detection/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0005",
                "CM0006",
                "CM0046",
                "CM0091",
                "CM0117",
                "CM0127",
                "CM0130",
                "CM0131",
                "CM0132",
                "CM0273",
                "CM0368"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Security Bulletin MS06-015 - Critical Vulnerability in Windows Explorer Could Allow Remote Code Execution (908531)",
                    "url": "https://learn.microsoft.com/en-us/security-updates/SecurityBulletins/2006/ms06-015"
                },
                {
                    "source_name": "devblogs.microsoft.com",
                    "description": "How my lack of understanding of how processes exit on Windows XP forced a security patch to be recalled",
                    "url": "https://devblogs.microsoft.com/oldnewthing/20070504-00/?p=26983"
                },
                {
                    "source_name": "lolbas-project.github.io",
                    "description": "Verclsid.exe",
                    "url": "https://lolbas-project.github.io/lolbas/Binaries/Verclsid/"
                },
                {
                    "source_name": "medium.com",
                    "description": "The missing verclsid.exe documentation",
                    "url": "https://medium.com/falconforce/the-missing-verclsid-exe-documentation-7080757e9acf"
                },
                {
                    "source_name": "www.codeproject.com",
                    "description": "COM IDs & Registry keys in a nutshell",
                    "url": "https://www.codeproject.com/Articles/1265/COM-IDs-Registry-keys-in-a-nutshell"
                },
                {
                    "source_name": "attack.mitre.org",
                    "description": "Hancitor",
                    "url": "https://attack.mitre.org/software/S0499/"
                },
                {
                    "source_name": "github.com",
                    "description": "ReaCOM Verclsid.md",
                    "url": "https://github.com/homjxi0e/ReaCOM/blob/master/Classes/Verclsid.md"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Old Phishing Attacks Deploy a New Methodology: Verclsid.exe",
                    "url": "https://redcanary.com/blog/threat-detection/verclsid-exe-threat-detection/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1218.012",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0008",
            "name": "Block or Monitor Mavinject.exe Utility",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0008\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nBlocking or monitoring execution of the Mavinject.exe utility (Microsoft\nApplication Virtualization Injector) blocks or detects adversary defense\nevasion using proxy execution of code.\n\n## Introduction\n\nMavinject.exe is the Microsoft Application Virtualization Injector, a Windows utility that can inject code into external processes as part of the Microsoft Application Virtualization (App-V) client for virtualization. While Mavinject.exe can be used by other legitimate programs, it is primarily used by App-V. If App-V capabilities are not required, it may be safer to remove the Mavinject.exe program and implement defenses to prevent its future installation and execution.\n\n## Preparation\n\n- Identify a baseline of behavior for Mavinject.exe.\n- Determine necessity of permitting Mavinject.exe in environment.\n\n## Risks\n\n- This countermeasure can break legitimate functionality. However, this risk is only likely if App-V is in use in the enterprise.\n\n## Guidance\n\n### Monitor\n\nConfigure the host-based agent to monitor for:\n\n- Process execution\n- Command-line parameter inspection\n- Process lineage monitoring\n\nTo gain insight into attempts at binary masquerading, consider collecting process metadata. Adversaries have been observed renaming binaries to evade brittle detections.\n\n- Collect data on module loads and monitor DLLs.\n- Analytics can be written to monitor for API calls indicative of process injection. Take care to tune the analytic to reduce false positives.\n- Implement network monitoring to detect anomalous network connections and support the ability to correlate connections to processes.\n\n### Block\n\n- Explore the feasibility of removing the Mavinject.exe binary.\n- Scanning for filenames and hashes associated with Mavinject.exe and auditing command line/PowerShell logs can be useful for detecting Mavinject.exe. \n- EDR rules can be used to detect and prevent the execution of Mavinject.exe where contextually relevant.\n- Mavinject.exe execution can be blocked by leveraging commercial or opensource tools that are designed to block programs from executing (e.g., Windows Defender Application Blocking, CrowdStrike).\n\n## References\n\n- mavinject.exe Functionality Deconstructed | <https://posts.specterops.io/mavinject-exe-functionality-deconstructed-c29ab2cf5c0e>\n- The Curious Case Of Mavinject.Exe | <https://fourcore.io/blogs/mavinject-curious-process-injection>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0005",
                "CM0033",
                "CM0046",
                "CM0091",
                "CM0117",
                "CM0127",
                "CM0130",
                "CM0131",
                "CM0132"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "posts.specterops.io",
                    "description": "mavinject.exe Functionality Deconstructed",
                    "url": "https://posts.specterops.io/mavinject-exe-functionality-deconstructed-c29ab2cf5c0e"
                },
                {
                    "source_name": "fourcore.io",
                    "description": "The Curious Case Of Mavinject.Exe",
                    "url": "https://fourcore.io/blogs/mavinject-curious-process-injection"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1218.013",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0009",
            "name": "Update Domain Name Service (DNS) Deny List",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0009\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nUpdating the Domain Name Service (DNS) deny list blocks adversary command and control (C2).\n\n## Introduction\n\nAdversaries who acquire infrastructure can use bad domains to run C2-based offensive operations.\n\n## Preparation\n\nNo Preparation content identified.\n\n## Risks\n\n- Blocking domains can unintentionally prevent access to domains that that are needed for the enterprise.\n\n## Guidance\n\nDNS blacklists or deny lists are often to filter and block emails containing known bad domains. They can also be used to block, blocks of IP addresses or even an internet service provider known for spam. There are two ways to block a domain: \n- Domain redirect - A domain redirect will redirect a flagged domain to a quarantine zone.\n- Request denied - A request denied will refuse DNS queries from flagged domains.\n\n## References\n\n- What is a DNSBL? | <https://whatismyipaddress.com/dnsbl-blacklist>\n- DNS Blocking: A Viable Strategy in Malware Defense | <https://insights.sei.cmu.edu/blog/dns-blocking-a-viable-strategy-in-malware-defense/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0011",
                "CM0035",
                "CM0040",
                "CM0093",
                "CM0106",
                "CM0262",
                "CM0271",
                "CM0369"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "whatismyipaddress.com",
                    "description": "What is a DNSBL?",
                    "url": "https://whatismyipaddress.com/dnsbl-blacklist"
                },
                {
                    "source_name": "insights.sei.cmu.edu",
                    "description": "DNS Blocking: A Viable Strategy in Malware Defense",
                    "url": "https://insights.sei.cmu.edu/blog/dns-blocking-a-viable-strategy-in-malware-defense/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1566",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1583.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1583.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0010",
            "name": "Enable Internet Protocol (IP) Address Allowlists",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0010\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling Internet Protocol (IP) address allowlists restricts adversary\ninitial access and command and control using unverified IP addresses.\n\n## Introduction\n\nThere are numerous open-source and commercially available solutions for\nIP allowlisting.\n\n## Preparation\n\nNo Preparation content identified.\n\n## Risks\n\n- This countermeasure may block legitimate activity.\n- IP allowlisting risks blocking legitimate and/or mission essential connections.\n\n## Guidance\n\nOn the host\n\n- Check the firewall (Windows, UFW, etc.) for the presence of specific IP addresses for whitelisting.\n- If not present, create an inbound rule for specifically approved IP addresses. \n\nOn the Enterprise\n\n- Maintain a list of allowed IP addresses.\n- Import the allowlist into the endpoint detection/protection solution or via the main firewall.\n- Process requests for adding new IP addresses to the allowlist.\n\n## References\n\n- Security - Firewall | <https://ubuntu.com/server/docs/firewalls>\n- iptables(8) - Linux man page | <https://linux.die.net/man/8/iptables>\n- How to Add IP Address in Windows Firewall | <https://web.archive.org/web/20240616112618/https://www.oryon.net/knowledge-base/article/how-to-add-ip-address-in-windows-firewall/>\n- Uncomplicated Firewall | <https://wiki.archlinux.org/title/Uncomplicated_Firewall>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0034",
                "CM0035",
                "CM0037",
                "CM0093"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "ubuntu.com",
                    "description": "Security - Firewall",
                    "url": "https://ubuntu.com/server/docs/firewalls"
                },
                {
                    "source_name": "linux.die.net",
                    "description": "iptables(8) - Linux man page",
                    "url": "https://linux.die.net/man/8/iptables"
                },
                {
                    "source_name": "web.archive.org",
                    "description": "How to Add IP Address in Windows Firewall",
                    "url": "https://web.archive.org/web/20240616112618/https://www.oryon.net/knowledge-base/article/how-to-add-ip-address-in-windows-firewall/"
                },
                {
                    "source_name": "wiki.archlinux.org",
                    "description": "Uncomplicated Firewall",
                    "url": "https://wiki.archlinux.org/title/Uncomplicated_Firewall"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1071.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1557",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1572",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0011",
            "name": "Enable Domain Name System (DNS) Sinkhole",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0011\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling a Domain Name System (DNS) sinkhole blocks adversary command\nand control (C2) using known C2 servers.\n\n## Introduction\n\nDNS sinkholes redirect clients attempting to connect to a malicious\ndomain to a benign destination. This capability can be paired with\nservers/listeners to emulate normal transactions. The integration of an\nintrusion detection system (IDS) enables real-time alerting and regular\nreporting.\n\n## Preparation\n\n- DNS BIND\n    - Deploy BIND to publish and resolve DNS information over the internet.\n    - Modify the zone configuration file (/etc/named.conf). This file specifies options for BIND, what to log, and which zones to load. Specify organization-specific settings and sink hole zones for blocked domains.\n- Publicly Available Lists\n    - Confirm that lists do not include extranets or business partners.\n    - Note the Time to Live (TTL) assigned to all domains. The TTL should be modified according to the requirement of immediacy. These changes will need to propagate to all other DNS servers in the organization's configuration to take effect.\n    - Remove duplicate domains and subdomains of any top-level domains from list.\n- Custom Lists\n    - Each time a host is observed connecting to a domain associated with adversarial activity, an entry should be made to prevent other hosts from interacting with said domain.\n- Restart DNS Service\n    - Point /etc/resolve.conf to DNS server IP.\n    - Test using digg and nslookup to ensure domains are either blocked or resolving properly.\n    - Capture log to find infected hosts.\n\n## Risks\n\n- This countermeasure may not stop all ongoing activity.\n    - Malware may evade sinkholing by hard-coding IP addresses, and using them for C2.\n    - A newly-sinkholed domain may continue to resolve until the domain record's Time to Live (TTL) expires.\n- This countermeasure may block legitimate activity.\n    - Valid domains may be accidentally sinkholed.\n\n## Guidance\n\nEnable the monitoring and logging of systems that hit the DNS sinkhole server. Sinkhole server logs can assist in identifying compromised hosts in scenarios in which the firewall does not provide visibility into the origins of DNS queries.\n\n- Configure a dedicated sinkhole server to ensure maximum logging\n- Consider running a packet capture tool persistently for full packet payloads using circular logging\n- Configure SOcket CAT (Socat) to listen on specific ports. Socat can be configured to simulate a 3-way handshake to capture GET/POST data\n    - Multiple listeners can be configured on the same IP address\n    - Alternatively, if you elect to establish multiple sinkholes, Socat can be configured to listen on multiple IP addresses\n- Configure an Intrusion Detection System (IDS) such as Snort, to enable the sinkhole to capture and alert on redirects to the sinkhole in real-time\n- Consider configuring regular (daily) reporting on sinkhole traffic\n\n## References\n\n- How DNS Sinkholing Works | <https://docs.paloaltonetworks.com/pan-os/9-1/pan-os-admin/threat-prevention/use-dns-queries-to-identify-infected-hosts-on-the-network/dns-sinkholing>\n- Understanding DNS sinkholes - A weapon against malware [updated 2021] | <https://www.infosecinstitute.com/resources/general-security/dns-sinkhole/>\n- DNS sinkhole: A tool to help thwart cyberattacks | <https://bluecatnetworks.com/blog/dns-sinkhole-a-tool-to-help-thwart-cyberattacks/>\n- Network Admin's Guide to Synthetic Monitoring | <https://www.catchpoint.com/network-admin-guide/dns-sinkhole>\n- How to Configure DNS Sinkholing in the Firewall | <https://campus.barracuda.com/product/cloudgenfirewall/doc/98210196/how-to-configure-dns-sinkholing-in-the-firewall/>\n- Build Securely a DNS Sinkhole Step-by-Step Powered by Slackware Linux | <https://handlers.sans.org/gbruneau/docs/DNS_Sinkhole_setup.pdf>\n- DNSBlackHole | <https://github.com/yoda66/DNSBlackHole>\n- SEC505 Scripts | <https://blueteampowershell.com/SEC505-Scripts.zip>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0009",
                "CM0035",
                "CM0040",
                "CM0093"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "docs.paloaltonetworks.com",
                    "description": "How DNS Sinkholing Works",
                    "url": "https://docs.paloaltonetworks.com/pan-os/9-1/pan-os-admin/threat-prevention/use-dns-queries-to-identify-infected-hosts-on-the-network/dns-sinkholing"
                },
                {
                    "source_name": "www.infosecinstitute.com",
                    "description": "Understanding DNS sinkholes - A weapon against malware [updated 2021]",
                    "url": "https://www.infosecinstitute.com/resources/general-security/dns-sinkhole/"
                },
                {
                    "source_name": "bluecatnetworks.com",
                    "description": "DNS sinkhole: A tool to help thwart cyberattacks",
                    "url": "https://bluecatnetworks.com/blog/dns-sinkhole-a-tool-to-help-thwart-cyberattacks/"
                },
                {
                    "source_name": "www.catchpoint.com",
                    "description": "Network Admin's Guide to Synthetic Monitoring",
                    "url": "https://www.catchpoint.com/network-admin-guide/dns-sinkhole"
                },
                {
                    "source_name": "campus.barracuda.com",
                    "description": "How to Configure DNS Sinkholing in the Firewall",
                    "url": "https://campus.barracuda.com/product/cloudgenfirewall/doc/98210196/how-to-configure-dns-sinkholing-in-the-firewall/"
                },
                {
                    "source_name": "handlers.sans.org",
                    "description": "Build Securely a DNS Sinkhole Step-by-Step Powered by Slackware Linux",
                    "url": "https://handlers.sans.org/gbruneau/docs/DNS_Sinkhole_setup.pdf"
                },
                {
                    "source_name": "github.com",
                    "description": "DNSBlackHole",
                    "url": "https://github.com/yoda66/DNSBlackHole"
                },
                {
                    "source_name": "blueteampowershell.com",
                    "description": "SEC505 Scripts",
                    "url": "https://blueteampowershell.com/SEC505-Scripts.zip"
                }
            ],
            "techniques": []
        },
        {
            "id": "CM0012",
            "name": "Disable or Restrict Distributed Component Object Model (DCOM) Protocol",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0012\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling or restricting the Distributed Component Object Model (DCOM)\nprotocol blocks or restricts adversary lateral movement using malicious\nCOM objects.\n\n## Introduction\n\nDCOM is a technology that enables software component communication and interaction between software components directly over a network enabling distributed computing and inter-process communication. In many organizations, DCOM has been replaced by the .NET Framework, RESTful APIs, and Web Services. However, DCOM is still an essential technology for some organizations because it is required by some applications and legacy systems.\n\n## Preparation\n\n- Determine necessity of permitting DCOM in the environment.\n- Determine whether blocking the protocol to specific systems, such as kiosks, fileservers, etc. is sufficient to harden security.\n\n## Risks\n\n- This countermeasure may block legitimate activity. This countermeasure should only be implemented by organizations for which DCOM is not an essential technology.\n- Disabling DCOM may impact the functionality of applications and services that rely on it. Potential problems include:\n    - Any COM objects that can be started remotely may not function correctly.\n    - The local COM+ snap-in will not be able to connect to remote servers to enumerate their COM+ catalog.\n    - Certificate auto-enrollment may not function correctly.\n    - WMI queries against remote servers may not function correctly.\n    - Disabling DCOM by modifying the registry may occur if the registry is modified incorrectly. To limit the damage caused by incorrectly modifying the registry, administrators should modify the registry using the GPO method, and ensure that the registry is backed up prior to attempted modifications.\n\n## Guidance\n\nIf reliant on DCOM, organizations should ensure all updates to the\nprotocol\\'s implementation have been installed, including DCOM updates\nreleased by Microsoft. \n\nOtherwise, if DCOM is not required, follow the guidelines below.\n\n### Disable DCOM using GPO\n\nDCOM can be disabled across multiple systems using a Group Policy Object\n(GPO) created or modified within the Group Policy Management Console.\nSpecifically, system administrators can disable DCOM by selecting the\n\\\"Enabled\\\" option for \\\"Default Properties\\\" located at Computer\nConfiguration \\> Policies \\> Administrative Templates \\> System \\>\nDistributed COM\n\n### Disable DCOM using Dcomcnfg.exe\n\nDCOM can be disabled by running Dcomcnfg.exe and clearing the \\\"Enable\nDistributed COM on this Computer\\\" checkbox within the Default\nProperties tab of the window. Afterwards, administrators should apply\nthe changes and restart the operating system for the changes to take\neffect. Dcomcnfg.exe can be further used to configure DCOM, including\naccess to highly sensitive\nobjects.\n\n### Block DCOM with Windows Firewall\n\nUnder appropriate circumstances, security teams may want to consider\nrestricting DCOM on systems by blocking port 135 to reduce DCOM\nfunctionality. DCOM uses port 135 for the initial session creation.\nBlocking port 135 will inhibit remote procedure call (RPC) and remote\nmanagement of endpoints disrupting communication between workstations\nand Domain Controllers and disrupting SMB file-sharing on Windows\nservers.\n\n### Harden Systems\n\nVerify that other mitigations that prevent an adversary from enabling DCOM or potentially performing other malicious activities are implemented alongside any decision to disable or restrict DCOM. This may require disabling the remote registry and implementing GPOs which harden access privileges.\n\n### Create DCOM Baseline\n\nSecurity teams should create a baseline for DCOM usage in their networks\nso anomalous DCOM activity can be detected.\n\n## References\n\n- How to disable DCOM support in Windows | <https://support.microsoft.com/en-us/topic/how-to-disable-dcom-support-in-windows-2bb8c280-9698-7f9c-bf67-2625a5873c7b>\n- New lateral movement techniques abuse DCOM technology | <https://www.cybereason.com/blog/dcom-lateral-movement-techniques>\n- KB5004442---Manage changes for Windows DCOM Server Security Feature Bypass (CVE-2021-26414) | <https://support.microsoft.com/en-us/topic/kb5004442-manage-changes-for-windows-dcom-server-security-feature-bypass-cve-2021-26414-f1400b52-c141-43d2-941e-37ed901c769c>\n- Lateral Movement using DCOM Objects - How to do it the right way? | <https://www.scorpiones.io/articles/lateral-movement-using-dcom-objects>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0013",
                "CM0019",
                "CM0020",
                "CM0025",
                "CM0042",
                "CM0100"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "support.microsoft.com",
                    "description": "How to disable DCOM support in Windows",
                    "url": "https://support.microsoft.com/en-us/topic/how-to-disable-dcom-support-in-windows-2bb8c280-9698-7f9c-bf67-2625a5873c7b"
                },
                {
                    "source_name": "www.cybereason.com",
                    "description": "New lateral movement techniques abuse DCOM technology",
                    "url": "https://www.cybereason.com/blog/dcom-lateral-movement-techniques"
                },
                {
                    "source_name": "support.microsoft.com",
                    "description": "KB5004442---Manage changes for Windows DCOM Server Security Feature Bypass (CVE-2021-26414)",
                    "url": "https://support.microsoft.com/en-us/topic/kb5004442-manage-changes-for-windows-dcom-server-security-feature-bypass-cve-2021-26414-f1400b52-c141-43d2-941e-37ed901c769c"
                },
                {
                    "source_name": "www.scorpiones.io",
                    "description": "Lateral Movement using DCOM Objects - How to do it the right way?",
                    "url": "https://www.scorpiones.io/articles/lateral-movement-using-dcom-objects"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0013",
            "name": "Block Windows Management Instrumentation (WMI) Service",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0013\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nBlocking the Windows Management Instrumentation (WMI) service blocks adversary discovery, persistence, and lateral movement using WMI.\n\n## Introduction\n\nWMI is the infrastructure for management data and operations on Windows-based operating systems. WMI may be used for incident response. For example, the opensource incident\nresponse tool CimSweep relies on CIM/WMI to perform incident response and hunting operations on Windows. By blocking endpoint access via WMI, adversaries will have one less means of moving laterally and execute payloads across the environment.\n\n## Preparation\n\n- Determine the scope of the impact that blocking WMI would have on operations and prepare contingency plan should unintended disruption occur.\n\n## Risks\n\n- This countermeasure may block legitimate activity.\n- Blocking WMI may prevent administrators from taking necessary actions, such as performing automated software updates, and may prevent hunting and IR tools from operating.\n- Consider the impact on the enterprise environment and the incident response before blocking WMI.\n\n## Guidance\n\n- WMI should be blocked to inhibit communication from workstation to workstation and blocked between workstations and non-Domain Controllers and File Servers.\n- The Group Management Console can be used to create a GPO to block WMI remote use. This can be achieved by configuring Windows Firewall to restrict inbound communications for WMI or by assigning a static DCOM port for WMI and blocking it (the default static port in this case is TCP 24158).\n\n## References\n\n- Windows Management Instrumentation (WMI) Offense, Defense, and Forensics | <https://www.mandiant.com/sites/default/files/2021-09/wp-windows-management-instrumentation.pdf>\n- Starting and stopping WMI service | <https://learn.microsoft.com/en-us/windows/win32/wmisdk/starting-and-stopping-the-wmi-service>\n- Setting up a Remote WMI Connection | <https://learn.microsoft.com/en-us/windows/win32/wmisdk/connecting-to-wmi-remotely-starting-with-vista>\n- Setting Up a Fixed Port for WMI | <https://learn.microsoft.com/en-us/windows/win32/wmisdk/setting-up-a-fixed-port-for-wmi>\n- Windows Management Instrumentation | <https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0012",
                "CM0015",
                "CM0019",
                "CM0032",
                "CM0038",
                "CM0039",
                "CM0096",
                "CM0097"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.mandiant.com",
                    "description": "Windows Management Instrumentation (WMI) Offense, Defense, and Forensics",
                    "url": "https://www.mandiant.com/sites/default/files/2021-09/wp-windows-management-instrumentation.pdf"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Starting and stopping WMI service",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/wmisdk/starting-and-stopping-the-wmi-service"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Setting up a Remote WMI Connection",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/wmisdk/connecting-to-wmi-remotely-starting-with-vista"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Setting Up a Fixed Port for WMI",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/wmisdk/setting-up-a-fixed-port-for-wmi"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Windows Management Instrumentation",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page"
                }
            ],
            "techniques": []
        },
        {
            "id": "CM0014",
            "name": "Disable Cisco Smart Install Feature",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0014\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling the Cisco Smart Install feature blocks adversary collection of\nnetwork configuration files and execution of arbitrary commands.\n\n## Introduction\n\nThe Cisco Smart Install Client is a legacy utility designed to allow\nno-touch installation of new Cisco equipment, specifically Cisco\nswitches. Adversaries may abuse this feature to access, copy, or poison\na client's startup-config file or maliciously modify the Cisco IOS to\nenable persistence.\n\n## Preparation\n\n- Upgrade Cisco devices to latest possible Internetworking Operating System (IOS) release.\n\n## Risks\n\n- This countermeasure increases the risk of breaking legitimate functionality.\n- Switch software updates and configuration changes must be performed manually when Smart Install is disabled. \n    - Manual operations increase the likelihood of errors that could cause network inaccessibility or downtime.\n    - Manual operations are more labor-intensive than over-the-network operations.\n- This countermeasure may result in excess resource use.\n\n## Guidance\n\n- Determine whether Smart Install is Enabled\n- Investigate Evidence of Smart Install Abuse\n    - Analyze traffic and device logs to determine whether unauthorized changes were made to startup-config, Cisco IOS, or the tfcp-server. \n    - Organizations should preserve a copy of the tampered configuration file or any additional evidence of abuse during the incident response investigation.\n- Isolate and Restore Affected Device(s)\n    - If network administrators determine a network device was abused, they should isolate the affected device from the network.\n    - Before bringing the device back online, teams should reverse changes made by the adversary by restoring the device's image and configuration to a secure state. This process may include the use of a known good configuration backup, performing a factory reset of the device, and ensuring the latest vendor patches are applied.\n- Restrict and/or Disable Smart Install\n    - Network administrators should verify Smart Install is using TCP port 4786 before then blocking it.\n    - If Smart Install cannot be disabled, organizations should implement interface access control lists (ACLs) and Control Plane Policing (CoPP) to drop traffic.\n- Harden\n    - System administrators should ensure all patches for known security vulnerabilities associated with their network devices are applied. \n    - Migrate to new technology to replace the Smart Install legacy protocol, specifically Cisco Network Plug and Play for securely configuring new switches.\n    - Network administrators should consult Cisco's Guide to Harden Cisco IOS Devices for additional instructions for improving device security.\n\n## References\n\n-   Smart Install Descriptions - Restrictions for Smart Install | <https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/concepts.html#23355>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisco.com",
                    "description": "Smart Install Descriptions - Restrictions for Smart Install",
                    "url": "https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/concepts.html#23355"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1190",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1602.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0015",
            "name": "Block Default Screensaver Programs and Monitor SCR Executable Files",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0015\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nBlocking default screensaver programs and monitoring SCR executable\nfiles restricts and detects adversary privilege escalation and\npersistence using malicious SCR files.\n\n## Introduction\n\nNo Introduction content identified.\n\n## Preparation\n\nNo Preparation content identified.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\n### Monitor\n\nConfigure Endpoint Detection and Response (EDR) tools to alert for execution of suspicious .scr files. \n\n- Monitor .scr files executed from non-standard locations (i.e., locations outside of C:\\Windows\\System32\\\\, C:\\Windows\\sysWOW64\\\\, C:\\Windows\\servicing\\LCU\\\\, and C:\\Windows\\WinSxS\\\\)\n- Monitor .scr files associated with unexpected modifications to registry hives (e.g., HKCU:\\Control\\Panel\\Desktop\\\\)\n- Monitor .scr files with nonstandard names (e.g., Bubbles.scr, Mystify.scr, scrnsave.scr).\n\n### Block\n\n- Block .scr Files at gateways\n- Use Group Policy Objects (GPOs) to disable default screensavers\n    - Disable the following: \n        - Enable screen saver\n        - Screen saver timeout\n        - Force specific screen saver\n    - Enable the following:\n        - Prevent changing screen saver\n\n## References\n\n- Persistence - Screensaver | <https://pentestlab.blog/2019/10/09/persistence-screensaver/>\n- Force Disable Screen Saver in Windows 10 | <https://winaero.com/force-disable-screen-saver-in-windows-10/>\n- Analysis of malicious Screen Saver files | <https://medium.com/@APT-410/analysis-of-malicious-screen-saver-files-adb3b7c01939>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0013",
                "CM0138"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "pentestlab.blog",
                    "description": "Persistence - Screensaver",
                    "url": "https://pentestlab.blog/2019/10/09/persistence-screensaver/"
                },
                {
                    "source_name": "winaero.com",
                    "description": "Force Disable Screen Saver in Windows 10",
                    "url": "https://winaero.com/force-disable-screen-saver-in-windows-10/"
                },
                {
                    "source_name": "medium.com",
                    "description": "Analysis of malicious Screen Saver files",
                    "url": "https://medium.com/@APT-410/analysis-of-malicious-screen-saver-files-adb3b7c01939"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1546",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0016",
            "name": "Remove Suspicious Property List (PLIST) Files",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0016\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving suspicious Property List (PLIST) files terminates adversary\ndefense evasion and persistence using modified PLIST files.\n\n## Introduction\n\nA PLIST (Property List) file is a file format used to store structured data on Apple\nplatforms, including macOS and iOS. Because these files are commonly\nused for storing configuration settings and preferences in XML, JSON, or\nbinary, adversaries may modify or introduce weaponized PLIST files to\nachieve persistence or manipulate them to execute malicious activities.\n\nMalicious PLIST files can be stored in a number of directories\nincluding:\n\n-   \\~/Library/LaunchAgents\n-   \\~/Library/LaunchAgent\n-   \\~/Library/LaunchDaemons\n-   \\~/Library/Application Support\n-   \\~/Library/Preferences\n-   \\~/Library/StartupItems\n\n## Preparation\n\n- Unhide the directories where malicious PLIST files are commonly stored.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Legitimate applications may store their configuration settings in a PLIST file that is under suspicion.\n- This countermeasure may not stop all ongoing adversary activity.\n- Adversaries may use multiple malicious PLIST files, and may have established other persistence mechanisms.\n\n## Guidance\n\n- Investigate Launch Agents and Launch Daemons as a means of achieving persistence on macOS.\n- Quarantine the suspicious PLIST file via the organization's anti-virus or endpoint detection and response. \n- Deploy tools to collect and analyze macOS data and artifacts (AutoMacTC, Aftermath, etc.)\n- If a PLIST file appears modified to trigger malicious action, investigate the process that modified the PLIST file for malicious properties.\n- Restrict unprivileged access to persistence directories (e.g., * ~/Library/LaunchAgents and ~/Library/LaunchDaemons)\n\n## References\n\n- About Information Property List Files | <https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/AboutInformationPropertyListFiles.html>\n- How Malware Persists on macOS | <https://www.sentinelone.com/blog/how-malware-persists-on-macos/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0022",
                "CM0120"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "developer.apple.com",
                    "description": "About Information Property List Files",
                    "url": "https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/AboutInformationPropertyListFiles.html"
                },
                {
                    "source_name": "www.sentinelone.com",
                    "description": "How Malware Persists on macOS",
                    "url": "https://www.sentinelone.com/blog/how-malware-persists-on-macos/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1543.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1543.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1647",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0017",
            "name": "Enable Port Filtering on Host-based Firewalls",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0017\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling port filtering on host-based firewalls restricts adversary\nlateral movement using subnet hosts.\n\n## Introduction\n\nOrganizations may be able to provide sufficient security through a combination of endpoint detection and response (EDR) and network access control (NAC) solutions on endpoints. However, using host-based firewalls in combination with EDR and NAC provides layered defense.\n\n## Preparation\n\n- Organizations should manage their host-based firewalls with a centrally-managed service, such as Windows Group Policy Management Console (GPMC) or an alternate vendor-provided solution. \n- System administrators should consult internal policies and vendor instructions on how to appropriately configure their host-based firewalls and any other relevant NAC software.\n- Host-based firewalls should be configured with a default deny rule, only allowing services and ports that are explicitly permitted.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Port filtering may block legitimate activity and break legitimate functionality.\n\n## Guidance\n\n### Windows\n\n- To verify whether host-based firewalls are enabled by default on all hosts in a subnet, system administrators can launch GPMC and verify whether a Group Policy Object (GPO) exists that manages the firewall settings on all machines in the respective organizational unit.\n- If host-based firewalls are not enabled by default on the affected subnet, organizations should identify the appropriate steps to isolate impacted systems from non-impacted systems and networks.\n\n### Mac\n\n- Each mobile device management (MDM) solution vendor may implement Mac firewall settings differently. Organizations that have introduced Macs into their environment should consult their vendor's documentation.\n\n## References\n\n- Open the Group Policy Management Console to Windows Firewall with Advanced Security | <https://learn.microsoft.com/en-us/windows/security/operating-system-security/network-security/windows-firewall/open-the-group-policy-management-console-to-windows-firewall-with-advanced-security>\n- Configure rules with group policy | <https://learn.microsoft.com/en-us/windows/security/operating-system-security/network-security/windows-firewall/configure>\n- A host-based firewall must be installed and enabled on the system. | <https://www.stigviewer.com/stig/microsoft_windows_server_2016/2021-03-05/finding/V-224846>\n- Firewall MDM payload settings for Apple devices | <https://support.apple.com/guide/deployment/firewall-payload-settings-dep8d306275f/web>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0019",
                "CM0020",
                "CM0025",
                "CM0042",
                "CM0141",
                "CM0143"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Open the Group Policy Management Console to Windows Firewall with Advanced Security",
                    "url": "https://learn.microsoft.com/en-us/windows/security/operating-system-security/network-security/windows-firewall/open-the-group-policy-management-console-to-windows-firewall-with-advanced-security"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Configure rules with group policy",
                    "url": "https://learn.microsoft.com/en-us/windows/security/operating-system-security/network-security/windows-firewall/configure"
                },
                {
                    "source_name": "www.stigviewer.com",
                    "description": "A host-based firewall must be installed and enabled on the system.",
                    "url": "https://www.stigviewer.com/stig/microsoft_windows_server_2016/2021-03-05/finding/V-224846"
                },
                {
                    "source_name": "support.apple.com",
                    "description": "Firewall MDM payload settings for Apple devices",
                    "url": "https://support.apple.com/guide/deployment/firewall-payload-settings-dep8d306275f/web"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562.004",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0018",
            "name": "Enable Active Directory (AD) Protected Users Security Group",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0018\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling the Active Directory (AD) Protected Users security group\nrestricts adversary lateral movement using protected user credentials.\n\n## Introduction\n\nThe Protected Users security group is designed as part of a strategy to\nmanage credential exposure within the enterprise. Members of this group\nautomatically have non-configurable protections applied to their\naccounts. Membership in the Protected Users group is meant to be\nrestrictive and proactively secure by default. The only method to modify\nthese protections for an account is to remove the account from the\nsecurity group.\n\n## Preparation\n\n- Confirm that primary domain controller is running at least Windows Server 2012 R2.\n- Confirm that client computers are running at least Windows 8.1 or Windows Server 2012 R2.\n- If systems to not meet above criteria, protected user group will not be available.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Adding Managed Service Accounts to \"Protected Users\" will break their functionality, by breaking Kerberos Constrained Delegation (KCD).\n- Responders are advised against this countermeasure for this reason.\n\n## Guidance\n\n- Add \"Admin\" to the Protected Users Group\n- Verify Protected User is Added\n- Best Practices\n    - The Protected Users Group protections may be replicated to OSes below Windows Server 2012 R2 if a Windows Server 2012 R2 or above is the Primary Domain Controller emulator.\n    - The Protected Users Group protections will not work for client devices that are NOT Windows 8.1.\n    - Maintain situational awareness on authentication attempts by reviewing \"Protected Users\" user and failure logs.\n    - Never add all privileged accounts to the Protected Users Group since there is potential to be locked out.\n\n## References\n\n- Guidance about how to configure protected accounts | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/how-to-configure-protected-accounts>\n- Ten things you need to be aware of before using the Protected Users Group | <https://dirteam.com/sander/2014/11/25/ten-things-you-need-to-be-aware-of-before-using-the-protected-users-group/>\n- Step-by-Step Guide to Active Directory \"Protected Users Security Group\" | <https://www.rebeladmin.com/step-step-guide-active-directory-protected-users-security-group/>\n- Protected Users Security Group | <https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0029",
                "CM0033",
                "CM0043",
                "CM0063",
                "CM0071",
                "CM0072",
                "CM0089",
                "CM0090",
                "CM0096",
                "CM0104",
                "CM0107",
                "CM0121",
                "CM0122",
                "CM0125"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Guidance about how to configure protected accounts",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/how-to-configure-protected-accounts"
                },
                {
                    "source_name": "dirteam.com",
                    "description": "Ten things you need to be aware of before using the Protected Users Group",
                    "url": "https://dirteam.com/sander/2014/11/25/ten-things-you-need-to-be-aware-of-before-using-the-protected-users-group/"
                },
                {
                    "source_name": "www.rebeladmin.com",
                    "description": "Step-by-Step Guide to Active Directory \"Protected Users Security Group\"",
                    "url": "https://www.rebeladmin.com/step-step-guide-active-directory-protected-users-security-group/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Protected Users Security Group",
                    "url": "https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group"
                }
            ],
            "techniques": []
        },
        {
            "id": "CM0019",
            "name": "Disable or Restrict Windows Remote Management (WinRM) Protocol",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0019\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling or restricting the Windows Remote Management (WinRM) protocol\nblocks or restricts adversary lateral movement using WS-Management\n(WSMan) remoting in PowerShell.\n\n## Introduction\n\nWinRM may be required on select machines during incident response so that PowerShell remoting can be used to collect data from endpoints. This countermeasure discusses the disabling of WinRM, however, if certain systems require the protocol, establish a separate WinRM infrastructure complete with separate WinRM accounts and permissions.\n\n## Preparation\n\n- Establish and review the baseline behavior of WinRM in the environment.\n- Determine necessity of permitting WinRM in the environment.\n- Follow WinRM best practices on use of host firewalls to restrict WinRM access to/from specific devices.\n- Enable firewall auditing to track changes made to the firewall exceptions policy and receive alerts if WinRM is enabled.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Disabling the WinRM protocol will limit usage of tools and services that require WS-Management/WINRM for PowerShell Remoting (including IR tools such as KANSA and PowerForensics).\n\n## Guidance\n\n### Disable WinRM\n\n- WinRM can be disabled by executing PowerShell commands or by configuring the Group Policy (GP).\n- Disable firewall exceptions for WS-Management communications. \n\n### Restrict WinRM\n\n- If WinRM must be enabled, configure the GP via the GPMC. \n\n### Monitor WinRM\n\n- Leverage Windows Event Logs to monitor for hosts that initialize (Event ID 6) and receive (Event ID 91) WinRM connections.     \n- Use PowerShell module logging (Event ID 4103) to investigate what was executed after the WinRM connection was made.\n\n## References\n\n- Windows Remote Management | <https://learn.microsoft.com/en-us/windows/win32/winrm/portal>\n- Security considerations for PowerShell Remoting using WinRM | <https://learn.microsoft.com/en-us/powershell/scripting/learn/remoting/winrmsecurity>\n- Installation and configuration for Windows Remote Management | <https://learn.microsoft.com/en-us/windows/win32/winrm/installation-and-configuration-for-windows-remote-management>\n- Disable-PSRemoting | <https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/disable-psremoting>\n- Ransomware Protection and Containment Strategies: Practical Guidance for Endpoint Protection, Hardening, and Containment | <https://cloud.google.com/blog/topics/threat-intelligence/ransomware-protection-and-containment-strategies/>\n- Investigating PowerShell Attacks | <https://www.mandiant.com/sites/default/files/2021-09/wp-lazanciyan-investigating-powershell-attacks.pdf>\n- Disable PowerShell remoting: Disable-PSRemoting, WinRM, listener, firewall, LocalAccountTokenFilterPolicy | <https://4sysops.com/archives/disable-powershell-remoting-disable-psremoting-winrm-listener-firewall-and-localaccounttokenfilterpolicy/>\n- Securing PowerShell in the Enterprise | <https://www.cyber.gov.au/resources-business-and-government/maintaining-devices-and-systems/system-hardening-and-administration/system-administration/securing-powershell-enterprise>\n- 18.10.89.1.3 (L1) Ensure 'Disallow Digest authentication' is set to 'Enabled' | <https://www.tenable.com/audits/items/CIS_Microsoft_Windows_Server_2019_STIG_v2.0.0_L1_MS.audit:4bea4f57951af345a039dd713431eeef>\n- 18.10.88.2.2 (L2) Ensure 'Allow remote server management through WinRM' is set to 'Disabled' | <https://www.tenable.com/audits/items/CIS_Microsoft_Windows_11_Stand-alone_v3.0.0_L2_BL.audit:d8dcd7935901b03d13a43119fa7af50f>\n- 18.10.89.2.4 (L1) Ensure 'Disallow WinRM from storing RunAs credentials' is set to 'Enabled' | <https://www.tenable.com/audits/items/CIS_DC_SERVER_2012_Level_1_v3.0.0.audit:8b4ecce5f7751760d031ef407d50a6fd>\n- 18.9.97.1.1 Ensure 'Allow Basic authentication' is set to 'Disabled' - Client | <https://www.tenable.com/audits/items/CIS_MS_Windows_7_v3.2.0_Level_1.audit:1e60e54b01648b82c665f8e42f7dd20d>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0012",
                "CM0013",
                "CM0017",
                "CM0020",
                "CM0025",
                "CM0042",
                "CM0052",
                "CM0096",
                "CM0098"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Windows Remote Management",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/winrm/portal"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Security considerations for PowerShell Remoting using WinRM",
                    "url": "https://learn.microsoft.com/en-us/powershell/scripting/learn/remoting/winrmsecurity"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Installation and configuration for Windows Remote Management",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/winrm/installation-and-configuration-for-windows-remote-management"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Disable-PSRemoting",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/disable-psremoting"
                },
                {
                    "source_name": "cloud.google.com",
                    "description": "Ransomware Protection and Containment Strategies: Practical Guidance for Endpoint Protection, Hardening, and Containment",
                    "url": "https://cloud.google.com/blog/topics/threat-intelligence/ransomware-protection-and-containment-strategies/"
                },
                {
                    "source_name": "www.mandiant.com",
                    "description": "Investigating PowerShell Attacks",
                    "url": "https://www.mandiant.com/sites/default/files/2021-09/wp-lazanciyan-investigating-powershell-attacks.pdf"
                },
                {
                    "source_name": "4sysops.com",
                    "description": "Disable PowerShell remoting: Disable-PSRemoting, WinRM, listener, firewall, LocalAccountTokenFilterPolicy",
                    "url": "https://4sysops.com/archives/disable-powershell-remoting-disable-psremoting-winrm-listener-firewall-and-localaccounttokenfilterpolicy/"
                },
                {
                    "source_name": "www.cyber.gov.au",
                    "description": "Securing PowerShell in the Enterprise",
                    "url": "https://www.cyber.gov.au/resources-business-and-government/maintaining-devices-and-systems/system-hardening-and-administration/system-administration/securing-powershell-enterprise"
                },
                {
                    "source_name": "www.tenable.com",
                    "description": "18.10.89.1.3 (L1) Ensure 'Disallow Digest authentication' is set to 'Enabled'",
                    "url": "https://www.tenable.com/audits/items/CIS_Microsoft_Windows_Server_2019_STIG_v2.0.0_L1_MS.audit:4bea4f57951af345a039dd713431eeef"
                },
                {
                    "source_name": "www.tenable.com",
                    "description": "18.10.88.2.2 (L2) Ensure 'Allow remote server management through WinRM' is set to 'Disabled'",
                    "url": "https://www.tenable.com/audits/items/CIS_Microsoft_Windows_11_Stand-alone_v3.0.0_L2_BL.audit:d8dcd7935901b03d13a43119fa7af50f"
                },
                {
                    "source_name": "www.tenable.com",
                    "description": "18.10.89.2.4 (L1) Ensure 'Disallow WinRM from storing RunAs credentials' is set to 'Enabled'",
                    "url": "https://www.tenable.com/audits/items/CIS_DC_SERVER_2012_Level_1_v3.0.0.audit:8b4ecce5f7751760d031ef407d50a6fd"
                },
                {
                    "source_name": "www.tenable.com",
                    "description": "18.9.97.1.1 Ensure 'Allow Basic authentication' is set to 'Disabled' - Client",
                    "url": "https://www.tenable.com/audits/items/CIS_MS_Windows_7_v3.2.0_Level_1.audit:1e60e54b01648b82c665f8e42f7dd20d"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021.006",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1059.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0020",
            "name": "Disable Virtual Network Computing (VNC) Desktop-sharing System",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0020\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling the Virtual Network Computing (VNC) desktop-sharing system\nblocks adversary lateral movement using VNC.\n\n## Introduction\n\nVirtual Network Computing (VNC) is a graphical desktop-sharing system\nthat uses the Remote Frame Buffer protocol (RFB) to remotely control\nanother computer, relaying keyboard and mouse input to a server from a\nclient. Implementers of this countermeasure can consult available documentation\nfor different VNC implementations (LibVNC, TightVNC, UltraVNC, RealVNC).\n\n## Preparation\n\n- Identify organizational components that use the VNC system to perform remote troubleshooting, server management, and remote work and inform them that the system will be disabled.\n- Ensure access to critical endpoints will remain accessible before disabling VNC, particularly if operational technology for critical infrastructure is in use.\n- Coordinate with administrators to determine the extent VNC is used for administrative tasking.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Disabling VNC will limit remote access to endpoints (follow guidelines in Preparation section).\n- This countermeasure may not stop all ongoing activity.\n- Disabling VNC will not prevent remote access if other means of remote access, such as RDP, are still available and unsecure.\n\n## Guidance\n\n### Kill the VNC Service\n\n- If VNC cannot be found but is being used by the adversary, hunt for suspicious processes that may be obfuscated VNC services. For guidance, see CM0023 - Identify and Terminate Suspicious Process.\n\n### Block VNC traffic via Firewall\n\n- By default, VNC uses TCP ports 5900 for the server, 5800 for browser access, and 5500 for a viewer in listening mode. Host and network inbound and outbound rules can be configured to deny VNC access.\n\n### Disable VNC Service via GPO\n\n- Create a new Group Policy Object (GPO) or edit an existing GPO in the Group Policy Management Console to disable the VNC service.\n- After establishing this GPO, link it to the appropriate Organizational Unit (OU) and apply the update to all relevant computers.\n\n### Block Execution of VNC.exe\n\n- Third-party endpoint protection software can be used to define a rule to block the execution of vnc.exe.\n- Windows Attack Surface Reduction (ASR) rules can also be used to block the execution of specific processes, including VNC.exe. For instructions on using ASR, see RM000X.\n\n## References\n\n- Setting up VNC Connect for Maximum Security | <https://help.realvnc.com/hc/en-us/articles/360002253278-Setting-up-VNC-Connect-for-Maximum-Security>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0012",
                "CM0017",
                "CM0019",
                "CM0025",
                "CM0032",
                "CM0042",
                "CM0048",
                "CM0052",
                "CM0062",
                "CM0098"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "help.realvnc.com",
                    "description": "Setting up VNC Connect for Maximum Security",
                    "url": "https://help.realvnc.com/hc/en-us/articles/360002253278-Setting-up-VNC-Connect-for-Maximum-Security"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1021.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1071",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0021",
            "name": "Enable Behavioral and Heuristic-based Malware Detection",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0021\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling behavioral and heuristic-based malware detection detects adversary execution of malicious code.\n\n## Introduction\n\nBehavioral and heuristic-based malware detection software employs methods beyond the identification of specific file signatures or hashes to alert on and react to malware and malicious behavior. These methods rely on either a rules-based or weight-based approach. Behavioral-based\napproaches typically detect anomalous behaviors such as unusual network traffic, abnormal file access patterns, system events, and/or atypical process behavior. Heuristic methods use data mining and machine learning to analyze features such as API calls, Operational Code, N-Grams, and\nControl Graph Flow.\n\n## Preparation\n\n- Understand the scope and responsibilities of the hunt.\n- Determine whether additional resources or tooling will need to be allocated, provisioned, or acquired to enhance hunt practices.\n- Prepare and document clear policies and procedures for investigating and handling malware samples and compromised systems.\n\n## Risks\n\n- This countermeasure may result in excessive resource use.\n- Deploying new tools may result in a labor-intensive integration effort, while deploying new rulesets may require careful tuning and updates. This may overburden responders and operators.\n- The tools may consume excessive amounts of CPU or memory on workstations, degrading performance.\n- Assess the impact of deploying new tools before large-scale deployments.\n\n## Guidance\n\n- While deploying malware detection tools may often be thought of as strictly a preventative measure, leveraging them during incident response to alert on recently observed behaviors can still prove valuable for acquiring greater visibility into potential living-off-the-land techniques subsequently executed by the adversary. \n\n\t- Security operations should update their behavioral rulesets with new alerts based on observed adversary activities, malware behaviors in detonation chambers, or recommendations made from the security community. \n\n- Step-by-step instructions for deploying new detection tools and technologies in the aftermath of an incident is beyond the scope of this countermeasure. Security operators should reflect on their unique organizational requirements and consult with the appropriate experts and vendors to enhance their security when considering new heuristic and behavioral technologies following an incident.\n\n## References\n\n- Accuracy, Precision, Recall or F1? | <https://towardsdatascience.com/accuracy-precision-recall-or-f1-331fb37c5cb9>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0022"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "towardsdatascience.com",
                    "description": "Accuracy, Precision, Recall or F1?",
                    "url": "https://towardsdatascience.com/accuracy-precision-recall-or-f1-331fb37c5cb9"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1027.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0022",
            "name": "Quarantine Suspicious Files",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0022\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nQuarantining suspicious files terminates adversary execution of malware.\n\n## Introduction\n\nQuarantining suspicious files involves relocating files to a location\nwhere any harm that can be caused by malicious files is mitigated. This\nwill allow an organization to analyze suspicious files while mitigating\npotential further harm to any other systems. \n\nAn example of a security solution that can safely quarantine a file is Microsoft Defender, which can quarantine files automatically and manually depending on the configuration implemented.\n\n## Preparation\n\n- Determine a location where suspicious files can be quarantined to limit any harm that can be done by a malicious file. \n    - Many specialized software solutions that can safely quarantine a file offer options to specify where a quarantined file should be placed.\n    - Some solutions only allow quarantining to a preselected, default location. \n    - Many antivirus/security solutions offer quarantine locations ready to be used without any configuration.\n    - Quarantine environments are generally characterized by a storage location where files have strict permissions. \n    - Ensure access to the quarantine location is restricted to authorized personnel only.\n- Determine a naming convention to help identify files and relevant information (date of detection, location origin, etc.).\n- Configure security solutions so that only one security solution is leveraged to quarantine files to avoid conflicting attempts by different solutions to quarantine any file.\n- If an Endpoint Detection and Response (EDR) or Antivirus (AV) is being used, the appropriate solution's documentation should be referenced to understand the methods implemented when quarantining a Potentially Unwanted Application (PUA)/Potentially Unwanted Program (PUP).\n    - Understanding a security solution's implementation of file quarantining along with an understanding of a file's behavior is key to ensuring a file is quarantined properly.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- False positives can result in quarantining a legitimate file.\n- This countermeasure may not stop all ongoing activity.\n- False negatives can result in a malicious file remaining outside of quarantine.\n- Errors can render this countermeasure ineffective.\n- Malicious files may escape quarantine and continue to operate.\n\n## Guidance\n\n- Moving suspicious files\n    - Use AV/EDR solutions to manually flag or quarantine a suspicious file that were not marked automatically by the AV/EDR solution.\n    - Relocate suspicious files to a location that has been secured and mitigates any potential harm that can be caused by malicious files.\n- Logging relevant information\n    - Log information related to any quarantined files (source of the file, flags that were raised, etc.) to aid in analysis efforts.\n- Post-quarantine\n    - Analyze suspicious files to determine whether they are benign or malicious. If a file cannot be determined to be benign or malicious after analysis efforts, a decision should be made to delete the file or release it from quarantine after considering the risks of either option.\n    - If a file is determined to be malicious, it should be analyzed further to identify characteristics that can be leveraged to further fine-tune defenses and to defend against further compromise.\n    - If a file has been confirmed to be benign, then it can be released from quarantine.\n\n## References\n\n- Computer Security Incident Handling Guide | <https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf>\n- Cybersecurity Incident & Vulnerability Response Playbooks | <https://www.cisa.gov/sites/default/files/2024-08/Federal_Government_Cybersecurity_Incident_and_Vulnerability_Response_Playbooks_508C.pdf>\n- Take response actions on a file | <https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/respond-file-alerts>\n- VirusTotal | <https://www.virustotal.com/gui/home/upload>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0003",
                "CM0016",
                "CM0021",
                "CM0065",
                "CM0066",
                "CM0105",
                "CM0110",
                "CM0185"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "nvlpubs.nist.gov",
                    "description": "Computer Security Incident Handling Guide",
                    "url": "https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "Cybersecurity Incident & Vulnerability Response Playbooks",
                    "url": "https://www.cisa.gov/sites/default/files/2024-08/Federal_Government_Cybersecurity_Incident_and_Vulnerability_Response_Playbooks_508C.pdf"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Take response actions on a file",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/respond-file-alerts"
                },
                {
                    "source_name": "www.virustotal.com",
                    "description": "VirusTotal",
                    "url": "https://www.virustotal.com/gui/home/upload"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1036",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0023",
            "name": "Identify and Terminate Suspicious Processes",
            "subtype": "Examine, Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0023\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nIdentifying and terminating suspicious processes terminates adversary\nexecution of malware.\n\n## Introduction\n\nSuspicious or anomalous processes include unrecognized process names,\nespecially names that imitate a legitimate or benign system processes or\nappear randomly generated. Characteristics os suspicious processes\ninclude: \n\n- Processes with no icon, version information, description, or company name. \n- Processes that are unsigned, especially a process with a company name like Microsoft Corporate that is also unsigned. \n- Processes hosted by service host executables and other Windows utilities without a valid parent-child relationship with the principal Windows processes. \n- Processes that have used compression as compressed code may indicate obfuscation or encryption. Processes explorer highlights these in purple.\n\n## Preparation\n\n- Disconnect the system from the network.\n- Ensure that sanitized and approved backups are available.\n- Create forensic image of the machine.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Terminating legitimate processes may impact system or application operation.\n\n## Guidance\n\n### Investigate Suspicious or Anomalous Processes\n\nExamine how the process interacts with the Registry, the file system, and on the network. Seek to answer the following questions:\n\n- How is the process launched?\n- What files is it manipulating?\n- Is the process restored on reboot? If so, how?\n- Is system privilege inhibiting the ability to terminate or access the process?\n- Is the process associated with any ports? Is the process communicating with any domains or IP subnets?\n- If the process is legitimate but acting in an unusual way, could the process be injected with malicious code? What would the impact of suspending or terminating a hijacked legitimate process?\n\n### Terminate Suspicious or Anomalous Process\n\n- Contain the affected system.  Consider the impact of disconnecting the affected system from the network.  If viable, disconnect the affected system from the network.  \n- Collect information about the affected system and suspicious process.  Take a system image and/or dump process information from memory prior to terminating the process and repairing the compromised system. \n- Terminate the suspended process only if doing so is necessary to begin the remediation process.  Remove relevant persistence mechanisms (auto-start locations, scheduled tasks, registry keys, etc.) This may require reverting the affected system to a known secure baseline and reinstalling the operating system. \n- Reboot the system and monitor for the existence of the process and anomalous network activity.  If suspicious activity persists, consider reinstalling the operating system and applications with an approved secure baseline.  Continued persistence may indicate firmware or software supply chain compromise.  \n- Readmit the system into the production environment only after hardening and continuing to closely monitor.\n\n## References\n\nNo References content identified.",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0002",
                "CM0024",
                "CM0030",
                "CM0034",
                "CM0049",
                "CM0065",
                "CM0123",
                "CM0135",
                "CM0147"
            ],
            "automatable": "unspecified",
            "references": [],
            "techniques": [
                {
                    "tech_id": "T1055",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1543",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0024",
            "name": "Disconnect Internet-facing Boundary Controllers",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0024\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nDisconnecting Internet-facing boundary controllers terminates adversary\nexfiltration and command and control via the Internet.\n\n## Introduction\n\nDisconnecting an enterprise from the Internet is a significant mitigation\nstep that involves physically or logically isolating the enterprise's\nsystems and data. Disconnection is sometimes necessary to limit the harm a potential/confirmed infection can cause to an organization. Extreme caution should be taken while implementing this countermeasure.\n\nPerforming an \"all-at-once\" disconnection of an enterprise network will stop communications between infected devices and the outside network. This has the potential added benefit of catching an adversary off-guard, thus limiting the response an adversary can prepare\nor implement. While the enterprise network is disconnected from the\nInternet, exfiltration of data/live control of any infected devices\nwithin a network will be prevented. This will give incident responders\ntime to investigate and remediate any security incidents.\n\n## Preparation\n\n- Identify critical business & security systems.\n- Identify systems that cannot be disconnected from the Internet. Identifying such systems ahead of time will lessen the countermeasure's business impact. \n- Develop a comprehensive plan that includes:\n    - A complete list of business tasks that will be impacted, along with a list of temporary workarounds.\n    - Alternative communication methods in case of communication impact.\n    - Steps required to restore Internet connectivity.\n    - List of personnel to coordinate with prior, during, and after disconnection takes place.\n    - An estimated timeline to aid in investigation and planning.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Disconnecting an enterprise from the Internet will likely cause business interruption.\n- Any Internet connections left active can reduce or eliminate the effectiveness of the countermeasure.\n\n## Guidance\n\n### Physical Disconnect\n\n- Physically disconnecting any infected or suspected infected networks from the Internet is a straightforward method to carry out this mitigation. The exact steps for this will be dependent on the architecture of a network as well as the hardware deployed. \n- A thorough understanding of an organization's network architecture is key to implementing this mitigation correctly.\n\n### Logical Disconnect\n\n- In some cases, a complete physical disconnection from the Internet is not feasible. For these situations, logical disconnection can be implemented at the firewall level by introducing firewall rules that will drop traffic to and from infected systems. This can be done by identifying infected endpoints and blocking/dropping packets designated to or from unique identifiable information (IP, MAC, etc.). \n- The proper documentation for the deployed firewall solution should be consulted for specific guidance on how to create these firewall rules.\n\n## References\n\n- Cybersecurity Incident & Vulnerability Response Playbooks | <https://www.cisa.gov/sites/default/files/2024-08/Federal_Government_Cybersecurity_Incident_and_Vulnerability_Response_Playbooks_508C.pdf>\n- Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise | <https://www.cisa.gov/news-events/analysis-reports/ar21-134a>\n- Remediating Networks Affected by the SolarWinds and Active Directory/M365 Compromise: Risk Decisions for Leaders | <https://www.cisa.gov/sites/default/files/publications/CISA_Insights_SolarWinds-and-AD-M365-Compromise-Risk-Decisions-for-Leaders_0.pdf>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0023",
                "CM0065",
                "CM0071",
                "CM0106",
                "CM0273",
                "CM0274",
                "CM0276"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisa.gov",
                    "description": "Cybersecurity Incident & Vulnerability Response Playbooks",
                    "url": "https://www.cisa.gov/sites/default/files/2024-08/Federal_Government_Cybersecurity_Incident_and_Vulnerability_Response_Playbooks_508C.pdf"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise",
                    "url": "https://www.cisa.gov/news-events/analysis-reports/ar21-134a"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "Remediating Networks Affected by the SolarWinds and Active Directory/M365 Compromise: Risk Decisions for Leaders",
                    "url": "https://www.cisa.gov/sites/default/files/publications/CISA_Insights_SolarWinds-and-AD-M365-Compromise-Risk-Decisions-for-Leaders_0.pdf"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1036",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1587.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0025",
            "name": "Disable Remote Desktop Protocol (RDP)",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0025\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling the Remote Desktop Protocol (RDP) blocks adversary initial\naccess and lateral movement using RDP.\n\n## Introduction\n\nRDP, also known as terminal services, allows users to remotely connect\nfrom one computer to another. This countermeasure disables RDP, but if\nRDP is needed, it should be made accessible to users via a secure\nvirtual private network (VPN) connection after authenticating via\nmulti-factor authentication (MFA) or through a zero-trust remote access\ngateway. Furthermore, if RDP access cannot be disabled, security teams should \nrotate RDP passwords and eliminate systems running RDP where possible.\n\n## Preparation\n\n- Assess the impact to operations if RDP is disabled or restricted.\n- Conduct risk assessment to understand whether potential disruption outweighs consequences of continued adversary access.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Disabling RDP can disrupt legitimate business functions.\n\n## Guidance\n\n- By default, RDP communicates over port 3389. System administrators should consider blocking RDP for all users that don't belong to specific approved security groups.\n- RDP can be disabled via GPO or on specific hosts via PowerShell and the Windows Firewall.\n\n## References\n\n- Ransomware Protection and Containment Strategies: Practical Guidance for Endpoint Protection, Hardening, and Containment | <https://cloud.google.com/blog/topics/threat-intelligence/ransomware-protection-and-containment-strategies/>\n- Integrate your Remote Desktop Gateway infrastructure using the Network Policy Server (NPS) extension and Microsoft Entra ID | <https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-nps-extension-rdg>\n- Configure remote access client account lockout | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/configure-remote-access-client-account-lockout>\n- Remote Desktop Services must be configured with the client connection encryption set to the required level. | <https://stigviewer.com/stig/windows_10/2020-06-15/finding/V-63741>\n- Establishing a Baseline for Remote Desktop Protocol | <https://cloud.google.com/blog/topics/threat-intelligence/establishing-baseline-remote-desktop-protocol/>\n- Deny log on through Remote Desktop Services | <https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/deny-log-on-through-remote-desktop-services>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0012",
                "CM0017",
                "CM0019",
                "CM0020",
                "CM0036",
                "CM0042"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "cloud.google.com",
                    "description": "Ransomware Protection and Containment Strategies: Practical Guidance for Endpoint Protection, Hardening, and Containment",
                    "url": "https://cloud.google.com/blog/topics/threat-intelligence/ransomware-protection-and-containment-strategies/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Integrate your Remote Desktop Gateway infrastructure using the Network Policy Server (NPS) extension and Microsoft Entra ID",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-nps-extension-rdg"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Configure remote access client account lockout",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/configure-remote-access-client-account-lockout"
                },
                {
                    "source_name": "stigviewer.com",
                    "description": "Remote Desktop Services must be configured with the client connection encryption set to the required level.",
                    "url": "https://stigviewer.com/stig/windows_10/2020-06-15/finding/V-63741"
                },
                {
                    "source_name": "cloud.google.com",
                    "description": "Establishing a Baseline for Remote Desktop Protocol",
                    "url": "https://cloud.google.com/blog/topics/threat-intelligence/establishing-baseline-remote-desktop-protocol/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Deny log on through Remote Desktop Services",
                    "url": "https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/deny-log-on-through-remote-desktop-services"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1049",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1071",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1219",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1563.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1570",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1572",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0026",
            "name": "Reboot Servers",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0026\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRebooting servers blocks adversary initial access using patched\nvulnerabilities and restricts adversary execution of fileless malware.\n\n## Introduction\n\nNo Introduction content identified.\n\n## Preparation\n\n- Establish which users need to be notified of reboots.\n- Reboot systems at times that will minimize disruption.\n\n## Risks\n\nThis countermeasure may have impacts that disrupt operations, including:\n\n-   Downtime - Rebooting a server can result in downtime for the applications or services that are hosted on that server. This can impact the productivity of the organization and potentially lead to revenue losses.\n-   Data loss - If a server is not properly backed up before rebooting, there is a risk of data loss if the server fails to restart properly or if there are any issues during the reboot process.\n-   Application compatibility issues - Some applications may not be compatible with the latest software versions and security patches that are installed during the reboot process. This can result in application failures or compatibility issues that can impact the productivity of the organization.\n\nThis countermeasure may introduce vulnerabilities, including:\n\n-   Configuration errors - In some cases, rebooting a server can result in configuration errors that can impact the functionality of the server or its applications. This can result in additional downtime and potentially require further troubleshooting and maintenance.\n-   Security risks - Rebooting a server can temporarily disable security features such as firewalls or intrusion detection systems, which can leave the server vulnerable to attacks during the reboot process.\n-   Preventing Recovery - If system(s) are infected with ransomware, rebooting a compromised system risks restarting tripped up/stuck ransomware or malware scheduled to activate on rebooting. Moreover, any artifacts saved to memory, such as potential decryption keys on some ransomware variants, will be lost of a system is rebooted. Rebooting the system may only be appropriate to clear memory resident malware that is unlikely to cause data loss.\n\n## Guidance\n\n- Schedule reboots during off-peak hours.\n- Notify users and stakeholders in advance of any planned system reboots to minimize any potential disruptions or downtime.\n- After the system has been rebooted, test all applications and services to ensure that they are functioning properly.\n- Monitor the system after the reboot to ensure that it is running smoothly and that there are no issues or errors.\n- Keep the system and its applications up to date with the latest software versions and security patches to minimize the risk of any compatibility issues or security vulnerabilities.\n\n## References\n\n- Experts: Don't reboot your computer after you've been infected with ransomware | <https://www.zdnet.com/article/experts-dont-reboot-your-computer-after-youve-been-infected-with-ransomware/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0066",
                "CM0067",
                "CM0086"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.zdnet.com",
                    "description": "Experts: Don't reboot your computer after you've been infected with ransomware",
                    "url": "https://www.zdnet.com/article/experts-dont-reboot-your-computer-after-youve-been-infected-with-ransomware/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1563.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1563.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1592.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1592.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1592.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1595.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0027",
            "name": "Rebuild Compromised Host",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0027\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRebuilding a compromised host terminates adversary persistence, command\nand control, and execution using the compromised host.\n\n## Introduction\n\nReimaging involves restoring the systems to their original state by reverting to a clean image which can help remove malware and associated artifacts. Rebuilding systems can be resource intensive and involves restoring systems to their original state by comprehensively rebuilding different aspects or parts of a system to a previous desired point (files, programs, settings, etc.).\n\n## Preparation\n\n- Determine the scope and impact of the incident to identify which systems need to be reimaged/rebuilt. \n    - It is imperative to accurately determine the scope of a compromise to eliminate the ability for adversaries to maintain access past an initial response to a compromise. Without this, the potential for a drawn out and reactionary (as opposed to proactive) engagement of repeatedly removing an adversary's access increases.\n- Identify and prepare clean Operating System (OS) images, application installations, and files for restoration and recovery efforts.\n    - Confirm the integrity of any clean images/software prior to use, to avoid the risk of re-infection.\n    - Checks must verify that no infection or malicious files are present.\n- Check for available backups to minimize data loss. \n    - If a backup of critical data on an impacted system does not existed, performing one should be done with extreme caution. Attempts at preserving any data on an impacted system runs the risk of preserving compromised data, allowing persistence of adversaries, and carrying over any general compromises to the reimaged system. \n    - Confirm backups are free of compromise. \n    - Any data that is attempted to be backed up should be examined extremely carefully and thoroughly prior to use.\n\n## Risks\n\n- This countermeasure may have impacts that disrupt operations, including\n    - Data loss: Data entered since the last clean backup may be lost.\n    - Business disruption: Downtime during business hours may disrupt business.\n- Errors can render this countermeasure ineffective.\n\n## Guidance\n\nThe specifics for rebuilding or performing a reimage of impacted systems will vary with each scenario. The following steps are considered best practices but do not represent an exhaustive list, and a security professional should be consulted to create and execute a comprehensive Rebuilding/Reimaging plan.\n\n- Verify the integrity of selected clean images/software\n    - Images/software used in rebuilding/reimaging efforts must be clean and free from infection/issues.\n- Securely wipe affected systems\n    - Identify an appropriate solution to securely wipe affected systems. Many specialized software solutions are available that are designed for this.\n- Reinstall resources for affected systems (software, operating systems, etc.)\n    - Utilize a verified clean image/copy to reinstall the operating system/software.\n    - Many systems provide specific guidance on how to properly reinstall operating systems or software and appropriate documentation should be consulted to ensure the best results.\n- Deploy any necessary patches\n\n## References\n\n- Computer Security Incident Handling Guide | <https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf>\n- Cybersecurity Incident & Vulnerability Response Playbooks | <https://www.cisa.gov/sites/default/files/2024-08/Federal_Government_Cybersecurity_Incident_and_Vulnerability_Response_Playbooks_508C.pdf>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0059",
                "CM0065",
                "CM0066",
                "CM0067",
                "CM0081",
                "CM0137",
                "CM0449"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "nvlpubs.nist.gov",
                    "description": "Computer Security Incident Handling Guide",
                    "url": "https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "Cybersecurity Incident & Vulnerability Response Playbooks",
                    "url": "https://www.cisa.gov/sites/default/files/2024-08/Federal_Government_Cybersecurity_Incident_and_Vulnerability_Response_Playbooks_508C.pdf"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1037",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1053",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1092",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1105",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1136.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1137",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1176",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1203",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1204",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1543",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1547",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1554",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1568",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1569",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1574",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1653",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1659",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0028",
            "name": "Reset Service Account Passwords",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0028\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting service account passwords restricts adversary persistence and lateral movement using valid accounts.\n\n## Introduction\n\nThere are different types of service accounts: built-in service accounts, traditional service accounts, and managed service accounts.\nPlease refer to the Microsoft Service Account Selection Matrix below which provides guidance for what and when a particular service account should be used. \n\n| Criterion | gMSA | sMSA | Computer Account | User account |\n|-----------|------|------|------------------|--------------|\n| App runs on a single server | Yes | Yes. Use a gMSA if possible | Yes. Use an MSA if possible | Yes. Use an MSA if possible |\n| App runs on multiple servers | Yes | No | No. Account is tied to the server. | Yes. Use an MSA if possible. |\n| App runs behind a load balancer | Yes | No | No | Yes. Use only if you can't use a gMSA. |\n| App runs on Windows Server 2008 R2 | No | Yes | Yes. Use an MSA if possible | Yes. Use an MSA if possible |\n| App runs on Windows Server 2012 | Yes | Yes. Use a gMSA if possible | Yes. Use an MSA if possible. | Yes. Use an MSA if possible. |\n| Requirement to restrict service account to single server | No | Yes | Yes. Use an sMSA if possible. | No |\n\nIn summary:\n\n-   All Service Accounts: Any Windows Desktop Operating System (preferably attached to Active Directory)\n-   Windows 2008 R2 and Above:  Virtual Service Account or Standalone Managed Service Account\n-   Windows 2012 and Above: Group Managed Service Account\n\n## Preparation\n\nDocumentation or knowledge of the purpose of the service accounts and potential impacts of a password reset is necessary to handle risks.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n\n- Resetting Service Account passwords may cause crashes in ongoing processes that have dependencies on services that require authentication. For example, processes that depend on scheduled tasks will fail to execute due to password changes.\n\n## Guidance\n\n### Built-in Service Accounts\n\nThe accounts in this section do not have a password. Built-in service\naccounts are: System Account, NetworkService Account, and\nLocalService Account. These accounts do not appear in User\nManagement and cannot be added to groups in AD, but can be viewed in\nService Control Manager (SCM). Service Control Manager can be accessed\nby pressing \"Windows + R\" to access the Run dialog box and entering\n\"services.msc\".\n\n### Traditional Service Accounts\n\nA \"traditional\" service account is a standard user account configured to\nrun one or more services. Administrators and users may use their account\nto run services because it is quicker and more convenient. However, this\nwill lead to issues when trying to track down which accounts are\nassociated with which services. Another issue that arises is creating a\nnew account for each service or a group of related services. Not only is\nthis a tedious task, but it is also problematic if you must manage the\npasswords for all of these accounts. There's also the risk of breaking\napplications or services associated with the changed passwords.\nTherefore, organizations set these accounts to never expire and never\nupdate them.\n\nA solution to counter this would be to configure a group(s) in Active\nDirectory that contains accounts responsible for service(s). Proper\nrecord keeping of what services these accounts are responsible for\nshould be kept so planned password resets can be accompanied with\ncredential updates for services. Also, temporary service disruption can\nbe planned and accounted for. Password resets can be done through Active\nDirectory or by using PowerShell cmdlets.\n\nFor consideration, do not add service accounts to privileged user\ngroups. This would enable services to run with elevated privileges and\ngive an attacker the ability to escalate privileges by compromising a\nservice or account. Each service should have its own account for\nauditing and security purposes.\n\n### Managed Service Accounts\n\nManaged service accounts are designed for running services. Unique\npasswords are automatically generated and changed every 30 days by\nActive Directory. Interactive logon is not allowed; passwords are not\nstored on the local system; and only Kerberos is used for\nauthentication. There are two types of managed service accounts,\nstandalone managed service accounts (sMSA) and group managed service\naccounts.\n\nStandalone managed service accounts (sMSAs) require windows server 2008\nR2 and above. sMSAs can only run on one server; multiple services can be\nrun on that server. sMSAs cannot run scheduled tasks.\n\nGroup managed service accounts supersede sMSA and require Windows server\n2012 or later. gMSAs can be used across multiple servers and can be used\nto run scheduled tasks.\n\n## References\n\n- Windows LocalSystem vs. System | <https://serverfault.com/questions/168752/windows-localsystem-vs-system>\n- Secure on-premises computer accounts with Active Directory | <https://learn.microsoft.com/en-us/entra/architecture/service-accounts-computer>\n- Securing on-premises service accounts | <https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/service-accounts-on-premises>\n- LocalSystem Account | <https://learn.microsoft.com/en-us/windows/win32/services/localsystem-account>\n- NetworkService Account | <https://learn.microsoft.com/en-us/windows/win32/services/networkservice-account>\n- Local Accounts | <https://learn.microsoft.com/en-us/windows/security/identity-protection/access-control/local-accounts>\n- LocalService Account | <https://learn.microsoft.com/en-us/windows/win32/services/localservice-account>\n- Reset-ComputerMachinePassword | <https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/reset-computermachinepassword>\n- Using Managed Service Accounts (MSA and gMSA) in Active Directory | <https://woshub.com/group-managed-service-accounts-in-windows-server-2012/>\n- LocalService Account | <https://learn.microsoft.com/en-us/windows/win32/services/localservice-account>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0033",
                "CM0041",
                "CM0043",
                "CM0044",
                "CM0050",
                "CM0070",
                "CM0079",
                "CM0083",
                "CM0092",
                "CM0099",
                "CM0135"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "serverfault.com",
                    "description": "Windows LocalSystem vs. System",
                    "url": "https://serverfault.com/questions/168752/windows-localsystem-vs-system"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Secure on-premises computer accounts with Active Directory",
                    "url": "https://learn.microsoft.com/en-us/entra/architecture/service-accounts-computer"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Securing on-premises service accounts",
                    "url": "https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/service-accounts-on-premises"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "LocalSystem Account",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/services/localsystem-account"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "NetworkService Account",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/services/networkservice-account"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Local Accounts",
                    "url": "https://learn.microsoft.com/en-us/windows/security/identity-protection/access-control/local-accounts"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "LocalService Account",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/services/localservice-account"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Reset-ComputerMachinePassword",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/reset-computermachinepassword"
                },
                {
                    "source_name": "woshub.com",
                    "description": "Using Managed Service Accounts (MSA and gMSA) in Active Directory",
                    "url": "https://woshub.com/group-managed-service-accounts-in-windows-server-2012/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "LocalService Account",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/services/localservice-account"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110.004",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0029",
            "name": "Reset NT Hashes for Smart Card-enabled Accounts",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0029\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting NT hashes for smart card-enabled accounts restricts adversary\ndefense evasion and lateral movement using pass-the-hash attacks.\n\n## Introduction\n\nNo Introduction content identified.\n\n## Preparation\n\n- Assess the potential disruption refreshing smartcards/personal identity verification cards will have on the organization prior.\n- Verify that the adversary is inhibited from performing subsequent pass-the-hash attacks in the environment so that the adversary does not respond to this mitigation by simply dumping the hashes after a refresh is performed.\n- Ensure that the action will not generate a large number of re-authentication requests that risk overloading the Domain Controllers.\n\n## Risks\n\n- This countermeasure may disrupt operations.\n- Users of smartcard/PIV-enabled accounts will need to re-associate their smartcard with their account. This re-association can be disruptive if large numbers of users are affected. \n- Refreshing NT hashes will, by itself, not be sufficient to evict a adversary from a compromised network. An adversary must be fully evicted from a network for this countermeasure to be effective. Otherwise, a returning adversary with the requisite privileges may be able to engage in repeated credential theft of LM hashes.\n\n## Guidance\n\n### Automated Method \n\n- Consult the NSA's Pass-the-Hash Guidance.\n- Use either the NSA's Invoke-SmartcardHashRefresh PowerShell cmdlet from the \"PtHTools\" module to change the underlying NT hash or the DoD PKI-PKE provided script under PKI and PKE Tools.\n\n### Manual Method\n\n- To manually update the NT hash for a specific account, disable and re-enable the \"Smart Card required for interactive logon\" (SCRIL) option.  \n- The manual method is not scalable for large groups of accounts.\n\n## References\n\n- NTLM Overview | <https://learn.microsoft.com/en-us/windows-server/security/kerberos/ntlm-overview>\n- Password-less strategy: Configure user accounts to disallow password authentication | <https://learn.microsoft.com/en-us/windows/security/identity-protection/hello-for-business/passwordless-strategy#configure-user-accounts-to-disallow-password-authentication>\n- What's new in Credential Protection | <https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/whats-new-in-credential-protection>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0018",
                "CM0033",
                "CM0098",
                "CM0104"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "NTLM Overview",
                    "url": "https://learn.microsoft.com/en-us/windows-server/security/kerberos/ntlm-overview"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Password-less strategy: Configure user accounts to disallow password authentication",
                    "url": "https://learn.microsoft.com/en-us/windows/security/identity-protection/hello-for-business/passwordless-strategy#configure-user-accounts-to-disallow-password-authentication"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "What's new in Credential Protection",
                    "url": "https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/whats-new-in-credential-protection"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1555",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0030",
            "name": "Remove Known Malware",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0030\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving known malware terminates adversary collection, persistence, and\ncommand and control using malware.\n\n## Introduction\n\nNo Introduction content identified.\n\n## Preparation\n\n- Review malware eradication strategy to minimize chances of an adversary presence surviving or being reinstated after eradication steps have been implemented.\n- Determine whether any specific vulnerabilities, if any, were used by or exploited to install the malware and investigate how to prevent future exploitation.\n\n## Risks\n\n- This countermeasure may have impacts that disrupt operations, including\n    - Data loss: Data entered since the last clean backup may be lost.\n    - Business disruption: Downtime during business hours may disrupt business.\n- Errors can render this countermeasure ineffective.\n- Confirm the integrity of any clean images/software prior to usage, to avoid the risk of re-infection.\n\n## Guidance\n\nThe specifics on the eradication of malware, backdoors, and implants will vary with each instance. The following is a list of some recommended practices regarding malware eradication activities. Please note, this is not an exhaustive list.\n- Search for Indicators of Compromise (IOCs) (IP addresses, domains, certificates).\n- Search for Tactics, Techniques, and Procedures (TTPs) consistent with adversary activity.\n- Exploit internal resources (threat intelligence feeds, logs, etc.) to inform understanding of the attack and pivot to discover additional IOCs and TTPs.\n- Reimage affected systems by restoring to an original uncorrupted state.\n- Rebuild or replace hardware in the event of hard to eradicate infections such as root kits.\n- Replace compromised files with uncorrupted files.\n- Install Patches to mitigate any existing vulnerabilities.\n- Monitor the system to verify successful eradication.\n\n## References\n\n- Cybersecurity Incident & Vulnerability Response Playbooks | <https://www.cisa.gov/sites/default/files/2024-08/Federal_Government_Cybersecurity_Incident_and_Vulnerability_Response_Playbooks_508C.pdf>\n- Computer Security Incident Handling Guide | <https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0023",
                "CM0065",
                "CM0083",
                "CM0106",
                "CM0120",
                "CM0137",
                "CM0147",
                "CM0330",
                "CM0449"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisa.gov",
                    "description": "Cybersecurity Incident & Vulnerability Response Playbooks",
                    "url": "https://www.cisa.gov/sites/default/files/2024-08/Federal_Government_Cybersecurity_Incident_and_Vulnerability_Response_Playbooks_508C.pdf"
                },
                {
                    "source_name": "nvlpubs.nist.gov",
                    "description": "Computer Security Incident Handling Guide",
                    "url": "https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1587.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0031",
            "name": "Monitor PowerShell Program",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0031\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nMonitoring PowerShell detects adversary execution using PowerShell.\n\n## Introduction\n\nPowerShell is one of the top post-exploitation techniques identified in\ncyber incidents. Adversaries use PowerShell to carry out a wide-variety\nof malicious tasks.\n\n## Preparation\n\n- PowerShell 5.0 requires at least Windows 7-SP1, Server 2008-R2-SP1, or later.\n- PowerShell requires .NET Framework 4.5 or later.\n- Determine which logging features should be turned on, based on the size of the resulting log files (to avoid issues with excessively large log files).\n\n## Risks\n\n- This countermeasure may result in excessive resource use.\n- Module and Script Block Logging can create large log files.\n\n## Guidance\n\nThe enhanced logging features of PowerShell 5.0 must be configured via Group Policy or registry keys. The following log types should be enabled:\n\n- Enable module logging to capture command-line parameters and the content of pipeline output.  \n- Enable script block logging to capture the commands inside PowerShell script blocks.  Includes encoded/obfuscated and decoded/deobfuscated code.  Does not capture command output.  \n    - To avoid excessive logging, do not enable script block invocation start/stop events as it can result in an excessive number of events. \n- Enable transcription logging to capture records of every PowerShell session, including all input and output.  Transcription will log all commands, including base-64 encoded script blocks in memory. \n    - Consider recording timestamps.\n    - Consider writing transcripts to a remote, write-only network share to ensure defenders are reviewing logs in secure manner.\n\n## References\n\n- What is Windows PowerShell? | <https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/overview>\n- about_Script_Blocks | <https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_script_blocks>\n- Greater Visibility Through PowerShell Logging | <https://cloud.google.com/blog/topics/threat-intelligence/greater-visibility/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0057",
                "CM0068",
                "CM0096",
                "CM0097",
                "CM0110",
                "CM0123",
                "CM0125"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "What is Windows PowerShell?",
                    "url": "https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/overview"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "about_Script_Blocks",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_script_blocks"
                },
                {
                    "source_name": "cloud.google.com",
                    "description": "Greater Visibility Through PowerShell Logging",
                    "url": "https://cloud.google.com/blog/topics/threat-intelligence/greater-visibility/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1059.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1070.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0032",
            "name": "Revoke and Regenerate SSH Keys",
            "subtype": "Disable, Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0032\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRevoking and regenerating SSH keys terminates adversary persistence and lateral movement using compromised private keys.\n\n## Introduction\n\nNo Introduction content identified.\n\n## Preparation\n\n- Administrators should inventory all systems and devices that use SSH keys to be prepared in the event of an incident.\n\n## Risks\n\n- Errors can render this countermeasure ineffective.\n- Regenerating SSH keys on a compromised host (e.g. jump box, bastion host) will allow adversaries to access and use the new keys. Eliminate the adversary's access to the host before regenerating the SSH keys.\n- This countermeasure may have impacts that disrupt operations.\n- Activities relying on the SSH service will be disrupted during the key revocation, regeneration and server restart process.\n\n## Guidance\n\n- Revoke SSH Keys\n    - Access remote hosts and revoke public keys associated with the compromised private key. For a small number of systems, this can be performed by manually updating the authorized_keys file. \n- Regenerate SSH Keys\n    - After revoking public keys on all servers where the original system was granted access, system administrators should replace the compromised private key using OpenSSH or a Centralized Key Management System.  If key generation is required at a larger scale, consider automating the process using frameworks like Ansible or Puppet.    \n- Update the Public Keys on All Servers\n- Restart SSH service\n    - By restarting the SSH service, users using the revoked key pair will be booted off remote systems and attempts to reinitialize using the blacklisted key will fail.\n- Restrict SSH\n    - In addition to revoking and generating new SSH keys, system administrators should consider implementing additional restrictions on SSH use and access.\n- Disable SSH Daemon\n    - In some cases, system administrators may find it necessary to disable the SSH Daemon.\n- Restrict Access to SSH in UNIX\n- Restrict Access to SSH Daemon\n- Restrict Access to the Authorized_Keys File\n- Disable Root Login Over SSH\n    - Disable root login over SSH to reduce the ability of adversaries to brute-force systems remotely.\n\n## References\n\n- Key-based authentication in OpenSSH for Windows | <https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh_keymanagement>\n- Authorized Key in SSH | <https://www.ssh.com/academy/ssh/authorized-key>\n- NISTIR 7966: Security of Interactive and Automated Access Management Using Secure Shell (SSH) | <https://nvlpubs.nist.gov/nistpubs/ir/2015/nist.ir.7966.pdf>\n- Using PuTTYgen on Windows to generate SSH key pairs | <https://www.ssh.com/academy/ssh/putty/windows/puttygen>\n- How (and Why) to Disable Root Login Over SSH on Linux | <https://www.howtogeek.com/828538/how-and-why-to-disable-root-login-over-ssh-on-linux/>\n- Configure SSH to use two-factor authentication | <https://ubuntu.com/tutorials/configure-ssh-2fa#3-configuring-authentication>\n- OpenSSH/Cookbook/Certificate-based Authentication | <https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Certificate-based_Authentication>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0013",
                "CM0020",
                "CM0036",
                "CM0076"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Key-based authentication in OpenSSH for Windows",
                    "url": "https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh_keymanagement"
                },
                {
                    "source_name": "www.ssh.com",
                    "description": "Authorized Key in SSH",
                    "url": "https://www.ssh.com/academy/ssh/authorized-key"
                },
                {
                    "source_name": "nvlpubs.nist.gov",
                    "description": "NISTIR 7966: Security of Interactive and Automated Access Management Using Secure Shell (SSH)",
                    "url": "https://nvlpubs.nist.gov/nistpubs/ir/2015/nist.ir.7966.pdf"
                },
                {
                    "source_name": "www.ssh.com",
                    "description": "Using PuTTYgen on Windows to generate SSH key pairs",
                    "url": "https://www.ssh.com/academy/ssh/putty/windows/puttygen"
                },
                {
                    "source_name": "www.howtogeek.com",
                    "description": "How (and Why) to Disable Root Login Over SSH on Linux",
                    "url": "https://www.howtogeek.com/828538/how-and-why-to-disable-root-login-over-ssh-on-linux/"
                },
                {
                    "source_name": "ubuntu.com",
                    "description": "Configure SSH to use two-factor authentication",
                    "url": "https://ubuntu.com/tutorials/configure-ssh-2fa#3-configuring-authentication"
                },
                {
                    "source_name": "en.wikibooks.org",
                    "description": "OpenSSH/Cookbook/Certificate-based Authentication",
                    "url": "https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Certificate-based_Authentication"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1098.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1552.004",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0033",
            "name": "Reset User Account Passwords",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0033\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting user account passwords restricts adversary persistence and lateral movement using valid accounts.\n\n## Introduction\n\nNo introduction content identified.\n\n## Preparation\n\n- Configure environment to support self-service password reset (SSPR) for users.\n- Develop standard operating procedures (SOPs) when pushing out mandatory password resets to affected accounts. Instructions should include guidance for alerting users and instructions on self-service password resets.\n- Ensure a means of attestation is defined to verify the veracity of users requiring a manual password reset.\n\n## Risks\n\n- This countermeasure may have impacts that disrupt operations.\n- Organization's helpdesk may be inundated with assistance reset if a password reset is pushed. Staging the password reset will mitigate the burden on both users and service desk technicians. \n- Reducing the password expiration age or gradually resetting passwords for user accounts in timed batches, while often necessary, will risk the adversary maintaining authenticated sessions until the hijacked account's password is reset.\n- Remote users may be unable to fulfill their job responsibilities until they reset their password and successfully authenticate on the domain. \n- Adversaries that manage to exfiltrate the Active Directory Directory Services (AD DS) database or are abusing the SSPR may be able to re-establish initial access or persistence via SSPR.\n\n## Guidance\n\n- Post-breach, configure domains to request password resets for user accounts. \n- For onsite users with direct access to domain controllers, password resets can be performed in batches by resetting passwords by organizational units and leveraging the \"User must change password at next logon\" PowerShell flag. \n- Alternately, Fine Grained Password Policies (FGPP) and reducing password age through domain policy modifications may facilitate mass password resets of user accounts.\n- For hybrid organizations using Microsoft Entra ID, administrators may use Microsoft Graph to set user attributes to either \"forceChangePasswordNextSignIn\" or \"forceChangePasswordNextSignInWithMfa.\" \n- Ensure compliance with best practices, to include:\n    - Salting passwords\n    - Increasing password length and complexity\n    - Prevent password reuse\n\n## References\n\n- Digital Identity Guidelines | <https://nvlpubs.nist.gov/nistpubs/specialpublications/nist.sp.800-63b.pdf>\n- Set the password expiration policy for your organization | <https://learn.microsoft.com/en-us/microsoft-365/admin/manage/set-password-expiration-policy>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0018",
                "CM0028",
                "CM0029",
                "CM0043",
                "CM0068",
                "CM0069",
                "CM0071",
                "CM0075",
                "CM0112",
                "CM0118",
                "CM0121",
                "CM0124",
                "CM0125",
                "CM0138",
                "CM0140",
                "CM0326",
                "CM0330",
                "CM0335",
                "CM0336"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "nvlpubs.nist.gov",
                    "description": "Digital Identity Guidelines",
                    "url": "https://nvlpubs.nist.gov/nistpubs/specialpublications/nist.sp.800-63b.pdf"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Set the password expiration policy for your organization",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/admin/manage/set-password-expiration-policy"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1110",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1555",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0034",
            "name": "Identify and Block Suspicious Hosts",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0034\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nIdentifying and blocking suspicious hosts restricts adversary initial\naccess and privilege escalation from malicious hosts.\n\n## Introduction\n\nNo Introduction content identified.\n\n## Preparation\n\n- Take inventory of all hosts and services on the network.\n- Establish a baseline of normal activity to more accurately detect suspicious and irregular events.\n- Commercially solutions are available to identify and block suspicious hostnames. Determine which solution(s) will satisfy environmental requirements.\n\n## Risks\n\n- This countermeasure may have impacts that disrupt operations.\n- The anomaly detection or intrusion prevention system may identify legitimate hosts as suspicious.\n\n## Guidance\n\nIdentifying suspicious hostnames can be achieved through a combination of these tools and techniques:\n\n- Network Monitoring Tools\n    - Leverage network monitoring tools to identify suspicious hostnames by way of anomalous network activity or unauthorized connections. \n- Security Information and Event Management (SIEM) System\n    - Use a SIEM to collect, aggregate, and analyze all available log data to identify suspicious hostnames and abnormal activity.  \n- Host Discovery and Port Scanning\n    - Use a host discovery or port scanning tool to take inventory of hosts and open ports.  Use this information to determine if a host and/or port is legitimate.\n\n## References\n\n- Network Monitoring Tools | <https://www.manageengine.com/network-monitoring/network-monitoring-tools.html>\n- Top 10 Network Behavior Anomaly Detection Tools in 2022 | <https://www.spiceworks.com/tech/networking/articles/network-behavior-anomaly-detection-tools/>\n- What is SIEM? | <https://www.ibm.com/topics/siem>\n- 6 Best Network Discovery Tools - What is Network Discovery | <https://www.dnsstuff.com/network-discovery-tools#what-is-network-discovery>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0010",
                "CM0023",
                "CM0035",
                "CM0058",
                "CM0064",
                "CM0065"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.manageengine.com",
                    "description": "Network Monitoring Tools",
                    "url": "https://www.manageengine.com/network-monitoring/network-monitoring-tools.html"
                },
                {
                    "source_name": "www.spiceworks.com",
                    "description": "Top 10 Network Behavior Anomaly Detection Tools in 2022",
                    "url": "https://www.spiceworks.com/tech/networking/articles/network-behavior-anomaly-detection-tools/"
                },
                {
                    "source_name": "www.ibm.com",
                    "description": "What is SIEM?",
                    "url": "https://www.ibm.com/topics/siem"
                },
                {
                    "source_name": "www.dnsstuff.com",
                    "description": "6 Best Network Discovery Tools - What is Network Discovery",
                    "url": "https://www.dnsstuff.com/network-discovery-tools#what-is-network-discovery"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1199",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0035",
            "name": "Configure Uniform Resource Locator (URL) Filtering",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0035\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nConfiguring Uniform Resource Locator (URL) filtering restricts adversary initial access and execution via  malicious URLs.\n\n## Introduction\n\nUniform Resource Locator (URL) filtering, also known as web filtering, is used to control access to web pages by permitting or denying access when a user clicks on a link. URL filtering blocks compromised webpages used by adversaries to facilitate phishing attacks and malicious code execution.   \n\nURL filtering operates similarly to Domain Name System (DNS) filtering, although the latter blocks blocks DNS query requests for a domain.\n\nNote that adversaries are able to generate new URLs, so manually updating URL filtering will not be sufficient for full protection against adversaries phishing attempts and should be paired with other, more sophisticated, methods of web security.\n\n## Preparation\n\n- No Preparation content identified.\n\n## Risks\n\n- Blocking legitimate URLs may disrupt business operations.\n\n## Guidance\n\nA URL filter is useful to configure for instances where a webpage on a domain is known to be or has been compromised or to meet business objectives. \n\n### Evaluating URLs during an Incident\n\n* Check URLs against IoCs.\n* Check clickable links/downloads available on the webpage.\n* Check HTTP headers and Payloads using an intercept proxy such as, OWASP ZAP, to the site. \n* View network traffic to suspicious URK using a protocol analyzer such as WireShark\n    \n\n### Applying a Filter\n\nApplying a filter can be based on an allow-list, block-list, or both. \nThere are multiple commercial tools that may be used to block malicious URLs (Cisco Umbrella, ZScaler, Palo Alto,  etc). Organizations should consult their vendor for specific steps to block a known malicious URL. Commercial tools will also come with pre-built categories or URLs for preventative or post measures. Another, preventative step for consideration is blocking common mistypings of popular or common URLs used by staff to prevent typosquatting attacks.\n\n## References\n\n- What is URL Filtering | <https://www.zscaler.com/zpedia/what-is-url-filtering>\n- URL Filtering | <https://www.cisco.com/c/en/us/td/docs/routers/sdwan/configuration/security/ios-xe-16/security-book-xe/url-filtering.pdf>\n- Threat Hunting URLs for URLs as an IoC | <https://www.cisco.com/c/en/us/td/docs/routers/sdwan/configuration/security/ios-xe-16/security-book-xe/url-filtering.pdf>\n- How to prevent and protect from typosquatting | <https://www.redpoints.com/blog/prevent-typosquatting/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0009",
                "CM0010",
                "CM0011",
                "CM0034",
                "CM0040"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.zscaler.com",
                    "description": "What is URL Filtering",
                    "url": "https://www.zscaler.com/zpedia/what-is-url-filtering"
                },
                {
                    "source_name": "www.cisco.com",
                    "description": "URL Filtering",
                    "url": "https://www.cisco.com/c/en/us/td/docs/routers/sdwan/configuration/security/ios-xe-16/security-book-xe/url-filtering.pdf"
                },
                {
                    "source_name": "www.cisco.com",
                    "description": "Threat Hunting URLs for URLs as an IoC",
                    "url": "https://www.cisco.com/c/en/us/td/docs/routers/sdwan/configuration/security/ios-xe-16/security-book-xe/url-filtering.pdf"
                },
                {
                    "source_name": "www.redpoints.com",
                    "description": "How to prevent and protect from typosquatting",
                    "url": "https://www.redpoints.com/blog/prevent-typosquatting/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1189",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1204",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1204.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1566",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1566.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1566.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0036",
            "name": "Identify and Monitor Remote Access Tools",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0036\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling or restricting remote access tools blocks or restricts\nadversary persistence, lateral movement, and exfiltration using remote\naccess tools.\n\n## Introduction\n\nSome of the most common remote access tools include TeamViewer, AnyDesk, VNC Connect, Remote Desktop Protocol (RDP), Secure Shell (SSH), Virtual Private Networks (VPNs), and Windows Remote Desktop Services (RDS).\n\nSecurity professionals need to be aware of all remote access tools enabled within their environment. In addition, security operations should consider assessing visibility into remote access tool usage and affirm strong remote access application monitoring practices if tools are used on the organization's network.\n\n## Preparation\n\n- Determine what is necessary for day-to-day operations prior to disabling native remote access applications.\n\n## Risks\n\n- This countermeasure may have impacts that disrupt operations.\n- Limiting remote access tools can lead to reduced operational flexibility and convenience.\n\n## Guidance\n\n- Determine the presence of existing remote access tools (TeamViewer, AnyDesk, VNC Connect, Remote Desktop Protocol (RDP), SSH, VPNs, Windows Remote Desktop Services (RDS), etc.) and ensure remote access activity is being logged and monitored. \n- Identify open ports commonly used for remote access (20 (FTP), 21 (FTP), 22 (SSH), 23 (Telnet), 3389 (Microsoft Remote Display Protocol)).  Note, the absence of these ports does not negate the presence of remote access tools/protocols.\n- Ensure the use of secure protocols such as Secure File Transfer Protocol (SFTP) and Secure Shell (SSH).\n- Alert on persistent/prolonged remote connections and implement idle session timeout.\n\n## References\n\n- Technical Approaches to Uncovering and Remediating Malicious Activity | <https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-245a>\n- principle of least privilege (POLP) | <https://www.techtarget.com/searchsecurity/definition/principle-of-least-privilege-POLP>\n- Guide to Enterprise Telework, Remote Access, and Bring Your Own Device (BYOD) Security | <https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-46r2.pdf>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0025",
                "CM0032",
                "CM0042",
                "CM0109",
                "CM0141"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisa.gov",
                    "description": "Technical Approaches to Uncovering and Remediating Malicious Activity",
                    "url": "https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-245a"
                },
                {
                    "source_name": "www.techtarget.com",
                    "description": "principle of least privilege (POLP)",
                    "url": "https://www.techtarget.com/searchsecurity/definition/principle-of-least-privilege-POLP"
                },
                {
                    "source_name": "nvlpubs.nist.gov",
                    "description": "Guide to Enterprise Telework, Remote Access, and Bring Your Own Device (BYOD) Security",
                    "url": "https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-46r2.pdf"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1018",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1021",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1021.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1047",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1113",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1218.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1219",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1563",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0037",
            "name": "Enable Geolocation-based Traffic Filtering",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0037\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling geolocation-based traffic filtering restricts adversary\nreconnaissance and initial access from geographic regions of concern.\n\n## Introduction\n\nRemote access logins and interactions from foreign nations into organizations network can be restricted using a number of methods depending on the specific requirements and available resources. Next-generation firewalls, content delivery networks (CDN), proxy servers, DNS services, and web application firewalls (WAFs) can all be configured to block traffic from specific regions based on geolocation. User identity management services can also be configured to block logins from specific geographic regions.\n\nBy blocking incoming requests from specific countries, a security operation center (SOC) may be able to optimize their network defenses by denying countries that perpetrate large amounts of low-level, automated\nnetwork probing.\n\n## Preparation\n\n- Confirm with business leadership that implementing the desired geo-block will not prevent critical business activities from taking place.\n\n## Risks\n\n- This countermeasure may have impacts that disrupt operations. For example, implementing geolocation traffic filtering may result in false-positives and blocking legitimate traffic, particularly if users apply VPN solutions before connecting into the network. \n- Geo-blocking will impair any legitimate interactions with entities in the blocked region.\n- There may be legal restrictions on geo-blocking in certain regions, particularly within the European Union.\n\n## Guidance\n\nBlocking Outgoing Requests to Specific Countries\n\n- If suspicious outbound traffic to a country of concern is discovered, investigate, and activate response measures according to the incident response plan.\n- Consider implementing deny-all rules restricting outbound traffic to only approved countries or block outbound connections to countries deemed particularly high-risk.\n- Consider implementing deception practices for externally facing systems accessible from specific regions of concern to enhance situational awareness and inform security operations.\n- Monitor and investigate outgoing traffic from DMZ servers to suspicious geographic locations, particularly if a web application or network service is unlikely to have users located abroad.\n- Consider implementing blocking and alerts on \"impossible to travel\" traffic - whereby a user logs in from multiple IP addresses that are geographically distant within the same time frame.\n\nA variety of 3rd-party services, including user identity management, CDNs, and next-generation firewalls, provide support for geo-blocking. For instructions on establishing conditional access policies and geo-blocking, SOCs and network operation centers (NOCs) should consult vendor documentation used by their organization.\n\n## References\n\n- Geoblocking Best Practices: When Geoblocking Is (and Isn't) Useful | <https://www.itprotoday.com/cloud-security/geoblocking-best-practices-when-geoblocking-is-and-isn-t-useful>\n- NSA and CISA Recommend Immediate Actions to Reduce Exposure Across Operational Technologies and Control Systems | <https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-205a>\n- Q&A - Regulation on addressing unjustified geo-blocking | <https://www.ecommerce-europe.eu/wp-content/uploads/2019/03/Geo-blocking-QA.pdf>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0002",
                "CM0010",
                "CM0114"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.itprotoday.com",
                    "description": "Geoblocking Best Practices: When Geoblocking Is (and Isn't) Useful",
                    "url": "https://www.itprotoday.com/cloud-security/geoblocking-best-practices-when-geoblocking-is-and-isn-t-useful"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "NSA and CISA Recommend Immediate Actions to Reduce Exposure Across Operational Technologies and Control Systems",
                    "url": "https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-205a"
                },
                {
                    "source_name": "www.ecommerce-europe.eu",
                    "description": "Q&A - Regulation on addressing unjustified geo-blocking",
                    "url": "https://www.ecommerce-europe.eu/wp-content/uploads/2019/03/Geo-blocking-QA.pdf"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1190",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1592",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1594",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1595",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0038",
            "name": "Remove Windows Management Instrumentation (WMI) Event Subscription",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0038\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving a Windows Management Instrumentation (WMI) event subscription terminates adversary persistence and/or lateral movement via malicious content execution triggered by a WMI event subscription.\n\n## Introduction\n\nWMI is the infrastructure for management data and operations on Windows-based operating systems. Adversaries create WMI subscriptions to achieve event-initiated arbitrary code execution. This technique is typically employed to achieve and/or persistence.\n\nNote that Microsoft is deprecating WMIC in Windows Server in favor or interacting with WMI via PowerShell in Windows 11 (starting with build 22572).\n\n## Preparation\n\nNo Preparation content identified.\n\n## Risks\n\n- This countermeasure can break legitimate functionality.\n- Removing a benign WMI Event Subscription may break legitimate applications.\n\n## Guidance\n\nGain Visibility into WMI Subscription Events\n\n- Configure Sysmon to log WMiEventFilter, WmiEventConsumer, and WMIEventConsumerToFilter to enable detection of WMI abuse. \n\nSearch for and Review WMI Subscription Events\n\n- Use PowerShell or AutoRuns to list WMI Subscription Events.\n- Review WMI Subscription Events for suspicious attributes (invocation of scripting interpreter coupled with encoded content, etc.)\n\nEradicate WMI Subscription Events\n\n- Use PowerShell or AutoRuns to eradication malicious WMI Subscription Events.\n\n## References\n\n- Windows Management Instrumentation | <https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page>\n- Detecting & Removing an Attacker's WMI Persistence | <https://medium.com/threatpunter/detecting-removing-wmi-persistence-60ccbb7dff96>\n- AutoRuns for Windows v14.1 | <https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns>\n- Sysinternals Suite | <https://learn.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0013",
                "CM0039",
                "CM0103",
                "CM0120",
                "CM0138",
                "CM0147"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Windows Management Instrumentation",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page"
                },
                {
                    "source_name": "medium.com",
                    "description": "Detecting & Removing an Attacker's WMI Persistence",
                    "url": "https://medium.com/threatpunter/detecting-removing-wmi-persistence-60ccbb7dff96"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "AutoRuns for Windows v14.1",
                    "url": "https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Sysinternals Suite",
                    "url": "https://learn.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1047",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0039",
            "name": "Monitor Windows Management Instrumentation (WMI) Events",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0039\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nMonitoring Windows Management Instrumentation (WMI) events detects\nadversary execution of malicious commands and payloads.\n\n## Introduction\n\nWMI is the infrastructure for management data and operations on\nWindows-based operating systems.\n\n## Preparation\n\nNo Preparation content identified.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\n- Collect Information about WMI using PowerShell. Execute the following commands in PowerShell to collect WMI event filters, consumers, and bindings on a system. \n- Collect Information about WMI using free, open source, modular PowerShell-based incident response framework such as Arthur and/or KANSA.\n- Collect Information about WMI using Vendor Tools.\n    - In addition to the methods described above, various vendor tools may be used to collect WMI events (or indeed are configured to collect them by default). For example, Splunk supports WMI data collection. \n- Configure Sysmon to capture WMI Event Filter, Consumer, and Binding Activity. Sysmon can be configured to monitor WMIEventFilter activity (event 19), WMIEventConsumer activity (event 20), and WMIEventConsumerToFilter activity (event 21). Roberto Rodriguez' (@Cyb3rWard0g) Sysmon configuration file can be installed to capture Event IDs 19, 20, and 21. Sysmon can be installed with this configuration file using the following command.\n    - sysmon.exe -i -c .\\config_file.xml\n\n## References\n\n- Windows Management Instrumentation | <https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page>\n- Investigating WMI Attacks | <https://www.sans.org/blog/investigating-wmi-attacks/>\n- Kansa: A PowerShell-based incident response framework | <https://powershellmagazine.com/2014/07/18/kansa-a-powershell-based-incident-response-framework/>\n- MalwareArchaeology/ARTHIR | <https://github.com/MalwareArchaeology/ARTHIR>\n- Monitor data through Windows Management Instrumentation (WMI) | <https://docs.splunk.com/Documentation/Splunk/latest/Data/MonitorWMIdata>\n- StartLogging.xml | <https://gist.github.com/Cyb3rWard0g/136481552d8845e52962534d1a4b8664>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0013",
                "CM0038",
                "CM0096",
                "CM0097"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Windows Management Instrumentation",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page"
                },
                {
                    "source_name": "www.sans.org",
                    "description": "Investigating WMI Attacks",
                    "url": "https://www.sans.org/blog/investigating-wmi-attacks/"
                },
                {
                    "source_name": "powershellmagazine.com",
                    "description": "Kansa: A PowerShell-based incident response framework",
                    "url": "https://powershellmagazine.com/2014/07/18/kansa-a-powershell-based-incident-response-framework/"
                },
                {
                    "source_name": "github.com",
                    "description": "MalwareArchaeology/ARTHIR",
                    "url": "https://github.com/MalwareArchaeology/ARTHIR"
                },
                {
                    "source_name": "docs.splunk.com",
                    "description": "Monitor data through Windows Management Instrumentation (WMI)",
                    "url": "https://docs.splunk.com/Documentation/Splunk/latest/Data/MonitorWMIdata"
                },
                {
                    "source_name": "gist.github.com",
                    "description": "StartLogging.xml",
                    "url": "https://gist.github.com/Cyb3rWard0g/136481552d8845e52962534d1a4b8664"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1047",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0040",
            "name": "Clear Workstation and Server Domain Name Server (DNS) Caches",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0040\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nClearing workstation and server Domain Name Server (DNS) cache terminates collection and command-and-control (C2) via corrupted DNS lookups.\n\n## Introduction\n\nThe domain name system (DNS) cache is used to expedite the resolution of DNS queries for recently visited domains. Adversaries can poison the DNS cache by inserting or replacing records in the cache resulting in victims communicating with adversary-controlled infrastructure. By clearing the DNS cache, all stored queries, including malicious or corrupted IP-Domain mappings, will be purged.\n\n## Preparation\n\n- Capture all relevant forensic information before flushing cache.\n- Ensure appropriate privileges are possessed by the user account issuing commands to clear the DNS cache.\n\n## Risks\n\n- Clearing the DNS cache will remove important forensic artifacts and IOCs. Ensure forensic captures of the DNS cache are taken prior to flushing.\n\n## Guidance\n\n### Clear DNS Cache\n\n**Windows**\n* To flush DNS on a local Windows device with Command Prompt, the command: `ipconfig /flushdns` can be used. \n* To clear DNS on a Windows DNS server, the command-line tool Dnscmd can be used  with `dnscmd <DNSServerName> /clearcache` \n* System administrators can use the PowerShell cmdlets `Clear-DnsServerCache` and `Clear-DnsClientCache` respectively to clear resource records. \n\n**Linux**\n\nTo flush DNS on a local Linux device with Terminal, the commands vary based on the DNS caching service installed.\n* For `nscd`, use: `sudo /etc/init.d/nscd restart`\n* For `dnsmasq`, use: `sudo /etc/init.d/dnsmasq restart`\n* For `systemd-resolved`, use: `sudo systemd-resolve --flush-caches`. Confirm cache is cleared with the command `sudo systemd-resolve --statistics` and confirm \"Current Cache Size 0\".\n\n**MacOS**\n\nClearing the DNS cache on Mac workstations depends on the version of MacOS employed. For MacOS 10.10.4 and above the command is `sudo killall -HUP mDNSResponder`.\n\nClearing DNS records can be automated using scripts or using tools such as SolarWinds Server & Application Monitor. \n\n### Restart DNS Service\n\nSystem administrators should restart the DNS services ensure the cache is cleared. For example, with nscd or dnsmasq, the service can be restarted with `sudo systemctl restart nscd` or `sudo systemctl restart dnsmasq` respectively. If Windows PowerShell is being used for a Windows DNS server, system administrators can use `Restart-Service -Name DNS -Force`.\n\n## References\n\n- Flush DNS: What It Is & How to Easily Clear DNS Cache | <https://blog.hubspot.com/website/flush-dns>\n- Simplified Guide on How to Clear DNS Server Cache on Windows | <https://www.dnsstuff.com/clear-flush-dns-server-cache-windows>\n- Dnscmd | <https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd>\n-  Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise | <https://www.cisa.gov/news-events/analysis-reports/ar21-134a>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0009",
                "CM0011",
                "CM0035"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "blog.hubspot.com",
                    "description": "Flush DNS: What It Is & How to Easily Clear DNS Cache",
                    "url": "https://blog.hubspot.com/website/flush-dns"
                },
                {
                    "source_name": "www.dnsstuff.com",
                    "description": "Simplified Guide on How to Clear DNS Server Cache on Windows",
                    "url": "https://www.dnsstuff.com/clear-flush-dns-server-cache-windows"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Dnscmd",
                    "url": "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise",
                    "url": "https://www.cisa.gov/news-events/analysis-reports/ar21-134a"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1071.004",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0041",
            "name": "Disable Service Account Interactive Login",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0041\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling service account interactive login restricts adversary lateral movement using service accounts.\n\n## Introduction\n\nAn interactive logon is a software method in which the account information and credentials input by the user interactively are authenticated by a server or domain controller.\n\n## Preparation\n\n- Disable compromised user account.\n- Disconnect the system(s) from the network.\n\n## Risks\n\n- Errors can render this countermeasure ineffective.\n- If an adversary has compromised a user account with existing administrative rights, they will maintain the ability to install and configure services to run using the System account. Evict the adversary from retaining any control over privileged accounts or access to the network before assigning this right.\n- This countermeasure may not stop all ongoing activity.\n- Adversaries can still bypass AD group policies by brute-force or if default passwords are used.\n\n## Guidance\n\n### Disabling Interactive Logins for Service Accounts Manually\n\nTo manually assign this policy to a user and/or return the policy to its original state, use the Group Policy Object Editor or the Local Security Policy console. When modifying user rights associated with service accounts, it is recommended to assign the right via a Group Policy Object (GPO) as opposed to locally.\n\n### Disabling Interactive Logins for Service Accounts via GPO\n\nTo deny interactive logons for service accounts, system administrators should select the appropriate organizational unit (OU) via the Group Policy Management Console and either edit an existing group policy object (GPO) or create a new one. (There may be an existing GPO serving as a special security group with the excepted services that need to be modified.) \n\n- In the Group Policy Management Editor, administrators should navigate to *Computer Configuration > Policies > Windows Settings > Security Settings > Local Policies > User Rights Assignment*\n- Administrators should add the appropriate user accounts to both the \"Deny log on locally\" policy and the \"Deny log on through Terminal Services.\"\n- After linking these policies to the OU, the policy will apply after rebooting the machines. Both policies take priority over the \"Log on locally\" and \"Log on Through Terminal Services\" rights.\n\n## References\n\n- Red Flag Alert: Service Accounts Performing Interactive Logins | <https://www.crowdstrike.com/en-us/blog/service-accounts-performing-interactive-logins/>\n- Glossary - interactive logon | <https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-authsod/64781df1-ee20-413e-b8c5-6511c90dbc30#gt_9360639b-135c-46dc-9f9e-85728008146f>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0028",
                "CM0084",
                "CM0099"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.crowdstrike.com",
                    "description": "Red Flag Alert: Service Accounts Performing Interactive Logins",
                    "url": "https://www.crowdstrike.com/en-us/blog/service-accounts-performing-interactive-logins/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Glossary - interactive logon",
                    "url": "https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-authsod/64781df1-ee20-413e-b8c5-6511c90dbc30#gt_9360639b-135c-46dc-9f9e-85728008146f"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0042",
            "name": "Restrict Remote Desktop Protocol (RDP)",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0042\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nRestricting the Remote Desktop Protocol (RDP) restricts adversary initial access and lateral movement using RDP.\n\n## Introduction\n\nRDP, also known as terminal services, allows users to remotely connect from one computer to another. This countermeasure restricts RDP. When RDP is needed, it should be made\naccessible to users via a secure virtual private network (VPN) connection after authenticating via multi-factor authentication (MFA) or through a zero-trust remote access gateway.\n\n## Preparation\n\n- Estimate the impact of disabling RDP on business and sysadmin operations.\n- Conduct a risk assessment with network owners and system administrators to understand whether potential short-term disruption outweighs the consequences of continued adversary access.\n\n## Risks\n\n- This countermeasure may have impacts that disrupt operations.\n- Restricting RDP may disrupt legitimate operations that require the protocol.\n- If lockouts are enforced, an attacker can create a denial of service condition.\n\n## Guidance\n\n### Rotate Passwords for RDP\n\n- Limit RDP access by role-based access control and restrict to users that belong to a common security group.\n- If user accounts with RDP access were compromised, rotate passwords associated with remote service logins.\n\n### Disallow Administrative Accounts from Leveraging RDP on External-facing Systems\n\n- Administrative accounts should be prohibited from interfacing with servers using RDP. \n\n### Enforce Account Lockouts\n\n- Degrade the adversary's ability to brute force an RDP login by configuring account lockouts. \n    - For Windows Authentication on remote server access, manually edit the remote access lockout settings in the remote access server's registry. For RADIUS, configure the registry on the Internet Authentication Server (IAS).\n- Note that an attacker will still possess the ability to create a denial-of-service condition that intentionally locks out user accounts if lockouts are enforced. \n- Audit RDP Connection Logs. For example, the open source tool RdpMon can be used to show real-time and past RDP connections.\n\n## References\n\n- Ransomware Protection and Containment Strategies: Practical Guidance for Endpoint Protection, Hardening, and Containment | <https://cloud.google.com/blog/topics/threat-intelligence/ransomware-protection-and-containment-strategies/>\n- Integrate your Remote Desktop Gateway infrastructure using the Network Policy Server (NPS) extension and Microsoft Entra ID | <https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-nps-extension-rdg>\n- Configure remote access client account lockout | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/configure-remote-access-client-account-lockout>\n- Remote Desktop Services must be configured with the client connection encryption set to the required level | <https://stigviewer.com/stig/windows_10/2020-06-15/finding/V-63741>\n- Establishing a Baseline for Remote Desktop Protocol | <https://cloud.google.com/blog/topics/threat-intelligence/establishing-baseline-remote-desktop-protocol/>\n- Deny log on through Remote Desktop Services | <https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/deny-log-on-through-remote-desktop-services>\n- RdpMon - Server-side RDP monitoring tool | <https://github.com/cameyo/rdpmon>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0012",
                "CM0017",
                "CM0019",
                "CM0020",
                "CM0025",
                "CM0036"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "cloud.google.com",
                    "description": "Ransomware Protection and Containment Strategies: Practical Guidance for Endpoint Protection, Hardening, and Containment",
                    "url": "https://cloud.google.com/blog/topics/threat-intelligence/ransomware-protection-and-containment-strategies/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Integrate your Remote Desktop Gateway infrastructure using the Network Policy Server (NPS) extension and Microsoft Entra ID",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-nps-extension-rdg"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Configure remote access client account lockout",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/configure-remote-access-client-account-lockout"
                },
                {
                    "source_name": "stigviewer.com",
                    "description": "Remote Desktop Services must be configured with the client connection encryption set to the required level",
                    "url": "https://stigviewer.com/stig/windows_10/2020-06-15/finding/V-63741"
                },
                {
                    "source_name": "cloud.google.com",
                    "description": "Establishing a Baseline for Remote Desktop Protocol",
                    "url": "https://cloud.google.com/blog/topics/threat-intelligence/establishing-baseline-remote-desktop-protocol/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Deny log on through Remote Desktop Services",
                    "url": "https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/deny-log-on-through-remote-desktop-services"
                },
                {
                    "source_name": "github.com",
                    "description": "RdpMon - Server-side RDP monitoring tool",
                    "url": "https://github.com/cameyo/rdpmon"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1049",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1071",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1219",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1563.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1570",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1572",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0043",
            "name": "Monitor Permissions for User, Service, and Administrator Accounts",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0043\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nMonitoring permissions for user, service, and administrator accounts mitigates adversary privilege escalation using valid accounts.\n\n## Introduction\n\nThe approach, order, and speed to which organizations audit privileges will vary depending on context-specific factors such as the organization's environment, constraints, profile, and obligations or the attacker's activity within the environment. Because every incident is different, attackers are varied, and organizations diverse, an organization must consider this countermeasure in light of its specific circumstances.\n\n## Preparation\n\n- Gain a thorough understanding of the user account environment.\n- Ensure access to an administrator account as required by User Access Control mechanisms.\n- Verify which user groups are available and confirm the specific permissions for each group; differentiate between standard user and administrator accounts.\n\n## Risks\n\n- Incorrectly identifying users requiring elevated privileges as standard users may break legitimate functionality.\n\n## Guidance\n\nWhile implementing this countermeasure, ensure close coordination between onsite/local and remote system administrators. \n\n### Verify that Privilege Elevation is Disabled for Standard User Accounts\n\nSteps to verify proper disabling of privilege elevation for standard users varies depending on the specific implementation of an organization's architecture (use of Active Directory, custom user groups deployed, etc.). The following methods can be used to confirm details regarding user accounts, including whether privilege elevation is disabled for standard users.\n\n- Use the Windows Settings application to identify the type of account of different users that are available on the local workstation.\n- Use the Computer Management tool to identify Local Users and Groups and review properties associated with users of interest. Check that the groups a user is a member of do not contain administrator level privileges or other privileges that should not be assigned to standard users.\n- The Local Security Policy tool can help control certain behaviors of the User Account Control settings, including whether standard users are prompted for elevated credentials when attempting to complete an action that requires elevated privileges or whether they are denied automatically (standard users should be denied automatically). \n\n### Audit Account Privileges in Active Directory\n\n- Inventory roles and groups that possess privileged security levels in the environment.\n\t- For on-prem AD, use on-prem Active Directory or PowerShell to obtain a list privileged users in a domain. \n\t- For Azure AD, use Azure AD Privileged Identity Management (PIM) or the PowerShell API.\n\n#### Adopt a privileged access strategy\n\n- Azure AD customers should follow the rapid modernization plan (RAMP) to quickly adopt Microsoft's privileged access strategy if they aren't already.\n\n### Audit Relationships with Cloud Service Providers (CSPs)\n\n- In cloud environments, ensure permissions auditing includes shared trusts or identity relationships with third-party CSPs in which the identity is a resident on the CSP's tenant but is also capable of performing actions in the organization's M365 environment.\n    - Prioritize accounts associated with the threat actor\n    - Prioritize accounts that were associated with the compromised administrators, services, and users known to be leveraged by the adversary. \n    - Ensure SIEMs are configured to receive Windows event logs and exploit these logs to analyze events associated with the use or creation of privileged actions. \n\n### Ensure Highly Privileged Accounts are Delegated Just Enough Administration (JEA)\n\nConsiderations should exceed to what is immediately associated with the incident: \n\n- Focus recovery and response efforts on accounts belonging to highly privileged groups or recently obtained, undocumented privileges. These accounts usually have full administrative rights, such as Domain admins, Enterprise admins, and Schema admins, and are members of the forest root domain. \n- Explore all other accounts with limited, but still significant, rights (Account Operators, Server Operators, DNSAdmins) are also an important priority. \n- For built-in groups and custom groups, PowerShell can be used to enumerate their membership. When a highly privileged account is identified, consider granting the minimal rights and accounts needed to function, following the principles of JEA.\n\n### Review Access Control Lists to Identify Potential Backdoor Access\n\nWhen auditing privileges, review access control entries to ensure they are delegated according to the Principle of Least Privilege (PoLP) to limit the risk of backdoor access to additional powers. See the following guidance for recommendations when auditing AD access control listings.\n\n- Consult as a team to determine if an account's permissions should be revoked.\n- Determine whether each identified account of concern should maintain their current privileges. \n- When conducting the assessment, abide by the principle of least privilege. \n- Revoke all accounts that are unnecessary or possess privileges not expressly required by an account's function.\n- Accounts identified as having passwords past a certain age should be rotated.\n\n### Respond to Excessive Privileges\n\n- If accounts with excessive privileges are identified, revoke privileges assigned to the user or group.  If the account is unmanaged, decommission the account.  \n- Document any changes to privileges.  \n\n### Investigate the utility of 3rd-Party solutions\n\nOrganizations conducting account privilege auditing should consider the applicability of third-party and opensource tools to streamline the audit process, particularly for highly complex environments. While every tool may not be appropriate for every organization, teams should explore what tools are available and whether they can be used for their environments. Some possibilities include:\n\n- AD ACL Scanner - PowerShell tool used to create reports of access control lists and system access control lists in Active Directory. Useful for rapidly comparing Access Control Lists using update sequence number (USN) from replication metadata. \n- BloodHound - Uses graph theory to identify relationships within an within an Active Directory or Azure environment, allowing defenders to understand privilege relationships in their environment to revoke where appropriate. \n- Lithnet Access Manger - opensource software designed to allow the delegation of sensitive administrative access to computers for on-prem environments.\n\nIn addition, many commercial tools can also be used to perform privilege access management auditing and can be used to generate reports. \n\nAfter completion of a privilege audit, organizations should plan to regularly review and update privileges on an ongoing basis. More comprehensive assessments of account privileges should be scheduled in a timeline informed by the time and budgetary constraints of the organization.\n\n## References\n\n- User Account Control settings and configuration | <https://learn.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-security-policy-settings>\n- least privilege | <https://csrc.nist.gov/glossary/term/least_privilege>\n- Privileged access: Strategy | <https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-strategy>\n- Just Enough Administration | <https://learn.microsoft.com/en-us/powershell/scripting/security/remoting/jea/overview?view=powershell-7.4>\n- \"Admin Free\" Active Directory and Windows, Part 1- Understanding Privileged Groups in AD | <https://learn.microsoft.com/en-us/archive/blogs/lrobins/admin-free-active-directory-and-windows-part-1-understanding-privileged-groups-in-ad>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0003",
                "CM0018",
                "CM0028",
                "CM0033",
                "CM0044",
                "CM0048",
                "CM0060",
                "CM0085",
                "CM0112",
                "CM0114",
                "CM0118",
                "CM0124",
                "CM0136",
                "CM0139",
                "CM0145"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "User Account Control settings and configuration",
                    "url": "https://learn.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-security-policy-settings"
                },
                {
                    "source_name": "csrc.nist.gov",
                    "description": "least privilege",
                    "url": "https://csrc.nist.gov/glossary/term/least_privilege"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Privileged access: Strategy",
                    "url": "https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-strategy"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Just Enough Administration",
                    "url": "https://learn.microsoft.com/en-us/powershell/scripting/security/remoting/jea/overview?view=powershell-7.4"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "\"Admin Free\" Active Directory and Windows, Part 1- Understanding Privileged Groups in AD",
                    "url": "https://learn.microsoft.com/en-us/archive/blogs/lrobins/admin-free-active-directory-and-windows-part-1-understanding-privileged-groups-in-ad"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1548.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0044",
            "name": "Monitor Account Creation and Permission Changes",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0044\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nMonitoring account creation and permission changes detects adversary\npersistence and privilege escalation using valid accounts.\n\n## Introduction\n\nThreat actors will often create a local or domain account to maintain\npersistence in an environment. Additionally, account takeover is often\nfollowed by privilege escalation, so auditing known accounts for\nelevated privileges is necessary.\n\n## Preparation\n\nThis mitigation is applicable to multiple platforms at both the local\nand domain level. Administrators should not use this mitigation as\nprescriptive guidance, but rather descriptive guidance. The examples\nherein refer to the Windows operating system, but the context is\napplicable to other environments with minor changes.\n\n## Risks\n\n- New or undocumented accounts may be valid; deleting them may cause operational disruption.\n\n## Guidance\n\n### Permissions\n\nOnce an adversary has access to an account, the will likely try try\nelevate it's privileges. During an audit, check user SIDs and map to a\nbaseline configuration file for users. Users whose SIDS equal System or\nAdmin level without being a known Administrator or Service account\nshould be flagged for further review. A deeper inspection would be to\ncheck to see if users are running binaries, programs or processes with\nelevated privileges.\n\n### Creations\n\nAdversaries may also create their own rogue account in order to maintain\npersistent access to an environment. Compare \"known users\" with users\npresent in an environment and flag unknown users.\n\n### Incident Response\n\nDuring an ongoing incident, check for recently created accounts on local\nsystems and in a domain. Compare accounts to a secure baseline,\non-boarding documentation, etc. Suspicious accounts should be disabled\nand further investigated for activity performed on systems within the\nnetwork. Moreover, current accounts that are performing actions outside\nof the scope of the account type should be disabled. The relative\nidentifier which is the last number of the SID can indicate at what\nlevel an account is running. For example, 512 is the identifier for a\nuser belonging to the Domain Admins group. Accounts that should not\nbelong in this group should be disabled and further investigated.\nLastly, Microsoft's EventViewer is an excellent tool for auditing\naccounts.\n\n## References\n\n- Security Identifiers | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-identifiers>\n- Security principals | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-principals>\n- Active Directory security groups | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups>\n- Active Directory accounts | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-default-user-accounts>\n- Audit User Account Management | <https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-user-account-management>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0028",
                "CM0043",
                "CM0068",
                "CM0112",
                "CM0114",
                "CM0118",
                "CM0136",
                "CM0140"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Security Identifiers",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-identifiers"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Security principals",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-principals"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Active Directory security groups",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Active Directory accounts",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-default-user-accounts"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Audit User Account Management",
                    "url": "https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-user-account-management"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1136",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0045",
            "name": "Disable or Monitor Execution of WMIC.exe",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0045\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling or monitoring execution of wmic.exe will either prevent or alert to adversaries executing local or remote commands for lateral movement or persistence.\n\n## Introduction\n\nWindows Management Instrumentation (WMI) is a Microsoft module that is defined as the infrastructure for management data and operations. WMI is used to automate tasks, execute processes and scripts, and system configuration. WMIC.exe is a command-line tool to access WMI without the use of scripts.\n\n## Preparation\n\n- Identify applications that require WMI to function properly.\n\n## Risks\n\n- Disabling WMI could break microsoft applications that depend on WMI to function.\n\n## Guidance\n\n### Disabling Execution of WMIC.exe\n\nWMI can be disabled by enabling Attack Surface Reduction (ASR) rules to prevent processes created by WMI commands from running. \n\nAnother approach is to block wmic.exe directly using application control. Windows Defender Application Control (WDAC) policy rules can be configured to block wmic.exe. \n\n### Monitoring Execution of WMIC.exe\n\n* Process Monitoring: Monitor for new processes and/or commands containing \"wmi\".\n    * Windows Security log Event ID 4688 will track when a new process has been created.\n    * Sysmon Event ID 10 tracks process access. \n    * WMI can spawn two different processes: wmic.exe or wmiprvse.exe.\n    * A child process, scrcons.exe, is responsible for executing VBscript and Jscript code when ActiveScriptEventConsumer class is leveraged for persistence. \n    \n* Network Activity: Remote WMI is handled by remote services such as distributed component object model (DCOM) and windows remote management (WinRM).\n    * WMI over DCOM uses Remote Procedure Call (RPC) over port 135.\n    * WMI over WinRM uses HTTP port 5985 or HTTPS port 5986. \n\n\n* Command Logging/History: PowerShell script block logging and transcription logging should be enabled to view attempts at using wmic through powershell.\n\n## References\n\n- WMI - The Stealthy Component | <https://www.cynet.com/attack-techniques-hands-on/wmi-the-stealthy-component/>\n- Windows Management Instrumentation | <https://redcanary.com/threat-detection-report/techniques/windows-management-instrumentation/>\n- Windows Management Instrumentation Attacks - Detection & Response | <https://www.socinvestigation.com/windows-management-instrumentation-attacks-detection-response/>\n- Windows Management Instrumentation | <https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page>\n- A Description of the Windows Management Instrumentation (WMI) Command-Line Utility (Wmic.exe) | <https://support.microsoft.com/en-us/topic/a-description-of-the-windows-management-instrumentation-wmi-command-line-utility-wmic-exe-f5c16751-3a83-49ee-030d-5092ce1a04bb>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0005",
                "CM0056",
                "CM0097",
                "CM0138"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cynet.com",
                    "description": "WMI - The Stealthy Component",
                    "url": "https://www.cynet.com/attack-techniques-hands-on/wmi-the-stealthy-component/"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Windows Management Instrumentation",
                    "url": "https://redcanary.com/threat-detection-report/techniques/windows-management-instrumentation/"
                },
                {
                    "source_name": "www.socinvestigation.com",
                    "description": "Windows Management Instrumentation Attacks - Detection & Response",
                    "url": "https://www.socinvestigation.com/windows-management-instrumentation-attacks-detection-response/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Windows Management Instrumentation",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page"
                },
                {
                    "source_name": "support.microsoft.com",
                    "description": "A Description of the Windows Management Instrumentation (WMI) Command-Line Utility (Wmic.exe)",
                    "url": "https://support.microsoft.com/en-us/topic/a-description-of-the-windows-management-instrumentation-wmi-command-line-utility-wmic-exe-f5c16751-3a83-49ee-030d-5092ce1a04bb"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021.006",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1047",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1220",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1490",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0046",
            "name": "Block Execution of Compiled HTML (CHM) Files",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0046\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nBlocking execution of compiled HTML (CHM) files blocks adversary defense evasion using proxy execution of malicious CHM files.\n\n## Introduction\n\nCHM files are compressed compilations of content such as HTML documents, images, and scripting/web related programming languages such VBA, JScript, Java, and ActiveX. The Microsoft proprietary online help format uses CHM files, and CHM files are sometimes used for e-books. CHM content is displayed on Windows machines using the HTML Help executable (hh.exe). Adversaries can abuse vulnerabilities in CHM files to execute arbitrary code by tricking users into opening or decompiling a malicious CHM file.\n\n## Preparation\n\n- Assess the impact to operations if users lose access to Microsoft HTML Help.\n\n## Risks\n\n- Blocking execution of all CHM files will eliminate Microsoft online help.\n\n## Guidance\n\nCHM file execution can be blocked in two primary ways. The first blocks execution of all CHM files; the second blocks execution of CHM files from Internet sources. The methods should be used in combination for maximum security.\n\n### Block execution of hh.exe\n\nEither of these methods will prevent the execution of CHM files in Windows.\n- Use application control, such as EDR rules, to block execution of hh.exe. \n- Remove hh.exe from all client and server machines.\n\n### Block CHM file download\n\n- Restrict web-based traffic to block download of CHM files.\n- Filter email attachments to remove CHM files. (Microsoft now blocks CHM files in its Outlook email client.)\n- Configure web browsers so that they won't open CHM files.\n- The .chm file extension can be used to identify CHM files. However, any file with CHM formatting, regardless of file extension, should be blocked. (One characteristic is that CHM files start with the ASCII bytes \"ITSF.\")\n- Educate users so they know that .chm files are executable binary files and can cause the same harm as malicious .exe files.\n\n## References\n\n- Microsoft Compiled HTML Help | <https://en.wikipedia.org/wiki/Microsoft_Compiled_HTML_Help>\n- CHM | <https://www.trendmicro.com/vinfo/us/security/definition/chm>\n- Cryptowall Makes a Comeback Via Malicious Help Files (CHM) | <https://www.bitdefender.com/en-us/blog/hotforsecurity/cryptowall-makes-a-comeback-via-malicious-help-files-chm/>\n- Microsoft help file vulnerability could increase impact of phishing attack for all Windows users | <https://www.comparitech.com/blog/information-security/malicious-chm-files/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0005",
                "CM0006",
                "CM0007",
                "CM0008",
                "CM0091"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "en.wikipedia.org",
                    "description": "Microsoft Compiled HTML Help",
                    "url": "https://en.wikipedia.org/wiki/Microsoft_Compiled_HTML_Help"
                },
                {
                    "source_name": "www.trendmicro.com",
                    "description": "CHM",
                    "url": "https://www.trendmicro.com/vinfo/us/security/definition/chm"
                },
                {
                    "source_name": "www.bitdefender.com",
                    "description": "Cryptowall Makes a Comeback Via Malicious Help Files (CHM)",
                    "url": "https://www.bitdefender.com/en-us/blog/hotforsecurity/cryptowall-makes-a-comeback-via-malicious-help-files-chm/"
                },
                {
                    "source_name": "www.comparitech.com",
                    "description": "Microsoft help file vulnerability could increase impact of phishing attack for all Windows users",
                    "url": "https://www.comparitech.com/blog/information-security/malicious-chm-files/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1204",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1218.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0047",
            "name": "Block High-risk File Types at Web Gateway",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0047\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nBlocking high-risk file types at the web gateway restricts adversary initial access and execution.\n\n## Introduction\n\nA web gateway acts as an intermediary, situated between end-users and the internet.  Web gateways can be hosted on-premises or via the cloud.  The web gateway's purpose is to inspect, analyze, and filter malicious inbound/outbound web traffic.  Web gateways enforce acceptable use and security policies.\n\n## Preparation\n\n- Research the web gateway's capabilities.\n- Review policies currently applied to the web gateway.\n- Identify file types necessary to operations.\n- Identify file types that if blocked, could result in operational disruption.\n\n## Risks\n\nBlocking a file type that is necessary to operations can result in an operational disruption.  To mitigate the risk of disruption, ensure that blocked file types are not required.  Continually monitor the web gateway and adjust policies accordingly.\n\n## Guidance\n\nThis countermeasure assumes the organization is using a web gateway.  Please refer to vendor documentation for specific guidance.  \n\n1.\tLogin to the web gateway management portal\n2.\tLocate the existing rule you want to edit or create a new rule\n3.\tEdit or populate the rule with content\n4.\tSave, add, and activate the rule\n5.\tMonitor the web gateway to ensure the newly created rule is effective\n\nThough not exhaustive, the following file types could introduce risk.  Consider blocking executable file types.  Other file types can be blocked though operational necessity should be considered to mitigate the likelihood of disruption.   \n\n| File Types         | File Extensions                                |\n|:-------------------|:--------------------                           |\n|Executable          |exe, scr, vbs, js, xml, docm, xps               |\n|Image               |iso, img                                        |\n|Archive/Compressed  |arj, lzh, r01, r14, r18, r25, tar, ace, zip, jar|\n|Documents           |doc, rtf, xls, pdf, pub                         |\n\n## References\n\n- File Types to Block | <https://docs.umbrella.com/umbrella-user-guide/docs/file-types>\n- Internet Gateway Best Practice Security Policy | <https://docs.paloaltonetworks.com/best-practices/internet-gateway-best-practices/best-practice-internet-gateway-security-policy/transition-safely-to-best-practice-security-profiles/transition-file-blocking-profiles-safely-to-best-practices>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0002",
                "CM0004",
                "CM0056",
                "CM0116",
                "CM0143"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "docs.umbrella.com",
                    "description": "File Types to Block",
                    "url": "https://docs.umbrella.com/umbrella-user-guide/docs/file-types"
                },
                {
                    "source_name": "docs.paloaltonetworks.com",
                    "description": "Internet Gateway Best Practice Security Policy",
                    "url": "https://docs.paloaltonetworks.com/best-practices/internet-gateway-best-practices/best-practice-internet-gateway-security-policy/transition-safely-to-best-practice-security-profiles/transition-file-blocking-profiles-safely-to-best-practices"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1189",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1204.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1204.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0048",
            "name": "Disable Hyper-V",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0048\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling the native Windows Hyper-V hypervisor blocks adversary privilege escalation, lateral movement, and potential C2 capability facilitated by hyperjacking and/or host escape techniques.\n\n## Introduction\n\nHyper-V is a virtualization technology that allows users to create and run virtual machines (VMs) on Windows operating systems. Hyper-V (otherwise known as Viridian or Windows Server Virtualization) has personal and enterprise use cases across hardware virtualization. This countermeasure most closely remediates 'hyperjacking' attempts; hyperjacking involves an attacker installing malicious hypervisors or taking control of the hypervisor within a VM host.\n\nAlthough there are procedures that reduce the risk of hyperjacking such as ensuring isolation of virtual machines behind firewalls and conducting patching of hypervisors, disabling the native Hyper-V hypervisor on Windows machines where it is unnecessary or underutilized most effectively prevents an adversaries' unauthorized control of virtual machines.\n\n## Preparation\n\n- Assess the enterprise network to determine system and service dependencies on Hyper-V. \n\t- Type `msinfo32.exe` in Windows search box -> Select *System Information*\n\t- Locate entry `A hypervisor has been detected. Features required for Hyper-V will not be displayed.`\n- Conduct backup of data on virtual machines managed by Hyper-V.\n- Prior to disabling Hyper-V, ensure proper forensic information is collected on relevant virtual machines.\n- Evaluate possible replacements to Hyper-V technology such as Citrix or Red Hat solutions.\n\n## Risks\n\n- Disabling Hyper-V may disrupt services or the initialization of VMs altogether on host systems.\n- Countermeasure may introduce compatibility issues with applications or services that rely on Hyper-V.\n- Disabling Hyper-V may increase vulnerability of systems to downgrade attacks.\n\n## Guidance\n\n### Disable Hyper-V via Control Panel\n\n- Open the Windows **Control Panel** -> **Programs** -> **Programs and Features** -> *Turn Windows features on or off* \n\t- Locate and expand the folder option titled *Hyper-V*.\n\t- Uncheck the *Hyper-V Hypervisor* check box.\n\t- Restart the computer to apply changes.\n\n### Disable Hyper-V via PowerShell\n\n- Open an administrator PowerShell terminal\n\t- Run the following command `Disable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V-Hypervisor`\n\t- Restart the computer to apply changes.\n\n### Disable Hyper-V via BIOS/UEFI\n\n- Restart the computer to enter BIOS/UEFI settings\n- Locate the **Configuration** tab.\n- Locate the Virtualization Technology option (**Intel Virtual Technology**) to set to **Disabled**.\n- Save changes and exit the BIOS/UEFI settings.\n\n### Verify Hyper-V is Disabled\n\n- Ensure that Hyper-V is disabled by executing the following PowerShell command in an elevated prompt:\n\t-  `Get-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V`\n\t- The returned **State** parameter should contain a value of '**Disabled**.\n\n## References\n\n- Introduction to Hyper-V on Windows 10 | <https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/about/>\n- What is a Hyperjacking Attack and Are You at Risk? | <https://www.makeuseof.com/what-is-hyperjacking-attack/>\n- Virtualization application don't work together with Hyper-V, Device Guard, and Credential Guard | <https://learn.microsoft.com/en-us/troubleshoot/windows-client/application-management/virtualization-apps-not-work-with-hyper-v>\n- 5 Easy Ways to Disable Hyper-V in Windows 10 and 11 | <https://www.guidingtech.com/how-to-disable-hyper-v-windows/>\n- Mitigate VMware Vulnerabilities | <https://www.cisa.gov/news-events/directives/ed-22-03-mitigate-vmware-vulnerabilities>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0020",
                "CM0043",
                "CM0065"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Introduction to Hyper-V on Windows 10",
                    "url": "https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/about/"
                },
                {
                    "source_name": "www.makeuseof.com",
                    "description": "What is a Hyperjacking Attack and Are You at Risk?",
                    "url": "https://www.makeuseof.com/what-is-hyperjacking-attack/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Virtualization application don't work together with Hyper-V, Device Guard, and Credential Guard",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-client/application-management/virtualization-apps-not-work-with-hyper-v"
                },
                {
                    "source_name": "www.guidingtech.com",
                    "description": "5 Easy Ways to Disable Hyper-V in Windows 10 and 11",
                    "url": "https://www.guidingtech.com/how-to-disable-hyper-v-windows/"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "Mitigate VMware Vulnerabilities",
                    "url": "https://www.cisa.gov/news-events/directives/ed-22-03-mitigate-vmware-vulnerabilities"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1610",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1611",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0049",
            "name": "Disable or Monitor Executables with SUID and SGID Bits Set",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0049\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling or monitoring executables with SUID and SGID bits set prevents or detects adversaries from performing privilege escalation using misconfigured application permissions.\n\n## Introduction\n\nSet User ID (SUID) and Set Group ID (SGID) enables an executable on linux to run with the permissions of the owner.\n\n## Preparation\n\nNo Preparation content identified.\n\n## Risks\n\n- Executables that requires elevated privileges will not work for non-privileged users. \n- Tools that depend on the ability to execute SUID/SGID binaries may be disrupted.\n\n## Guidance\n\n### Disabling SUID & SGID Executables\n\nTo disable executables with setuid or setgid permissions, use sudo chmod u-s or chmod g-s respectively. This will remove the designated executable set permissions. If the executables with permissions set are not known, `find / -perm -u=s -type f 2>/dev/null` can be used to find all binaries with SUID starting at the root directory. SGID binaries can be discovered using the same command, but, replace `-u=s` with `-g=s`. Furthermore, the security-misc package my kick-secure can be installed and configured to automate the process of discovering and disabling suid binaries and libraries. A preventative measure that can be used is to mount a filesystem with nosuid flag set. This will prevent the use of executables with SUID or SGID set at or within those locations. \n\n### Monitoring SUID & SGID Binaries\n\nExecution of SUID and SGID binaries are not logged by default. If command history was not cleared, it is possible to check if an SUID/SGID binary was executed or if attempts to discover SUID/SGID binaries were made. The auditd package can be installed and configured to log execution of files and binary discovery commands by configuring the audit rules. Moreover, ps aux can be used to check what processes are running and by whose authority.\n\n## References\n\n- Linux 101: What is the SUID Permission? | <https://www.techrepublic.com/article/linux-101-what-is-the-suid-permission/>\n- SUID Disabler and Permission Hardener | <https://www.kicksecure.com/wiki/SUID_Disabler_and_Permission_Hardener>\n- security-misc: Enhance Miscellaneous Security Settings | <https://www.kicksecure.com/wiki/Security-misc>\n- Linux File Permissions: Understanding setuid, setgid, and the Sticky Bit | <https://www.cbtnuggets.com/blog/technology/system-admin/linux-file-permissions-understanding-setuid-setgid-and-the-sticky-bit>\n- Setuid and Setgid | <https://redcanary.com/threat-detection-report/techniques/setuid-setgid/>\n- Configure Linux system auditing with auditd | <https://www.redhat.com/en/blog/configure-linux-auditing-auditd>\n- The Pwnkit Vulnerability: Overview, detection, and remediation | <https://www.datadoghq.com/blog/pwnkit-vulnerability-overview-and-remediation/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0023",
                "CM0067",
                "CM0109"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.techrepublic.com",
                    "description": "Linux 101: What is the SUID Permission?",
                    "url": "https://www.techrepublic.com/article/linux-101-what-is-the-suid-permission/"
                },
                {
                    "source_name": "www.kicksecure.com",
                    "description": "SUID Disabler and Permission Hardener",
                    "url": "https://www.kicksecure.com/wiki/SUID_Disabler_and_Permission_Hardener"
                },
                {
                    "source_name": "www.kicksecure.com",
                    "description": "security-misc: Enhance Miscellaneous Security Settings",
                    "url": "https://www.kicksecure.com/wiki/Security-misc"
                },
                {
                    "source_name": "www.cbtnuggets.com",
                    "description": "Linux File Permissions: Understanding setuid, setgid, and the Sticky Bit",
                    "url": "https://www.cbtnuggets.com/blog/technology/system-admin/linux-file-permissions-understanding-setuid-setgid-and-the-sticky-bit"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Setuid and Setgid",
                    "url": "https://redcanary.com/threat-detection-report/techniques/setuid-setgid/"
                },
                {
                    "source_name": "www.redhat.com",
                    "description": "Configure Linux system auditing with auditd",
                    "url": "https://www.redhat.com/en/blog/configure-linux-auditing-auditd"
                },
                {
                    "source_name": "www.datadoghq.com",
                    "description": "The Pwnkit Vulnerability: Overview, detection, and remediation",
                    "url": "https://www.datadoghq.com/blog/pwnkit-vulnerability-overview-and-remediation/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1548.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0050",
            "name": "Reset Kerberos Ticket Granting Ticket (KRBTGT) Password Twice",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0050\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nReseting the Kerberos Ticket Granting Ticket (KRBTGT) password twice will terminate adversary credential access via Golden Ticket attacks.\n\n## Introduction\n\nThe KRBTGT account is the Kerberos Key Distribution Center (KDC) service account and is responsible for encrypting and signing all Kerberos ticket requests. The KRBTGT account's password should be reset twice as the account has a two-password history. Failing to reset KRBTGT twice risks another Domain Controller using an old password.\n\n## Preparation\n\n- Verify AD Replication health status.\n- Consult Microsoft Active Directory Forest Recovery - Reset the krbtgt password. Available at <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-reset-the-krbtgt-password>\n\n## Risks\n\n- Resetting the KRBTGT account password will invalidate all AD dependent applications tickets. Non-windows clients may be unable to request new tickets until existing tickets expire. \n- If the KRBTGT account password has never been rotated before, domains may experience replication issues due to KRBTGT account credentials utilizing outdated ciphers (such as DES or RC4).\n\n## Guidance\n\nThe first account reset for the KRBTGT needs to be allowed to replicate prior to the second reset to avoid any issues. Waiting at least 10 hours before performing a second reset will ensure the reset fully propagates within large AD environments. If the maximum lifetime for a user ticket or service ticket policy settings have been modified, the amount of time to wait should be more than the configured value. \n\n### Reset KRBTGT Password with PowerShell\n\nThe KRBTGT account password can be reset twice by using Microsoft's New-KrbtgtKeys script \n\nThe script is available at <https://github.com/microsoftarchive/New-KrbtgtKeys.ps1>.\n\nOrganizations using Read-Write Domain Controllers will need to run the script separately; once for Read-Write Domain Controllers and once for Read-Only Domain Controllers.\n\n\n### Reset KRBTGT Password with Administrative Tools\n\nThe KRBTGT account password can also be reset by using the Control Panel with Administrative Tools and resetting the password for the KRBTGT User account under Active Directory Users and Computers.\n\n## References\n\n- Active Directory Forest Recovery - Reset the krbtgt password | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-reset-the-krbtgt-password>\n- FAQs from the Field on KRBTGT Reset | <https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/faqs-from-the-field-on-krbtgt-reset/ba-p/2367838>\n- Practical Compromise Recovery Guidance for Active Directory | <https://m365internals.com/2021/04/27/practical-compromise-recovery-guidance-for-active-directory/>\n- Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise | <https://www.cisa.gov/news-events/analysis-reports/ar21-134a>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0028",
                "CM0069",
                "CM0070",
                "CM0073",
                "CM0077",
                "CM0083",
                "CM0092",
                "CM0126",
                "CM0135",
                "CM0145"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Active Directory Forest Recovery - Reset the krbtgt password",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-reset-the-krbtgt-password"
                },
                {
                    "source_name": "techcommunity.microsoft.com",
                    "description": "FAQs from the Field on KRBTGT Reset",
                    "url": "https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/faqs-from-the-field-on-krbtgt-reset/ba-p/2367838"
                },
                {
                    "source_name": "m365internals.com",
                    "description": "Practical Compromise Recovery Guidance for Active Directory",
                    "url": "https://m365internals.com/2021/04/27/practical-compromise-recovery-guidance-for-active-directory/"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise",
                    "url": "https://www.cisa.gov/news-events/analysis-reports/ar21-134a"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1558",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1558.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0051",
            "name": "Disable Bluetooth",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0051\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling Bluetooth will prevent adversary objectives of exfiltration and command and control that are achieved by exploiting the Bluetooth protocol.\n\n## Introduction\n\nBluetooth is a short-ranged wireless technology standard that is used to exchange files between nearby devices or for connecting wireless devices such as headphones. Adversaries have been able to leverage Bluetooth to send data to and from compromised devices in order to exfiltrate sensitive data or send command and control traffic over the connection.\n\n## Preparation\n\n-   Identify Applications and devices that require Bluetooth for operational purposes.\n-   Notify Users and Document changes in disabling Bluetooth across devices.\n\n## Risks\n\nDisabling Bluetooth could break some applications or devices that require Bluetooth to function\n\n## Guidance\n\n### Disable Bluetooth via Windows\n\n-   Bluetooth can be turned off via the Window's settings\n\n-   Another option can be via the action center in the bottom right of the taskbar. Open it and click on the Bluetooth icon.\n\n-   For a more permanent solution, one can go into device manager and disable the Bluetooth device outright.\n\n-   Another option is the Bluetooth User Support Service which can be stopped or disabled in the services menu.\n\n### Disabling Bluetooth via Configuration Manager for MDM devices\n\n-   Create a new configuration item in the Configuration Manager console.\n\n-   In the configuration item creation wizard, there are multiple device settings to choose from that let you restrict or outright disable Bluetooth.\n\n## References\n\n-   Turn Bluetooth off in Windows | <https://support.microsoft.com/en-us/windows/turn-bluetooth-on-or-off-in-windows-9e92fddd-4e12-e32b-9132-5e36bdb2f75a>\n-   Additiontal Ways to Turn Bluetooth off in Windows | <https://www.makeuseof.com/turn-off-bluetooth-on-windows-10/>\n-   Windows Bluetooth Features | <https://learn.microsoft.com/en-us/windows-hardware/design/component-guidelines/bluetooth>\n-   Create configuration items for Windows devices | <https://learn.microsoft.com/en-us/mem/configmgr/mdm/deploy-use/create-configuration-items-for-windows-8.1-and-windows-10-devices-managed-without-the-client>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0052",
                "CM0053"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "support.microsoft.com",
                    "description": "Turn Bluetooth off in Windows",
                    "url": "https://support.microsoft.com/en-us/windows/turn-bluetooth-on-or-off-in-windows-9e92fddd-4e12-e32b-9132-5e36bdb2f75a"
                },
                {
                    "source_name": "www.makeuseof.com",
                    "description": "Additiontal Ways to Turn Bluetooth off in Windows",
                    "url": "https://www.makeuseof.com/turn-off-bluetooth-on-windows-10/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Windows Bluetooth Features",
                    "url": "https://learn.microsoft.com/en-us/windows-hardware/design/component-guidelines/bluetooth"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Create configuration items for Windows devices",
                    "url": "https://learn.microsoft.com/en-us/mem/configmgr/mdm/deploy-use/create-configuration-items-for-windows-8.1-and-windows-10-devices-managed-without-the-client"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1011.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0052",
            "name": "Disable NetBIOS Service",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0052\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable \n* **Status:** Active\n\n## Intended Outcome\n\nDisabling the NetBIOS service blocks adversary initial access and lateral movement directives that exploit the NetBIOS service and port pairing.\n\n## Introduction\n\nNetBIOS (Network Basic Input/Output System) is an older network protocol used to facilitate communication between applications on different computers within a local area network (LAN). NetBIOS played a pivotal role in early networking communications and error recovery, although it is now often an unnecessary addition to the session layer of a network. NetBIOS is able to be exploited by attackers to gather computer names, account credentials, and shared network resources which may be leveraged for initial access or lateral movement within a network. For these reasons, it is recommended to disable the NetBIOS service entirely; if this cannot be done, NetBIOS traffic should be restricted to specific IP addresses and should be blocked to/from the Internet.\n\n## Preparation\n\n- Assess the network, identifying service/application dependencies on NetBIOS and impact to operations if NetBIOS is disabled or restricted.\n- Conduct a service scan to detect all devices and interfaces where NetBIOS is enabled.\n- Conduct risk assessment with relevant IT staff and stakeholders to determine whether potential disruption outweighs the consequence of increased exposure to adversary access and lateral movement.\n\n## Risks\n\n- This countermeasure can disrupt functionality of systems that rely on NetBIOS.\n- Disabling NetBIOS or restricting traffic under the service may result in compatibility issues with older networked applications and services.\n\n## Guidance\n\n### Disabling Action\n\n- By default, NetBIOS uses TCP port 139 to provide session services, and uses UDP ports 137 and 138 to provide name services and datagram services respectively. System administrators should disable NetBIOS over TCP/IP on all devices across the network.\n- The NetBIOS service is disabled via network adapter settings and can be functionally restricted to certain IP addresses using the Windows Firewall utility.\n- NetBIOs cannot be disabled via Group Policy adjustments, although it can be disabled programmatically through PowerShell. The following PowerShell script uses Windows Management Instrumentation (WMI) service to enumerate all IP enabled network interfaces to set all NIC's NetBIOS property to disabled:\n`\n$NETBIOS_DISABLED=2\n$NETBIOS_DISABLED=0\nGet-WmiObject Win32_NetworkAdapterConfiguration -filter \"ipenabled = 'true'\" | ForEach-Object { $_.SetTcpipNetbios($NETBIOS_DISABLED)}`\n\n## References\n\n- Weak Security Controls and Practices Routinely Exploited for Initial Access | <https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-137a>\n- NetBIOS (Network Basic Input/Output System) | <https://www.techtarget.com/searchnetworking/definition/NetBIOS>\n- NetBIOS and SMB Penetration Testing on Windows | <https://www.hackingarticles.in/netbios-and-smb-penetration-testing-on-windows/>\n- How to disable NetBIOS over TCP/IP by using DHCP server options | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/disable-netbios-tcp-ip-using-dhcp>\n- How to Disable NetBIOS and LLMNR | <https://blog.alexmags.com/posts/disable-netbios/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0019",
                "CM0020",
                "CM0051",
                "CM0053",
                "CM0098"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisa.gov",
                    "description": "Weak Security Controls and Practices Routinely Exploited for Initial Access",
                    "url": "https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-137a"
                },
                {
                    "source_name": "www.techtarget.com",
                    "description": "NetBIOS (Network Basic Input/Output System)",
                    "url": "https://www.techtarget.com/searchnetworking/definition/NetBIOS"
                },
                {
                    "source_name": "www.hackingarticles.in",
                    "description": "NetBIOS and SMB Penetration Testing on Windows",
                    "url": "https://www.hackingarticles.in/netbios-and-smb-penetration-testing-on-windows/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How to disable NetBIOS over TCP/IP by using DHCP server options",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/disable-netbios-tcp-ip-using-dhcp"
                },
                {
                    "source_name": "blog.alexmags.com",
                    "description": "How to Disable NetBIOS and LLMNR",
                    "url": "https://blog.alexmags.com/posts/disable-netbios/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1046",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1219",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0053",
            "name": "Disable Link-Local Multicast Name Resolution (LLMNR) Service",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0053\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable \n* **Status:** Active\n\n## Intended Outcome\n\nDisabling the Link-Local Multicast Name Resolution (LLMNR) service disrupts adversary credential access and collection via man-in-the-middle and LLMNR poisoning behaviors.\n\n## Introduction\n\nLink-Local Multicast Name Resolution (LLMNR) is a protocol used by Windows to enable name resolution in scenarios where DNS is not present or fails to properly determine hostname and IP address associations. LLMNR operates by sending multicast queries over local networks that prompt an answer (IP address response) from all computers as to whether a certain hostname exists. LLMNR is exploited by attackers to perform man-in-the-middle (MitM) attacks and credential harvesting via LLMNR poisoning. For these reasons, it is recommended to disable the LLMNR service entirely- if this cannot be done, network segmentation should be established between LLMNR and DNS-based networks.\n\n## Preparation\n\n- Assess the network, evaluating the current usage of LLMNR to understand why it is being used.\n- Determine the systems and applications that rely on LLMNR for functionality.\n- Conduct risk assessment with relevant IT staff and stakeholders to determine whether LLMNR can be effectively replaced by DNS implementation.\n- Ensure availability of system backups in scenarios where registry changes are implemented to disable LLMNR.\n\n## Risks\n\n- This countermeasure can disrupt business operations by causing network resolution failure.\n- Disabling LLMNR or switching to DNS may lead to compatibility issues with specialized software.\n- Disabling LLMNR encourages adoption of a DNS solution that requires alternative protections against attacks such as DNS Tunneling and denial-of-service.\n\n## Guidance\n\n### Disable LLMNR on Windows Devices via GPO\n\n- To prevent Windows machines from responding to or initiating LLMNR requests, navigate to the Local Group Policy Editor to set the \"Turn off multicast name resolution\" policy to \"Enabled.\"\n- The same group policy option can be applied to Active Directory Environments:\n\t- Computer Configuration -> Administrative Templates -> Network -> DNSClientEnable -> Turn Off Multicast Name Resolution -> Change value to \"Enabled\"\n- *Note: the option may read as \"Turn Off smart multi-homed name resolution\" instead of \"Turn Off Multicast Name Resolution.\" Change value to \"Enabled\" in both cases.*\n\n### Disable LLMNR on Windows Devices via Registry\n\n- Run the following commands in an elevated command prompt:\n`REG ADD  \"HKLM\\Software\\policies\\Microsoft\\Windows NT\\DNSClient\"`\n`REG ADD  \"HKLM\\Software\\policies\\Microsoft\\Windows NT\\DNSClient\" /v \"EnableMulticast\" /t REG_DWORD /d \"0\" /f`\n- This can also be accomplished by setting the value of the key `(HKLM\\Software\\Policies\\Microsoft\\Windows NT\\DNSClient\\EnableMulticast)` to zero.\n- Document the aforementioned registry key changes.\n\n### Disable LLMNR on Linux \n\n- Adjust the line \"LLMNR=yes\" to \"LLMNR=no\" within the `/etc/systemd/resolved.conf` file on Linux systems.\n- Reboot the Linux system to properly disable LLMNR functionality.\n\n### Configure Network Devices \n\n- Network devices such as routers and switches should be configured to block LLMNR traffic.\n- Filter out LLMNR traffic on the multicast IPv4 address of `224.0.0.252`.\n- After following configuration and disabling procedures, verify that LLMNOR is disabled by monitoring network traffic for LLMNR packets.\n\n## References\n\n- Weak Security Controls and Practices Routinely Exploited for Initial Access | <https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-137a>\n- What is LLMNR Poisoning and How to Avoid It | <https://redfoxsec.com/blog/what-is-llmnr-poisoning-and-how-to-avoid-it/>\n- How To Disable LLMNR & Why You Want To | <https://medium.com/@jamshed_hossain_miraz/how-to-disable-llmnr-why-you-want-to-e3f6deb9333d>\n- How To Disable LLMNR & Why You Want To | <https://www.blackhillsinfosec.com/how-to-disable-llmnr-why-you-want-to/>\n- How to disable NetBIOS and LLMNR Protocols via GPO in Windows 11/10 | <https://www.thewindowsclub.com/disable-netbios-and-llmnr-protocols-via-gpo>\n- Link-local Multicast Name Resolution (LLMNR) | <https://www.rfc-editor.org/rfc/rfc4795>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0051",
                "CM0052",
                "CM0098"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisa.gov",
                    "description": "Weak Security Controls and Practices Routinely Exploited for Initial Access",
                    "url": "https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-137a"
                },
                {
                    "source_name": "redfoxsec.com",
                    "description": "What is LLMNR Poisoning and How to Avoid It",
                    "url": "https://redfoxsec.com/blog/what-is-llmnr-poisoning-and-how-to-avoid-it/"
                },
                {
                    "source_name": "medium.com",
                    "description": "How To Disable LLMNR & Why You Want To",
                    "url": "https://medium.com/@jamshed_hossain_miraz/how-to-disable-llmnr-why-you-want-to-e3f6deb9333d"
                },
                {
                    "source_name": "www.blackhillsinfosec.com",
                    "description": "How To Disable LLMNR & Why You Want To",
                    "url": "https://www.blackhillsinfosec.com/how-to-disable-llmnr-why-you-want-to/"
                },
                {
                    "source_name": "www.thewindowsclub.com",
                    "description": "How to disable NetBIOS and LLMNR Protocols via GPO in Windows 11/10",
                    "url": "https://www.thewindowsclub.com/disable-netbios-and-llmnr-protocols-via-gpo"
                },
                {
                    "source_name": "www.rfc-editor.org",
                    "description": "Link-local Multicast Name Resolution (LLMNR)",
                    "url": "https://www.rfc-editor.org/rfc/rfc4795"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1557.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0054",
            "name": "Block or Restrict Removable Media",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0054\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nBlocking or restricting removable media blocks adversary initial access and lateral movement using malware located on removable media and blocks adversary exfiltration using removable media.\n\n## Introduction\n\nRemovable media bypasses firewalls and intrusion detection systems, making it a prime conduit for malware. Removable media can also be a channel for exfiltrating sensitive data.\n\n## Preparation\n\n- Assess the impact to operations if AutoRun is disabled.\n- Assess the impact to operations if removable media is blocked or restricted.\n- Define an appropriate removable media policy.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\nRemovable media can be disabled or restricted using group policy or the registry. \n\n### Group Policy\n\n- To block or restrict removable media across the organization at the machine level, create/open a GPO to configure the **Computer Configuration > Policies > Administrative Template > System > Removable Storage Access** node.\n- To block or restrict removable media across the organization at the user level, create/open a GPO to configure the **User Configuration > Policies > Administrative Template > System > Removable Storage Access** node.\n\n### Registry\n\nRegistry key values can be set to disable AutoRun or to deny access to removable storage. (Create registry keys as needed.)\n\n#### Disable AutoRun\n\n- Set the value of the **HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoDriveTypeAutoRun** key to **FF** to disable AutoRun on all drives (different bits and bitmask constants can be used to disable AutoRun for particular drive types).\n\n#### Disable Access to Removable Storage Devices\n\n- Set the value of the **HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\RemovableStorageDevices\\Deny_All** key to **1** to disable access to removable storage devices.\n\n## References\n\n- Enabling and Disabling AutoRun | <https://learn.microsoft.com/en-us/windows/win32/shell/autoplay-reg>\n- How to disable removable media access with Group Policy | <https://www.techtarget.com/searchSecurity/tutorial/How-to-disable-removable-media-access-with-Group-Policy>\n- How to Disable AutoRun and AutoPlay for External Devices | <https://www.lifewire.com/disable-autorun-on-a-pc-153344>\n- How to disable access to removable storage devices on Windows 10 | <https://www.windowscentral.com/how-disable-access-removable-storage-devices-windows-10>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Enabling and Disabling AutoRun",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/shell/autoplay-reg"
                },
                {
                    "source_name": "www.techtarget.com",
                    "description": "How to disable removable media access with Group Policy",
                    "url": "https://www.techtarget.com/searchSecurity/tutorial/How-to-disable-removable-media-access-with-Group-Policy"
                },
                {
                    "source_name": "www.lifewire.com",
                    "description": "How to Disable AutoRun and AutoPlay for External Devices",
                    "url": "https://www.lifewire.com/disable-autorun-on-a-pc-153344"
                },
                {
                    "source_name": "www.windowscentral.com",
                    "description": "How to disable access to removable storage devices on Windows 10",
                    "url": "https://www.windowscentral.com/how-disable-access-removable-storage-devices-windows-10"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1025",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1091",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0055",
            "name": "Implement SPF, DKIM, and DMARC Email Authentication Methods",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0055\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling Sender Policy Framework (SPF), DomainKeys Identified Mail (DKIM), and Domain-based Message Authentication Reporting and Conformance (DMARC) email authentication methods restricts adversary initial access via email sent on behalf of a domain they do not own.\n\n## Introduction\n\nSender Policy Framework (SPF) is an authentication protocol that lists IP addresses in a DNS TXT record that are authorized to send email on behalf of domains.  A sent email message will be checked for an SPF record and checked against an authorized sender list.  If the valid SPF record exists, a policy of \"PASS\" or \"FAIL\" will be applied.  Failed policy application should result in the message being routed to a spam folder.   \n\nDomainKeys Identified Mail (DKIM) adds a digital signature to email headers to ensure email content has not changed.  A sent email message will include a private key to encrypt the email signature.  The public key is included in a DNS TXT record.  The message recipient validates the signature by comparing the public/private keys.    \n\nDomain-based Message Authentication, Reporting, and Conformance (DMARC) is an email authentication protocol that uses SPF and DKIM to validate the sender and block fraudulent messaging.  It enables a domain owner to specify a policy for handling unauthenticated messages.    \n\nThese tools ensure that an email message is genuine and is coming from a validated source.  These protocols are not intended to work in isolation and should be implemented together.  Configuring these protocols differs between domain hosting providers.  The guidance herein is intended to describe the process common to all.\n\n## Preparation\n\n- Identify DNS provider and ensure access to the management console.\n- Identify all email senders (services/servers).\n- Some service providers implement these protocols by default.  Check the status of implementation with the organization's email provider.\n\n## Risks\n\nIncorrectly configuring SPF, DKIM, and DMARC can result in legitimate email messages being marked as spam.  To mitigate this risk, validate SPF, DKIM, and DMARC records and policies prior to deployment.  Continually monitor and refine policy implementation.\n\n## Guidance\n\nThis guidance assumes the organization is using a domain provider.  To implement this guidance, login to the domain provider's management console.  References to specific domain provider guidance is provided below.  This list is not exhaustive, please refer to the organization's domain provider for tailored guidance.  \n\n### SPF\n\n1.\tDefine your SPF record for your domain provider.  Ensure syntax is in accordance with domain provider guidance.  \n    - If the organization sends mail with additional services/servers, create a custom SPF record to authorize these services/servers.\n2.\tAdd the SPF record at the domain provider's management console.\n    - If necessary, apply the SPF record to subdomains.\n3.\tSpecify the enforcement rule to apply to the SPF record.  The \"all\" rule is recommended. \n4.\tVerify the SPF records for all relevant domains/subdomains in the domain provider's management console.\n\n### DKIM\n\n1.\tGenerate the public key.\n2.\tCreate and add a DNS TXT record to the organization's DNS manager.  \n3.\tCheck the validity of the DKIM implementation and enable email signing. \n\n### DMARC\n\n1.\tEnsure the existence of SPF and DKIM.  If these protocols are not currently being implemented, they will need to be configured. \n2.\tGenerate a DMARC record. \n3.\tAdd the DMARC record to DNS for each domain.  DMARC policies can be specified for subdomains.  If policies are not specifically applied to subdomains, they will inherent the parent domain's DMARC policy.  \n4.\tModify the policy accordingly.\n\n## References\n\n### SPF Guidance \n\n- Help prevent spoofing and spam with SPF | <https://support.google.com/a/answer/33786>\n- Set up SPF to identify valid email sources for your Microsoft 365 domain | <https://learn.microsoft.com/en-us/defender-office-365/email-authentication-spf-configure?view=o365-worldwide>\n- Video: How to add an SPF record for a domain in your Namecheap account | <https://www.namecheap.com/support/knowledgebase/article.aspx/317/2237/how-do-i-add-txtspfdkimdmarc-records-for-my-domain/>\n- Add an SPF record | <https://www.godaddy.com/help/add-an-spf-record-19218>\n- Using a custom MAIL FROM domain | <https://docs.aws.amazon.com/ses/latest/dg/mail-from.html>\n\n### DKIM Guidance \n\n- Turn on DKIM for your domain | <https://support.google.com/a/answer/174124>\n- Set up DKIM to sign mail from your Microsoft 365 domain | <https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/email-authentication-dkim-configure?view=o365-worldwide>\n- How do I add TXT/SPF/DKIM/DMARC records for my domain? | <https://www.namecheap.com/support/knowledgebase/article.aspx/317/2237/how-do-i-add-txtspfdkimdmarc-records-for-my-domain/>\n- Enable and add DKIM to my domain for Microsoft 365 | <https://www.godaddy.com/help/enable-and-add-dkim-to-my-domain-for-microsoft-365-41748>\n- Easy DKIM in Amazon SES | <https://docs.aws.amazon.com/ses/latest/dg/send-email-authentication-dkim-easy.html>\n\n### DMARC Guidance \n\n- Add your DMARC record | <https://support.google.com/a/answer/2466580>\n- Set up DMARC to validate the From address domain for senders in Microsoft 365 | <https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/email-authentication-dmarc-configure?view=o365-worldwide>\n- How do I add TXT/SPF/DKIM/DMARC records for my domain? | <https://www.namecheap.com/support/knowledgebase/article.aspx/317/2237/how-do-i-add-txtspfdkimdmarc-records-for-my-domain/>\n- Set up SPF, DKIM, or DMARC records for my hosting email | <https://www.godaddy.com/help/set-up-spf-dkim-or-dmarc-records-for-my-hosting-email-40810>\n\n### Verification Tools \n\n- DMARC deployment Tools | <https://dmarcly.com/tools/>\n- DKIM, SPF, DMARC DNS Verification Tool | <https://www.activecampaign.com/dkim-spf-check/>\n- DMARC Email Delivery Tools | <https://mxtoolbox.com/dmarc/dmarc-email-tools?referrer=cms_dmarchome>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "support.google.com",
                    "description": "Help prevent spoofing and spam with SPF",
                    "url": "https://support.google.com/a/answer/33786"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Set up SPF to identify valid email sources for your Microsoft 365 domain",
                    "url": "https://learn.microsoft.com/en-us/defender-office-365/email-authentication-spf-configure?view=o365-worldwide"
                },
                {
                    "source_name": "www.namecheap.com",
                    "description": "Video: How to add an SPF record for a domain in your Namecheap account",
                    "url": "https://www.namecheap.com/support/knowledgebase/article.aspx/317/2237/how-do-i-add-txtspfdkimdmarc-records-for-my-domain/"
                },
                {
                    "source_name": "www.godaddy.com",
                    "description": "Add an SPF record",
                    "url": "https://www.godaddy.com/help/add-an-spf-record-19218"
                },
                {
                    "source_name": "docs.aws.amazon.com",
                    "description": "Using a custom MAIL FROM domain",
                    "url": "https://docs.aws.amazon.com/ses/latest/dg/mail-from.html"
                },
                {
                    "source_name": "support.google.com",
                    "description": "Turn on DKIM for your domain",
                    "url": "https://support.google.com/a/answer/174124"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Set up DKIM to sign mail from your Microsoft 365 domain",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/email-authentication-dkim-configure?view=o365-worldwide"
                },
                {
                    "source_name": "www.namecheap.com",
                    "description": "How do I add TXT/SPF/DKIM/DMARC records for my domain?",
                    "url": "https://www.namecheap.com/support/knowledgebase/article.aspx/317/2237/how-do-i-add-txtspfdkimdmarc-records-for-my-domain/"
                },
                {
                    "source_name": "www.godaddy.com",
                    "description": "Enable and add DKIM to my domain for Microsoft 365",
                    "url": "https://www.godaddy.com/help/enable-and-add-dkim-to-my-domain-for-microsoft-365-41748"
                },
                {
                    "source_name": "docs.aws.amazon.com",
                    "description": "Easy DKIM in Amazon SES",
                    "url": "https://docs.aws.amazon.com/ses/latest/dg/send-email-authentication-dkim-easy.html"
                },
                {
                    "source_name": "support.google.com",
                    "description": "Add your DMARC record",
                    "url": "https://support.google.com/a/answer/2466580"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Set up DMARC to validate the From address domain for senders in Microsoft 365",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/email-authentication-dmarc-configure?view=o365-worldwide"
                },
                {
                    "source_name": "www.namecheap.com",
                    "description": "How do I add TXT/SPF/DKIM/DMARC records for my domain?",
                    "url": "https://www.namecheap.com/support/knowledgebase/article.aspx/317/2237/how-do-i-add-txtspfdkimdmarc-records-for-my-domain/"
                },
                {
                    "source_name": "www.godaddy.com",
                    "description": "Set up SPF, DKIM, or DMARC records for my hosting email",
                    "url": "https://www.godaddy.com/help/set-up-spf-dkim-or-dmarc-records-for-my-hosting-email-40810"
                },
                {
                    "source_name": "dmarcly.com",
                    "description": "DMARC deployment Tools",
                    "url": "https://dmarcly.com/tools/"
                },
                {
                    "source_name": "www.activecampaign.com",
                    "description": "DKIM, SPF, DMARC DNS Verification Tool",
                    "url": "https://www.activecampaign.com/dkim-spf-check/"
                },
                {
                    "source_name": "mxtoolbox.com",
                    "description": "DMARC Email Delivery Tools",
                    "url": "https://mxtoolbox.com/dmarc/dmarc-email-tools?referrer=cms_dmarchome"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1566.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1566.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1566.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0056",
            "name": "Disable Visual Basic for Applications (VBA) Macros",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0056\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling macros prevents the execution of Visual Basic for Applications (VBA) in Office documents that could otherwise afford an adversary the opportunity to achieve user-driven execution.\n\n## Introduction\n\nMacros enable users to use VBA to automate repetitive tasks in Microsoft Office. Macros are widely used but are commonly abused by adversaries to achieve user execution in pursuit of initial access, execution, lateral movement, and persistence.\n\nThough macros are often employed during phishing campaigns, the intent of this countermeasure is to contain a threat that is abusing macros to expand or maintain access, and thereby slow the pace and extent of adversarial advance.  This countermeasure is intended to be stopgap and should be implemented on a short-term basis.  This countermeasure should only be considered if attempts to restrict macros have not been successful.\n\n## Preparation\n\n-\tAttempt to determine the extent to which macros are used within the organization.\n-\tInform stakeholders of the potential for operational disruption.\n-\tConsider long-term alternatives that are less disruptive e.g. restricting macros.\n\n## Risks\n\nDisabling macros writ-large can disrupt operations. Consider less disruptive countermeasures e.g. restricting macros to minimize the risk of operational disruption.\n\n## Guidance\n\n### Disable via GPO \n\n-\tIf you are not already managing Microsoft Office settings using Group Policy, [import](https://learn.microsoft.com/en-us/troubleshoot/windows-client/group-policy/create-and-manage-central-store) the [Office administrative templates (ADMX)](https://www.microsoft.com/en-us/download/details.aspx?id=49030) for the correct version of Office.\n-\tVia the Group Policy Management Console, create or edit a Group Policy Object. \n-\tSelect `Administrative Templates>Microsoft Word 20xx>Word Options>Security Trust Center`.\n-\tEnable `Disable VBA for Office applications` and apply the policy.\n-\tEnable `Disable all macros with notification`. \n\n### Disable via Intune Policy\n\n-\tSign into the Intune Endpoint Manager portal.\n-\tSelect `Devices>Windows>Configuration Profiles>Create Profile`.\n-\tSelect `Platform>Windows xx>Profile>Profile Type>Settings Catalog` Create. \n-\tOn the `Basics` tab, Name the policy and enter a description.\n-\tIn `Configuration Settings` select `Add Settings`.\n-\tSearch for `Disable VBA for Office applications`.\n-\tEnable and apply the policy.\n-\tSearch for `Disable all macros with notification`.\n-\tEnable and apply the policy.\n\n## References\n\n- Macro Security for Microsoft Office | <https://www.ncsc.gov.uk/guidance/macro-security-for-microsoft-office>\n- Small Business Cloud Security Guides: Technical Example - Configure Macro Settings \n- Managing the Central Store for Group Policy Administrative Templates | <https://learn.microsoft.com/en-us/troubleshoot/windows-client/group-policy/create-and-manage-central-store>\n- Administrative Templates (ADMX/ADML) for Microsoft Office | <https://www.microsoft.com/en-us/download/details.aspx?id=49030>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0005",
                "CM0045",
                "CM0047",
                "CM0113",
                "CM0116"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.ncsc.gov.uk",
                    "description": "Macro Security for Microsoft Office",
                    "url": "https://www.ncsc.gov.uk/guidance/macro-security-for-microsoft-office"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Managing the Central Store for Group Policy Administrative Templates",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-client/group-policy/create-and-manage-central-store"
                },
                {
                    "source_name": "www.microsoft.com",
                    "description": "Administrative Templates (ADMX/ADML) for Microsoft Office",
                    "url": "https://www.microsoft.com/en-us/download/details.aspx?id=49030"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1137.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1204.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0057",
            "name": "Verify Signing of AppleScripts",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0057\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nVerifying that AppleScripts are signed by a trusted developer ID restricts an adversary's ability to arbitrarily execute untrusted AppleScripts.\n\n## Introduction\n\nAppleScript is a scripting language native to MacOS. It can be abused in a manner similar to Bash, Python, and PowerShell. Adversaries have used AppleScript to achieve browser hijacking, spoofing, and persistence.\n\nAppleScript can be used to achieve persistence, execution, and defense evasion, It can also be used to enable tactics like command-and-control. \n\nVerifying AppleScript signatures indicates that the AppleScript is from a trusted source. This measure will hinder an adversary's ability to abuse AppleScript to persist and further compromise the environment.\n\n## Preparation\n\n- Identify and document all AppleScripts currently in use within the organization. Assess their source and establish inventory count on those that are signed and those unsigned.\n- Compile a list of trusted developers whose signed scripts will be allowed to execute within the network. This list should be approved by the organization's security team.\n- Define guidelines for corporate development of AppleScripts- specify requirements for script signing and testing before deployment.\n\n## Risks\n\n- This countermeasure can interfere with business operations and efficacy as restricting AppleScripts to only those signed by trusted developers can negate the effect of unsigned scripts that existed in previous workflows.\n\n## Guidance\n\n### Enforcing Script Signing Policies \n\n- Utilize macOS Gatekeeper to constrain script execution to signed scripts. Configure Gatekeeper to block unsigned scripts and those not signed by previously identified trusted developers.\n- Conduct regular audits of script usage and signing policies to ensure that they remain effective and updated with the latest security practices and standards.\n\n### Developer Verification Process\n\n- Ensure that scripts are signed with a certificate that is validated/trusted by the organization.\n- Ensure that certificates used for signing have not been revoked; ensure the integrity of the trusted developer list is up to date with certificate lifespan.\n\n### Monitor for AppleScript Abuse\n\n- Implement endpoint detection and response (EDR) tools to collect data on process creation events that suggest AppleScript execution. Look for processes like `osascript` and investigate any anomalies.\n- Monitor the loading of modules and libraries related to AppleScript execution. Pay attention to any unsigned or suspicious modules.\n- Regularly analyze logs from macOS systems to detect unusual AppleScript execution or access attempts.\n\n## References\n\n- How AppleScript Is Used For Attacking macOS | <https://www.sentinelone.com/blog/how-offensive-actors-use-applescript-for-attacking-macos/>\n- Introduction to AppleScript Language Guide | <https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/introduction/ASLR_intro.html>\n- Gatekeeper and runtime protection in macOS | <https://support.apple.com/guide/security/gatekeeper-and-runtime-protection-sec5599b66df/web>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0031",
                "CM0091"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.sentinelone.com",
                    "description": "How AppleScript Is Used For Attacking macOS",
                    "url": "https://www.sentinelone.com/blog/how-offensive-actors-use-applescript-for-attacking-macos/"
                },
                {
                    "source_name": "developer.apple.com",
                    "description": "Introduction to AppleScript Language Guide",
                    "url": "https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/introduction/ASLR_intro.html"
                },
                {
                    "source_name": "support.apple.com",
                    "description": "Gatekeeper and runtime protection in macOS",
                    "url": "https://support.apple.com/guide/security/gatekeeper-and-runtime-protection-sec5599b66df/web"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1059.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0058",
            "name": "Detect and Block Execution of Vulnerable Drivers",
            "subtype": "Examine, Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0058\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDetecting and blocking the execution of vulnerable drivers prevents and/or detects adversaries attempting to use vulnerable drivers to evade defenses and escalate privileges.\n\n## Introduction\n\nDrivers are software that act as intermediaries between the operating system and the underlying hardware. In essence, a driver solves compatibility issues between hardware and software. Adversaries abuse vulnerable drivers using a technique known as Bring Your Own Vulnerable Driver (BYOVD). In this attack an adversary delivers and installs a vulnerable driver on to the target system and exploits the vulnerability to execute code in kernel mode. Adversaries in the past or targeting older platforms would load unsigned drivers for exploitation. Due to Windows Driver Signature Enforcement (DSE), only signed kernel drivers can be loaded. Therefore, adversaries will load and exploit vulnerable signed drivers and then load unsigned malicious drivers. Microsoft's attack surface reduction (ASR) tool, Intune, can be configured to prevent installation of vulnerable signed drivers.\n\n## Preparation\n\n- Consult documentation and SMEs regarding needed drivers.\n\n## Risks\n\n- Blocking vulnerable drivers can result in operational disruption if hardware that is no longer supported is in use. \n- Applications with embedded device drivers will break or lose functionality. Check vendor to see is a solution for decoupling an application from the embedded driver with a more secure version. \n- Blocking vulnerable device drivers can cause Windows to produce a \"Blue Screen of Death\" error.\n\n## Guidance\n\n### Detection of vulnerable or malicious drivers\n\n* Monitor driver loads through event logs. \n    - Sysmon event id 6 records driver loads.\n* Monitoring Services\n    - Command line monitoring (sc.exe query)\n    - Reg modifications to HKLM\\SYSTEM\\CurrentControlset\\Services\n    - Manual inspection using Windows Device Manager (devmgmt.msc)\n* Alert to security processes terminated by drivers\n* Audits using specialized software, driver queries, or manual inspection and comparing active driver list to a whitelist or blacklist of drivers. \n\n### Blocking execution or loading of vulnerable or malicious drivers\n\nTo address the challenge of adversaries loading signed drivers, the certificate of known vulnerable or malicious drivers should be in a revocation list. \nMicrosoft provides tools which can be enabled or configured to prevent abuse of vulnerable drivers which will be covered in this guidance section. \n\n#### Enable/Verify Microsoft's vulnerable driver blocklist\n\nMicrosoft's vulnerable driver blocklist is a native utility for Windows 11 2022 and above that receives updates 1-2 times per year for the block list. Vulnerable driver blocklist is enforced when Hypervisor-protected coded integrity or HVCI, Smart App Control, or S mode is active. \nNavigate to the Windows Security App -> Click Device Security -> Core Isolation -> Toggle switch on for Microsoft Vulnerable Driver Blocklist if off.\n\n#### Windows Defender Application Control (WDAC)\n\nFor devices where HVCI or S mode is not available, Microsoft offers a recommended block list that can be added to Windows Defender Application Control policy. To view and download list, search for Microsoft's driver block list. It is also recommended to test the policy in audit mode and review the audit block events to mitigate implementation risks.\n\n## References\n\n- Should You Use Microsoft Vulnerable Driver Blocklist? | <https://www.itprotoday.com/vulnerabilities-threats/should-you-use-microsoft-vulnerable-driver-blocklist->\n- What is a driver? | <https://learn.microsoft.com/en-us/windows-hardware/drivers/gettingstarted/what-is-a-driver->\n- Strategies to monitor and prevent vulnerable driver attacks | <https://techcommunity.microsoft.com/t5/microsoft-security-experts-blog/strategies-to-monitor-and-prevent-vulnerable-driver-attacks/ba-p/4103985#:~:text=This%20involves%20introducing%20a%20digitally,system%20behaviour%20to%20remain%20undetected.>\n- Microsoft recommended driver block rules | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/design/microsoft-recommended-driver-block-rules>\n- SCATTERED SPIDER Exploits Windows Security Deficiencies with Bring-Your-Own-Vulnerable-Driver Tactic in Attempt to Bypass Endpoint Security | <https://www.crowdstrike.com/en-us/blog/scattered-spider-attempts-to-avoid-detection-with-bring-your-own-vulnerable-driver-tactic/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0034",
                "CM0229"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.itprotoday.com",
                    "description": "Should You Use Microsoft Vulnerable Driver Blocklist?",
                    "url": "https://www.itprotoday.com/vulnerabilities-threats/should-you-use-microsoft-vulnerable-driver-blocklist-"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "What is a driver?",
                    "url": "https://learn.microsoft.com/en-us/windows-hardware/drivers/gettingstarted/what-is-a-driver-"
                },
                {
                    "source_name": "techcommunity.microsoft.com",
                    "description": "Strategies to monitor and prevent vulnerable driver attacks",
                    "url": "https://techcommunity.microsoft.com/t5/microsoft-security-experts-blog/strategies-to-monitor-and-prevent-vulnerable-driver-attacks/ba-p/4103985#:~:text=This%20involves%20introducing%20a%20digitally,system%20behaviour%20to%20remain%20undetected."
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft recommended driver block rules",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/design/microsoft-recommended-driver-block-rules"
                },
                {
                    "source_name": "www.crowdstrike.com",
                    "description": "SCATTERED SPIDER Exploits Windows Security Deficiencies with Bring-Your-Own-Vulnerable-Driver Tactic in Attempt to Bypass Endpoint Security",
                    "url": "https://www.crowdstrike.com/en-us/blog/scattered-spider-attempts-to-avoid-detection-with-bring-your-own-vulnerable-driver-tactic/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1068",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1553.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562.010",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0059",
            "name": "Configure Tactical Privileged Access Workstation",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0059\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nConfiguring a tactical privileged access workstation (PAW) enables privileged administrators to respond to an incident while minimizing the exposure of privileged administrator accounts.\n\n## Introduction\n\nA privileged access workstation (PAWs) is a dedicated computer environment that allows accounts with elevated permissions, such as Tier-0 domain administrators, to access and configure highly-sensitive accounts, resources, and functions. PAWs are deployed to enforce the separation of security tiers.  Properly configured PAWs ensure the device, accounts, and tools exist within the same security tier, thus minimizing the potential attack surface.\n\nIf properly implemented, the tactical PAWs will enable privileged administrators to respond with the required degree of privilege while reducing the risk of exposure from other security tiers. Note that the tactical deployment of PAWs will not protect an environment from an adversary that has already achieved privileged access.\n\n## Preparation\n\n- Ideally, PAWs will be configured prior to an incident as configuring dedicated PAWs can be time consuming. If this in not the case, PAWs will need to be rapidly configured with dedicated hardware and software to enable incident response and reduce exposure.\n\n## Risks\n\n- Leveraging a fresh PAW to facilitate incident response may result in unforeseen difficulties, including software components breaking or security controls interfering with what a responder needs to accomplish to remediate the compromise.\n\n## Guidance\n\n- Create a secure administrative Active Directory organizational unit (OU) structure to host the privileged access workstation (PAW).\n\n- Implement Microsoft Windows Privileged Access Workstation (PAW) Security Technical Implementation Guides (STIG) to quickly minimize the attack surface area of PAWs. The Windows PAW STIG provides configuration and installation requirements for dedicated Windows workstations used exclusively for remote administrative management of designated high-value IT resources.\n\n- Treat the PAW as if it were an air-gapped machine. This means ensuring all remote access is disabled and blocked to prevent unauthorized access.\n\n- Configure the domain administrator account (or other accounts with similarly expansive privilege sets) to only permit authentication from the newly provisioned PAWs. Continue to abide by the principle of least privilege. \n\n- Ensure firewall rules permit only communications with the AD server and utilize a jump box / jump server between the PAW and compromised computing environment. All outbound connections to the Internet from the PAW should be blocked. \n\n- Ensure physical hardware supports the latest Trusted Platform Module and encryption.\n\n- Require multi-factor authentication (MFA) for all accounts operating on PAW(s).\n\n- Avoid the use of wireless network communications and rely on wired network connections wherever possible. \n\n- Document use of USB storage media or peripherals. Avoid reuse of peripherals that were ever used on the compromised computing environment.  \n\n- Only run the necessary tooling to carry out system administration duties to minimize its attack surface. Adding unnecessary tools will risk introducing potential vulnerabilities to an otherwise secure workstation.\n\n## References\n\n- Implementing a Zero Trust strategy after compromise recovery | <https://www.microsoft.com/en-us/security/blog/2022/09/14/implementing-a-zero-trust-strategy-after-compromise-recovery/>\n- Privileged access: Strategy | <https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-strategy>\n- Privileged access deployment | <https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-deployment>\n- Microsoft Windows Privileged Access Workstation (PAW) STIG - Ver 2, Rel 3 | <https://public.cyber.mil/u_ms_windows_paw_v2r3_stig/>\n- Using Privileged Access Workstations (PAWs) to Protect the Cloud | <https://www.beyondtrust.com/blog/entry/using-privileged-access-workstations-to-protect-the-cloud>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0027",
                "CM0065",
                "CM0084",
                "CM0094"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.microsoft.com",
                    "description": "Implementing a Zero Trust strategy after compromise recovery",
                    "url": "https://www.microsoft.com/en-us/security/blog/2022/09/14/implementing-a-zero-trust-strategy-after-compromise-recovery/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Privileged access: Strategy",
                    "url": "https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-strategy"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Privileged access deployment",
                    "url": "https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-deployment"
                },
                {
                    "source_name": "public.cyber.mil",
                    "description": "Microsoft Windows Privileged Access Workstation (PAW) STIG - Ver 2, Rel 3",
                    "url": "https://public.cyber.mil/u_ms_windows_paw_v2r3_stig/"
                },
                {
                    "source_name": "www.beyondtrust.com",
                    "description": "Using Privileged Access Workstations (PAWs) to Protect the Cloud",
                    "url": "https://www.beyondtrust.com/blog/entry/using-privileged-access-workstations-to-protect-the-cloud"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1056",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1189",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1566",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1606",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1606.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0060",
            "name": "Restrict and Monitor Domain Accounts with Local Administrator Access to Workstations",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0060\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nRestricting and monitoring domain accounts with local administrator access to standard workstations prevents privilege escalation and impedes attempts at credential access and lateral movement.\n\n## Introduction\n\nWhen a domain account signs into a standard workstation, those account credentials may be cached. If an adversary compromises a standard workstation, they will be able to retrieve cached credentials belonging to other domain accounts. With these credentials, the adversary will be able to move vertically or horizontally in the network in pursuit of their ultimate objective(s). If the credentials obtained by the adversary belong to a domain account with local administrator access, the adversary will be able to leverage these privileges to persist in the network.\n\n## Preparation\n\n- Consult operations, documentation and personnel regarding needed actions to be performed as a local admin and device permissions.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\n### Monitor\n\nMonitoring activities for domain accounts with local privilege access will involve logging commands and tracking network activity. If an adversary has compromised a domain account with local privileged access to a workstation, their next goal will be to discover more information that will aid in pivoting. They may attempt to steal the SAM and System hive for offline cracking or use mimikatz to dump credentials stored on the host. Monitoring should track for use of the \"reg save\" command or vssadmin to stage the SAM and SYSTEM file in a folder for exfiltration. Windows Security Event ID 4656 can be used to track calls to the lsass.exe process. \n\nAttempts could also be made to use other local accounts to connect to a different workstation using PsExec or pass-the-hash tactics. PsExec logs can be tracked by Windows security log 5145 and Windows system log 7045. SMB connections to remote systems could be another indicator of attack. \n\n### Restrict\n\nGranting domain accounts local privileged access could be permissible in instances where the host is blocked or has restricted access to the internal network. Additionally, no credentials stored or open connections to the host from internal devices should be allowed or else that could enable the adversary to pivot to other hosts with stolen credentials.\n\n## References\n\n- GPO Abuse Privilege Escalation to Local Admin | <https://medium.com/@ericwsound/gpo-abuse-privilege-escalation-to-local-admin-cb212a1b4fdc>\n- Implementing Least Privilege Administrative Models | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/implementing-least-privilege-administrative-models>\n- Appendix H: Securing Local Administrator Accounts and Groups | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-h--securing-local-administrator-accounts-and-groups>\n- Mimikatz detection using Windows Security Event Logs | <https://www.linkedin.com/pulse/mimikatz-detection-using-windows-security-event-logs-samir-b->\n- Threat Hunting: How to Detect PsExec | <https://www.praetorian.com/blog/threat-hunting-how-to-detect-psexec/>\n- Detecting PsExec lateral movements: 4 artifacts to sniff out intruders | <https://www.hackthebox.com/blog/how-to-detect-psexec-and-lateral-movements>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0043",
                "CM0063",
                "CM0084",
                "CM0085",
                "CM0102",
                "CM0103",
                "CM0104",
                "CM0124",
                "CM0126",
                "CM0140",
                "CM0141"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "medium.com",
                    "description": "GPO Abuse Privilege Escalation to Local Admin",
                    "url": "https://medium.com/@ericwsound/gpo-abuse-privilege-escalation-to-local-admin-cb212a1b4fdc"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Implementing Least Privilege Administrative Models",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/implementing-least-privilege-administrative-models"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Appendix H: Securing Local Administrator Accounts and Groups",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-h--securing-local-administrator-accounts-and-groups"
                },
                {
                    "source_name": "www.linkedin.com",
                    "description": "Mimikatz detection using Windows Security Event Logs",
                    "url": "https://www.linkedin.com/pulse/mimikatz-detection-using-windows-security-event-logs-samir-b-"
                },
                {
                    "source_name": "www.praetorian.com",
                    "description": "Threat Hunting: How to Detect PsExec",
                    "url": "https://www.praetorian.com/blog/threat-hunting-how-to-detect-psexec/"
                },
                {
                    "source_name": "www.hackthebox.com",
                    "description": "Detecting PsExec lateral movements: 4 artifacts to sniff out intruders",
                    "url": "https://www.hackthebox.com/blog/how-to-detect-psexec-and-lateral-movements"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0061",
            "name": "Rotate Mailbox Passwords",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0061\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRotating mailbox passwords reduces the risk of unauthorized access, data breaches, and mailbox misuse for malicious purposes.\n\n## Introduction\n\nAdversaries that target an email account may intend to collect information, weaponize the account for spear phishing, or repurpose the account for data exfiltration. Rotating mailbox credentials will disrupt the adversary's access to the email account.\n\n## Preparation\n\n- Organizations using Microsoft365 should consult Microsoft's instructions for responding to a compromised email account and implement multi-factor authentication as part of their remediation strategy.\n- Organizations can prepare in advance by developing a standard operating procedure when pushing out mandatory password resets to affected accounts. These instructions should include guidance for alerting users and a means for users to confirm the veracity of password reset requests to reduce the risk for future social engineering attacks.\n- Know or find out who your mailbox users are in your environment.\n\n## Risks\n\n- User account password reset events could potentially alert an adversary to defensive measures being taken against their actions. \n- Users may forget newly created passwords and result in temporary account lockouts.\n- Administrators may reuse passwords and result in adversaries retaining or gaining access.\n\n## Guidance\n\n### Rotating Passwords\n\nOrganizations should consult the documentation provided by their respective email and personal information manager provider and follow the vendor's instructions for performing password resets. \n\nFor example, if the organization is subscribed to Microsoft365, administrators will be able to reset an individual's password (and therefore enterprise mailbox password) via the Microsoft 365 admin center. Alternately, administrators may instead use the PowerShell cmdlet Set-ADAccountPassword to perform the same action.\n\n## References\n\n- Responding to a compromised email account | <https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/responding-to-a-compromised-email-account?view=o365-worldwide>\n- Reset passwords for Microsoft 365 for business | <https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/reset-passwords?view=o365-worldwide&redirectSourcePath=%252farticle%252fadmins-reset-office-365-business-passwords-7a5d073b-7fae-4aa5-8f96-9ecd041aba9c>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0074",
                "CM0082",
                "CM0126",
                "CM0128"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Responding to a compromised email account",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/responding-to-a-compromised-email-account?view=o365-worldwide"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Reset passwords for Microsoft 365 for business",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/reset-passwords?view=o365-worldwide&redirectSourcePath=%252farticle%252fadmins-reset-office-365-business-passwords-7a5d073b-7fae-4aa5-8f96-9ecd041aba9c"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1110",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1114.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1555",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0062",
            "name": "Monitor or Block Server Message Block (SMB) Protocol",
            "subtype": "Examine, Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0062\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Disable\n* **Status:** Active\n\n## Intended Outcome\n\nMonitoring and/or blocking the Server Message Block (SMB) protocol detects and/or blocks adversary lateral movement and command and control using SMB.\n\n## Introduction\n\nNo Introduction content identified.\n\n## Preparation\n\n-\tDetermine the extent to which SMB is used in the environment.\n-\tDetermine the extent to which SMB has been secured in the environment.\n-\tIdentify distinctions between legitimate and malicious SMB usage.\n-\tIdentify opportunities for data collection.\n\n## Risks\n\n-\tBlocking SMB can impact the operation or functionality of systems in a domain by obstructing access to shared files, data, and/or devices.\n-\tTo minimize the likelihood of operational disruption, continually assess the effectiveness and efficiency of monitoring, collection, and detection.  Take steps to minimize the likelihood of false positives.\n\n## Guidance\n\n### Monitor\n\n#### Collection\n\n-\tHost-based agents should, to the extent possible, be configured to monitor files, processes, named pipes, logon sessions, network shares, network traffic, and command-line execution.  These measures could provide insight into SMB abuse.    \n-\tCollect host-based logs (EDR, event logs, Sysmon, etc.).  If available, consider collecting logs for process creation, file creation, named pipe creation, named pipe connection, and network connections.  Consider reviewing windows security events for process creation, remote network authentication, special logons, and network share logs.  Investigate instances of process execution from admin shares and file write on admin shares. \n\n#### Detection\n\n-\tConsider implementing detection logic that monitors for the following 3 conditions within a 10-minute period:\n    -   Successful logon event\n    -   A process launches in the ADMIN$ path on a remote host\n    -   A file share being opened repeatedly\n\n### Block\n\n-\tRestrict or block all SMB communication between workstations to limit the likelihood of abusing the protocol to move laterally.  \n-\tRestrict or block SMB communications from workstations to servers where the business need for the protocol does not exist.\n\n## References\n\n- Restricting SMB Based Lateral Movement in a Windows Environment | <https://blog.palantir.com/restricting-smb-based-lateral-movement-in-a-windows-environment-ed033b888721>\n- Offensive Lateral Movement | <https://posts.specterops.io/offensive-lateral-movement-1744ae62b14f>\n- Detecting Malicious C2 Activity - SpawnAs & SMB Lateral Movement in CobaltStrike | <https://dansec.medium.com/detecting-malicious-c2-activity-spawnas-smb-lateral-movement-in-cobaltstrike-9d518e68b64>\n- SMB/Windows Admin Shares | <https://redcanary.com/threat-detection-report/techniques/windows-admin-shares/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0020",
                "CM0100",
                "CM0141"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "blog.palantir.com",
                    "description": "Restricting SMB Based Lateral Movement in a Windows Environment",
                    "url": "https://blog.palantir.com/restricting-smb-based-lateral-movement-in-a-windows-environment-ed033b888721"
                },
                {
                    "source_name": "posts.specterops.io",
                    "description": "Offensive Lateral Movement",
                    "url": "https://posts.specterops.io/offensive-lateral-movement-1744ae62b14f"
                },
                {
                    "source_name": "dansec.medium.com",
                    "description": "Detecting Malicious C2 Activity - SpawnAs & SMB Lateral Movement in CobaltStrike",
                    "url": "https://dansec.medium.com/detecting-malicious-c2-activity-spawnas-smb-lateral-movement-in-cobaltstrike-9d518e68b64"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "SMB/Windows Admin Shares",
                    "url": "https://redcanary.com/threat-detection-report/techniques/windows-admin-shares/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1572",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0063",
            "name": "Investigate Suspicious Login Attempts",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0063\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nInvestigating suspicious login attempts detects adversary credential access and lateral movement.\n\n## Introduction\n\nCyber responders should follow best practices regarding monitoring systems for potential breaches. Two areas for consideration are external logins and internal logins. Adversaries may continue to use credential access techniques and/or abuse valid accounts after eradication and recovery efforts. \n\n### External Login Attempts\n\nExternal attacks for credential access will be for initial access to the environment. Investigate web application authentication logs, associated IP addresses, and frequency of http requests. An additional area of investigation is remote logins. Network activity should be monitored for signs of brute force, failed login attempts, and origin source. \n\n### Internal Login Attempts\n\nInternal login attempts may occur when an account in the environment has been compromised and the adversary is looking to move laterally or escalate privileges. Internal logins are suspicious if a logged in user or device is attempting to access accounts or devices not within the scope of their duties or usual activities.\n\n## Preparation\n\nNo Preparation content identified.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\nTo investigate suspicious login attempts, consider these 4 \"W\"s: \n\n- Who: The user(s) attempting to gain access,\n- When: At what times were access attempts occurring and frequency of attempts,\n- Where: The associated IP/MAC address the requests are coming from, and\n- What: The platform to be accessed (host, network service, web application, etc). \n\nAfter applying these 4 \"W\"s, it may be necessary to lock the account and send a notification to the affected user(s) to reset their secrets. \n\n### Incident Counter Strategies\n\nTo counter suspicious login attempts, it may be necessary to move an account to a protected users security group or an equivalent. Doing so will help protect against credential theft for both devices and users.\nAnother strategy will be to tune EDR, SIEMs, threat hunting tools, etc., to an ongoing threat actors potential targets. This will be useful in restricting an adversary's actions, determining their goals, and removing them from all affected systems. \n\n#### Windows Event Logs\n\nResponders should review event logs in case of an incident to check for suspicious activity. These logs can be found in C:\\Windows\\System32\\winevt\\Logs\\ or in event viewer's Window's Security logs and filtering for event IDs \n* Event ID: 4624 Captures successful logon events and will be an important log to monitor. This log also captures \"Logontypes\" with types 3, 9, and 10 being most important for suspicious activity. \n    - Logon type 3 refers to users logging in through network shares such as SMB. Adversaries will often use pass-the-hash or a discovered password to get an interactive shell or discover more information using a user's credentials. \n    - Logontype 9 can be suspicous if a regular user uses the \"runas\" command to perform actions as another user on the network. \n    - Logontype 10 captures remote log-in such as WinRM and RDP which is often used by adversaries that have stolen credentials. \n * Event ID: 4625 Captures failed logon events and will an another important event to monitor. It will be important to pay attention to the status codes which are in hexadecimal format.\n     - 0xC000006F describes a user that attempts to log-in outside of work hours. If the machine is configured to reject logon attempts outside of duty hours, this could be an indicator of attack (IoA).\n     - 0xc000015b describes a user that attempts to log-in to a machine not associated with their account. This could be a sign of pivoting attempts by an adversary and should be monitored. \n* Event ID: 4648 Captures logons using explicit credentials such as with the \"runas\" command. \n\n##### Enable Auditing\n\nTo enable auditing of logon events on a host follow these steps: Open gpmc.msc -> Computer Configuration -> Windows Settings -> Security Settings -> Local Policies -> Audit Policy -> Audit Account Logon Events -> Checkmark Success and Failure. \nThe steps are the same for Active directory except for these additional steps: Open gpmc.msc on domain controller -> Select Domain -> right-click domain and click \"Create a GPO in this domain, and Link it here\" -> Enter a GPO name -> Right click on new GPO and select edit. Then follow the rest of the steps from enabling on a host. \n\n### Post-Incident Activities\n\nAfter an incident occurs, compromised accounts should be monitored to verify no backdoor access mechanisms remains. This would include verifying vulnerabilities that were patched have not created another vulnerability that allows access to the same or different accounts.\n\n## References\n\n- How to investigate user logins | <https://www.cybertriage.com/blog/training/how-to-investigate-user-logins-intro-to-incident-response-triage-2021/>\n- Audit logon events | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/basic-audit-logon-events>\n- Windows Security Log Event ID 4624 | <https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4624>\n- Windows Security Log Event ID 4625 | <https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4625>\n- 4624 (S): An account was successfully logged on | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4624>\n- How to See Who Logged Into a Computer | <https://www.howtogeek.com/124313/how-to-see-who-logged-into-a-computer-and-when/>\n- Check User Login History in Windows Active Directory | <https://www.lepide.com/how-to/audit-who-logged-into-a-computer-and-when.html>\n- Audit logon Events | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/basic-audit-logon-events>\n- How to Detect Pass-The-Hash Attacks | <https://blog.netwrix.com/2021/11/30/how-to-detect-pass-the-hash-attacks/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0018",
                "CM0060",
                "CM0064",
                "CM0084",
                "CM0092",
                "CM0112",
                "CM0114",
                "CM0118",
                "CM0121",
                "CM0123",
                "CM0124",
                "CM0125",
                "CM0126",
                "CM0128",
                "CM0137",
                "CM0140"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cybertriage.com",
                    "description": "How to investigate user logins",
                    "url": "https://www.cybertriage.com/blog/training/how-to-investigate-user-logins-intro-to-incident-response-triage-2021/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Audit logon events",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/basic-audit-logon-events"
                },
                {
                    "source_name": "www.ultimatewindowssecurity.com",
                    "description": "Windows Security Log Event ID 4624",
                    "url": "https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4624"
                },
                {
                    "source_name": "www.ultimatewindowssecurity.com",
                    "description": "Windows Security Log Event ID 4625",
                    "url": "https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4625"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "4624 (S): An account was successfully logged on",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4624"
                },
                {
                    "source_name": "www.howtogeek.com",
                    "description": "How to See Who Logged Into a Computer",
                    "url": "https://www.howtogeek.com/124313/how-to-see-who-logged-into-a-computer-and-when/"
                },
                {
                    "source_name": "www.lepide.com",
                    "description": "Check User Login History in Windows Active Directory",
                    "url": "https://www.lepide.com/how-to/audit-who-logged-into-a-computer-and-when.html"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Audit logon Events",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/basic-audit-logon-events"
                },
                {
                    "source_name": "blog.netwrix.com",
                    "description": "How to Detect Pass-The-Hash Attacks",
                    "url": "https://blog.netwrix.com/2021/11/30/how-to-detect-pass-the-hash-attacks/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110.004",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0064",
            "name": "Investigate Account Manipulation",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0064\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nInvestigating account manipulation detects and terminates adversary persistence and privilege escalation.\n\n## Introduction\n\nAccount manipulation efforts by an adversary is often evidenced by credential changes or unusual authentication traffic. The unauthorized modification of accounts allows an adversary to maintain access and escalate privileges within a compromised system. Investigation of credential change events is necessary when logs or network traffic evidence the manipulation of user accounts, passwords, and permissions that may enable an adversaries' persistent access of one or more accounts. \n\nEffective detection and investigation of unauthorized credential changes are vital to disrupting adversarial persistence capabilities and mitigating further damage to organizational resources via privilege escalation.\n\n## Preparation\n\n- If not present, establish a comprehensive baseline of legitimate user account details, including history of legitimate user account credentials, access patterns, and expected behaviors.\n- Ensure a process or system for managing account creation and modification exists within the domain. Ensure technical policies are in place that temper the usage of authorized access and privileged accounts.\n- Ensure monitoring solutions such as EDRs and SIEMs are configured to properly alert on credential change or account manipulation events. Tailor monitoring towards out of cycle credential changes, failed login attempts, and unusual resource access.\n\n## Risks\n\n- Full-scale investigation of authentication and account manipulation events introduces overhead to domain administrators on events that can otherwise be false positives. Configure monitoring solutions to exclude policy-regulated credential changes or account access events that fall within expected time constraints.\n\n## Guidance\n\n### Forensic Analysis\n\n- Utilize forensic techniques such as open source intelligence to determine the origin of the credential access or logon event by pinpointing the IP address and type of device utilized.\n- Cross reference the history and use case of the modified credentials to determine if a high frequency of modification is expected for the credentials.\n- Isolate the affected system from the network after coming to a forensic conclusion.\n\n### Enforce Credential Policy\n\n- If credential changes or access activity is deemed to be unauthorized, immediately initiate a password reset on the affected account.\n- After each credential compromise event, it is recommended to increase password complexity and implement multi-factor authentication as part of organizational policy.\n- Conduct regular review and update of security policies related to credential management.\n\n### Implement or Configure Monitoring\n\n- Deploy real-time monitoring solutions such as Security Information and Event Management (SIEM) or Endpoint Detection Response (EDR) solutions to enable log-based analysis of credential modification events.\n- Ensure credential change and authentication events are routed through IAM systems that enforce policy compliance and logging of administrative actions.\n\n## References\n\n- Comprehensive Guide for Compromised Credential Detection | <https://www.silverfort.com/blog/detecting-compromised-credentials/>\n- Detecting Post-Compromise Threat Activity in Cloud Environments | <https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-008a>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0034",
                "CM0063",
                "CM0112",
                "CM0118",
                "CM0136",
                "CM0140",
                "CM0293"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.silverfort.com",
                    "description": "Comprehensive Guide for Compromised Credential Detection",
                    "url": "https://www.silverfort.com/blog/detecting-compromised-credentials/"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "Detecting Post-Compromise Threat Activity in Cloud Environments",
                    "url": "https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-008a"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1098",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0065",
            "name": "Isolate Endpoints from Network",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0065\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nIsolating an endpoint from the network blocks adversary initial access, lateral movement, and command and control to and from the host on a network.\n\n## Introduction\n\nAn endpoint is any physical or virtual device or node on a network which is the ultimate destination of communications encompassing laptops, desktops, workstations, smartphones, servers, IoT devices, virtual machines, and other computing devices linked within an enterprise environment. \n\nAdversaries that compromise an endpoint can perform a range of techniques to accomplish their objectives. By isolating a compromised endpoint, responders will be able to contain an incident by preventing the threat from issuing C2 commands and/or moving laterally across a network.  Endpoint isolation can further disrupt or otherwise limit additional network-centric activities ranging from discovery, collection, and exfiltration - although automated actions that do not require realtime communication with the adversary may still occur.\n\n## Preparation\n\n-\tEnsure plans, procedures, and authorities are in place to enable rapid containment of compromised endpoints. \n-\tThis countermeasure requires effective asset management and assumes use of endpoint management software or endpoint detection and response (EDR).\n-\tHaving backups or redundant devices available to replace the compromised endpoint will mitigate the likelihood of operational interruption.\n\n## Risks\n\n- Isolating critical endpoints may disrupt important business operations. Responders should factor in potential operational impacts into their decision-making process.\n\n## Guidance\n\nSoftware solutions (e.g. CrowdStrike, Defender for Endpoint, SentinalOne, etc.) may be used to quickly segregate endpoints from the rest of the network. Alternatly, teams may configure endpoint solutions to automatically isolate devices via workflows or playbooks under circumstances that warrant immediate containment. \n\nIn some cases, system administrators may want to consider either logically segregating virtual separation or physical disconnection from the network.\n\nWhile the steps to perform endpoint isolation vary depending on the circumstances of the incident, the characteristics of the network, and the options available to the organization, the following general steps are as follow:\n\n-\tIdentify compromised endpoint(s)\n-\tUnderstand the compromised endpoint(s) purpose to assess the potential for operational impact\n    -   Identify the type of endpoint (mobile device, workstation, server, etc.)\n    -   Determine the endpoint's function (desktop, web server, application server, etc.)\n    -   Identify to whom the endpoint is assigned and the individual's role (business function, administrator, c-suite/leadership, etc.)\n-\tIsolate the endpoint(s) from the network\n    - As part of isolation, responders may freeze system processes and prevent user interaction and perform a forensic capture of the device.    \n-\tInvestigate and eradicate the threat\n-\tPrioritize recovery according to endpoint criticality\n-\tRedeploy in a phased approach\n-\tMonitor restored endpoints for persistent malicious activity\n\n## References\n\n- IR in focus: Isolating & containing a confirmed threat | <https://redcanary.com/blog/incident-response/ir-containment-isolation/>\n- Endpoint Isolation | <https://thewatchman.pro/endpoint-isolation/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0022",
                "CM0023",
                "CM0024",
                "CM0027",
                "CM0030",
                "CM0034",
                "CM0048",
                "CM0059",
                "CM0137"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "redcanary.com",
                    "description": "IR in focus: Isolating & containing a confirmed threat",
                    "url": "https://redcanary.com/blog/incident-response/ir-containment-isolation/"
                },
                {
                    "source_name": "thewatchman.pro",
                    "description": "Endpoint Isolation",
                    "url": "https://thewatchman.pro/endpoint-isolation/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1003.006",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1008",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1011",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1018",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1020",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1021",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1021.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1021.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1029",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1030",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1041",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1048",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1048.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1048.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1048.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1071",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1071.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1071.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1071.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1071.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1090",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1090.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1090.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1090.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1090.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1095",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1102",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1104",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1105",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1110.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1114",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1132",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1133",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1185",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1197",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1205",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1205.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1210",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1219",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1498",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1498.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1498.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1499.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1534",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1542",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1542.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546.008",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1557",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1557.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1557.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1558",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1558.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1563",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1565",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1565.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1567",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1567.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1567.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1568",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1570",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1571",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1572",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1573",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1573.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1573.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1590.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0066",
            "name": "Update Firmware",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0066\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nUpdating firmware restricts adversary impact, privilege escalation, and lateral movement.\n\n## Introduction\n\nUpdating firmware on a device (also called \"flashing\") overwrites existing firmware with new data to patch security vulnerabilities, fix bugs, and/or replace malicious firmware installed by an adversary. Flashing is essential when corrupted system or component firmware would persist with a reimage (e.g., when a rootkit has corrupted the firmware).\n\n## Preparation\n\n* Understand the potential impact of the update.\n* Back up critical data.\n* Have a plan for dealing with a corrupted or failed update.\n\n## Risks\n\n* Firmware is often stored in non-volatile memory, so if an update is corrupted or fails, the device may become unusable.\n* Operations may be impacted because updating firmware requires system reboots and downtime.\n\n## Guidance\n\nDevices have different update methods, but the steps below apply to most.\n\n* Identify the exact model and version of the device.\n* Identify the update required and verify its integrity (firmware updates should come from the device manufacturer).\n* Back up the current firmware version.\n* Use an uninterruptible power supply (critical).\n* Disable antivirus software (re-enable after the update).\n\nRead the documentation provided by the device manufacturer for explicit firmware update steps. Common device access methods are outlined below. \n\n### Web Interface\n\nIf the device has a web interface, launch it and navigate to the firmware settings.\n\n### Custom App or Tool\n\nSome devices offer custom configuration tools. For example, Intel SSD drives use a custom tool called *Intel SSD Toolbox*. Using a custom tool typically involves navigating to the firmware update section and selecting \"update.\"\n\n## References\n\n- How to Update Firmware on Any Device | <https://www.digitalcitizen.life/how-update-firmware-any-device-6-steps/>\n- SI-2(5): Automatic Software / Firmware Updates | <https://csf.tools/reference/nist-sp-800-53/r4/si/si-2/si-2-5/>\n- Firmware Updates: What They Are and Why They Matter | <https://tech.target.com/blog/firmware-updates>\n- Easy Guide to Updating the BIOS on a Computer (Windows) | <https://www.wikihow.com/Update-Your-Computer%27s-BIOS>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0026",
                "CM0027",
                "CM0067",
                "CM0081",
                "CM0086"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.digitalcitizen.life",
                    "description": "How to Update Firmware on Any Device",
                    "url": "https://www.digitalcitizen.life/how-update-firmware-any-device-6-steps/"
                },
                {
                    "source_name": "csf.tools",
                    "description": "SI-2(5): Automatic Software / Firmware Updates",
                    "url": "https://csf.tools/reference/nist-sp-800-53/r4/si/si-2/si-2-5/"
                },
                {
                    "source_name": "tech.target.com",
                    "description": "Firmware Updates: What They Are and Why They Matter",
                    "url": "https://tech.target.com/blog/firmware-updates"
                },
                {
                    "source_name": "www.wikihow.com",
                    "description": "Easy Guide to Updating the BIOS on a Computer (Windows)",
                    "url": "https://www.wikihow.com/Update-Your-Computer%27s-BIOS"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T0839",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1495",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0067",
            "name": "Install Critical Software Security Updates",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0067\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nInstalling critical software security updates restricts adversary execution, persistence, credential access, lateral movement, collection, privilege escalation, and initial access techniques that exploit unpatched and vulnerable software.\n\n## Introduction\n\nA security update is a patch or modification to software or systems released by developers to correct vulnerabilities. A critical security update is often announced by a vendor to correct a zero-day/0-day vulnerability. Organizations that experience an incident involving exploitation of one or more vulnerabilities by an adversary should ensure that security updates are applied as soon as possible.\n\n## Preparation\n\n- Acquire and review documentation and guidance provided by the manufacturer and follow recommended steps when applying and configuring a security update.\n- Ensure periodic backups are taken and restore points are available. It may be necessary to create a new backup or create a restore point before installing the update.\n- Identify the software, operating system, or appliance that critical security updates will be applied to. An existing inventory of software and assets may be needed to ensure emergency software updates are installed to all relevant systems and software appliances. \n\n- Understand how the security update may affect the functionality of the organization's environment. This may involve testing the update before rolling it out to a production environment or using canary assets to confirm the patch is neither corrupted or breaks the software.\n- Verify the authenticity and integrity of the security update, ensuring it came directly from the manufacturer.\n- Prioritize the installation of critical software security updates based on risk, likelihood, and severity if multiple updates are needed.\n\n## Risks\n\n- Installing a critical security update may affect the functionality of the product or service.\n- Patching a vulnerability by applying an update alone is insufficient to fully remediate an incident, as a threat actor may have already established persistence in the environment or gained access to sensitive information or credentials that may be used to facilitate follow-on actions.\n- Emergency software updates may inadvertently align with the adversary's goals if the software's supply chain is compromised. In this is the case, organization's should be prepared to roll back said patch to a secure baseline. \n- Inability to update certain codebases like Java due to backwards compatability issues.\n\n## Guidance\n\nSoftware, systems, and appliances may have different steps to correct vulnerabilities. The exact process of implementing a critical software security update will depend on the instructions advised by the manufacturer, characteristics of the environment the software resides in, and the circumstances (e.g. urgency, environment scale) responders are operating in. Further detailed guidance concerning enterprise patch management may be found within the most recent revision of the National Institute of Standards and Technology (NIST) Special Publication 800-40.\n\n### Apply Critical Security Update\n\nOrganizations should apply the emergency update as soon as possible. In some cases where a security update will disrupt operations, it may be necessary to schedule the update, notifying the affected parties in advance if appropriate. \n\nPrioritized installing security updates when adversaries are known to have exploited current software versions.\n\nVerify the software patch has been installed successfully.\n\n### Monitor Software and Environment\n\nAfter applying the update, monitor the software environment to identify unintended side effects, as well as instances where the update was \"rolled-back\" by the adversary, whether unintentionally or intentionally. \n\n### Document Patching\n\nDocument the patch process and track progress. Validate through vulnerability scanning.\n\n### Implement Compensating Controls\n\nIf a security update is not yet available or the software has reached end-of-life, organizations should implement compensating controls until a fix is made available or a replacement solution can be acquired. This may include taking the affected software or appliance offline. \n\n### Enable Automatic Updates\n\nEnable automatic updates, if not already configured.\n\n## References\n\n- NIST SP 800-40 Rev. 4: Guide to Enterprise Patch Management Planning: Preventive Maintenance for Technology | <https://csrc.nist.gov/pubs/sp/800/40/r4/final>\n- Quest: Developing a zero-day patching strategy | <https://csrc.nist.gov/pubs/sp/800/40/r4/final>\n- CISA Insights: Remediate Vulnerabilities for Internet-Accessible Systems | <https://csrc.nist.gov/pubs/sp/800/40/r4/final>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0026",
                "CM0027",
                "CM0049",
                "CM0066",
                "CM0086",
                "CM0106",
                "CM0108",
                "CM0138"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "csrc.nist.gov",
                    "description": "NIST SP 800-40 Rev. 4: Guide to Enterprise Patch Management Planning: Preventive Maintenance for Technology",
                    "url": "https://csrc.nist.gov/pubs/sp/800/40/r4/final"
                },
                {
                    "source_name": "csrc.nist.gov",
                    "description": "Quest: Developing a zero-day patching strategy",
                    "url": "https://csrc.nist.gov/pubs/sp/800/40/r4/final"
                },
                {
                    "source_name": "csrc.nist.gov",
                    "description": "CISA Insights: Remediate Vulnerabilities for Internet-Accessible Systems",
                    "url": "https://csrc.nist.gov/pubs/sp/800/40/r4/final"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1068",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1072",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1137",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1176",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1189",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1190",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1195",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1195.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1195.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1210",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1211",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1212",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546.010",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1546.011",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1548",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1548.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1548.006",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1552",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1552.006",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1555",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1555.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1574",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1574.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1602",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1602.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1602.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0068",
            "name": "Audit and Restrict Exchange ApplicationImpersonation Role",
            "subtype": "Examine, Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0068\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Disable\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing and restricting the Exchange ApplicationImpersonation role detects and disrupts adversary persistence and privilege escalation.\n\n## Introduction\n\nThe ApplicationImpersonation management role enables applications to impersonate users in an organization to perform tasks on behalf of the user. When an adversary adds this management role to an account, they can impersonate any user within the Exchange web services (EWS) environment. \n\nWhen adversaries assign this role, they do so typically to access the mailbox of users within a Microsoft365 tenant. While this role can be added using the Exchange Admin Center, it is more likely to be added via Exchange Online PowerShell (ExOPS). \n\nThis role can both be created with limiting scopes to access the mailboxes of select users, or created without any explicit scopes, enabling an adversary to access all mailboxes in the tenant using impersonation.\n\n## Preparation\n\n- Because adversaries require access to accounts with sufficient privileges to assign management roles, ensure passwords for all admin accounts are rotated, particularly Exchange Admins and Global Admins.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\nIf a security team suspects that an adversary may have abused the ApplicationImpersonation role, they should audit for commands that assign the ApplicationImpersonation role to any user accounts. \n\nIf not already enabled, organizations should enable PowerShell logging following an incident to detect subsequent attempts by the adversary to add the ApplicationImpersonation role in addition to other malicious PowerShell operations.\n\nTeams can verify whether ApplicationImpersonation was added to an account by exporting the management role configuration settings. This can be performed via ExOPS with the following command. \n`Get-ManagementRoleAssignment -Role ApplicationImpersonation`.\n\nWhile auditing accounts that have the role, if an account with ApplicationImpersonation is identified that should not possess the role, administrators should remove the role where applicable. \nTo remove unnecessary or overly permissive Management Role Assignments, use the Remove-ManagementRoleAssignment cmdlet.\n\nIf the account legitimately possesses the ApplicationImpersonation role, administrators should consider applying a scope to further limit the accounts the role can be used to impersonate and adding conditional access to restrict logons for accounts holding the role.\n\nNote that because these impersonated events are not logged verbosely by the Unified Audit Logs, they can be difficult to detect. If it does not already exist, administrators should define rules to alert whenever the New-ManagementRoleAssignment operation is issued and filter for the assignment of the ApplicationImpersonation role.\n\n## References\n\n- Impersonation and EWS in Exchange | <https://learn.microsoft.com/en-us/exchange/client-developer/exchange-web-services/impersonation-and-ews-in-exchange>\n- Configure impersonation | <https://learn.microsoft.com/en-us/exchange/client-developer/exchange-web-services/how-to-configure-impersonation>\n- Early Bird Catches the Wormhole: Observations from the StellarParticle Campaign | <https://www.crowdstrike.com/en-us/blog/observations-from-the-stellarparticle-campaign/>\n- Remediation and Hardening Strategies for Microsoft 365 to Defend Against APT29 (v1.3) | <https://www.mandiant.com/sites/default/files/2022-08/remediation-hardening-strategies-for-m365-defend-against-apt29-white-paper.pdf>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0031",
                "CM0033",
                "CM0044",
                "CM0074",
                "CM0109"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Impersonation and EWS in Exchange",
                    "url": "https://learn.microsoft.com/en-us/exchange/client-developer/exchange-web-services/impersonation-and-ews-in-exchange"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Configure impersonation",
                    "url": "https://learn.microsoft.com/en-us/exchange/client-developer/exchange-web-services/how-to-configure-impersonation"
                },
                {
                    "source_name": "www.crowdstrike.com",
                    "description": "Early Bird Catches the Wormhole: Observations from the StellarParticle Campaign",
                    "url": "https://www.crowdstrike.com/en-us/blog/observations-from-the-stellarparticle-campaign/"
                },
                {
                    "source_name": "www.mandiant.com",
                    "description": "Remediation and Hardening Strategies for Microsoft 365 to Defend Against APT29 (v1.3)",
                    "url": "https://www.mandiant.com/sites/default/files/2022-08/remediation-hardening-strategies-for-m365-defend-against-apt29-white-paper.pdf"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1098.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1548.005",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0069",
            "name": "Reset Directory Services Restore Mode (DSRM) Account Passwords on Domain Controllers",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0069\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting Directory Services Restore Mode (DSRM) account passwords on domain controllers terminates adversary persistence on local Active Directory (AD) databases via the DSRM account.\n\n## Introduction\n\nThe DSRM account is a local administrator account in Windows Server operating systems used to restore or repair the server's Active Directory (AD) database should the database become corrupted inhibiting an administrator from logging in with their AD credentials. The DSRM account possesses full administrative rights, but not domain or network access rights. If an adversary has access the DSRM account, they will be able to achieve persistence by dumping the hash of the domain controller's password and modifying the registry key DsrmAdminLogonBehavior.\n\n## Preparation\n\n- Verify Windows server version supports `ntdsutil`. Older server versions (e.g., Windows 2000) may require the command `SETPWD`.\n- Confirm HKLM\\System\\CurrentControlSet\\Control\\Lsa\\DsrmAdminLogonBehavior is *not* set to 2. If DSRM is set to 2, the adversary likely modified its value to gain domain persistance. Administrators should change the registry key's default value to 0.\n\n## Risks\n\nNo Risks content identified. (Because the DSRM password is stored in the local Security Account Manager (SAM) database, other AD accounts should be unaffected.)\n\n## Guidance\n\n### Reset using Ntdsutil\n\nSystem administrators can use the command prompt tool `ntdsutil` and the commands `set dsrm password` followed by `reset password on server` specifying either `null` or the server name to reset their DSRM passwords.\n\nDSRM passwords are set on each individual domain controller and do not replicate across domain controllers in a domain. DSRM passwords should be unique from every other Domain Controller (DC) and changed regularly.\n\n## References\n\n- How to reset the Directory Services Restore Mode administrator account password in Windows Server | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/active-directory/reset-directory-services-restore-mode-admin-pwd>\n- Detecting DSRM Account Misconfigurations | <https://www.sentinelone.com/blog/detecting-dsrm-account-misconfigurations/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0033",
                "CM0050",
                "CM0073",
                "CM0077",
                "CM0098",
                "CM0107",
                "CM0122"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How to reset the Directory Services Restore Mode administrator account password in Windows Server",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/active-directory/reset-directory-services-restore-mode-admin-pwd"
                },
                {
                    "source_name": "www.sentinelone.com",
                    "description": "Detecting DSRM Account Misconfigurations",
                    "url": "https://www.sentinelone.com/blog/detecting-dsrm-account-misconfigurations/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0070",
            "name": "Reset Domain Controller (DC) Machine Account Password",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0070\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting the Domain Controller's account password terminates adversary persistence using stolen domain controller machine account credentials.\n\n## Introduction\n\nEvery Windows-based computer has a machine account (also known as the Active Directory (AD) Computer Object) password. These passwords are used to authenticate onto a domain and are typically managed by the Netlogon service, which resets expired passwords and maintains a machine's connection to the domain.\n\n## Preparation\n\n- Resetting a domain controller's (DC) machine account password requires domain administrator rights on both the machine and the computer object in AD. It may be appropriate to reset all domain administrator passwords prior to resetting the machine account password for DCs.\n\n## Risks\n\n- Resetting the password for the DC account may risk breaking synchoronization of the DC if done improperly, such as by using the `Reset-ComputerMachinePassword` cmdlet.\n\n## Guidance\n\n### Reset DC Machine Account Password with Netdom.exe\n\n1. Login to the DC whose password is to be changed. \n\n2. Stop and disable the Kerberos Key Distribution Center (KDC) service on the DC and select Manual for startup type. \n\n3. Clear Kerberos ticket cache on the DC with KLIST (command is `klist purge`), Kerbtest or KerbTray tools.\n\n4. Reset the domain controller's machine password using the command `netdom resetpwd /s:<server> /ud:<domain\\User> /pd:*`. Run this command twice to reset the current password and overwrite the previous password for the account.\n\nReplace `<server>` with the domain controller and `<domain/User>` with a user account on the domain with administrator privileges in the`domain\\User format. \n\nSystem administrators can run `netdom help resetpwd` to verify appropriate syntax. \n\n5. Restart the domain controller.\n\n6. Re-enable the KDC on the DC and return startup type to Automatic.\n\n7. Verify that the password for the DC machine account has changed by checking the pwdLastSet attribute.\n\n8. Repeat the process on all other DCs. The command `repadmin /syncall /AdeP` can be used to force changes to replicate across DCs.\n\n## References\n\n- Active Directory Forest Recovery - Reset the computer account on the DC legacy | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-reset-computer-account-dc>\n- Practical Compromise Recovery Guidance for Active Directory | <https://m365internals.com/2021/04/27/practical-compromise-recovery-guidance-for-active-directory/>\n- Use Netdom.exe to reset machine account passwords of a Windows Server domain controller | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/use-netdom-reset-domain-controller-password>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0028",
                "CM0050",
                "CM0079"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Active Directory Forest Recovery - Reset the computer account on the DC legacy",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-reset-computer-account-dc"
                },
                {
                    "source_name": "m365internals.com",
                    "description": "Practical Compromise Recovery Guidance for Active Directory",
                    "url": "https://m365internals.com/2021/04/27/practical-compromise-recovery-guidance-for-active-directory/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Use Netdom.exe to reset machine account passwords of a Windows Server domain controller",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/use-netdom-reset-domain-controller-password"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0071",
            "name": "Unenroll Suspicious Multifactor Authentication (MFA) Device from Microsoft User Account",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0071\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nUnenrolling a suspicious Multifactor Authentication (MFA) device from a Microsoft user account terminates adversary persistence to environments granted by the device.\n\n## Introduction\n\nMFA forces users to prove their digital identity to a system using two or more factors such as an approved smartphone and/or linked smartcard.\n\nTo circumvent this defense, adversaries may take control over a target's MFA device. Examples of this include but are not limited to:\n\n- Registering an adversary's own device as a form of authentication to maintain persistence in an environment.\n- Performing SIM swapping to register the attacker's device with the target's phone number in order to obtain the mobile authentication codes delivered via SMS. \n- Deploying malware to a target's mobile device to intercept SMS call logs, key logs, notifications, and application authenticator codes.\n\nWhen a sophisticated adversary is able to bypass MFA protections to hijack a valid account, administrators and individuals with mobile-device management authorities should consider revoking that device and enrolling the user in a new method of MFA.\n\n## Preparation\n\n- System administrators should rotate passwords before removing a suspicious MFA device and enrolling a new MFA device. \n- After an incident, responders should investigate user accounts with new or suspicious device associations. Devices associated with unusual times, sources, or suspicious logins should be prioritized.\n\n## Risks\n\n- Unenrolling a suspicious MFA device may disrupt user access to their account until a new device is registered.\n- Unenrolling an MFA device might risk temporarily disabling MFA and enabling password-only access until a new multifactor device is registered.\n\n## Guidance\n\n### Unenroll MFA Device\n\n#### Unenroll MFA Device via Microsoft 365 and Entra ID\n\nWithin the Entra admin center portal, administrators can navigate to Users > [Name] and Under Manage select \"Authentication methods.\" On this page, an individual user's usable authentication methods may be changed, password reset, MFA device re-registered, and MFA session revoked. \n\n#### Unenroll MFA Device with Graph API\n\nRather than using the web interface, administrators may also leverage Microsoft Graph API to interface with Microsoft Entra ID and modify user authentication methods. Administrators should identify which authentication method the adversary bypassed, consult Microsoft documentation for the appropriate authentication method, and identify the relevant API to invoke to unenroll the compromised device and/or replace the method with an alternate, more secure means of authentication. \n\n### Review and Update Conditional Access Policies\n\nSystem administrators should review existing Conditional Access policies to identify potential gaps and misconfigurations in light of MFA bypass and pay particular attention to privileged and Tier 0 accounts. \n\n### Continue Enforcing MFA\n\nAfter removing a suspicious or compromised MFA device, users should continue utilizing MFA for their logins.\n\nIf the removal of an adversary's MFA device temporarily permits the user to login without MFA, enable a new device for the user as soon as possible. \n\nOrganizations should continue enforcing MFA following an incident. Any subsequent changes to an organization's existing MFA policy will depend on how the adversary achieved authentication. For example, if an adversary intercepted a two factor authentication (2FA) code sent via SMS as a result of SIM swapping, organizations should consider rolling out application or hardware-based MFA solutions. Alternately, if the adversary managed to enroll their MFA device to a compromised account, teams should review their alerts or introduce new rules to alert on future, suspicious device registrations and duplicate MFA device associations.\n\n## References\n\n- Multifactor authentication for Microsoft 365 | <https://learn.microsoft.com/en-us/microsoft-365/admin/security-and-compliance/multi-factor-authentication-microsoft-365?view=o365-worldwide>\n- Manage device identities using the Microsoft Entra admin center | <https://learn.microsoft.com/en-us/entra/identity/devices/manage-device-identities>\n- Microsoft Entra authentication methods API overview | <https://learn.microsoft.com/en-us/graph/api/resources/authenticationmethods-overview?view=graph-rest-1.0>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0018",
                "CM0033",
                "CM0112",
                "CM0118",
                "CM0121",
                "CM0124",
                "CM0126",
                "CM0128"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Multifactor authentication for Microsoft 365",
                    "url": "https://learn.microsoft.com/en-us/microsoft-365/admin/security-and-compliance/multi-factor-authentication-microsoft-365?view=o365-worldwide"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Manage device identities using the Microsoft Entra admin center",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/devices/manage-device-identities"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Entra authentication methods API overview",
                    "url": "https://learn.microsoft.com/en-us/graph/api/resources/authenticationmethods-overview?view=graph-rest-1.0"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1098.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1111",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1556.006",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1621",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0072",
            "name": "Disable Credential Caching ",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0072 \n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable \n* **Status:** Active\n\n## Intended Outcome\n\nDisabling credential caching prevents adversaries from accessing credentials stored in the domain cache.\n\n## Introduction\n\nIf a device is unable to reach a domain controller for interactive logon (such as due to network connectivity issues), it may access domain cached credentials (DCC2) locally on a Windows device to facilitate authentication. Adversaries that retrieve DCC2 hashes may be able to brute-force and extract plaintext passwords used for logon on the machine by using cracking tools. This is especially damaging if the plaintext passwords retrieved are used by administrators.\n\n## Preparation\n\nNo Preparation content identified.\n\n## Risks\n\n- Users, including administrators, will not be able to log in to systems with their password if credential caching is disabled and the endpoints are unable to reach back to the domain controller for authentication.\n\n## Guidance\n\n### Disable Credential Caching using Group Policy \n\nThe setting \"Interactive logon: Number of previous logons to cache (in case domain controller is not available)\" refers to a Group policy option that determines how many previously successful interactive logons are stored locally before older logons are purged from the cache. By default, the policy value that controls credential caching is located in Computer Configuration >> Windows Settings >> Security Settings >> Local Policies >> Security Options. To disable credential caching, system administrators should set this policy value to 0. \n\n### Disable Credential Caching using Registry \n\nAlternatively, to disable credential caching manually in the registry, the CachedLogonsCount registry key must be changed on each relevant machine in the domain. This registry value can be found at HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\WinLogon\\cachedlogonscountvalue. It is generally recommended to modify credential caching by configuring the appropriate Group Policy and to ensure any changes to a systems registry occur only after the registry is backed up. \n\n### Reduce Number of Credentials Stored in Cache  \n\nWhile the criticality of a domain-joined system may vary depending on the sensitivity of the data contained therein, it is often recommended that systems keep the number of previous logons to cache (in case domain controller is not available) to the default of 10 or fewer. CIS Critical Security Controls goes further, suggesting it be set to 4 or fewer. In the immediate aftermath of an incident, it may be prudent to reduce the number of cached credentials to a value no less than 2. This will ensure users are able to log on if they are unable to reach the domain controller even if an IT administrator has logged in to the system.\n\n## References\n\n- Interactive logon: Number of previous logons to cache (in case domain controller is not available) | <https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/interactive-logon-number-of-previous-logons-to-cache-in-case-domain-controller-is-not-available>\n- Caching of logon credentials must be limited | <https://www.stigviewer.com/stig/windows_10/2020-06-15/finding/V-63687>\n- 2.3.7.7 (L2) Ensure 'Interactive logon: Number of previous logons to cache (in case domain controller is not available)' is set to '4 or fewer logon(s)' | <https://www.tenable.com/audits/items/CIS_Microsoft_Windows_11_Enterprise_v3.0.0_L2.audit:0759bcc846c2f767d9a84dd0c00d8050>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0018"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Interactive logon: Number of previous logons to cache (in case domain controller is not available)",
                    "url": "https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/interactive-logon-number-of-previous-logons-to-cache-in-case-domain-controller-is-not-available"
                },
                {
                    "source_name": "www.stigviewer.com",
                    "description": "Caching of logon credentials must be limited",
                    "url": "https://www.stigviewer.com/stig/windows_10/2020-06-15/finding/V-63687"
                },
                {
                    "source_name": "www.tenable.com",
                    "description": "2.3.7.7 (L2) Ensure 'Interactive logon: Number of previous logons to cache (in case domain controller is not available)' is set to '4 or fewer logon(s)'",
                    "url": "https://www.tenable.com/audits/items/CIS_Microsoft_Windows_11_Enterprise_v3.0.0_L2.audit:0759bcc846c2f767d9a84dd0c00d8050"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003.005",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0073",
            "name": "Rotate Active Directory Federation Services (AD FS) Certificates",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0073\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRotating Active Directory Federation Services (AD FS) certificates terminates adversary credential access via forged Security Assigned Markup Language (SAML) tokens.\n\n## Introduction\n\nAD FS certificates are used to decrypt and digitally sign all tokens that AD FS produces, ensuring that the tokens are tamper-proof and originate from a trusted source. These certificates typically have a default lifespan of one year.\n\nAn adversary that compromises either the AD FS service account or an account with local administrative permissions on AD FS servers may be able to extract the token-signing certificate. An adversary that uses the certificate to create forged SAML tokens or generates their own token-signing certificate will be able to authenticate across services that use SAML 2.0 as a single sign-on (SSO) mechanism.\n\n## Preparation\n\n- Document the the on-premises and cloud Token Signing Certificate thumbprint and expiration dates. This can be accomplished after connecting to the Microsoft Online Service with `Connect-MsolService` and running `Get-MsolFederationProperty -DomainName <domain>` or by using AD FS Management under Service > Certificates.\n- Determine whether  `AutoCertificateRollover` is set to `True` before generating a new self-signed certificate. This can be done using the PowerShell command `Get-AdfsProperties | FL AutoCert*, Certificate*` If `AutoCertificateRollover` is set to false, a new certificate will have to be generated manually.\n- Consult Microsoft's Emergency rotation of the AD FS certificates from Microsoft Entra documentation before proceeding with rotation of the AD FS certificates. Available at <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-emergency-ad-fs-certificate-rotation#remove-your-old-certificates>\n\n## Risks\n\n- This countermeasure may disrupt operations. For instance, rotating AD FS certificates may cause a service outage as trusts update to use the new certificates. Outages typically resolve after all the federation partners have the new certificates.\n- Manually importing a certificate from an untrusted source or compromised certificate authority may risk undermining efforts to contain the adversary\n\n## Guidance\n\n### Generate AD FS Certificates\n\n#### Automatically Generate Self-signed AD FS Certificate with PowerShell\n\nTo automatically generate a new token signing certificate run the following PowerShell command once logged into the primary AD FS server. The `-Urgent` flag will replace the primary certificate immediately without making a Secondary certificate.\n\n`Update-ADFSCertificate -CertificateType Token-Signing -Urgent`\n`Update-ADFSCertificate -CertificateType Token-Decrypting -Urgent`\n\n\nTo generate a second token certificate:\n\n`Update-ADFSCertificate -CertificateType Token-Signing`\n`Update-ADFSCertificate -CertificateType Token-Decrypting`\n\nTo verify that a new token certificates are generated, the following PowerShell command may be run:\n\n`Get-ADFSCertificate -CertificateType Token-Signing`\n`Get-ADFSCertificate -CertificateType Token-Decrypting`\n\n#### Manually Generate New AD FS Certificate\n\nAD FS servers where `AutoCertificateRollover` is set to `false` must aquire two new certificates from their certificate authority and import them into the local machine personal certificate store on each federation server. Certificates must be obtained from trusted sources. Backup certificates stored on the local AD FS servers should not be used.\n\nConfiguring a new primary and secondary certificates can be accomplished with the AD FS management console. \n\n### Update Entra ID with New Signing Certificates\n\nRun Azure AD PowerShell, connect to Microsoft Entra ID, and sign in with hybrid identity credentials on the primary federation server. To update the certificate information, administrators should run the PowerShell command `Update-MsolFederatedDomain` and provide the domain name when prompted. The flag `-SupportMultipleDomain` may be necessary if an error is received. \n\n### Replace SSL Certificates\n\nAfter rotating AD FS token signing certificates, organizations should revoke and replace their SSL certificate for AD FS and their Web Application Proxy (WAP) server. \n\n- When a new certificate is provided from a trusted certificate authority, update the primary  AD FS server with the PowerShell command `Set-AdfsSslCertificate -Thumbprint '<thumbprint of new cert>'` to rotate the SSL certificate. \n- Run `Set-WebApplicationProxySslCertificate -Thumbprint '<thumbprint of new cert>'` in PowerShell to install a new TLS/SSL certificate for the WAP server.\n\n### Remove Old Certificates\n\nOld certificates that the adversary may use should be removed. This may be accomplished with the following command run on the primary AD FS server. \n\n`Remove-ADFSCertificate -CertificateType Token-Signing -thumbprint <thumbprint>`\n\n### Verify Certificate Revocation\n\nAdministrators should run the PowerShell command `Get -MsolFederationProperty -DomainName` and confirm that thumbprints belonging to previously compromised certificates are not present.\n\n### Update Federation Partners\n\nEnsure all federation partners have consumed the new certificate. Partners that cannot consume federation metadata must be manually sent the public key of the token signing and decrypting certificate.\n\n### Revoke Microsoft 365 Refresh Tokens\n\nAfter connecting to Azure with `Connect-Azure-AD`, revoke M365 refresh tokens with the following PowerShell command:\n\n`Get-AzureADuser -all $true | Revoke-AzureADUserAllRefreshToken`\n\nFor further guidance see CM0077 - Revoke Microsoft 365 Refresh Tokens.\n\n## References\n\n- Emergency rotation of the AD FS certificates | <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-emergency-ad-fs-certificate-rotation>\n- Import a Certificate | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc754489(v=ws.11)>\n- Manage TLS/SSL certificates in AD FS and WAP in Windows Server 2016 | <https://learn.microsoft.com/en-us/windows-server/identity/ad-fs/operations/manage-ssl-certificates-ad-fs-wap#replace-the-tlsssl-certificate-for-ad-fs>\n- Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452 | <https://www.mandiant.com/sites/default/files/2021-11/wp-m-unc2452-000343.pdf>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0050",
                "CM0069",
                "CM0077",
                "CM0134"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Emergency rotation of the AD FS certificates",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-emergency-ad-fs-certificate-rotation"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Import a Certificate",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc754489(v=ws.11)"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Manage TLS/SSL certificates in AD FS and WAP in Windows Server 2016",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-fs/operations/manage-ssl-certificates-ad-fs-wap#replace-the-tlsssl-certificate-for-ad-fs"
                },
                {
                    "source_name": "www.mandiant.com",
                    "description": "Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452",
                    "url": "https://www.mandiant.com/sites/default/files/2021-11/wp-m-unc2452-000343.pdf"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1606.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0074",
            "name": "Audit and Restrict Mailbox Permissions",
            "subtype": "Examine, Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0074\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Disable\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing and restricting mailbox permissions detects and blocks adversary exfiltration using mailboxes.\n\n## Introduction\n\nAdversaries may attempt to modify mailbox account permissions in order to access the contents of a mailbox account or use the compromised mailbox as a staging ground for exfiltration. When responding to an incident involving business email compromise (BEC) or likely compromise of a user's mailbox, administrators should audit mailbox access logs and confirm additional email permissions were not delegated by the adversary.\n\n## Preparation\n\n- Administrators should confirm that Exchange mailbox auditing is enabled. This can be done by connecting to the Exchange Server and confirming that auditing is enabled before accessing audit reports from the Microsoft 365 portal. (Get-OrganizationConfig | Format-List AuditDisabled). Note that while mailbox auditing may be enabled, only subscribers with Premium licenses (e.g. E5/A5/G5 licenses) will be able to return mailbox audit log events in audit log searches in the Microsoft Purview compliance portal or via the Office 365 Management Activity API by default.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\nWhile delegation is likely possible on any mailbox application, adversaries are most likely to abuse Microsoft Exchange, a component of Microsoft 365 which may be run locally or, more often, as SaaS. The following instructions provide guidance for Microsoft Exchange. \n\n### Review Audit Logs in Microsoft Exchange\n\nAdministrators can investigate mailbox permission modifications in Microsoft 365 by checking the mailbox audit logs. This may be accomplished using different methods. Audit log searches can be conducted using Microsoft Purview or the Office 365 Management Activity API, entering commands in Exchange Online PowerShell, and/or generating reports via Exchange Admin Center (EAC). \n\nMicrosoft Purview Audit (Premium) provides administrator's with access to MailItemsAccessed audit records. These records can guide their hunt for suspicious permission modifications of suspected compromised accounts. \n\nAlternately, administrators might consider using the EAC to run a non-owner mailbox access report for recent mailbox access. \n\nOrganizations without access to Microsoft Purview Audit (Premium) should still generate an audit log report and search for suspicious use of Microsoft PowerShell cmdlets. The following cmdlets may be suspicious and warrant further investigation, given the right context:\n\n- Add-MailboxPermission: May be misused to add permissions to a mailbox.  \n- Set-CASMailbox: May be misused to configure client access settings on a mailbox - such as allowing them to sync mailboxes and copy mail to the adversary's device(s).  \n- Add-MailboxFolderPermission: May be misused to grant permissions to specific mailbox folders (e.g., Inbox, Sent Items). \n- Set-MailboxFolderPermission: May be misused to modify folder-level permissions for users in mailboxes for existing permission entries. \n- Remove-MailboxFolderPermission: May be misused by an adversary to undo mailbox folder permission changes and cover up their tracks. \n\nAuditing Exchange mailboxes may be accomplished with PowerShell using the following cmdlets:\n\n- Search-UnifiedAuditLog to search the Exchange Online unified audit log and other cloud-based services such as SharePoint Online, Microsoft Teams, and Microsoft Entra ID. \n- Search-MailboxAuditLog to search mailbox audit log entries matching specified search terms. \n- Get-MailboxPermission to retrieve permissions on a mailbox. \n- Get-MailboxFolderPermission (or, for Exchange Online PowerShell, Get-EXOMailboxFolderPermission) to view folder-level permissions. \n\nAdministrators may also want to consult existing PowerShell scripts used to perform mailbox auditing of Microsoft 365 accounts.\n\n### Review Graph API Application Permissions for Mailbox Access\n\nAdversaries that compromise an Azure AD Tenant will be able to create new multi-tenant applications equipped with specific API permissions. Users who unintentionally consent to an applications permissions request may compromise their mailbox, among other possibilities.  For example, an adversary might assign Mail.Read to an application to allow it to read mail in an inbox without a signed-in user. Other potential permissions include:\n\n- Mail.Read\n- Mail.ReadBasic\n- Mail.ReadBasic.All\n- Mail.ReadWrite\n- Mail.Send\n- MailboxSettings.Read\n- MailboxSettings.ReadWrite\n- Calendars.Read\n- Calendars.ReadWrite\n- Contacts.Read\n- Contacts.ReadWrite\n\nTeams may need to investigate their Azure logs if they suspect access to a mailbox via suspicious application consent. Microsoft provides hunting queries / analytics to locate this type of behavior, including for the SolarWinds Compromise / Solorigate and the O365 Attack Toolkit.  Alternately, CISA's Sparrow tool may be used to check the Graph API application permissions of all service principals and applications in M365/Azure AD. \nAdministrators can use the New-ApplicationAccessPolicy PowerShell cmdlet to restrict application access to specific mailboxes. \n\n### Establish an Alert Policy for Mailbox Permission Changes\n\nAdministrators should consider establishing an alert policy to receive notifications when administrators assign mailbox permissions. Alerts may be created and viewed either via Microsoft's Compliance Center or the Microsoft Defender Portal.\n\n## References\n\n- Manage mailbox auditing | <https://learn.microsoft.com/en-us/purview/audit-mailboxes?view=o365-worldwide#more-information>\n- Use Microsoft Purview Audit (Premium) to investigate compromised accounts | <https://learn.microsoft.com/en-us/purview/audit-log-investigate-accounts>\n- Run a non-owner mailbox access report | <https://learn.microsoft.com/en-us/exchange/policy-and-compliance/non-owner-mailbox-access-reports?view=exchserver-2019>\n- Add-MailboxPermission | <https://learn.microsoft.com/en-us/powershell/module/exchange/add-mailboxpermission?view=exchange-ps>\n- Set-CASMailbox | <https://learn.microsoft.com/en-us/powershell/module/exchange/set-casmailbox?view=exchange-ps>\n- Add-MailboxFolderPermission | <https://learn.microsoft.com/en-us/powershell/module/exchange/add-mailboxfolderpermission?view=exchange-ps>\n- Set-MailboxFolderPermission | <https://learn.microsoft.com/en-us/powershell/module/exchange/set-mailboxfolderpermission?view=exchange-ps>\n- Remove-MailboxFolderPermission | <https://learn.microsoft.com/en-us/powershell/module/exchange/remove-mailboxfolderpermission?view=exchange-ps>\n- Remove-MailboxExportRequest | <https://learn.microsoft.com/en-us/powershell/module/exchange/remove-mailboxexportrequest?view=exchange-ps>\n- Search-UnifiedAuditLog | <https://learn.microsoft.com/en-us/powershell/module/exchange/search-unifiedauditlog?view=exchange-ps>\n- Search-MailboxAuditLog | <https://learn.microsoft.com/en-us/powershell/module/exchange/search-mailboxauditlog?view=exchange-ps>\n- Get-MailboxPermission | <https://learn.microsoft.com/en-us/powershell/module/exchange/get-mailboxpermission?view=exchange-ps>\n- Get-MailboxFolderPermission | <https://learn.microsoft.com/en-us/powershell/module/exchange/get-mailboxfolderpermission?view=exchange-ps>\n- admindroid-community Enable mailbox auditing in Exchange Online | <https://github.com/admindroid-community/powershell-scripts/blob/master/Enable%20Mailbox%20Auditing%20for%20Office%20365%20Users/EnableMBAuditLogging.ps1>\n- Real-Time Alerting with Microsoft 365 Alert Policies | <https://o365reports.com/2022/03/10/real-time-alerting-with-microsoft-365-alert-policies/>\n- Limiting application permissions to specific Exchange Online mailboxes | <https://learn.microsoft.com/en-us/graph/auth-limit-mailbox-access>\n- Detecting Post-Compromise Threat Activity in Microsoft Cloud Environments | <https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-008a>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0061",
                "CM0068",
                "CM0082"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Manage mailbox auditing",
                    "url": "https://learn.microsoft.com/en-us/purview/audit-mailboxes?view=o365-worldwide#more-information"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Use Microsoft Purview Audit (Premium) to investigate compromised accounts",
                    "url": "https://learn.microsoft.com/en-us/purview/audit-log-investigate-accounts"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Run a non-owner mailbox access report",
                    "url": "https://learn.microsoft.com/en-us/exchange/policy-and-compliance/non-owner-mailbox-access-reports?view=exchserver-2019"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Add-MailboxPermission",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/add-mailboxpermission?view=exchange-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Set-CASMailbox",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/set-casmailbox?view=exchange-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Add-MailboxFolderPermission",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/add-mailboxfolderpermission?view=exchange-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Set-MailboxFolderPermission",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/set-mailboxfolderpermission?view=exchange-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Remove-MailboxFolderPermission",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/remove-mailboxfolderpermission?view=exchange-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Remove-MailboxExportRequest",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/remove-mailboxexportrequest?view=exchange-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Search-UnifiedAuditLog",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/search-unifiedauditlog?view=exchange-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Search-MailboxAuditLog",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/search-mailboxauditlog?view=exchange-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Get-MailboxPermission",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/get-mailboxpermission?view=exchange-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Get-MailboxFolderPermission",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/get-mailboxfolderpermission?view=exchange-ps"
                },
                {
                    "source_name": "github.com",
                    "description": "admindroid-community Enable mailbox auditing in Exchange Online",
                    "url": "https://github.com/admindroid-community/powershell-scripts/blob/master/Enable%20Mailbox%20Auditing%20for%20Office%20365%20Users/EnableMBAuditLogging.ps1"
                },
                {
                    "source_name": "o365reports.com",
                    "description": "Real-Time Alerting with Microsoft 365 Alert Policies",
                    "url": "https://o365reports.com/2022/03/10/real-time-alerting-with-microsoft-365-alert-policies/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Limiting application permissions to specific Exchange Online mailboxes",
                    "url": "https://learn.microsoft.com/en-us/graph/auth-limit-mailbox-access"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "Detecting Post-Compromise Threat Activity in Microsoft Cloud Environments",
                    "url": "https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-008a"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1070.008",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1114.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0075",
            "name": "Implement Access Restrictions on Cloud Storage Objects ",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0075\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nImplementing access restrictions on cloud storage objects restricts an adversary's ability to discover contents/information within cloud storage.\n\n## Introduction\n\nObject storage services are prevalent in enterprise environments where the storage of data is dominated by scalable Cloud solutions. Examples of cloud storage services are Amazon S3, Google Cloud Storage, Microsoft Azure Blob, IBM Cloud Object Storage, and DigitalOcean Spaces.\n\nCloud storage auditing/configuration is a process that enables a user to remotely verify and help ensure the integrity of cloud storage services and the objects they contain. In some cases, outsourced data is present in cloud storage, which requires proper sanitization and authentication so as to eliminate the possibility of adversary access by embedded payloads or encoded commands.\n\nThe objective of this countermeasure is to eliminate an adversaries' ability to enumerate objects within cloud storage, and to enable prevention of object discovery in cloud storage by a threat actor. If an adversary is able to identify cloud storage services, they may conduct follow-on behaviors of exploitation/exfiltration of objects stored in cloud infrastructure.\n\nProper configuration or auditing of storage objects requires that permissions be designated to each user account or cloud service account under the Principle of Least Privilege.\n\nAdditionally, usage of APIs that list/enumerate objects in cloud storage should be restricted to accounts of higher privilege.\n\n## Preparation\n\n- Ensure that the cloud storage service(s) are updated and have logging and auditing features enabled. \n- Configure alerts and notifications constrained to anomalous data transfers, authentication events, and object access events.\n- Take note of compromised/accessed storage objects, and be prepared to restore the affected storage objects to a previous backup.\n- Compromised accounts or credentials must be evident before permissions and credentials are manipulated.\n\n## Risks\n\n- This countermeasure can interfere with and/or break cloud storage objects and the contained data; poses the risk of misconfiguration which invites data breaches, unauthorized access, and loss of data.\n- Rotating credentials for compromised cloud accounts tied to object storage services can disrupt business operations and induce downtime.\n- Improper configuration of cloud storage services could lead to compatibility issues with objects connected to cloud storage.\n- Adjusting API access creates administrator overhead and reduced functionality of the storage service.\n\n## Guidance\n\n### Restrict API Access within Cloud Storage \n\n- Limit API access that permits listing of storage objects and/or buckets to privileged/administrator accounts. Examples of these sensitive APIs are ListObjectsV2 (AWS) and List Blobs (Azure).\n- Implement IP whitelisting and blacklisting to constrain access of APIs that list objects or buckets to trusted IP addresses.\n- Implement vendor-specific immutability features to objects that are essential to business operation and incident resolution.\n- Keep API keys secret and regularly examine their usage to help ensure they are used by legitimate accounts. \n\n### Adjust Access Control Policies\n\n- Setup Access Control Lists (ACLs) to specify who can access or perform actions on cloud storage.\n- Restrict 'full control' permissions for cloud storage objects to the administrator account.\n- Implement object-level and bucket-level policies that define access permissions at a granular level.\n\n## References\n\n- How do you audit and monitor cloud storage activities and events? | <https://www.linkedin.com/advice/0/how-do-you-audit-monitor-cloud-storage-activities>\n- Enable Object Lock or a Legal Hold on an Existing Bucket | <https://www.backblaze.com/docs/cloud-storage-enable-object-lock-or-a-legal-hold-on-an-existing-bucket>\n- Public cloud object storage auditing: Design, implementation, and analysis | <https://www.sciencedirect.com/science/article/pii/S0743731524000340>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0033",
                "CM0076",
                "CM0083",
                "CM0099",
                "CM0133"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.linkedin.com",
                    "description": "How do you audit and monitor cloud storage activities and events?",
                    "url": "https://www.linkedin.com/advice/0/how-do-you-audit-monitor-cloud-storage-activities"
                },
                {
                    "source_name": "www.backblaze.com",
                    "description": "Enable Object Lock or a Legal Hold on an Existing Bucket",
                    "url": "https://www.backblaze.com/docs/cloud-storage-enable-object-lock-or-a-legal-hold-on-an-existing-bucket"
                },
                {
                    "source_name": "www.sciencedirect.com",
                    "description": "Public cloud object storage auditing: Design, implementation, and analysis",
                    "url": "https://www.sciencedirect.com/science/article/pii/S0743731524000340"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1580",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1619",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0076",
            "name": "Remove Adversary Certificates and Rotate Secrets for Applications and Service Principals ",
            "subtype": "Disable, Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0076\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving adversary certificates and rotating secrets for applications and service principals terminates persistence via adversary-controlled credentials.\n\n## Introduction\n\nEach application in Microsoft Entra ID is associated with a service principal and an application object.\n\n- Service principals, also referred to as Enterprise Applications in the Azure Portal, are security identities or accounts used by applications in a tenant or directory to interact with Microsoft Azure via the Azure API. Service principals are local representations in a tenant and are based on application objects. \n\n- Application objects, (managed as App Registrations in the Azure Portal) are the global representation of an application across tenants and serve as a template for service principal objects. \n\nTo authenticate to Microsoft 365 and access the API, applications have credentials (x509 certificates or secrets) associated with them.\n\nAdversaries may add their own credentials to a service principal or application object to maintain persistent access to victim accounts and instances within the environment. Adversaries that add new certificates or secrets to an application object or service principal will possess the ability to perform API operations using the permissions that are assigned to it. By hijacking service principals and applications, adversaries can inherit permissions that enable them to access data normally protected by multi-factor authentication (MFA), such as the contents of a mailbox via Mail.Read, Mail.ReadWrite permissions.\n\nSophisticated adversaries may remove any adversary-controlled credentials after carrying out their objectives. Organizations should nonetheless investigate any lingering adversary-controlled credentials and increase security and monitoring of this attack technique in their cloud environment.\n\n## Preparation\n\n- Connect to Azure and enumerate application objects and service principals, flagging those which are suspect. The identification of permission and credential changes to applications and service principals can be accelerated using [Sparrow](https://github.com/cisagov/Sparrow). Alternately, responders should investigate the existing capabilities of their SIEM and/or the applicability of [similar](https://github.com/mandiant/Mandiant-Azure-AD-Investigator) [forensic](https://cloudforensicator.com/) [tools](https://github.com/AzureAD/Azure-AD-Incident-Response-PowerShell-Module) to assist with detection and investigation of applications and service principals in Azure. Validate that an application or service principal is likely compromised by considering a service principal's creation date, user account that provided consent, and the permissions associated with the service principal. Consider whether it has illustrated any suspicious sign-on behavior, including login location, failures, timestamps, and frequency. Review Entra ID Audit log and Unified Audit logs. A compromised application object used for applications from additional organizations means an adversary will have access to these organization's data as well. \n\n- Accounts used to remove certificates and passwords from application and service principals should have the appropriate permissions, such as global administrator or security administrator.\n\n- Because credential rotation for service principals is common as service principal certificates expire upon completion of their lifespan, leaning on existing change control processes to document rotation and distinguish valid from unusual credential rotation may help investigation and response.\n\n## Risks\n\n- Removing credentials may prevent services from authenticating, inhibiting their functionality and thus disrupting business operations. Assess business impact prior to removing any credentials.\n\n- Revoking refresh tokens will cause users to need to reauthenticate, risking additional disruption to business operations.\n\n## Guidance\n\nThis countermeasure assumes that a suspicious service principal or application object has been identified and a compromise has occurred. \n\n### Managing Application and Service Principal Certificates and Rotating Secrets in Microsoft Azure\n\nService principals can be created, removed, and modified by using a number of different tools, including Microsoft Graph PowerShell, Graph API, Azure PowerShell, the Azure command-line interface (CLI), and the deprecated AzureAD Powershell module.\n\nNote that if an application object is modified, the changes will only show in its service principal object in the home tenant (where it was registered).\n\n###  via Entra Admin Center\n\nApplication registrations and service principal credentials may be added and/or removed within the Microsoft Entra Admin Center under \"Certificates & secrets.\"\n\n####  via Microsoft Graph API\n\nCredentials can be added and/or removed using the Graph API.\n\n- [`servicePrincipal: removePassword`](https://learn.microsoft.com/en-us/graph/api/serviceprincipal-removepassword?view=graph-rest-1.0&tabs=http) may be used to remove a secret from a service principal object.\n\n- [`servicePrincipal: addPassword`](https://learn.microsoft.com/en-us/graph/api/serviceprincipal-addpassword?view=graph-rest-1.0&tabs=http) may be used to add a secret to a service principal\n\nCombining both effectively rotates the secret for the associated service principal. \n\n- [`servicePrincipal: removeKey`](https://learn.microsoft.com/en-us/graph/api/serviceprincipal-removekey?view=graph-rest-1.0&tabs=http) may be used to remove a key from a Service Principal. \n\n- [`servicePrincipal: addKey`](https://learn.microsoft.com/en-us/graph/api/serviceprincipal-addkey?view=graph-rest-1.0&tabs=http) may be used to add a key to a Service Principal. \n\nCombining these requests effectively rotates a specific service principal key.\n\n#### via Azure CLI\n\n- [`az ad sp credential reset`](https://learn.microsoft.com/en-us/cli/azure/ad/sp/credential?view=azure-cli-latest#az-ad-sp-credential-reset) can be used to reset a service principals password or certificate credential. \n\n- [`az ad sp credential delete`](https://learn.microsoft.com/en-us/cli/azure/ad/sp/credential?view=azure-cli-latest#az-ad-sp-credential-delete) can be used to remove a secret or certificate credential. \n\n#### via Azure PowerShell module\n\n- [`Remove-AzADAppCredential`](https://learn.microsoft.com/en-us/PowerShell/module/az.resources/remove-azadappcredential?view=azps-0.10.0) can be used to remove credentials associated with one or more service principals.\n\n- [`Remove-AzADApplication`](https://learn.microsoft.com/en-us/powershell/module/az.resources/remove-azadapplication?view=azps-11.6.0) deletes a specific Azure AD application.\n\n- [`Remove-AzADSpCredential`](https://learn.microsoft.com/en-us/powershell/module/az.resources/remove-azadspcredential?view=azps-11.6.0) removes credentials associated with one or more service principal.\n\n- [`Remove-AzADServicePrincipal`](https://learn.microsoft.com/en-us/powershell/module/az.resources/remove-azadserviceprincipal?view=azps-11.6.0) deletes a specific service principal.\n\n### Revoke All Refresh Tokens\n\nAfter removing adversary-controlled certificates and rotating secrets associated with applications and service principals, all associated refresh tokens should be revoked. Like the prior instructions, this may be accomplished through multiple channels, such as Graph or the Azure PowerShell module. \n\n####  via Microsoft Graph API\n\n- [`user: invalidateAllRefreshTokens`](https://learn.microsoft.com/en-us/graph/api/user-invalidateallrefreshtokens?view=graph-rest-beta&tabs=http) revokes all refresh tokens issued to applications (beta version as of May 2024)\n\n#### via Azure PowerShell module\n\n- [`Revoke-AzureADUserAllRefreshToken`](https://learn.microsoft.com/en-us/powershell/module/azuread/revoke-azureaduserallrefreshtoken?view=azureadps-2.0) revokes existing refresh tokens.\n\n#### Verify that Application Objects and Service Principals are removed from environment\n\nAs part of remediation, if any application objects or service principals are removed from the environment, confirm they are removed and monitor for unexpected changes to applications in Azure.\n\n## References\n\n- Application and service principal objects in Microsoft Entra ID | <https://learn.microsoft.com/en-us/entra/identity-platform/app-objects-and-service-principals>\n- Securing service principals in Microsoft Entra ID | <https://learn.microsoft.com/en-us/entra/architecture/service-accounts-principal>\n- Microsoft Entra security operations guide for applications | <https://learn.microsoft.com/en-us/entra/architecture/security-operations-applications>\n- How adversaries use Entra ID service principals in business email compromise schemes | <https://redcanary.com/blog/threat-detection/entra-id-service-principals/>\n- Compromised and malicious applications investigation | <https://learn.microsoft.com/en-us/security/operations/incident-response-playbook-compromised-malicious-app>\n- Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452 | <https://www.mandiant.com/sites/default/files/2021-11/wp-m-unc2452-000343.pdf>\n- Microsoft Entra recommendation: Renew expiring service principal credentials | <https://learn.microsoft.com/en-us/entra/identity/monitoring-health/recommendation-renew-expiring-service-principal-credential>\n- Microsoft Entra recommendation: Renew expiring application credentials | <https://learn.microsoft.com/en-us/entra/identity/monitoring-health/recommendation-renew-expiring-application-credential>\n- Sparrow | <https://github.com/cisagov/Sparrow>\n- Mandiant Azure AD Investigator | <https://github.com/mandiant/Mandiant-Azure-AD-Investigator>\n- Cloud Forensics using Hawk | <https://cloudforensicator.com/>\n- Azure AD Incident Response PowerShell Module | <https://github.com/AzureAD/Azure-AD-Incident-Response-PowerShell-Module>\n- servicePrincipal: removePassword | <https://learn.microsoft.com/en-us/graph/api/serviceprincipal-removepassword?view=graph-rest-1.0&tabs=http>\n- servicePrincipal: addPassword | <https://learn.microsoft.com/en-us/graph/api/serviceprincipal-addpassword?view=graph-rest-1.0&tabs=http>\n- servicePrincipal: removeKey | <https://learn.microsoft.com/en-us/graph/api/serviceprincipal-removekey?view=graph-rest-1.0&tabs=http>\n- servicePrincipal: addKey | <https://learn.microsoft.com/en-us/graph/api/serviceprincipal-addkey?view=graph-rest-1.0&tabs=http>\n- az ad sp credential reset | <https://learn.microsoft.com/en-us/cli/azure/ad/sp/credential?view=azure-cli-latest#az-ad-sp-credential-reset>\n- az ad sp credential delete | <https://learn.microsoft.com/en-us/cli/azure/ad/sp/credential?view=azure-cli-latest#az-ad-sp-credential-delete>\n- Remove-AzADAppCredential | <https://learn.microsoft.com/en-us/PowerShell/module/az.resources/remove-azadappcredential?view=azps-0.10.0>\n- Remove-AzADApplication | <https://learn.microsoft.com/en-us/powershell/module/az.resources/remove-azadapplication?view=azps-11.6.0>\n- Remove-AzADSpCredential | <https://learn.microsoft.com/en-us/powershell/module/az.resources/remove-azadspcredential?view=azps-11.6.0>\n- Remove-AzADServicePrincipal | <https://learn.microsoft.com/en-us/powershell/module/az.resources/remove-azadserviceprincipal?view=azps-11.6.0>\n- user: invalidateAllRefreshTokens | <https://learn.microsoft.com/en-us/graph/api/user-invalidateallrefreshtokens?view=graph-rest-beta&tabs=http>\n- Revoke-AzureADUserAllRefreshToken | <https://learn.microsoft.com/en-us/powershell/module/azuread/revoke-azureaduserallrefreshtoken?view=azureadps-2.0>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0032",
                "CM0075",
                "CM0077",
                "CM0082",
                "CM0083",
                "CM0099",
                "CM0105",
                "CM0134"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Application and service principal objects in Microsoft Entra ID",
                    "url": "https://learn.microsoft.com/en-us/entra/identity-platform/app-objects-and-service-principals"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Securing service principals in Microsoft Entra ID",
                    "url": "https://learn.microsoft.com/en-us/entra/architecture/service-accounts-principal"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Entra security operations guide for applications",
                    "url": "https://learn.microsoft.com/en-us/entra/architecture/security-operations-applications"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "How adversaries use Entra ID service principals in business email compromise schemes",
                    "url": "https://redcanary.com/blog/threat-detection/entra-id-service-principals/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Compromised and malicious applications investigation",
                    "url": "https://learn.microsoft.com/en-us/security/operations/incident-response-playbook-compromised-malicious-app"
                },
                {
                    "source_name": "www.mandiant.com",
                    "description": "Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452",
                    "url": "https://www.mandiant.com/sites/default/files/2021-11/wp-m-unc2452-000343.pdf"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Entra recommendation: Renew expiring service principal credentials",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/monitoring-health/recommendation-renew-expiring-service-principal-credential"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Entra recommendation: Renew expiring application credentials",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/monitoring-health/recommendation-renew-expiring-application-credential"
                },
                {
                    "source_name": "github.com",
                    "description": "Sparrow",
                    "url": "https://github.com/cisagov/Sparrow"
                },
                {
                    "source_name": "github.com",
                    "description": "Mandiant Azure AD Investigator",
                    "url": "https://github.com/mandiant/Mandiant-Azure-AD-Investigator"
                },
                {
                    "source_name": "cloudforensicator.com",
                    "description": "Cloud Forensics using Hawk",
                    "url": "https://cloudforensicator.com/"
                },
                {
                    "source_name": "github.com",
                    "description": "Azure AD Incident Response PowerShell Module",
                    "url": "https://github.com/AzureAD/Azure-AD-Incident-Response-PowerShell-Module"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "servicePrincipal: removePassword",
                    "url": "https://learn.microsoft.com/en-us/graph/api/serviceprincipal-removepassword?view=graph-rest-1.0&tabs=http"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "servicePrincipal: addPassword",
                    "url": "https://learn.microsoft.com/en-us/graph/api/serviceprincipal-addpassword?view=graph-rest-1.0&tabs=http"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "servicePrincipal: removeKey",
                    "url": "https://learn.microsoft.com/en-us/graph/api/serviceprincipal-removekey?view=graph-rest-1.0&tabs=http"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "servicePrincipal: addKey",
                    "url": "https://learn.microsoft.com/en-us/graph/api/serviceprincipal-addkey?view=graph-rest-1.0&tabs=http"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "az ad sp credential reset",
                    "url": "https://learn.microsoft.com/en-us/cli/azure/ad/sp/credential?view=azure-cli-latest#az-ad-sp-credential-reset"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "az ad sp credential delete",
                    "url": "https://learn.microsoft.com/en-us/cli/azure/ad/sp/credential?view=azure-cli-latest#az-ad-sp-credential-delete"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Remove-AzADAppCredential",
                    "url": "https://learn.microsoft.com/en-us/PowerShell/module/az.resources/remove-azadappcredential?view=azps-0.10.0"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Remove-AzADApplication",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/az.resources/remove-azadapplication?view=azps-11.6.0"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Remove-AzADSpCredential",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/az.resources/remove-azadspcredential?view=azps-11.6.0"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Remove-AzADServicePrincipal",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/az.resources/remove-azadserviceprincipal?view=azps-11.6.0"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "user: invalidateAllRefreshTokens",
                    "url": "https://learn.microsoft.com/en-us/graph/api/user-invalidateallrefreshtokens?view=graph-rest-beta&tabs=http"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Revoke-AzureADUserAllRefreshToken",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/azuread/revoke-azureaduserallrefreshtoken?view=azureadps-2.0"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1098",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0077",
            "name": "Revoke Microsoft 365 Refresh Tokens",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0077\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nRevoking Microsoft 365 (M365) refresh tokens terminates adversary lateral movement and defensive evasion using compromised tokens upon expiration of their access token.\n\n## Introduction\n\nM365 refresh tokens are used by Microsoft 365 to request new access tokens to enable authenticated users to remain signed-in. Unlike refresh tokens, M365 access tokens cannot be revoked. They will expire according to their specified time (default being 1 hour).\n\n## Preparation\n\n- This action should always be performed after issuing new Active Directory Federation Server (AD FS) certificates following a reported incident. \n- Appropriate permissions must be delegated in order to execute the cmdlets. In most cases these should be run with M365 `Global Administrator` permissions to revoke refresh tokens for all roles.\n\n## Risks\n\n- This countermeasure may disrupt operations.\n- User accounts will be required to reauthenticate to M365.\n\n## Guidance\n\nRefresh tokens in Microsoft 365 can be revoked either with the AD PowerShell module or Graph API. \n\n### Revoke M365 Refresh Tokens via Graph API\n\nAdministrators can use `Get-MgUser - All` with  `Revoke-MgUserSignInSession` to invalidate all refresh tokens.\n\n### Revoke M365 Refresh Tokens via Azure AD PowerShell Module\n\nFirst, connect to Azure AD with `Connect-AzureAD`\n\nAfterwards, administrators may run the following command to revoke M365 refresh tokens.\n\n`Get-AzureADuser -all $true | Revoke-AzureADUserAllRefreshToken`\n\n## References\n\n- Revoke-AzureADUserAllRefreshToken | <https://learn.microsoft.com/en-us/powershell/module/azuread/revoke-azureaduserallrefreshtoken?view=azureadps-2.0>\n- Immediately revoke access to Microsoft 365 applications | <https://www.michev.info/blog/post/4688/immediately-revoke-access-to-microsoft-365-applications>\n- Find Azure AD PowerShell and MSOnline cmdlets in Microsoft Graph PowerShell | <https://learn.microsoft.com/en-us/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0050",
                "CM0069",
                "CM0073",
                "CM0076",
                "CM0083",
                "CM0099"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Revoke-AzureADUserAllRefreshToken",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/azuread/revoke-azureaduserallrefreshtoken?view=azureadps-2.0"
                },
                {
                    "source_name": "www.michev.info",
                    "description": "Immediately revoke access to Microsoft 365 applications",
                    "url": "https://www.michev.info/blog/post/4688/immediately-revoke-access-to-microsoft-365-applications"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Find Azure AD PowerShell and MSOnline cmdlets in Microsoft Graph PowerShell",
                    "url": "https://learn.microsoft.com/en-us/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1550",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0078",
            "name": "Disable or Monitor Windows Script Host (WSH) Administration Tool",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0078\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling or monitoring the Windows Script Host (WSH) administration tool blocks or detects adversary execution of script-based malware via WSH.\n\n## Introduction\n\nWindows Script Host provides scripting abilities comparable to batch files, and enables execution of VBScript and JScript. If other scripting engines are installed, such as Ruby or Python, WSH can run their code as well. The scripts can be run from the desktop using the WScript.exe program or from a command line using CScript.exe. PowerShell is a substitute for WSH.\n\n## Preparation\n\n* Determine whether WScript.exe or CScript.exe are needed in the environment.\n\n## Risks\n\n* On some systems, disabling WSH may cause problems with system updates and the system recovery mechanism.\n\n## Guidance\n\nWSH should be disabled if it is acceptable from an operations perspective. Otherwise, WSH should be monitored. \n\n### Disabling WSH\n\n#### Modify the Registry Manually\n\n1. Open the system registry in edit mode\n2. Navigate to **HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Windows Script Host\\\\Settings\\\\**\n3. If it doesn't already exist, create a REG_DWORD called **Enabled**; assign the REG_DWORD the value **0** (zero)\n4. Navigate to **HKEY_LOCAL_MACHINE\\\\Software\\\\Microsoft\\\\Windows Script Host\\\\Settings\\\\**\n5. If it doesn't already exist, create a REG_DWORD called **Enabled**; assign the REG_DWORD the value **0** (zero)\n\n#### Modify via Group Policy Management Console\n\nRegistry settings as defined above can be applied across an organization or domain via the Group Policy Management console. Please see [ref] for details.\n\n### Monitoring WSH\n\nConfigure the host-based agent to monitor for process execution, command-line parameter inspection, and/or process lineage monitoring. These measures could provide insight into WScript.exe and CScript.exe abuse.\n\n## References\n\n- cscript | <https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/cscript>\n- wscript | <https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wscript>\n- Disable Windows Script Host (WSH) to block .VBS malware | <https://www.linkedin.com/pulse/disable-windows-script-host-wsh-block-vbs-malware-valerio-de-sanctis>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "cscript",
                    "url": "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/cscript"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "wscript",
                    "url": "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wscript"
                },
                {
                    "source_name": "www.linkedin.com",
                    "description": "Disable Windows Script Host (WSH) to block .VBS malware",
                    "url": "https://www.linkedin.com/pulse/disable-windows-script-host-wsh-block-vbs-malware-valerio-de-sanctis"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1059.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1059.007",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0079",
            "name": "Reset Active Directory Services (AD DS) Connector Account Password",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0079\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting the Active Directory Services (AD DS) Connector account password eliminates persistence and privilege escalation via hijacking of AD DS Connector account.\n\n## Introduction\n\nEntra Connect (formerly Azure AD Connect) is used to synchronize identity information, enabling users to be signed into both the organization's on-premises and cloud infrastructure. Entra Connect consists of three accounts:\n\n* **AD DS Connector account:** Also referred to as the AD Connector, this account is used to read and write information to the on-premises Windows Server AD by using Active Directory Domain Services (AD DS). This acccount is a Microsoft Online Services (MSOL) account with a name starting with MSOL_ followed by a hex code (e.g. MSOL_4f374eb2b150). While it requires a complex password, by default its passwords are not set to expire. \n* **ADSync service account** (also called the sync engine): the main component of Entra Connect, this account is used to run the sync service and access the SQL Server database that stores Azure AD Connect's information and settings. It's default name is NT SERVICE\\ADSync.\n* **Microsoft Entra Connector account:** Formerly known as the AAD Connector Acccount, this acccount is used to write information to the Microsoft Entra ID (formerly Azure Active Directory or AAD) tenant of the organization's Microsoft 365 subscription. It is named Sync_[hostname of on-prem Entra Connect server]_[ID].\n\nEntra Connect's AD DS Connector account possesses permissions that enable DCSync. \n* Replicating Directory Changes\n* Replicating Directory Changes All\n\nThese permissions, usually reserved for domain admins and the domain controllers, facilitates password hash synchronization; AD DS Connector account can retrieve an NT hash for an account that changes its password and provide it to the Entra Connector Account.\n\nHowever, if the AD DS Connector account is compromised, adversaries may use it to carry out DCSync attacks to dump secrets on a specified domain controller or move laterally to Azure AD.\n\n## Preparation\n\n- Identify the location of the AD DS Connector account within the on-prem Active Directory forest. If express settings were used, it will be created in Windows Server AD and located in the forest root domain in the Users container and begin with the prefix MSOL_.\n\n## Risks\n\n- Resetting an Entra Connect password may disrupt password synchronization between the on-prem AD and Microsoft Entra / Azure Active Directory.\n\n## Guidance\n\nThe following guidance describes the process of rotating the password associated with Entra Connect. Note that Microsoft Entra Connect cloud sync is replacing Microsoft Entra Connect Sync. Organizations should consider migrating to Cloud sync.\n\n### Reset Entra Connect AD DS Account Password\n\nTo change the AD DS connector account in Active Directory, system administrators can use either the Active Directory Users and Computers Console (ADUC) or via PowerShell with the Set-ADAccountPassword cmdlet. \n\n### Update Microsoft Entra Connect Synchronization Service with New Password\n\nSystem administrators should update Synchronization Service with the new account password. Otherwise synchronization will fail with a no-start-credentials error. \n\nFrom the Synchronization Service Manager, under the connections tab, select the AD Connector corresponding to the AD DS connector account. Under Actions, select properties and Connect to Active Directory Forest. Confirm the ID of the AD DS account and enter the new password in the corresponding box. Afterwards, restart Microsoft Entra ID Sync from the Windows Control Manager. \n\nThe PowerShell cmdlet `Start-ADSyncSyncCycle -PolicyType Delta` can be used on the Entra Connect Server to sync changes which can be verified in the Synchronization Service Manager. \n\n### Lock Down AD DS Account\n\nLock down access to the AD DS account by updating the accounts permissions. For further information see https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/reference-connect-version-history-archive#lock\n\n## References\n\n- Changing the AD DS connector account password | <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-sync-change-addsacct-pass>\n- Microsoft Entra Connect: Accounts and permissions | <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/reference-connect-accounts-permissions>\n- Guarding the Bridge: New Attack Vectors in Azure AD Connect | <https://www.sygnia.co/blog/guarding-the-bridge-new-attack-vectors-in-azure-ad-connect/>\n- Abuse of Azure AD Connect Sync Service Account | <https://github.com/Cloud-Architekt/AzureAD-Attack-Defense/blob/main/AADCSyncServiceAccount.md>\n- Change AD DS Connector account | <https://www.alitajran.com/change-ad-ds-connector-account/>\n- Azure AD Connect for Red Teamers | <https://blog.xpnsec.com/azuread-connect-for-redteam/>\n- Securing Microsoft Azure AD Connect | <https://www.hub.trimarcsecurity.com/post/securing-microsoft-azure-ad-connect>\n- Protect Microsoft Entra Connect (Azure AD Connect) from hackers | <https://www.prosec-networks.com/en/blog/microsoft-entra-connect-azure-ad-connect-vor-hackern-schuetzen/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0028",
                "CM0070",
                "CM0088",
                "CM0092",
                "CM0121"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Changing the AD DS connector account password",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-sync-change-addsacct-pass"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Entra Connect: Accounts and permissions",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/reference-connect-accounts-permissions"
                },
                {
                    "source_name": "www.sygnia.co",
                    "description": "Guarding the Bridge: New Attack Vectors in Azure AD Connect",
                    "url": "https://www.sygnia.co/blog/guarding-the-bridge-new-attack-vectors-in-azure-ad-connect/"
                },
                {
                    "source_name": "github.com",
                    "description": "Abuse of Azure AD Connect Sync Service Account",
                    "url": "https://github.com/Cloud-Architekt/AzureAD-Attack-Defense/blob/main/AADCSyncServiceAccount.md"
                },
                {
                    "source_name": "www.alitajran.com",
                    "description": "Change AD DS Connector account",
                    "url": "https://www.alitajran.com/change-ad-ds-connector-account/"
                },
                {
                    "source_name": "blog.xpnsec.com",
                    "description": "Azure AD Connect for Red Teamers",
                    "url": "https://blog.xpnsec.com/azuread-connect-for-redteam/"
                },
                {
                    "source_name": "www.hub.trimarcsecurity.com",
                    "description": "Securing Microsoft Azure AD Connect",
                    "url": "https://www.hub.trimarcsecurity.com/post/securing-microsoft-azure-ad-connect"
                },
                {
                    "source_name": "www.prosec-networks.com",
                    "description": "Protect Microsoft Entra Connect (Azure AD Connect) from hackers",
                    "url": "https://www.prosec-networks.com/en/blog/microsoft-entra-connect-azure-ad-connect-vor-hackern-schuetzen/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003.006",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.004",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0080",
            "name": "Block and Reissue Tokens",
            "subtype": "Disable, Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0080\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nBlocking and reissuing tokens blocks adversary persistence and lateral movement using tokens.\n\n## Introduction\n\nA token is an authorization file that is generated by a server and\nstored client-side. Tokens are often used for authentication,\nauthorization, and for storing user preferences or session information.\nTokens can either be \"stateful\" -- stored in a server-side database and\nsent to the client to be stored in a browser cookie (e.g., session IDs)\n-- or more commonly \"stateless\" and only stored in client-side data\nstructures (e.g., JSON Web Tokens and opaque bearer tokens such as\naccess tokens.)\n\nAdversaries can steal tokens used for stateful authentication by\ncompromising a server and accessing session information stored in the\nserver's database. However, because HTTP is inherently stateless,\nadversaries most often steal stateless tokens by compromising the client\nmachine and performing \"pass-the-cookie\" attacks. For this reason,\nstateless tokens should be securely kept in cookies with the HttpOnly\nattribute to mitigate theft.\n\nAn adversary that steals a token will be able to circumvent multi-factor\nauthentication (MFA) to hijack a user account and impersonate a user,\nissuing fraudulent authenticated API calls. In doing so, an adversary\nmay be able to access resources in cloud and container-based\napplications and software-as-a-service (SaaS).\n\n## Preparation\n\n- Verify suspicious activity of the potentially compromised user account by reviewing user and machine logs.\n- Utilize Microsoft's investigation checklist for suspicious activities and Microsoft Entra ID Protection (formerly Azure Active Directory) alerts.\n\n## Risks\n\n- Reissuing tokens may disrupt legitimate sessions.\n\n## Guidance\n\nIf an organization suspects that a token associated with a hijacked\naccount was stolen, they should immediately do the following.\n\n1.  **Revoke compromised tokens or update revocation list**. If the\n    compromised account uses stateful authentication, any database\n    records containing session information of the compromised user\n    account should immediately be invalidated.\n\nIf access was granted using a stateless token (e.g., JWTs) they will not\nbe stored in any server-side database and therefore cannot be\ninvalidated. However, the refresh token used to sign the access token\nmay be invalidated if stored server-side by using a revocation list (aka\ntoken deny list) on the server. Refresh tokens stored server-side may\nalso be rotated, invalidating old refresh tokens and issuing new ones.\nPerforming both actions to refresh tokens may temporarily disrupt the\nadversary when they request a new signed access token.\n\n2.  **Force a password reset and consider disabling compromised\n    account:** By resetting an account's password and requiring the user\n    set a new password, an adversary that has hijacked the session and\n    modified the user's login credentials for access will be unable to\n    use their credentials for access. This is a temporary solution, as\n    an adversary who still has the ability to steal JWT may be able to\n    perform credential modification again. Implementing multi-factor\n    authentication may further slow the adversary. Disabling the account\n    will inhibit the ability of the adversary to perform actions with\n    the compromised user account.\n\n3.  **Identify the expiration timeline of the token and shorten the\n    duration of subsequent tokens**. Short-lived tokens are advisable\n    over long-term tokens. If a short-lived token is compromised, the\n    time-window that an attacker will be able to use the stolen token\n    will be narrowed. Incident response teams should review the life of\n    tokens and reduce the duration of subsequent tokens if deemed\n    necessary. Reducing the duration of stateless tokens to a shorter\n    length of time (e.g., 5 minutes) may slow the adversary, as they\n    will need to re-steal subsequent tokens. However, if an adversary\n    manages to steal one, chances are they will be able to perform the\n    theft again.\n\n4.  **Trace source of attack:** An adversary that can steal tokens has\n    either compromised a client or server environment. As part of\n    incident response, teams will need to identify the source of\n    compromise, and whether the compromised account was part of a larger\n    supply-chain compromise if authentication is provided by a provider.\n\n5.  **Remove malicious changes introduced or used by the adversary.** An\n    adversary that gains access to a user account via token theft may\n    have added malicious email rules or misconfigured MFA with new\n    devices. To respond to these actions, see CM0082: Audit/Remove\n    Suspicious Email Forwarding Rules and CM0071: Unenroll Suspicious \n    Multifactor Authentication (MFA) Device from Microsoft User Account.\n\n## References\n\n- What Happens If Your JWT Is Stolen? | <https://developer.okta.com/blog/2018/06/20/what-happens-if-your-jwt-is-stolen>\n- Token tactics: How to prevent, detect, and respond to cloud token theft | <https://www.microsoft.com/en-us/security/blog/2022/11/16/token-tactics-how-to-prevent-detect-and-respond-to-cloud-token-theft/>\n- Revoke user access in Microsoft Entra ID | <https://learn.microsoft.com/en-us/entra/identity/users/users-revoke-access>\n- Token Theft Playbook | <https://learn.microsoft.com/en-us/security/operations/token-theft-playbook>\n- Token-based Authentication: Everything You Need to Know | <https://www.strongdm.com/blog/token-based-authentication>\n- Token Types | <https://cloud.google.com/docs/authentication/token-types>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0082",
                "CM0083",
                "CM0099"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "developer.okta.com",
                    "description": "What Happens If Your JWT Is Stolen?",
                    "url": "https://developer.okta.com/blog/2018/06/20/what-happens-if-your-jwt-is-stolen"
                },
                {
                    "source_name": "www.microsoft.com",
                    "description": "Token tactics: How to prevent, detect, and respond to cloud token theft",
                    "url": "https://www.microsoft.com/en-us/security/blog/2022/11/16/token-tactics-how-to-prevent-detect-and-respond-to-cloud-token-theft/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Revoke user access in Microsoft Entra ID",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/users/users-revoke-access"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Token Theft Playbook",
                    "url": "https://learn.microsoft.com/en-us/security/operations/token-theft-playbook"
                },
                {
                    "source_name": "www.strongdm.com",
                    "description": "Token-based Authentication: Everything You Need to Know",
                    "url": "https://www.strongdm.com/blog/token-based-authentication"
                },
                {
                    "source_name": "cloud.google.com",
                    "description": "Token Types",
                    "url": "https://cloud.google.com/docs/authentication/token-types"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1528",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0081",
            "name": "Rebuild Citrix NetScaler Appliances ",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0081\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRebuilding NetScaler appliances disrupts adversary discovery and credential access via session hijacking NetScaler Application Delivery Controller (ADC).\n\n## Introduction\n\nThe Citrix NetScaler ADC is a network appliance typically architected between company firewall(s) and an application server located in a demilitarized zone (DMZ) that aims to increase efficiency of business operations through load balancing, network performance acceleration, and software/application distribution.\n\nNetscaler ADCs are secured by NetScaler Gateways that provide administrators application-level policy controls and action controls, which secure access to applications and data accessible remotely through Secure Sockets Layer (SSL) (virtual private network) VPN technology. However, if an adversary is able to bypass credential provision or legitimate session creation by hijacking a session, they will be able to exfiltrate credentials, authentication tokens, and cookies. Given the prevalence of NetScaler ADCs in enterprise environments, and that the security of NetScaler ADCs is largely accounted for by proper configuration through NetScaler Gateway, proper remediating steps are required after compromise of user sessions or authentication tokens via NetScaler appliances.\n\n## Preparation\n\n- Ensure isolation of NetScaler ADC and Gateway applications prior to application of patches or firmware upgrades.\n- Correlate user session creation with anomalous data enumeration or transfer events.\n- Identify whether the adversary compromised MFA tokens along with hijacked user sessions.\n\n## Risks\n\n- Implementing this countermeasure will temporarily disrupt business operations and application access that is provided by NetScaler ADC.\n- Upgrading firmware related to NetScaler ADC and Gateway will incur operational downtime, and in some cases may introduce compatibility issues and bugs to the appliances.\n- Isolation of NetScaler appliances is very likely to sever load balancing and the timely access of business software.\n\n## Guidance\n\n### Apply Upgrades/Updates to NetScaler Appliances\n\n- Firsthand effort should be focused on updating and patching the NetScaler ADC and Gateway applications.\n- In cases where the affected appliances cannot be prioritized for patching, ingress IP address restrictions need be implemented to constrain exposure and increased attack surface.\n- Upgrade vulnerable NetScaler ADC and NetScaler Gateway appliances to their latest firmware versions after verifying upgrade integrity from vendor.\n\n### Terminate Active Sessions\n\n- Review the persistent and active sessions between NetScaler Gateway and NetScaler ADC separately. \n- Connect to the NetScaler appliances via CLI and kill all active sessions by specifying the relevant virtual server to target.\n- Delegate API keys on an as-needed basis - keep secret and regularly audit API key usage to verify their usage by legitimate accounts.\n\n### Credential Rotation \n\n- In the absence of log records or artifacts of exploitation activity, organizations should rotate the credentials of identities that were provisioned for accessing resources via NetScaler ADC or NetScaler Gateway appliances.\n- Larger scope credential rotation is required in incidents where session hijacking is evident, and single factor authentication (SFA) remote access is permitted for resource access through the Internet.\n\n### Rebuild NetScaler ADC/Gateway\n\n- The presence of web shells or backdoors on NetScaler appliances begets network administrators to rebuild each appliance with a clean-source image and updated vendor firmware.\n- Backup configurations should be reviewed to help ensure a lack of backdoors or loosely configured remote access tools.\n\n## References\n\n- Citrix NetScaler ADC/Gateway: CVE-2023-4966 Remediation | <https://services.google.com/fh/files/misc/citrix-netscaler-adc-gateway-cve-2023-4966-remediation.pdf>\n- #StopRansomware: LockBit 3.0 Ransomware Affiliates Exploit CVE 2023-4966 Citrix Bleed Vulnerability | <https://www.cisa.gov/sites/default/files/2023-11/aa23-325a_lockbit_3.0_ransomware_affiliates_exploit_cve-2023-4966_citrix_bleed_vulnerability_0.pdf>\n- What is Citrix NetScaler, and how does it work? | <https://www.logicmonitor.com/blog/what-is-citrix-netscaler-and-how-does-it-work>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0027",
                "CM0066"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "services.google.com",
                    "description": "Citrix NetScaler ADC/Gateway: CVE-2023-4966 Remediation",
                    "url": "https://services.google.com/fh/files/misc/citrix-netscaler-adc-gateway-cve-2023-4966-remediation.pdf"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "StopRansomware: LockBit 3.0 Ransomware Affiliates Exploit CVE 2023-4966 Citrix Bleed Vulnerability",
                    "url": "https://www.cisa.gov/sites/default/files/2023-11/aa23-325a_lockbit_3.0_ransomware_affiliates_exploit_cve-2023-4966_citrix_bleed_vulnerability_0.pdf"
                },
                {
                    "source_name": "www.logicmonitor.com",
                    "description": "What is Citrix NetScaler, and how does it work?",
                    "url": "https://www.logicmonitor.com/blog/what-is-citrix-netscaler-and-how-does-it-work"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1082",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1539",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0082",
            "name": "Identify and Remove Suspicious Email Forwarding Rules ",
            "subtype": "Examine, Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0082 \n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Eliminate \n* **Status:** Active\n\n## Intended Outcome\n\nIdentifying and removing suspicious email forwarding rules restricts adversary collection using compromised e-mail accounts.\n\n## Introduction\n\nAdversaries that have compromised email accounts may introduce auto-forward rules to collect sensitive information, monitor an account's communications, or maintain persistent access to an account after credentials are reset. When recovering from an incident involving account compromise, investigate suspect email forwarding rules and remove any that may be leveraged by the adversary.\n\n## Preparation\n\n- Before removing a forwarding rule, administrators should disable the rule while investigating the sender's past behavior and recent activities to determine whether the account is indeed compromised. This may include reviewing the time, location, and devices used by the account holder.  \n\n- Administrators should block the ability for the affected user(s) to login, reset the user's password(s), revoke the appropriate access session tokens, and take note of the forwarding address before removing forwarding rule(s) introduced by a suspected adversary.  \n\n- When auditing email accounts for suspicious forwarding rules, administrators should verify that mailbox auditing is turned on (auditing is usually on by default). This can be performed using Exchange Online PowerShell.\n\n- If the forwarding address is associated with a suspicious domain, administrators should also consider adding it to their DNS blocklist, as doing so will also disrupt the adversary's exfiltration destination.  \n\n- Organizations using Microsoft 365 should consult Microsoft's instructions for responding to a compromised email account and implement multi-factor authentication as part of their remediation strategy.\n\n## Risks\n\n- Unintentionally removing non-malicious mailbox rules may disrupt business operations. \n\n- Failing to sever the adversary's access to the account will only temporarily set back the adversary and permit the adversary to reintroduce malicious forwarding rules.\n\n## Guidance\n\nAdversaries have multiple ways of creating malicious email rules. These include abusing email client software (e.g., Microsoft Outlook or Mozilla ThunderBird), web applications (e.g., Outlook on the web / OWA), and command-line interfaces (e.g., PowerShell).  \n\nAdversaries may also hide their rules so they are not visible in Outlook or Exchange Administration tools by abusing the Microsoft Messaging API (MAPI) to modify the rule properties. Both visible and hidden malicious forwarding rules must be identified and removed.  \n\nEmail administrators should also consider disabling the ability for users to forward emails outside of the domain all together. \n\nWhen investigating a suspicious forwarding address or rule, administrators should consider using Message Trace to understand the flow of emails sent by a suspicious forwarding rule.  \n\n### Mailbox Forwarding Rules \n\n#### Audit for Suspicious Forwarding Addresses \n\nAdversaries configure the user's mailbox settings to forward mail to a designated mailbox address. By specifying the attribute ForwardingSmtpAddress with the cmdlet Get-Mailbox, adversaries can forward mail to a mailbox destination outside of the organization. Likewise, by using the attribute ForwardingAddress, adversaries can forward emails to an internal destination.  \n\nTo identify suspicious mailbox forwarding rules, administrators should list and review all mailboxes configured with forwarding Address from Mailbox Settings. This can be accomplished with the Get-Mailbox cmdlet. Administrators can search Microsoft Unified Audit Logs using PowerShell through the ExchangeOnlineManagement module for past evidence of adversaries modifying mailbox settings. \n\n#### Remove Suspicious Forwarding Address \n\nTo remove a suspicious forwarding address, administrators can use the PowerShell cmdlet Set-Mailbox and set ForwardingAddress and/or ForwardingSmtpAddress to $Null. \n\n#### Audit for Suspicious Inbox Forwarding Rules \n\nIf an organization suspects a suspicious mailbox forwarding rule has been added or has identified  one or more malicious mailbox forwarding rules, performing an audit on all inbox forwarding rules will allow an organization to locate any overlooked forwarding rules introduced to one or more user accounts.  \n\nTo audit Microsoft Exchange logs,  administrators can log into Microsoft365 and search the audit log for suspicious use of the following cmdlets. \n\n-   New-InboxRule  \n-   Set-InboxRules \n-   UpdateInboxRules \n\nWhen retrieving inbox rules, use the flag -includehidden to view hidden rules as well.  \n\n#### Remove Mailbox Forwarding Rule \n\nIf a malicious mailbox forwarding rule is known, administrators can remove it using the command line with PowerShell in  Microsoft365. This can be accomplished with the Remove-InboxRule cmdlet and associated rule ID.\n\n### Mail Flow Rules \n\n#### Audit for Suspicious Mail Flow Rules \n\nAdministrators can set up email forwarding rules that apply across the entire organization, rather than just individual inboxes. This is useful for organizations using platforms like Microsoft Exchange, which allow mail flow rules (also called transport rules) that automatically filter incoming emails based on specified conditions and perform actions on them. However, adversaries that abuse such features may be able to enable forwarding on all or specific mail an organization receives.\n\nFollowing an incident, administrators should review logs for the creation of these rules. This can be accomplished with the Get-TransportRule cmdlet to view transport rules (mail flow rules). If a suspicious mail flow rule is identified, rotate the credentials for accounts belonging to email admins, ensure multi-factor authentication is deployed (ideally other than SMS), and investigate the admin account compromise. While investigating, the adversary's transport rule can be disabled with the cmdlt  Disable-TransportRule  using  ExchangePowerShell. \n\n#### Remove Suspicious Mail Flow Rule \n\nMail flow rules can be removed with the ExchangePowerShell cmdlet Remove-TransportRule after specifying a Rule ID. \n\n### Block External Forwarding  \n\nIf necessary, email administrators can disable external forwarding all together by creating a new MailFlow rule. Senders should receive a Non-Delivery Report (NDR) with code 5.7.520 to tell them that the organization doesn't allow external forwarding. \n\n### Investigate Potential Methods of Persistence \n\nEven if a rule is removed and credentials rotated, adversaries may still have implemented automated processes to reestablish forwarding in the account.  \n\nIncident responders should also triage the account owner's device(s) to identify whether malware has been granted the Mailbox.Settings.ReadWrite  permission. In cases where it is suspected that the user's device is compromised, reimaging may be needed to resolve the incident.  \n\nMicrosoft365 subscribers should audit all the audit logs for a compromised account, as there are often multiple means by which adversaries establish persistence. This includes Microsoft Flow rules or granting inappropriate mailbox permissions. \n\nVerify that the SMTP server is not compromised.\n\n## References\n\n- Alert classification for suspicious inbox forwarding rules | <https://learn.microsoft.com/en-us/defender-xdr/alert-grading-playbook-inbox-forwarding-rules>\n- Detecting suspicious email forwarding rules on Office 365 | <https://redcanary.com/blog/threat-detection/email-forwarding-rules/>\n- Forward thinking: How adversaries abuse Office 365 email rules | <https://redcanary.com/blog/threat-detection/o365-email-rules-mindmap/>\n- Threat Hunting in Microsoft 365 Environment | <https://www.youtube.com/watch?v=2A0faMIEp00>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0061",
                "CM0074",
                "CM0076",
                "CM0080"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Alert classification for suspicious inbox forwarding rules",
                    "url": "https://learn.microsoft.com/en-us/defender-xdr/alert-grading-playbook-inbox-forwarding-rules"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Detecting suspicious email forwarding rules on Office 365",
                    "url": "https://redcanary.com/blog/threat-detection/email-forwarding-rules/"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Forward thinking: How adversaries abuse Office 365 email rules",
                    "url": "https://redcanary.com/blog/threat-detection/o365-email-rules-mindmap/"
                },
                {
                    "source_name": "www.youtube.com",
                    "description": "Threat Hunting in Microsoft 365 Environment",
                    "url": "https://www.youtube.com/watch?v=2A0faMIEp00"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1114.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0083",
            "name": "Rotate Application Programming Interface (API) Keys",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0083\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRotating API keys disrupts privilege escalation, credential access, defense evasion, lateral movement, and persistence using stolen API keys.\n\n## Introduction\n\nAn Application Programming Interface (API) is a system access point or library that has a well-defined syntax enabling software components to communicate by exchanging data in a structured and standardized way. Communication is made possible with an API key that is used to authenticate and authorize the application (or party) making the request. While API keys are not the only means of authenticating and authorizing requests, they are the simplest, and therefore very common across different use cases. \n\nAdversaries who obtain private API keys may use them to make fraudulent requests and exploit API functionality, enabling their attack campaigns. An adversary who steals a sensitive API key may alter or exfiltrate sensitive data in an organization, compromising the integrity of critical services such as file sharing, repositories, and collaboration platforms.\n\n## Preparation\n\n-  Work toward establishing a comprehensive view of the organization's API attack surface. This may include consulting documentation on API keys and access control records. \n- Review which applications/services use the affected API to understand what applications/services will be impacted. \n- Identify the attack path that allowed the adversary to steal the API key(s) and remediate. If malware was used to harvest the API keys or gain a foothold in the network to facilitate information gathering, purge the malware and fully evict the adversary from the environment to prevent them from re-harvesting the API keys. If the API key was inadvertently leaked publicly, consider taking down the source of the exposed key, if possible.\n- Confirm the necessary permissions are made available to change the API key when rotated.\n\n## Risks\n\n- Rotating an API key may break communication between components that rely on stolen hardcoded keys or stolen keys stored on devices, risking downtime.\n\n## Guidance\n\nRotating API keys consists of three core steps: \n\n1. Generating a new API key\n2. Replacing the compromised key\n3. Revoking the compromised key and securely deleting the old API key\n\nNote that different vendors and SaaS platforms have different processes for rotating their API keys. Organization's should consult vendor documentation for specific guidance relevant to their environment.\n\nHow To Rotate provides step-by-step instructions for rotating API keys for a variety of SaaS platforms (Link may be found in the references below.)\n\n\n### Implement Additional Authentication Protections\n\nEven after rotating API keys, multiple additional protections should be considered if appropriate. These include:\n\n- Migrating to phishing resistant Multi-factor Authentication.\n- Replacing API keys with token-based authentication, if appropriate.\n- Ensuring API keys are regularly rotated. Typically it is recommended that keys are rotated at least every 90 days.\n\n## References\n\n- Getting Started | <https://howtorotate.com/docs/introduction/getting-started/>\n- How to Become Great at API Key Rotation: Best Practices and Tips | <https://securityboulevard.com/2023/12/how-to-become-great-at-api-key-rotation-best-practices-and-tips/>\n- Mapping the MITRE ATT&CK Framework to API Security | <https://salt.security/blog/mapping-the-mitre-att-ck-framework-to-api-security>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0028",
                "CM0030",
                "CM0050",
                "CM0075",
                "CM0076",
                "CM0077",
                "CM0080",
                "CM0143"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "howtorotate.com",
                    "description": "Getting Started",
                    "url": "https://howtorotate.com/docs/introduction/getting-started/"
                },
                {
                    "source_name": "securityboulevard.com",
                    "description": "How to Become Great at API Key Rotation: Best Practices and Tips",
                    "url": "https://securityboulevard.com/2023/12/how-to-become-great-at-api-key-rotation-best-practices-and-tips/"
                },
                {
                    "source_name": "salt.security",
                    "description": "Mapping the MITRE ATT&CK Framework to API Security",
                    "url": "https://salt.security/blog/mapping-the-mitre-att-ck-framework-to-api-security"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1528",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0084",
            "name": "Restrict Accounts with Privileged Active Directory (AD) Access from Logging into Endpoints",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0084\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nRestricting accounts with privileged Active Directory (AD) access from logging into endpoints blocks adversary lateral movement via privileged AD access.\n\n## Introduction\n\nAccounts with domain privileges should only be accessed through designated Privileged Access Workstations (PAWs). If an adversary compromises a privileged or service account, they may attempt to perform lateral movement by accessing workstations, common access servers, and other endpoints. To disrupt the ability of an adversary to access these endpoints, system administrators should block accounts with privileged AD access, such as Domain Admins, from being able to log into unauthorized endpoints.\n\n## Preparation\n\n- Assess the impact of the mitigation on the job activities of the affected accounts. \n- If containing the adversary, inhibiting their access to the compromised account first by first rotating credentials.   \n- Verify whether the user right is absolutely required by a service account. If so, create a Group Managed Service Account (gMSA) and delegate only the necessary privileges for the service running the task(s).\n\n## Risks\n\n- Removing the ability for a service account to log into an endpoint may disrupt services or processes on the endpoint.\n\n## Guidance\n\n### Apply Deny Log On User Rights\n\nTo deny accounts with privileged AD access from logging into endpoints, the following restrictions should be enforced on the account(s):\n\n- Deny access to this computer from the network (SeDenyNetworkLogonRight)\n- Deny logon as a service (SeDenyServiceLogonRight)\n- Deny log on as a batch job (SeDenyBatchLogonRight)\n- Deny log on locally (SeDenyInteractiveLogonRight)\n- Deny log on through Remote Desktop (sometimes known as Deny log on through Terminal Services) (SeDenyRemoteInteractiveLogonRight)\n\nThese user right restrictions may be assigned to a new or existing Group Policy Object (GPO) using the Group Policy Editor (GPE) (gpedit.msc)\n\nComputer Configuration > Policies > Windows Settings > Security Settings > Local Policies > User Rights Assignment \n\nWhen assigning the \"deny access to this computer from the network\", include the security identifier (SID) flag S-1-5-114.\n\nAfterwards, link the GPO to the appropriate domain, site, or organizational unit (OU).\n\nIn addition to the above method, an administrator may use PowerShell to configure user rights. \n\n### Remove Unauthorized Log On User Rights\n\nAfter applying the 'deny' user rights to an account or group, system administrators should remove the equivalent 'log on' user rights. These include\n\n- Access this computer from the network (SeNetworkLogonRight)\n- Logon as a service (SeServiceLogonRight)\n- Log on as a batch job (SeBatchLogonRight)\n- Allow log on locally (SeInteractiveLogonRight)\n- Allow log on through Remote Desktop Services (SeRemoteInteractiveLogonRight)\n\nWhile the \"deny\" rights override the \"log on\" rights, accounts should be configured to possess either one or the other - not both. \n\nForce Group Policies updates with `Gpupdate /force` to ensure the policy changes are applied.\n\n## References\n\n- Proactive Preparation and Hardening to Protect Against Destructive Attacks | <https://cloud.google.com/blog/topics/threat-intelligence/protect-against-destructive-attacks/>\n- Implementing Least-Privilege Administrative Models | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/implementing-least-privilege-administrative-models>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0041",
                "CM0059",
                "CM0060",
                "CM0063",
                "CM0111",
                "CM0114",
                "CM0124",
                "CM0126",
                "CM0128"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "cloud.google.com",
                    "description": "Proactive Preparation and Hardening to Protect Against Destructive Attacks",
                    "url": "https://cloud.google.com/blog/topics/threat-intelligence/protect-against-destructive-attacks/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Implementing Least-Privilege Administrative Models",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/implementing-least-privilege-administrative-models"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0085",
            "name": "Audit Group Policy Objects (GPOs) in Active Directory (AD)",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0085\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing Group Policy Objects (GPOs) in Active Directory (AD) restricts adversary persistence, privilege escalation, and execution.\n\n## Introduction\n\nA Group Policy Object (GPO) is a virtual collection of policy settings that is enforced on devices and users in an Active Directory (AD) environment. Adversaries can abuse GPOs by identifying writable GPOs to perform privilege escalation, modifying security settings to perform specific tasks, and distributing malware. \nDuring an incident, audit logs should be checked to determine who (device and/or user) performed what actions. This will allow responders to triage and isolate rogue or suspicious users and devices. Both Microsoft's Policy Analyzer and Backup-GPO can be used for quickly restoring policy settings to a known secure baseline.\n\n## Preparation\n\n- Consult documentation of last known good or approved configurations.\n\n## Risks\n\nNo risks content identified.\n\n## Guidance\n\nAudits should prioritize top level domain policies, tier 0 assets, and domains with suspicious or anomalous activity. The rest of this guidance will cover how to enable Active Directory's audit policy setting and how to compare GPOs to a secure baseline. \n\n### Enable Audit Policy Setting and Review System Event Logs Concerning GPOs\n\nActive Directory's audit policy settings define which system events and account activity are tracked. \nAn audit policy in Active Directory defines what events to keep track of.\n\nThe events that are tracked will ultimately determine what information can be reviewed or not. The following steps were provided in a Microsoft Q&A response for how to enable GPO audits. \n\nStep 1: Enable Audit\n\n1. Launch \"Group Policy Management Console\", create a new GPO and link to Domain Controllers OU.\n\n2. From the context menu, click on \"Edit\" to open the \"Group Policy Management Editor\" window. Navigate to \"Computer Configuration\" -> \"Policies\" -> \"Windows Settings\" -> \"Security Settings\" -> \"Advanced Audit Policy Configuration\" -> \"Audit Policies\" -> \"DS Access\".\n\n3. Click \"Audit Directory Service changes\", click \"Configure the following audit events\" and choose \"Success\".\n\n4. To force Group Policy Update, we could run \"gpupdate /force\" on the domain controllers.\n\nStep 2: Configuring Group Policy Container Objects auditing\n\n1. Launch the ADSIEdit.msc and Connect to the Default naming context.\n\n2. Navigate to CN=Policies,CN=System,DC=domain -> Open the \"Properties of Policies\" object -> Go to the Security tab -> Click the Advanced button.\n\n3. Go to the Auditing tab -> Add the Principal Everyone -> Choose the Type Success -> For Applies to, click This object and Descendant objects -> Under Permissions, select following checkboxes: \"Create groupPolicyContainer objects\", \"Delete\", \"Modify Permissions\" -> Click OK.\n\nStep 3: Review changes in the security Event Log. \n\n1. Event ID 5137 captures who created the GPO.\n\n2. Event ID 5141 is logged with the Unique ID of the GPO that was deleted and the user who performed the deletion. \n\n3. Event ID 5136 is generated when a GPO is modified. \n\n### Compare GPO Configurations to Secure Baseline\n\n#### Comparing Against Audit Policy Baseline\n\nAnother approach would be to have a baseline and backups of approved GPO policies to perform manual audits. Backup-GPO can be used to create a backup of one or more GPOs. Get-GPOReport can then be used to grab the current GPO and compare it against a secure baseline. Regular backups would need to be performed to have the most current and approved GPO.\n\n#### Microsoft's Security Compliance Toolkit\n\nMicrosoft's Security Compliance Toolkit (SCT) is a set of tools for enterprise administration. Within the toolkit, the Policy Analyzer enables administrators to capture a baseline and compare it to different versions for the purposes of identifying where changes occurred. Example usage and screen grabs of the policy analyzer and other tools in the toolkit can be viewed in the \"Microsoft Security Compliance Toolkit\" article provided in the references.\n\n## References\n\n- Group Policy Objects | <https://learn.microsoft.com/en-us/previous-versions/windows/desktop/policy/group-policy-objects>\n- How to Audit Group Policy Changes Using Event Logs | <https://www.lepide.com/how-to/audit-changes-made-to-group-policy-objects.html>\n- Top 11 Windows Audit Policy Best Practices | <https://activedirectorypro.com/audit-policy-best-practices/>\n- Backup-GPO | <https://learn.microsoft.com/en-us/powershell/module/grouppolicy/backup-gpo?view=windowsserver2022-ps>\n- Microsoft Security Compliance Toolkit - How to use | <https://learn.microsoft.com/en-us/windows/security/operating-system-security/device-management/windows-security-configuration-framework/security-compliance-toolkit-10>\n- GPO Abuse | <https://redfoxsec.com/blog/gpo-abuse/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0043",
                "CM0060",
                "CM0113",
                "CM0125",
                "CM0133",
                "CM0140",
                "CM0144"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Group Policy Objects",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/desktop/policy/group-policy-objects"
                },
                {
                    "source_name": "www.lepide.com",
                    "description": "How to Audit Group Policy Changes Using Event Logs",
                    "url": "https://www.lepide.com/how-to/audit-changes-made-to-group-policy-objects.html"
                },
                {
                    "source_name": "activedirectorypro.com",
                    "description": "Top 11 Windows Audit Policy Best Practices",
                    "url": "https://activedirectorypro.com/audit-policy-best-practices/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Backup-GPO",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/grouppolicy/backup-gpo?view=windowsserver2022-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Security Compliance Toolkit - How to use",
                    "url": "https://learn.microsoft.com/en-us/windows/security/operating-system-security/device-management/windows-security-configuration-framework/security-compliance-toolkit-10"
                },
                {
                    "source_name": "redfoxsec.com",
                    "description": "GPO Abuse",
                    "url": "https://redfoxsec.com/blog/gpo-abuse/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1484.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1484.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0086",
            "name": "Reboot Workstations",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0086\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRebooting workstations removes memory-resident malware from Random Access Memory (RAM).\n\n## Introduction\n\nAdversaries may deploy memory-resident malware to minimize their presence in a target network, circumvent defenses, and reduce the risk of being detected. Memory-resident malware exists in RAM and does not typically involve leaving artifacts on a host's hard-drive.\n\n## Preparation\n\n- Rebooting a workstation will destroy memory-resident malware and its artifacts. This can ultimately hinder further analysis. If this is a concern, consider capturing a memory dump before rebooting the host.\n\n## Risks\n\n- Rebooting a workstation will clear memory-resident malware from RAM. If the malware has instantiated a persistence mechanism e.g. WMI event subscriptions, scheduled tasks, etc., the malware will persist after reboot. As such, rebooting workstations may not be adequate to completely mitigate the threat. \n- If a workstation is infected with ransomware, a reboot can result in permanent data loss.\n\n## Guidance\n\n-\tNotify users and stakeholders in advance of any planned system reboots to minimize any potential disruptions or downtime. \n-\tConsider capturing artifacts before the reboot for later analysis.\n-\tAfter the system has been rebooted, continually monitor the workstation for indications of persistence.\n\n## References\n\n- What is Fileless Malware | <https://www.fortinet.com/resources/cyberglossary/fileless-malware>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0026",
                "CM0066",
                "CM0067"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.fortinet.com",
                    "description": "What is Fileless Malware",
                    "url": "https://www.fortinet.com/resources/cyberglossary/fileless-malware"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1055",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1112",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0087",
            "name": "Disable Credential Caching in the WDigest Authentication Protocol",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0087\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling credential caching in the WDigest authentication protocol restricts adversary credential access and privilege escalation.\n\n## Introduction\n\nWDigest is a legacy authentication protocol that stores clear-text passwords in memory. WDigest is frequently targeted by adversaries who perform credential dumping in order to escalate privileges and move laterally.  As of the release of Windows Server 2012 R2, WDigest should be disabled by default on recent versions of the Windows operating system. However, it is not removed and can be enabled by an adversary with local administrator privileges. Disabling \"UseLogonCredential\" prevents WDigest from storing clear-text passwords in memory.\n\n## Preparation\n\n-\tDetermine if and to what extent the organization uses WDigest for authentication. This can be accomplished by reviewing event logs on servers for event ID 4624 and checking domain controller logs for event ID 4776 to identify whether any users have logged in with 'Authentication Package: WDigest'.\n- Verify that WDigest has not been manually enabled. The status of WDigest can be queried using \n\n    `reg query HKLMSYSTEMCurrentControlSetControlSecurityProvidersWDigest /v UseLogonCredential`\n\n- Update KB2871997 must first be installed to disable WDigest authentication in Windows 7, Windows 8, Windows Server 2008 R2 and Windows Server 2012.\n\n## Risks\n\n-\tOrganizations that use WDigest for authentication will experience operational disruption if they prevent WDigest from storing clear-text credentials.\n\n## Guidance\n\n-\tUse the Group Policy Editor to create a new Group Policy Object (GPO) that's linked to the domain or the Organizational Unit (OU) that contains user accounts.\n-\tSet the \"UseLogonCredential\" registry key in the HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest path to \"0.\" \n-   Force GPO update with `gpupdate`\n-\tVerify the change persists.\n\n## References\n\n- Disabling credentials caching in WDigest | <https://learn.microsoft.com/en-us/answers/questions/463368/disabling-credentials-caching-in-wdigest>\n- An Overview of KB2871997 | <https://msrc.microsoft.com/blog/2014/06/an-overview-of-kb2871997/>\n- WDigest Clear-Text Passwords: Stealing More than a Hash | <https://blog.netwrix.com/2022/10/11/wdigest-clear-text-passwords-stealing-more-than-a-hash/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0088",
                "CM0089",
                "CM0090",
                "CM0094"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Disabling credentials caching in WDigest",
                    "url": "https://learn.microsoft.com/en-us/answers/questions/463368/disabling-credentials-caching-in-wdigest"
                },
                {
                    "source_name": "msrc.microsoft.com",
                    "description": "An Overview of KB2871997",
                    "url": "https://msrc.microsoft.com/blog/2014/06/an-overview-of-kb2871997/"
                },
                {
                    "source_name": "blog.netwrix.com",
                    "description": "WDigest Clear-Text Passwords: Stealing More than a Hash",
                    "url": "https://blog.netwrix.com/2022/10/11/wdigest-clear-text-passwords-stealing-more-than-a-hash/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0088",
            "name": "Enable Credential Guard",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0088\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling Credential Guard restricts adversary credential access.\n\n## Introduction\n\nCredential Guard is one of several countermeasures available to prevent credential access and is enabled by default on Windows 11 22H2 and later.  Credential Guard uses Virtualization-based security (VBS) to isolate credentials so that only privileged system software can access them.  This countermeasure protects NTLM password hashes, Kerberos Ticket Granting Ticket (TGT), and credential manager domain credentials.\n\n## Preparation\n\n-\tFor Credential Guard to be enabled, the following requirements must be met:\n    -    Windows 11 version 22H2 or later\n    -    64-bit CPU\n    -    Support for Virtualization-based security\n    -    Secure boot\n-\tCheck for the existence of legacy authentication protocols.  Credential Guard does not permit the following protocols:\n    -    NTLMv1\n    -    Digest\n    -    CredSSP\n    -    MS-CHAPv2\n    -    Kerberos unconstrained delegation\n    -    Kerberos DES encryption support\n    -    Extracting the Kerberos TGT\n-\tCheck for the presence of 3rd party Security Support Providers (SSPs).  Some third-party SSPs may not be compatible with Credential Guard.  \n-\tThe following features are not requirements but can provide additional protections:\n    -    Trusted Platform Module (TPM) provides binding to hardware.\n    -    UEFI lock prevents attackers from disabling Credential Guard.\n- Verify status of Credential Guard. Administrators can verify whether Credential Guard is running on a system with the following PowerShell command `Get-CimInstance -ClassName 'Win32_DeviceGuard' -Namespace 'root\\Microsoft\\Windows\\DeviceGuard'`\n\n## Risks\n\n-\tDue to hardware and software requirements, there is a risk of operational disruption during deployment and performance degradation on systems with processors that do not support VBS. To minimize the likelihood of this risk, consider deploying Credential Guard in a phased approach and monitor audit logs to help ensure successful deployment.  \n-\tCredential Guard is not compatible with legacy authentication protocols and will prevent authentication or force users to manually authenticate if legacy protocols are in use.   \n-\tThird-party authentication modules must be digitally signed with a Microsoft digital signature and be compliant with the Microsoft Security Development Lifecycle.  If the third-party modules do not meet these requirements, there is a risk of operational disruption. \n-\tCredential Guard can be disabled by privileged users. Disabling Credential Guard would not afford access to credential material in LSASS but would afford access to hashes from future logins.   \n-\tCredential Guard does not protect:\n    -    Local accounts and Microsoft accounts\n    -    Active Directory database on Windows Server domain controllers\n    -    Keylogging\n    -    Physical attacks\n    -    The use of privileges associated with any credential\n    -    3rd party security packages\n    -    Supplied credentials for NTLM authentication\n    -    Kerberos service tickets\n    -    Windows cached credentials\n\n## Guidance\n\n### Enable Credential Guard with Group Policy Editor\n\n-\tUse the Group Policy Editor to create a new Group Policy Object (GPO) that's linked to the domain or Organization Unit (OU) and enable Virtualization-based security.\n-\tSpecify the Platform Security Level and Credential Guard Configuration. System administrators should select Secure Boot with DMA protection unless CPU does not support input/output memory management unit (in which case, select Secure Boot) and Enabled with UEFI lock to help ensure Credential Guard cannot be remotely disabled.\n-\tApply the policy and verify that it was successfully enabled.\n\n### Enable Credential Guard with Microsoft Intune\n\n- Alternatly, system administrators can enable Credential Guard via the Microsoft Intune admin center. \n- Create a profile and add Device Guard from the settings picker. After selecting Device Guard, select Credential Guard from the policy settings.\n\n## References\n\n- Credential Guard overview | <https://learn.microsoft.com/en-us/windows/security/identity-protection/credential-guard>\n- Configure Credential Guard | <https://learn.microsoft.com/en-us/windows/security/identity-protection/credential-guard/configure?tabs=intune>\n- Considerations and known issues when using Credential Guard | <https://learn.microsoft.com/en-us/windows/security/identity-protection/credential-guard/considerations-known-issues>\n- How Credential Guard works | <https://learn.microsoft.com/en-us/windows/security/identity-protection/credential-guard/how-it-works>\n- Virtualization-based security must be enabled with the platform security level configured to Secure Boot or Secure Boot with DMA Protection. | <https://www.stigviewer.com/stig/windows_server_2016/2018-03-07/finding/V-73513>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0079",
                "CM0087",
                "CM0089",
                "CM0090",
                "CM0094",
                "CM0096",
                "CM0104"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Credential Guard overview",
                    "url": "https://learn.microsoft.com/en-us/windows/security/identity-protection/credential-guard"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Configure Credential Guard",
                    "url": "https://learn.microsoft.com/en-us/windows/security/identity-protection/credential-guard/configure?tabs=intune"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Considerations and known issues when using Credential Guard",
                    "url": "https://learn.microsoft.com/en-us/windows/security/identity-protection/credential-guard/considerations-known-issues"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How Credential Guard works",
                    "url": "https://learn.microsoft.com/en-us/windows/security/identity-protection/credential-guard/how-it-works"
                },
                {
                    "source_name": "www.stigviewer.com",
                    "description": "Virtualization-based security must be enabled with the platform security level configured to Secure Boot or Secure Boot with DMA Protection.",
                    "url": "https://www.stigviewer.com/stig/windows_server_2016/2018-03-07/finding/V-73513"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1003.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1555.004",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0089",
            "name": "Enable Local Security Authority (LSA) Protections",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0089\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling Local Security Authority (LSA) protections blocks adversary credential access via Local Security Authority Subsystem Service (LSASS) process memory dumping.\n\n## Introduction\n\nThe Local Security Authority (LSA) is a process that validates users for sign-ins and enforces local security policies. LSA protection prevents code injection and memory reads by unprotected processes. Therefore, LSA protection prevents unauthorized access to the credentials stored and managed by the LSA.\n\n## Preparation\n\n-   If the organization uses third-party authentication modules, these modules must be digitally signed with a Microsoft digital signature and be compliant with the Microsoft Security Development Lifecycle.\n    -\tIdentify all LSA plug-ins and drivers, including non-Microsoft drivers or plug-ins and internally developed software. \n    -\tEnsure all LSA plug-ins are digitally signed with a Microsoft certificate.\n    -\tEnsure all signed plug-ins successfully load into LSA and function correctly.\n    -\tReview audit-logs to identify LSA plug-ins and drivers that fail to run as protected processes.\n\n## Risks\n\n-\tIf third-party modules do not meet these requirements, there is a risk of operational disruption.\n\n## Guidance\n\n-\tUse the Group Policy Editor to create a new Group Policy Object (GPO) that's linked to the domain or the Organizational Unit (OU) that contains user accounts.\n-\tCreate a new registry item in the HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa path and specify the value \"RunAsPPL\".\n-\tApply the policy, update group policies with `gpupdate /force`, and verify that it was successfully enabled.\n\n## References\n\n- Configure added LSA protection | <https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/configuring-additional-lsa-protection>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0018",
                "CM0087",
                "CM0088",
                "CM0090",
                "CM0094",
                "CM0096"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Configure added LSA protection",
                    "url": "https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/configuring-additional-lsa-protection"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1003.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1003.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1589.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0090",
            "name": "Detect Attempts to Access Local Security Authority Subsystem Service (LSASS) Process",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0090\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDetecting attempts to access the Local Security Authority Subsystem Service (LSASS) process detects adversary credential access via LSASS credential dumping.\n\n## Introduction\n\nLocal Security Authority Subsystem Service (LSASS) is a crucial system file on the Microsoft Windows operating system that is responsible for verifying users logging into a system, handling password changes, and creating access tokens. LSASS is frequently the target of adversarial efforts to dump credentials for the purposes of privilege escalation and lateral movement.\n\n## Preparation\n\nNo Preparation content identified.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\nConfigure the host-based agent to detect:\n\n-\tProcess lineage\n    -    Instances where LSASS.exe was spawned from a suspicious parent process\n    -    LSASS.exe as the parent of any process\n-\tProcess access\n    -    LSASS being accessed by a suspicious processes\n    -    Filter out legitimate attempts to access LSASS (antivirus, policy enforcement, etc.)\n-\tFile monitoring\n    -    The creation of dump files in specific locations \n-\tDLL module loads\n    -    Commonly abused DLLs to dump LSASS\n-\tCommand-line parameter inspection\n    -    Functions used to dump LSASS\n\n## References\n\n- Detecting and preventing LSASS credential dumping attacks | <https://www.microsoft.com/en-us/security/blog/2022/10/05/detecting-and-preventing-lsass-credential-dumping-attacks/>\n- LSASS Memory | <https://redcanary.com/threat-detection-report/techniques/lsass-memory/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0018",
                "CM0087",
                "CM0088",
                "CM0089",
                "CM0094"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.microsoft.com",
                    "description": "Detecting and preventing LSASS credential dumping attacks",
                    "url": "https://www.microsoft.com/en-us/security/blog/2022/10/05/detecting-and-preventing-lsass-credential-dumping-attacks/"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "LSASS Memory",
                    "url": "https://redcanary.com/threat-detection-report/techniques/lsass-memory/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1003.004",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0091",
            "name": "Prevent and Detect System Binary Proxy Execution",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0091\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nPreventing and detecting abuse of trusted system binaries restricts and detects adversary malicious code execution.\n\n## Introduction\n\nAdversaries abuse trusted system binaries to execute malicious code by proxy to evade process and signature-based defenses.  Commonly abused system binaries include, but are not limited to rundll32, regsvr32, msbuild, msiexec, and mshta.\n\n## Preparation\n\n-\tConsult the references section for familiarization with system binaries that are commonly abused to achieve proxy execution.\n-\tDetermine the necessity of permitting the execution of these binaries in the environment.  This can be laborious, but each individual binary should be assessed for the likelihood of causing an unintended interruption if it is blocked or disabled.   \n-\tTo the extent possible, identify baseline behavior for binaries commonly used to achieve proxy execution.\n\n## Risks\n\n-\tBlocking or disabling system binaries can break legitimate functionality.  Responders must take steps to mitigate the risk of operational disruption.\n-\tMonitoring binaries for proxy execution can lead to false positives.  Baselining and optimization can help reduce the likelihood of false positives.\n\n## Guidance\n\nRemediating adversary proxy execution of signed and/or trusted binaries may require organizations make changes to  existing application control settings and host-based agents alerts to improve subsequent detection and prevention of this technique.\n\n### Prevent\n\n-\tConfigure the host-based agent or firewall to block binaries that are commonly used to achieve system proxy execution.    \n-\tEnable auditing for successful and unsuccessful attempts to abuse system binaries and ensure the effective logging and monitoring of this activity. \n\n### Detect\n\nConfigure the host-based agent to monitor for:\n\n-   Process execution\n    -  Process lineage to include, at a minimum, parent-child relationships\n    -  Process metadata to detect binary masquerading\n-   Command-line parameter inspection\n-\tDLL module loads\n-\tNetwork calls from binaries commonly used to achieve proxy execution\n\n## References\n\n- Living off the Land Binaries, Scripts and Libraries | <https://lolbas-project.github.io>\n- Rundll32 | <https://redcanary.com/threat-detection-report/techniques/rundll32/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0005",
                "CM0006",
                "CM0007",
                "CM0008",
                "CM0046",
                "CM0057"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "lolbas-project.github.io",
                    "description": "Living off the Land Binaries, Scripts and Libraries",
                    "url": "https://lolbas-project.github.io"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Rundll32",
                    "url": "https://redcanary.com/threat-detection-report/techniques/rundll32/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1218",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0092",
            "name": "Reset Entra Seamless Sign-on Account Password",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0092\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting the Microsoft Entra seamless sign-on account password terminates persistence and privilege escalation via hijacking of the seamless sign-on account.\n\n## Introduction\n\nMicrosoft Entra seamless single sign-on (formerly Azure Active Directory (AD) Seamless Single Sign-On or Azure AD / AAD Seamless SSO) is a Microsoft Entra ID feature that automatically signs users in when they are on a on-premises domain joined device.\n\nWhen Entra seamless SSO is first configured for an organization, a service principal named AzureADSSOACC is created in the on-premises AD and in each AD forest that synchronizes to Entra ID via Entra Connect. By default this account's password is not set to expire despite being particularly sensitive and should therefore be refreshed every 30 days.\n\n## Preparation\n\n- Confirm that the organization has implemented Entra seamless SSO. Organizations may not be using Entra seamless SSO and instead use Windows Hello for Business or simply just Entra (formerly Azure AD) Hybrid Join.\n- Ensure the system administrator rolling over the Kerberos decryption key possesses domain and global admin/hybrid identity administrator credentials.\n\n## Risks\n\n- Removing the domain administrator account from the Protected Users group may place the domain administrator at greater risk of compromise. If using the Protected Users group for domain administrators, return the account back to the Protected Users group after rotating the Entra Seamless SSO Password.\n\n## Guidance\n\n### Reset Entra Seamless SSO Password with Azure AD PowerShell\n\nSystem administrators should follow Microsoft's documentation and use Azure AD PowerShell to reset the Entra seamless SSO password. The following are instructions for Azure AD PowerShell. Note that Microsoft is expected to depreciate Azure AD PowerShell and replace it with Microsoft Graph PowerShell in March 2024. \n\n1. Sign into the Entra Connect server with domain administrator account (note that if the domain administrator is a member of the Protected Users group, this operation will fail.)\n2. Import the PowerShell module `AzureADSSO.psd1`\n3. Run PowrShell as administrator and call `New-AzureADSSOAuthenticationContext` to sign in with Global administrator or Hybrid administrator credentials\n4. Call `Get-AzureADSSOStatus | ConvertFrom-Json` to retreive a list of AD forests where AD seamless SSO is enabled.\n5. Call `Update-AzureADSSOForest`.\n6. Call `$Cred = Get-Credential` \n7. Call `Update-AzureADSSOForest -OnPremCredentials $creds` to update the Kerberos decryption key for AZUREADSSO in an AD forest and Entra ID. \n8. Verify the password for AzureADSSOACC has been rotated.\n9. Repeat this process for each AD forest with AD seamless SSO. Ensure these forests have connectivity to the global catalog server (TCP 3268 and TCP 3269). This does not need to be done on Entra Connect servers in staging mode. `Update-AzureADSSOForest` should not be run more than once per forest.\n\n## References\n\n- Microsoft Entra seamless single sign-on | <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-sso>\n- Microsoft Entra seamless single sign-on: Frequently asked questions | <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-sso-faq#how-can-i-disable-seamless-sso->\n- Az - Seamless SSO | <https://cloud.hacktricks.xyz/pentesting-cloud/azure-security/az-lateral-movement-cloud-on-prem/azure-ad-connect-hybrid-identity/seamless-sso>\n- Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452 | <https://www.mandiant.com/sites/default/files/2021-10/Mandiant-unc2452-remediations-and-hardening-strategies-whitepaper.pdf>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0028",
                "CM0050",
                "CM0079"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Entra seamless single sign-on",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-sso"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Entra seamless single sign-on: Frequently asked questions",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-sso-faq#how-can-i-disable-seamless-sso-"
                },
                {
                    "source_name": "cloud.hacktricks.xyz",
                    "description": "Az - Seamless SSO",
                    "url": "https://cloud.hacktricks.xyz/pentesting-cloud/azure-security/az-lateral-movement-cloud-on-prem/azure-ad-connect-hybrid-identity/seamless-sso"
                },
                {
                    "source_name": "www.mandiant.com",
                    "description": "Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452",
                    "url": "https://www.mandiant.com/sites/default/files/2021-10/Mandiant-unc2452-remediations-and-hardening-strategies-whitepaper.pdf"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0093",
            "name": "Prevent and Detect Network Traffic to/from The Onion Router (Tor) Exit Nodes",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0093\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nPreventing and detecting network traffic to/from The Onion Router (Tor) exit nodes protects against attempts at reconnaissance, initial access, command-and-control (C2), exfiltration, and impact originating from, or destined to the Tor network.\n\n## Introduction\n\nTor is software that encrypts and proxies traffic through multiple nodes to provide users a degree of anonymity.  While there are legitimate use-cases for Tor, adversaries commonly use the software to anonymize their attempts to perform reconnaissance, initial access, command-and-control, exfiltration, and adversely impact targets.\n\n## Preparation\n\n-\tAssess existing security tools for the ability to protect against and detect activity consistent with Tor usage.\n-\tMaintain an updated list of Tor exit nodes.  Tor provides lists of exit nodes available in multiple formats (see references).\n\n## Risks\n\nThere are legitimate use cases for Tor.  The countermeasures recommended herein are restrictive given the contextual assumption of incident response.  Be aware that these countermeasures risk disrupting non-malicious Tor traffic.  If this is a concern, you may opt to monitor suspected Tor traffic prior to deciding on a responsive course of action.  Additionally, it is important to note that not all Tor exit nodes are publicly listed.  As such, this countermeasure does not eliminate the threat of adversary activity originating form or destined for Tor nodes.\n\n## Guidance\n\n### Prevent\n\n-\tConfigure external network security tools to block all inbound network traffic from Tor exit nodes.  The intent is to prevent or respond to reconnaissance, initial access, and attempts to disrupt operations originating from known Tor exit nodes. \n-\tConfigure internal network security tools to block all outbound network traffic to Tor exit nodes.  The intent is to prevent or respond to command-and-control and/or exfiltration from internal assets to Tor exit nodes.  \n\n### Detect\n\n-\tMonitor TCP/UDP ports 9001, 9030, 9040, 9050, 9051, 9150 and TCP 443, 8443. Monitoring TCP 443 will generate a high rate of false positives and will require fine-tuning and correlative analysis. \n-\tMonitor DNS queries for domain names ending in torproject.org.\n-\tMonitor DNS queries for domains ending in. onion to detect misconfigured Tor clients.\n-\tMonitor for unusually large dataflows or persistent connections between hosts on the network and Tor exit nodes to detect command-and-control or exfiltration.\n\n## References\n\n- Defending Against Malicious Cyber Activity Originating from Tor | <https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-183a>\n- Changes to the Tor Exit List Service | <https://blog.torproject.org/changes-tor-exit-list-service/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0009",
                "CM0010",
                "CM0011",
                "CM0106"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisa.gov",
                    "description": "Defending Against Malicious Cyber Activity Originating from Tor",
                    "url": "https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-183a"
                },
                {
                    "source_name": "blog.torproject.org",
                    "description": "Changes to the Tor Exit List Service",
                    "url": "https://blog.torproject.org/changes-tor-exit-list-service/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1041",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1048.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1090.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1090.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1090.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1105",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1133",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1190",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1491",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1498",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1499",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1566.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1566.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1567",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1573.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1583.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1594",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1595.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1595.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1595.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1598.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1598.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1659",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0094",
            "name": "Restrict Domain Admin User Rights and Monitor Protected Users on Workstations",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0094\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nRestricting Domain Admin user rights and monitoring Protected Users on workstations and servers limits the likelihood of privileged credential access via credential dumping.\n\n## Introduction\n\nAdversaries iteratively dump credentials and move laterally to progressively escalate privileges.  Domain Administrator credentials are often the target of these efforts as they provide an unparalleled level of privilege in the Windows environment.  This countermeasure will prevent Domain Administrator credentials from being cached on member workstations and servers and therefore reduce the likelihood of Domain Administrator credential access.\n\n## Preparation\n\n-\tReview all accounts (user and service) in the Domain Administrator group.  Ensure that all accounts added to the Domain Administrator group require Domain Administrator privileges.  \n-\tDomain Administrators are default members of the local Administrator group on all member workstations and servers to enable build and disaster recovery scenarios. Consider removing all members from the Domain Administrators group.  You may elect to allow the local Administrator group if it has been appropriately secured in accordance with Microsoft guidance.\n\n## Risks\n\nIdentify scenarios in which Domain Administrators are currently accessing member workstations and servers and consider alternative courses of action to perform these tasks in a manner that does not introduce vulnerability and to minimize the likelihood of operational interruption.\n\n## Guidance\n\n### Configure\n\n-\tCreate a new Group Policy Object (GPO) or modify an existing one.\n-\tNavigate to `Configuration > Windows Settings > Security Settings > Local Policies > User Rights Assignment`.\n-\tAdd the Domain Administrators group to the following list:\n    - `Deny access to this computer from the network`\n    - `Deny log on as a batch job`\n    - `Deny log on as a service`\n    - `Deny log on locally`\n    - `Deny log on through Remote Desktop Service user rights`\n-\tApply the GPO to the appropriate Organizational Units (OU).\n\n### Monitor\n\n-\tConsider filtering and aggregating Windows event logs to monitor protected users and interactive logons `event id 4624 - type 2`.\n\n## References\n\n- Appendix F: Securing Domain Admins Groups in Active Directory | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-f--securing-domain-admins-groups-in-active-directory>\n- Appendix D: Securing Built-In Administrator Accounts in Active Directory | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-d--securing-built-in-administrator-accounts-in-active-directory>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0059",
                "CM0087",
                "CM0088",
                "CM0089",
                "CM0090"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Appendix F: Securing Domain Admins Groups in Active Directory",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-f--securing-domain-admins-groups-in-active-directory"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Appendix D: Securing Built-In Administrator Accounts in Active Directory",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-d--securing-built-in-administrator-accounts-in-active-directory"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0095",
            "name": "Detect Attempts to Modify or Disable Defender from the Command Line ",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0095\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDetecting attempts to abuse command line utilities to modify or disable Windows Defender alerts responders to attempts to evade defenses.\n\n## Introduction\n\nAdversaries modify or disable security tools to evade detection and impede response.  PowerShell and CMD can be used to disable or modify firewalls, antivirus solutions, and logging.\n\n## Preparation\n\n- Ensure Tamper protection is enabled for Microsoft Defender.  Tamper protection prevents settings from being modified or disabled. Tamper Protection does not prevent an adversary from creating exclusions to prevent Microsoft Defender from scanning specific files or directories.  \n- Ensure comprehensive endpoint detection and response.  Logs should be aggregated and processed in a centralized location to enable analysis and response efforts.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\nMonitor process creation, specifically PowerShell and CMD.  If possible, consider monitoring for instances in which the processes of security utilities are terminated.  File creation can also indicate attempts to modify the configuration files of security tools.    \n\n-\tModify (Add Exclusions)\n    - Monitor the PowerShell and CMD processes.\n    - Monitor the command line for the Add-MpPreference cmdlet and the following file extensions (.exe, .dll, .vbs, .zip, .bat, .ps1).\n-\tDisable Defender\n    - Monitor the PowerShell and CMD processes.\n    - Monitor the command line for the Set-MpPreference cmdlet and the MpCmdRun utility and the following parameters (disablerealtimemonitoring, disableioavprotection, disablebehaviormonitoring, disableintrusionpreventionsystem, exclusionprocess, disablescriptscanning).\n\n## References\n\n- Disable or Modify Tools | <https://redcanary.com/threat-detection-report/techniques/disable-or-modify-tools/>\n- Defender Endpoint Prevent Changes to Security Settings with Tamper Protection | <https://learn.microsoft.com/en-us/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection?view=o365-worldwide>\n- Disable and Bypass Defender | <https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/defense-evasion/disable-defender>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0110"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "redcanary.com",
                    "description": "Disable or Modify Tools",
                    "url": "https://redcanary.com/threat-detection-report/techniques/disable-or-modify-tools/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Defender Endpoint Prevent Changes to Security Settings with Tamper Protection",
                    "url": "https://learn.microsoft.com/en-us/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection?view=o365-worldwide"
                },
                {
                    "source_name": "viperone.gitbook.io",
                    "description": "Disable and Bypass Defender",
                    "url": "https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/defense-evasion/disable-defender"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1562.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562.004",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0096",
            "name": "Prevent and Detect Attempts to Copy NT Directory Services Database Information Table (NTDS.dit)",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0096\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nPreventing and detecting attempts to copy the NT Directory Services Database Information Table (NTDS.dit) will prevent and alert defenders to attempts to duplicate the file for exfiltration.\n\n## Introduction\n\nNTDS.dit is a database file hosted on Domain Controllers (DC).  The file stores information on all existing objects in the domain, to include users, service accounts, group memberships, password hashes, and other sensitive details. NTDS.dit cannot be copied directly, a volume shadow copy must be created.  This copy is typically archived, staged, and exfiltrated.  Once exfiltrated, information can be extracted and used to achieve credential access, lateral movement, and persistence.  Preventing attempts to copy the NTDS file is an effort to limit the extent of an adversary's advance and is therefore, a preemptive measure to contain the adversary.\n\n## Preparation\n\n- Identify options for remotely executing commands on DC e.g. WMI, PowerShell/WMI, WinRM, PowerShell Remoting.\n- Verify that appropriate protection and detection measures are in place to mitigate the risks of remote command execution on domain controllers (see related countermeasures).\n\n## Risks\n\n- No Risks content identified.\n\n## Guidance\n\n### Prevent\n\n-\tMinimize the number of accounts that can log on to DC.\n-\tRestrict access to the NTDS.dit file using Access Control Lists (ACLs).  \n-\tIf possible, enable BitLocker to encrypt the operating system on the DC.\n-\tAudit and monitor access to the NTDS.dit file. \n-\tEnsure effective endpoint logging, aggregation, and monitoring for all workstations and servers, to include DC.  \n\n### Detect\n\nMonitor endpoint protection and event logs for:\n\n-\tProcess creation (Event ID 4688)\n    - Vssadmin.exe (remote)\n    - Ntdsutil.exe (local)\n    - Esentutl.exe (local)\n\n-\tCommand-line parameter inspection (PowerShell, Wmic, Vssadmin)\n    - Monitor endpoints for tools that can be used to remotely execute commands on DC and the following command line parameters:\n        - Wmic.exe `process call create /c vssadmin create shadow`\n        - PowerShell.exe `win32_shadowcopy`\n        - Vssadmin.exe `create shadow`\n        - `Copy \\Windows\\NTDS\\NTDS.dit`\n    - Monitor the DC for tools that can be used locally to copy NTDS.dit\n        - Ntdsutil.exe `create full`\n        - Esentutl.exe `/y /vss`\n\nThe various tools used to create volume shadow copies all rely on the Volume Snapshot Service.  For a higher fidelity detection:\n\n-\tMonitor shadow copy creation `event ID 8222` \n-\tConsider correlating this event to several requests in short succession to create a handle to the Security Account Manager (SAM) `event ID 4661`.  This activity is typically indicative of attempts to generate a shadow copy of C:\\.\n\n## References\n\n- Forensic Traces of Exporting NTDS | <https://medium.com/@alsaifmay/forensic-traces-of-exporting-ndts-3ee52fcafad3>\n- Part 2 Sensor Mapping - Reverse Engineering NTDS | <https://detect.fyi/part-2-sensor-mapping-reverse-engineering-ntds-a73bde69031e>\n- Domain of Thrones: Part I | <https://securityboulevard.com/2023/10/domain-of-thrones-part-i/>\n- How Attackers Dump Active Directory Database Credentials | <https://adsecurity.org/?p=2398>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0013",
                "CM0018",
                "CM0019",
                "CM0031",
                "CM0039",
                "CM0088",
                "CM0089"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "medium.com",
                    "description": "Forensic Traces of Exporting NTDS",
                    "url": "https://medium.com/@alsaifmay/forensic-traces-of-exporting-ndts-3ee52fcafad3"
                },
                {
                    "source_name": "detect.fyi",
                    "description": "Part 2 Sensor Mapping - Reverse Engineering NTDS",
                    "url": "https://detect.fyi/part-2-sensor-mapping-reverse-engineering-ntds-a73bde69031e"
                },
                {
                    "source_name": "securityboulevard.com",
                    "description": "Domain of Thrones: Part I",
                    "url": "https://securityboulevard.com/2023/10/domain-of-thrones-part-i/"
                },
                {
                    "source_name": "adsecurity.org",
                    "description": "How Attackers Dump Active Directory Database Credentials",
                    "url": "https://adsecurity.org/?p=2398"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0097",
            "name": "Detect Attempts to Delete Shadow Copies",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0097\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDetecting the deletion of shadow copies will alert defenders to an adversary attempting to destroy volume backups.\n\n## Introduction\n\nShadow copies are a form of Windows data backup.  Ransomware actors commonly attempt to delete shadow copies before deploying ransomware to inhibit system recovery and make victim data inaccessible until a ransom is paid.  This is typically accomplished using native Windows binaries (Vssadmin.exe, PowerShell.exe, and WMIC.exe).\n\n## Preparation\n\n- Ensure systems are frequently performing backups.  Backups should be securely stored on a separate device that is inaccessible from the network.  \n- Ensure comprehensive endpoint protection and response.  Logs should be aggregated and processed in a centralized location to enable analysis and response efforts.\n\n## Risks\n\n- No Risks content identified.\n\n## Guidance\n\n-\tMonitor endpoint protection and event logs for process creation `Event ID 4688`\n    - Vssadmin.exe\n-\tMonitor endpoints for the following command line parameters:\n    - Vssadmin.exe `Delete Shadows`\n    - Vssadmin.exe `resize shadowstorage`\n    - Wmic.exe `shadowcopy delete`\n    - PowerShell.exe `win32_shadowcopy`\n    - `delete shadows`\n    - `list shadows`\n\n## References\n\n- Volume Shadow Copy Service | <https://learn.microsoft.com/en-us/windows-server/storage/file-server/volume-shadow-copy-service>\n- How Can I Protect Against Ransomware? | <https://www.cisa.gov/stopransomware/how-can-i-protect-against-ransomware>\n- CAR-2021-01-009: Detecting Shadow Copy Deletion or Resize | <https://car.mitre.org/analytics/CAR-2021-01-009/>\n- Its All Fun and Games Until Ransomware Deletes the Shadow Copies | <https://redcanary.com/blog/threat-detection/its-all-fun-and-games-until-ransomware-deletes-the-shadow-copies/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0013",
                "CM0031",
                "CM0039",
                "CM0045"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Volume Shadow Copy Service",
                    "url": "https://learn.microsoft.com/en-us/windows-server/storage/file-server/volume-shadow-copy-service"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "How Can I Protect Against Ransomware?",
                    "url": "https://www.cisa.gov/stopransomware/how-can-i-protect-against-ransomware"
                },
                {
                    "source_name": "car.mitre.org",
                    "description": "CAR-2021-01-009: Detecting Shadow Copy Deletion or Resize",
                    "url": "https://car.mitre.org/analytics/CAR-2021-01-009/"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Its All Fun and Games Until Ransomware Deletes the Shadow Copies",
                    "url": "https://redcanary.com/blog/threat-detection/its-all-fun-and-games-until-ransomware-deletes-the-shadow-copies/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1486",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1490",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0098",
            "name": "Enable Extended Protection for Authentication (EPA) ",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0098\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling Extended Protection for Authentication on clients and servers restricts adversary credential access and lateral movement facilitated by man-in-the-middle (MITM) or relay attacks.\n\n## Introduction\n\nMan-in-the-middle attacks such as NTLM Relay attacks are often observed in adversarial attempts at credential access that involve certificate authority (CA) impersonation and authentication request interception. The PetitPotam attack is a prime example of an NTLM Relay attack that targets Active Directory Certificate Services (AD CS) lacking proper protection such as client-authenticated TLS channels. Extended Protection for Authentication (EPA) is a feature that provides protection for authentication protocols such as NTLM and Kerberos by binding the session key generated by Secure Sockets Layer (SSL) when a TLS channel is established to the session key that is generated during a client's attempted authentication. Enabling EPA prevents malicious tradecraft observed in the PetitPotam attack where legitimate authentication requests are captured and replayed by an attacker to an AD CS server.\n\nSimilarly, adversary MITM attacks have been observed exploiting Microsoft Exchange Server systems where EPA is absent. For this reason it is important to properly configure Exchange Server with Extended Protection.\n\n## Preparation\n\n- Identify all systems and services within the network that rely on NTLM or Kerberos for authentication. Prioritize identification of systems that utilize AD CS.\n- Ensure all identified systems are upgraded to the latest security patches and update.\n- Inform administrative personnel about the intent to enable EPA on the client and server side of authentication infrastructure.\n- Identify the Exchange Server version that is present. Take note of Exchange Servers that are published using Hybrid Agent.\n-  When enabling EPA for Exchange Server, SSL flags of `SSL` and `SSL128` are required to be present. \n- SSL offloading for Outlook Anywhere must be disabled before EPA is enabled in Exchange Server: [Exchange Server support for Windows Extended Protection | Microsoft Learn](https://learn.microsoft.com/en-us/exchange/plan-and-deploy/post-installation-tasks/security-best-practices/exchange-extended-protection?view=exchserver-2019)\n\n## Risks\n\n- Enabling EPA may incite compatibility issues with older applications or services that do not support EPA such as RPC.\n- Enabling EPA is a delicate process that incurs administrative overhead on client and server AD CS machines.\n- Misconfiguration of Windows Authentication features increase the vulnerability of AD CS machines to authentication channel abuse.\n- Enabling Extended Protection on Exchange Servers that are published via Hybrid Agent may incite disruption of features such as mailbox moves and free/busy calls.\n\n## Guidance\n\n### Enable EPA for Certificate Authority Web Enrollment (CertSrv)\n\n- Access the Internet Information Services (IIS) Manager in order to enable EPA for each web service or application listed under the `Sites` pane of the respective IIS Server.\n- Ensure that **Windows Authentication** is set to **Enabled** in the **Authentication** pane.\n- Enter the **Advanced Settings** of the **Windows Authentication** feature to set **Extended Protection** to **Required**\n\n### Enable EPA for Certificate Enrollment Web Service (CES) Role\n\n- Repeat the aforementioned steps for the Certificate Enrollment Web Service role.\n- Ensure updates to the *Web.config* file generated by the CES Role by adding `<extendedProtectionPolicy>` set with a value of **Always**.\n\n### Enable EPA for Microsoft Exchange Server\n\n- Windows extended protection is also relevant when enhancing existing authentication measures in Microsoft Exchange Server. It is enabled by default in Exchange Server 2019 (and newer) versions.\n- Implement EPA for older Exchange Server versions by downloading the `ExchangeExtendedProtectionManagement.ps1` script from Microsoft: [ExchangeExtendedProtectionManagement - Microsoft - CSS-Exchange](https://microsoft.github.io/CSS-Exchange/Security/ExchangeExtendedProtectionManagement/)\n- Follow the supplied directives on proper execution syntax of the `ExchangeExtendedProtectionManagement.ps1` script based on discretion to exclude specific servers from the enablement of EPA.\n\n## References\n\n- Extended Protection for Authentication Overview | <https://learn.microsoft.com/en-us/dotnet/framework/wcf/feature-details/extended-protection-for-authentication-overview>\n- KB5005413: Mitigating NTLM Relay Attacks on Active Directory Certificate Services (AD CS) | <https://support.microsoft.com/en-us/topic/kb5005413-mitigating-ntlm-relay-attacks-on-active-directory-certificate-services-ad-cs-3612b773-4043-4aa9-b23d-b87910cd3429>\n- PetitPotam attack on Active Directory Certificate Services: How to mitigate NTLM Relay PetitPotam attacks on AD CS | <https://community.veeam.com/blogs-and-podcasts-57/petitpotam-attack-on-active-directory-certificate-services-how-to-mitigate-ntlm-relay-petitpotam-attacks-on-ad-cs-1202>\n- Configure Windows Extended Protection in Exchange Server | <https://learn.microsoft.com/en-us/exchange/plan-and-deploy/post-installation-tasks/security-best-practices/exchange-extended-protection?view=exchserver-2019>\n- Exchange Extended Protection Management | <https://microsoft.github.io/CSS-Exchange/Security/ExchangeExtendedProtectionManagement/>\n- Microsoft Exchange Vulnerability Actively Exploited | <https://www.threatdown.com/blog/microsoft-exchange-vulnerability-actively-exploited/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0019",
                "CM0020",
                "CM0029",
                "CM0052",
                "CM0053",
                "CM0069",
                "CM0142"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Extended Protection for Authentication Overview",
                    "url": "https://learn.microsoft.com/en-us/dotnet/framework/wcf/feature-details/extended-protection-for-authentication-overview"
                },
                {
                    "source_name": "support.microsoft.com",
                    "description": "KB5005413: Mitigating NTLM Relay Attacks on Active Directory Certificate Services (AD CS)",
                    "url": "https://support.microsoft.com/en-us/topic/kb5005413-mitigating-ntlm-relay-attacks-on-active-directory-certificate-services-ad-cs-3612b773-4043-4aa9-b23d-b87910cd3429"
                },
                {
                    "source_name": "community.veeam.com",
                    "description": "PetitPotam attack on Active Directory Certificate Services: How to mitigate NTLM Relay PetitPotam attacks on AD CS",
                    "url": "https://community.veeam.com/blogs-and-podcasts-57/petitpotam-attack-on-active-directory-certificate-services-how-to-mitigate-ntlm-relay-petitpotam-attacks-on-ad-cs-1202"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Configure Windows Extended Protection in Exchange Server",
                    "url": "https://learn.microsoft.com/en-us/exchange/plan-and-deploy/post-installation-tasks/security-best-practices/exchange-extended-protection?view=exchserver-2019"
                },
                {
                    "source_name": "microsoft.github.io",
                    "description": "Exchange Extended Protection Management",
                    "url": "https://microsoft.github.io/CSS-Exchange/Security/ExchangeExtendedProtectionManagement/"
                },
                {
                    "source_name": "www.threatdown.com",
                    "description": "Microsoft Exchange Vulnerability Actively Exploited",
                    "url": "https://www.threatdown.com/blog/microsoft-exchange-vulnerability-actively-exploited/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1557.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0099",
            "name": "Remove/Rotate Kubernetes Service Account Token",
            "subtype": "Disable, Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0099\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving Kubernetes service account tokens, and/or rotating as needed, disrupts adversary credential access via Kubernetes service account token theft.\n\n## Introduction\n\nKubernetes service account tokens are credentials (effectively JSON Web Tokens) used by Kubernetes clusters to authenticate and authorize communication between various components within the cluster. They provide an identity for processes running within pods, allowing them to interact securely with the Kubernetes API server and other cluster resources. \n\nKubernetes service account tokens include both *legacy tokens* and *bound tokens.* Legacy tokens are from Kubernetes version < 1.22 and are long-lived, and therefore stored indefinitely as secrets that are mounted into pods so that applications can authenticate API requests. Bound tokens are audience-bound, volume projected, and usually short-lived because they are time-bound. \n\nService account tokens may be exposed to the adversary through any number of ways, including unencrypted transmission, public code repositories, misconfigured access rights, insider threats, and vulnerabilities in applications running in the cluster. \n\nAdversaries that steal Kubernetes service account tokens will be able to authenticate with the Kubernetes API, gaining access to the cluster and performing any number of actions including privilege escalation, data theft, persistent backdoor access to the cluster, or the deployment of malicious containers.\n\n## Preparation\n\n- Identify Kubernetes service account token to be revoked.\n- Install Kubernetes command line tool\n- Configure local system to communicate with cluster by downloading the cluster's kubeconfig file and saving its file path to the `$KUBECONFIG` environment variable.\n\n## Risks\n\n- No Risks content identified.\n\n## Guidance\n\n- Secrets can be invalidated with the command `kubectl delete secret name-of-secret` if a Secret is known for a specific service account. \n- Tokens can be rotated by creating a new service account with a new token (`kubectl create serviceaccount`) and then update the pods or deployments to use the new service account. Old service accounts can be deleted with the command `kubectl delete serviceaccount <old-service-account-name>`\n- After invalidating any service account tokens, secrets, or service accounts, restart all pods.\n- Consider limiting the Service Account API credential auto-mounting with `automountServiceAccountToken: false`\n- Where possible, use short-lived tokens over long-lived ones and use available commercial tools like Kyverno or Gatekeeper to enforce policies. \n- Explore using tools such as [External Secrets Operator](https://external-secrets.io/) to manage external secrets from third-party key vaults.\n\n## References\n\n- Regenerate Kubernetes Service Account Tokens | <https://blog.gitguardian.com/understanding-the-risks-of-long-lived-kubernetes-service-account-tokens/>\n- Managing Service Accounts | <https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/?ref=blog.gitguardian.com#bound-service-account-token-volume>\n- Kubernetes Service Account Tokens -Security Improvements | <https://medium.com/@radharamadoss/kubernetes-service-account-tokens-security-improvements-a9734c186afb>\n- Steal Pod Service Account Token | <https://stratus-red-team.cloud/attack-techniques/kubernetes/k8s.credential-access.steal-serviceaccount-token/>\n- Guides - Rotate Kubernetes Secrets | <https://techdocs.akamai.com/cloud-computing/docs/rotate-kubernetes-secrets>\n- External Secrets Operator | <https://external-secrets.io/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0028",
                "CM0041",
                "CM0075",
                "CM0076",
                "CM0077",
                "CM0080"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "blog.gitguardian.com",
                    "description": "Regenerate Kubernetes Service Account Tokens",
                    "url": "https://blog.gitguardian.com/understanding-the-risks-of-long-lived-kubernetes-service-account-tokens/"
                },
                {
                    "source_name": "kubernetes.io",
                    "description": "Managing Service Accounts",
                    "url": "https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/?ref=blog.gitguardian.com#bound-service-account-token-volume"
                },
                {
                    "source_name": "medium.com",
                    "description": "Kubernetes Service Account Tokens -Security Improvements",
                    "url": "https://medium.com/@radharamadoss/kubernetes-service-account-tokens-security-improvements-a9734c186afb"
                },
                {
                    "source_name": "stratus-red-team.cloud",
                    "description": "Steal Pod Service Account Token",
                    "url": "https://stratus-red-team.cloud/attack-techniques/kubernetes/k8s.credential-access.steal-serviceaccount-token/"
                },
                {
                    "source_name": "techdocs.akamai.com",
                    "description": "Guides - Rotate Kubernetes Secrets",
                    "url": "https://techdocs.akamai.com/cloud-computing/docs/rotate-kubernetes-secrets"
                },
                {
                    "source_name": "external-secrets.io",
                    "description": "External Secrets Operator",
                    "url": "https://external-secrets.io/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1528",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0100",
            "name": "Restrict and Monitor Remote Procedure Calls (RPC)",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0100\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nRestricting and monitoring Remote Procedure Calls (RPC) limits opportunities for an adversary to conduct reconnaissance and achieve execution, lateral movement, and privilege escalation via RPC abuse.\n\n## Introduction\n\nRemote Procedure Call (RPC) is a protocol native to the Windows operating system that enables inter-process communication (IPC) both locally and remotely. RPC is ubiquitous in a Windows environment and although necessary, significantly expands the attack surface.  RPC can be abused by adversaries to achieve reconnaissance, execution, lateral movement, and privilege escalation.   \n\nRPC cannot be completely blocked, but it can be filtered and monitored. RPC filtering is a capability native to Windows that is facilitated by the Windows Filtering Platform (WFP) via netsh.exe.  Another option to consider is the [RPC Firewall](https://github.com/zeronetworks/rpcfirewall) by Zero Networks. This free and open-source tool may offer additional capabilities to enable defenders to more granularly filter and monitor RPC traffic.\n\n## Preparation\n\n-\tAudit RPC traffic to assess a baseline and identify anomalous traffic.\n-\tRPC filtering can be used to proactively prevent RPC abuse. A deny list can be created to block RPC interfaces and reduce the attack surface introduced by the protocol.\n\n## Risks\n\nRPC filtering is a complex topic that requires responders to be familiar with both the protocol and it's attack surface. Inadvertently blocking necessary RPC traffic can introduce the risk of operational disruption.\n\n## Guidance\n\n### Restrict\n\nRPC can be restricted by leveraging native RPC filtering capabilities via netsh.exe or by implementing the RPC Firewall. Consider filtering, at a minimum, the following:\n    - Permit only specific privileged users to create services remotely.\n    - Permit only specific hosts to modify registry data remotely.\n    - Prevent scheduled tasks from being created remotely.\n    - Only permit Kerberos authentication to a specific RPC endpoint.\n    - Block connections to an RPC endpoint made over specific named pipes.\n\n#### RPC Filtering via netsh.exe\n\n-\tConsider the following process to create an RPC filter:\n    - Add a rule - `netsh rpc filter add rule...`\n    - Add conditions to the rule - `add condition field...`\n    - Add the rule to a filter - `add filter...`\n\n#### RPC Filtering via RPC Firewall\n\n-\tConsider the following process to create an RPC filter:\n    - Identify the Universally Unique Identifier (UUID) and the Opnum (the number of a specific function of an RPC interface) of the RPC call.\n    - Collect whitelisted IPs of endpoints that should be permitted to access RPC methods.\n    - Block/allow/audit the call.\n\n### Monitor\n\n-\tMonitoring RPC traffic is necessary to prevent and detect RPC abuse. RPC auditing can be implemented via the WFP and netsh.exe or via the RPC Firewall. Successful and failed connections should be captured in the Security Event Log and forwarded to a centralized location for detection and analysis.\n\n## References\n\n- Stopping Lateral Movement via the RPC Firewall | <https://zeronetworks.com/blog/stopping-lateral-movement-via-the-rpc-firewall>\n- A Definitive Guide to the Remote Procedure Call (RPC) Filter | <https://www.akamai.com/blog/security/guide-rpc-filter>\n- Filtering Layer Identifiers | <https://learn.microsoft.com/en-us/windows/win32/fwp/management-filtering-layer-identifiers->\n- The Dark Side of Microsoft Remote Procedure Call Protocols | <https://redcanary.com/blog/threat-detection/msrpc-to-attack/>\n- RPC Firewall | <https://github.com/zeronetworks/rpcfirewall>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0012",
                "CM0062"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "zeronetworks.com",
                    "description": "Stopping Lateral Movement via the RPC Firewall",
                    "url": "https://zeronetworks.com/blog/stopping-lateral-movement-via-the-rpc-firewall"
                },
                {
                    "source_name": "www.akamai.com",
                    "description": "A Definitive Guide to the Remote Procedure Call (RPC) Filter",
                    "url": "https://www.akamai.com/blog/security/guide-rpc-filter"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Filtering Layer Identifiers",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/fwp/management-filtering-layer-identifiers-"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "The Dark Side of Microsoft Remote Procedure Call Protocols",
                    "url": "https://redcanary.com/blog/threat-detection/msrpc-to-attack/"
                },
                {
                    "source_name": "github.com",
                    "description": "RPC Firewall",
                    "url": "https://github.com/zeronetworks/rpcfirewall"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021.003",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1210",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0101",
            "name": "Block Applications in Writable Locations using AppLocker",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0101\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nBlocking applications in writable locations using AppLocker blocks execution by malware in compromised environments.\n\n## Introduction\n\nAdversaries deploy malware in furtherance of tactical objectives e.g. establish command-and-control or to achieve lateral movement, and persistence.  In the event of a large-scale, malware-enabled compromise, AppLocker can be employed to halt the pace and extent of adversarial advance on the network.  \n\nAppLocker is an application control utility native to the Windows operating system (Windows 7 or more recent).  AppLocker enables responders to permit or deny the execution of specific applications in writable locations by users.  It can be configured to assess files based on the following attributes: digital signature, publisher, product, version, hash, and path.  \n\nThis countermeasure is specific to blocking the execution of malware to enable containment. To do so, AppLocker requires the location or hash of the malware.\n\nAppLocker can block the following filetypes:\n\n| File Type\t| File Extension |\n| :--------------| --------------:|\n| Executables\t| .exe, .dll, .ocx, .com\t|\n| Windows Installers | .mst, .msi, .msp |\n| Script Files\t| .bat, .ps1, .cmd, .js, .vbs |\n| Packaged Application Installers\t| .appx |\n\n## Preparation\n\n-\tEnforce the principle of least privilege.  Ensure users are not members of the local administrator group.  AppLocker's default rule set allows local administrators to run executables, scripts, and installer files.  If the adversary has elevated privileges, AppLocker's default ruleset should be considered nullified until privileges have been revoked.     \n-\tIf AppLocker is not already enabled, the Application Identify service (AppIDSvc) must be started to enable AppLocker.\n-\tIdentify attributes of the malicious file e.g. path or file hash.\n\n## Risks\n\n- Application control can be a necessary component of the incident response process.  It is not however, sufficient in and of itself, to stop the spread of malware, as it can be bypassed.  AppLocker policies will not impede an adversary with elevated privileges.\n\n## Guidance\n\nAppLocker's deny list can be employed during incident response to contain the spread of malware.  \n\n### Enable AppLocker and Apply Default Rules\n\n-\tUse the GPMC to navigate to `Security Settings> Application Control Policies> AppLocker> Executable Rules` in the Group Policy object.\n-\tSelect `Executable Rules` and enable `Create Default Rules`.\n-\tDefine `Deny` rules based on file attributes and characteristics associated with files determined to be malicious.  \n\n#### Block by Location\n\nAppLocker can be used to block execution by location.  If blocking files by location is an option, assess locations that non-admins have permission to write to, and execute from.  Take care not to block legitimate applications should they exist in these locations.  Malware is commonly deployed to the following locations:\n-\t`C:\\Users\\AppData\\Local\\Temp`\n-\t`C:\\Users\\AppData\\Local`\n-\t`C:\\Users\\AppData`\n-\t`C:\\Users\\AppData\\Roaming`\n-\t`C:\\ProgramData`\n\n#### Block by Filetype\n\nAppLocker can be used to block filetypes from running in specific locations.  Again, if this approach is an option, take care not to block the execution of legitimate applications.  The following filetypes can be, but are not always, indicative of malware:\n\n`.ade, .adp, .ani, .bas, .bat, .chm, .cmd, .com, .cpl, .crt, .hlp, .ht, .hta, .inf, .ins, .isp, .jar, .job, .js, .jse, .lnk, .mda, .mdb, .mde, .mdz, .msc, .msi, .msp, .mst, .ocx, .pcd, .ps1, .reg, .scr, .sct, .shs, .svg, .url, .vb, .vbe, .vbs, .wbk, .wsc, .ws, .wsf, .wsh, .exe, .pif, .pub`\n\n### Monitor\n\nMonitoring is an essential component of effective application control.  AppLocker allows rules to be configured to `Enforce` and/or `Audit`.  \n`Audit` can be used during initial test and implementation to monitor effectiveness.  It should also be configured to enable continual monitoring.\n\n## References\n\n- Administer AppLocker | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/administer-applocker>\n- Understanding AppLocker Default Rules | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/understanding-applocker-default-rules>\n- How to Prevent Ransomware: 5 Practical Techniques and Countermeasures | <https://redcanary.com/blog/threat-detection/how-to-prevent-ransomware/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0110",
                "CM0117",
                "CM0127",
                "CM0130",
                "CM0131",
                "CM0132"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Administer AppLocker",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/administer-applocker"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Understanding AppLocker Default Rules",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/understanding-applocker-default-rules"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "How to Prevent Ransomware: 5 Practical Techniques and Countermeasures",
                    "url": "https://redcanary.com/blog/threat-detection/how-to-prevent-ransomware/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1204.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1570",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0102",
            "name": "Remove Cached Domain Credentials From Workstation",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0102\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving cached domain credentials from workstations prevents adversaries from pursuing credential access via password stores and OS credential dumping.\n\n## Introduction\n\nCaching domain credentials locally allows users to log-in if domain controller(s) are down. Adversaries abuse this functionality by dumping cached credentials using tools such as mimikatz.\n\n## Preparation\n\n- Identify which users, if any, should have credentials cached to maintain business operations or communications.\n\n## Risks\n\n- Users won't be able to login if authentication servers are down and domain controller authentication is required. \n- Users won't be able to access networked resources.\n\n## Guidance\n\n### Configure via Group Policy\n\nOpen gpedit.msc -> Computer Configuration -> Windows Settings -> Security Settings -> Local Policies -> Security Options -> Double-click Policy Named, \"Interactive logon: Number of previous logons to cache (in case domain controller is not available).\" -> Select 0 \nThis will set previous cached credentials to zero. run gpuupdate force\n\n### Configure via Registry\n\nOpen regedit.exe -> Navigate to HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ -> Double-Click \"cachedlogonscount\" -> Set Value to 0. \nRestart will be required to enforce changes.\n\n## References\n\n- How to remove saved domain credentials from workstation | <https://learn.microsoft.com/en-us/answers/questions/1611007/how-to-remove-saved-domain-credentials-from-a-work>\n- Mimikatz | <https://redcanary.com/threat-detection-report/threats/mimikatz/>\n- Credential Dumping: Domain Cache Credential | <https://www.hackingarticles.in/credential-dumping-domain-cache-credential/>\n- Campus Active Directory - Windows Endpoints - Caching Credentials for Remote Users | <https://kb.wisc.edu/iam/page.php?id=114011#:~:text=Caching%20credentials%20is%20a%20feature,no%20domain%20controllers%20are%20available.>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0060",
                "CM0122"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How to remove saved domain credentials from workstation",
                    "url": "https://learn.microsoft.com/en-us/answers/questions/1611007/how-to-remove-saved-domain-credentials-from-a-work"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Mimikatz",
                    "url": "https://redcanary.com/threat-detection-report/threats/mimikatz/"
                },
                {
                    "source_name": "www.hackingarticles.in",
                    "description": "Credential Dumping: Domain Cache Credential",
                    "url": "https://www.hackingarticles.in/credential-dumping-domain-cache-credential/"
                },
                {
                    "source_name": "kb.wisc.edu",
                    "description": "Campus Active Directory - Windows Endpoints - Caching Credentials for Remote Users",
                    "url": "https://kb.wisc.edu/iam/page.php?id=114011#:~:text=Caching%20credentials%20is%20a%20feature,no%20domain%20controllers%20are%20available."
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003.005",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0103",
            "name": "Deny Logon as a Batch Job",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0103\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDenying log on as a batch job for a particular account disrupts the ability for an adversary to automate tasks or execute malicious scripts at specified times.\n\n## Introduction\n\nNo Introduction content identified.\n\n## Preparation\n\n- Before assigning an account the \"Deny log on as a batch job\" user right, assess the impact of the countermeasure on the job activities of the affected accounts. If containing the adversary, consider first inhibiting their access to the compromised account by rotating the credentials of the compromised account. \n- If \"log on as a batch job\" is required by a service account, create a Group Managed Service Account (gMSA) and delegate only the necessary privileges for the service running the task(s).\n\n## Risks\n\n- Removing the ability for a user or group to log on as a batch job may disrupt legitimate processes or services that rely on privilege. By default, logon as a batch job is enabled for administrators and backup operators on domain controllers and stand-alone servers so denying this ability may introduce downtime to domain controllers and administrative servers.\n\n## Guidance\n\nEnsure that the Guest user group is denied the ability to log on as a batch job. Extend \"deny log on as a batch job\" to Local Accounts, Domain Admins, Enterprise Admins, and all other user accounts as necessary. \n\nConfirm Domain Admins and Enterprise Admins in an AD Domain are denied logons on lower trust systems and ensure auditing is configured to alert if modifications are made to properties or memberships of highly-privileged groups. \n\n### Remove the ability to log on as a batch job using Group Policy Management Console (GPMC)\n\nAfter editing an existing Group Policy Object (GPO) or creating a new GPO, navigate to\nComputer Configuration > Policies > Windows Settings > Security Settings > Local Policies > User Rights Assignment\nfrom the Group Policy Editor.\n\nFrom here, the properties menu can be opened for \"Deny log on as a batch job\" and a user account or group added. \n\nAfter updating \"Deny log on as a batch job,\" open the properties window of \"Log on as a batch job\" and remove any unauthorized Users or Groups that possess the right to log on as a batch job. While \"Deny log on as a batch job\" overrides \"Log on as a batch job,\" users should still be removed from the latter if a user has both.\n\nAfter completing these steps, link the GPO to the appropriate domain, site, or organizational unit (OU) to apply the policy. \n\n### Remove the ability of a user to log on as a batch job using PowerShell\n\nIn addition to the above method, an administrator may use PowerShell to create a GPO and deny log on as a batch job.\n\n## References\n\n- Deny log on as a batch job | <https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/deny-log-on-as-a-batch-job>\n- Log on as a batch job | <https://www.ultimatewindowssecurity.com/wiki/page.aspx?spid=LogonAsBatch>\n- The \"Deny log on as a batch job\" user right will be configured to include \"Guests\". | <https://www.stigviewer.com/stig/windows_7/2012-07-02/finding/V-26483>\n- Windows Server 2019 Deny log on as a batch job user right on domain-joined member servers must be configured to prevent access from highly privileged domain accounts and from unauthenticated access on all systems. | <https://www.stigviewer.com/stig/windows_server_2019/2019-07-09/finding/V-93011>\n- The Deny log on as a batch job user right on domain controllers must be configured to prevent unauthenticated access. | <https://www.stigviewer.com/stig/windows_server_2016/2018-09-05/finding/V-73761>\n- Appendix E: Securing Enterprise Admins Groups in Active Directory | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-e--securing-enterprise-admins-groups-in-active-directory>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0038",
                "CM0060",
                "CM0109",
                "CM0120"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Deny log on as a batch job",
                    "url": "https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/deny-log-on-as-a-batch-job"
                },
                {
                    "source_name": "www.ultimatewindowssecurity.com",
                    "description": "Log on as a batch job",
                    "url": "https://www.ultimatewindowssecurity.com/wiki/page.aspx?spid=LogonAsBatch"
                },
                {
                    "source_name": "www.stigviewer.com",
                    "description": "The \"Deny log on as a batch job\" user right will be configured to include \"Guests\".",
                    "url": "https://www.stigviewer.com/stig/windows_7/2012-07-02/finding/V-26483"
                },
                {
                    "source_name": "www.stigviewer.com",
                    "description": "Windows Server 2019 Deny log on as a batch job user right on domain-joined member servers must be configured to prevent access from highly privileged domain accounts and from unauthenticated access on all systems.",
                    "url": "https://www.stigviewer.com/stig/windows_server_2019/2019-07-09/finding/V-93011"
                },
                {
                    "source_name": "www.stigviewer.com",
                    "description": "The Deny log on as a batch job user right on domain controllers must be configured to prevent unauthenticated access.",
                    "url": "https://www.stigviewer.com/stig/windows_server_2016/2018-09-05/finding/V-73761"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Appendix E: Securing Enterprise Admins Groups in Active Directory",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-e--securing-enterprise-admins-groups-in-active-directory"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1053",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1053.005",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0104",
            "name": "Enable Interactive Logon and Require Smart Card Policy for Privileged User Accounts",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0104\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling Interactive logon and requiring smart card policy for privileged user accounts prevents adversaries from logging into privileged accounts via cracked credentials.\n\n## Introduction\n\nAdversaries frequently take advantage of stolen credentials to abuse privileged accounts. Smart cards can add a physical layer of security and two-factor authentication for cards that require personal identification numbers (PINS).\n\n## Preparation\n\nA smart card solution for organization is required including a public key infrastructure, smart cards, and smart card readers. Building and implementating a new smart card solution during remdiation for this countermeasure is not recommended.\n\nDetermine if the time and resources for the preparation of the this countermeasure are an efficient approach.\n\nDistribution of smart cards and smart card readers to those who need to access the privileged accounts.\n\n## Risks\n\nThis countermeasure could result in loss of access to privleged user accounts by Administrators if incorrectly configured.\n\n## Guidance\n\n### Enable Interactive logon: Require smart card via group policy\n\nThe setting \"Interactive logon: require smart card\" (or \"Interactive logon: Require Windows Hello for Business or smart card\" for windows 10 or newer) refers to a Group policy option that requires users to sign in via a smart card or Windows Hello for Business Method. By default, the policy value that controls this is located in 'Computer Configuration>Windows Settings>Security Settings> Local Policies>Security Options'. Enable this policy for the Domain Admins security group to require privileged users specifically. It is recommended that implentation should be gradually tested and monitored to ensure it is configured correctly and effectively.\n\n### Enabling manually\n\nIndividual accounts can also have smart cards required for login via the account's properties tab in Active Directory Users and computer tool. The flag to set can be found account tab in the \"Account options\" section.\n\n## References\n\n-   Interactive logon: Require Windows Hello for Business or smart card | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/security-policy-settings/interactive-logon-require-smart-card>\n-   Appendix D: Securing Built-in Administrator Accounts in Active Directory | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/security-policy-settings/interactive-logon-require-smart-card>\n-   KnowledgeBase: Windows Hello for Business satisfies Smartcard is required for interactive logon requirements | <https://dirteam.com/sander/2021/12/03/knowledgebase-windows-hello-for-business-satisfies-smartcard-is-required-for-interactive-logon-requirements/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0018",
                "CM0029",
                "CM0060",
                "CM0088"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Interactive logon: Require Windows Hello for Business or smart card",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/security-policy-settings/interactive-logon-require-smart-card"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Appendix D: Securing Built-in Administrator Accounts in Active Directory",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/security-policy-settings/interactive-logon-require-smart-card"
                },
                {
                    "source_name": "dirteam.com",
                    "description": "KnowledgeBase: Windows Hello for Business satisfies Smartcard is required for interactive logon requirements",
                    "url": "https://dirteam.com/sander/2021/12/03/knowledgebase-windows-hello-for-business-satisfies-smartcard-is-required-for-interactive-logon-requirements/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1552",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0105",
            "name": "Remove Malicious Enterprise Applications and Service Account Principals",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0105\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving malicious applications and service account principals blocks an adversary's persistance via applications and service principals in the environment.\n\n## Introduction\n\nAdversaries may compromise legitimate enterprise applications with malicious code using hooks, payload injections, and other tactics to maintain persistence and evade defenses. Service principals are the identities of applications as stored in Entra ID, determining the resources an application is allowed to access. Compromised service principals lead to incorrect access controls and permissions. \n\nMalicious Azure applications are a newer attack vector for adversaries since they are difficult to block and detect in an environment. Adversaries create a custom Azure application to use in a phishing attack, then use the Azure APIs to integrate with a victim's Microsoft 365 environment, obtain persistance, remotely execute code, or perform discovery on the organization. These applications do not require permission from Microsoft, come with valid Microsoft certificates, and they do not require code execution on endpoint devices, making detection via antivirus (AV) solutions or endpoint detection and response (EDR) difficult. \n\nWhile a user is informed that an application is not published by Microsoft or their organization when they are prompted for authorization and permissions, this may be overlooked. Upon gaining access, attackers can access files, read and send emails, modify the calendar, and see all other users in the organization via user directories.\n\n## Preparation\n\n- Audit Enterprise Applications in the Azure portal to ensure all applications are known or trusted.\n- Identify the impact removing the applications or service account principles will have on business operations.\n- Identify if privileged or administrator credentials are compromised due to the malicious application and coordinate credential resets or other eviction techniques to eliminate all adversary access to/through the application.\n- Determine the ID of the application(s) to be removed.\n- Locate accounts using service principals and identify which ones are legitimate. Both Azure commandline interface (CLI) and PowerShell have commands to discover service principaled accounts.\n\n## Risks\n\n- Deleting legitimate applications can be disruptive to business operations; audit if applications are in use before deleting and alert users. \n- Removing service principals can cause users to no longer have access to applications. \n- Microsoft discourages organizations from completely disabling third-party applications. Instead, Microsoft recommends auditing 3rd party applications used by the organization and removing any that are not critical to business operations or have misconfigured permissions.\n\n## Guidance\n\nAuthentication of the application is handled by Microsoft and users log in with valid credentials to their Office 365 instance, so multi-factor authentication (MFA) is not a useful mitigation for this tactic. Malicious applications should be deleted or disabled with revoked permissions, though deletion is recommended.  \n\n### Deleting applications through Azure portal or Microsoft Graph API\n\n- Via the Azure portal, delete applications in the `Enterprise Applications` section under the `Azure Active Directory` tab.\n- Via the Graph API, soft delete the application (recoverable for 30 days) using `DELETE /applications{id}`.\n\t- If you do not permanently delete the application, set up monitoring or logging to be alerted if the application state changes, such as being reenabled or recovered. \n- Permanenetly delete the application using `DELETE /directory/deletedItems/{id}`.\n\n### Remediate service principals\n\n- Rotate any KeyVault secrets that the service principal had access to in the following order:\n\t- Directly exposed secrets via the `GetSecrets` calls.\n\t- Other exposed secrets in KeyVault.\n\t- Other exposed secrets across other subscriptions. \n- Remove service principals for malicious applications using the `Remove-ServicePrincipal` cmdlet, specifying the ID of the service principal.\n\n## References\n\n- Compromised and malicious applications investigation | <https://learn.microsoft.com/en-us/security/operations/incident-response-playbook-compromised-malicious-app>\n- Use service principals & managed identities | <https://learn.microsoft.com/en-us/azure/devops/integrate/get-started/authentication/service-principal-managed-identity?view=azure-devops>\n- Securing service principals in Microsoft Entra ID | <https://learn.microsoft.com/en-us/entra/architecture/service-accounts-principal>\n- Remove-ServicePrincipal | <https://learn.microsoft.com/en-us/powershell/module/exchange/remove-serviceprincipal?view=exchange-ps>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0022",
                "CM0076",
                "CM0135"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Compromised and malicious applications investigation",
                    "url": "https://learn.microsoft.com/en-us/security/operations/incident-response-playbook-compromised-malicious-app"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Use service principals & managed identities",
                    "url": "https://learn.microsoft.com/en-us/azure/devops/integrate/get-started/authentication/service-principal-managed-identity?view=azure-devops"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Securing service principals in Microsoft Entra ID",
                    "url": "https://learn.microsoft.com/en-us/entra/architecture/service-accounts-principal"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Remove-ServicePrincipal",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/exchange/remove-serviceprincipal?view=exchange-ps"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1554",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0106",
            "name": "Eliminate Web Shells",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0106\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nEliminating web shells removes malicious code from vulnerable web servers that enable initial access and persistence.\n\n## Introduction\n\nA web shell is malicious code that is written to a vulnerable web server. \nAdversaries typically exploit server misconfigurations or software vulnerabilities to deploy web shells. Web shells provide adversaries with a foothold that enables them to execute commands, exfiltrate data, and upload additional files to expand access beyond the initial point of access.\n\n## Preparation\n\n-\tVerify that plans, procedures, and authorities are in place to enable rapid containment and eradication of adversary from the compromised server. \n-\tTake steps to prepare for the operational interruptions incurred by taking a web server offline.\n\n## Risks\n\n-\tEliminating web shells may require down-time and thus disrupt the availability of the compromised web server.  \n-\tWeb shells are often used to achieve initial access and/or persistence. Additional tools, e.g. malware, are often deployed to enable the adversary to further compromise the environment. As such, additional countermeasures may be required to fully contain and eradicate the adversary from the compromised environment.\n\n## Guidance\n\n### Detecting Web Shells\n\nThe following detection logic should be considered components of a broader defense-in-depth strategy, not stand-alone solutions. \n\n- Compare files on web server with a known-good version. [Windiff](https://learn.microsoft.com/en-us/troubleshoot/windows-client/shell-experience/how-to-use-windiff-utility) is a tool developed by Microsoft for file and directory comparison. Another option to consider is [dirChecker](https://github.com/nsacyber/Mitigating-Web-Shells/blob/master/dirChecker.ps1) by NSA Cyber.  \n- Detect anomalous user agents, referrer headers, and IP Addresses in web server logs. This detection logic is likely to result in a high rate of false positives and should be continually monitored and refined.     \n- Detect host-based artifacts for common web shells. Consider using a security scanning tool like [YARA](https://github.com/virustotal/yara/) and the [core web shell detection signatures](https://github.com/nsacyber/Mitigating-Web-Shells/blob/master/core.webshell_detection.yara)\n- Detect network-based artifacts for common web shells.  \n- Detect unexpected network flows.\n\n### Eliminating Web Shells\n\n-\tIsolate the compromised web server to reduce the likelihood of lateral movement.\n-\tPreserve artifacts to enable further analysis. \n    - Disk and memory artifacts.\n    - Logs (operating system, web application, access, error, web application firewall, reverse proxy, content delivery network, DMZ firewall, and database logs).\n-\tDelete the web shell.\n-\tChange passwords for the web administrator, database user, hosting account, and remote access (FTP, SSH, etc.)\n-\tInvestigate the underlying vulnerability/cause of the breach.\n-\tRestore from clean backup.\n-\tHaving identified the underlying vulnerability / misconfiguration that led to the breach remediate by patching and hardening the web application and/or web server.\n\n## References\n\n- Mitigating Web Shells | <https://github.com/nsacyber/Mitigating-Web-Shells>\n- Threat Actors Exploit Multiple Vulnerabilities in Ivanti Connect Secure and Policy Secure Gateways | <https://www.cisa.gov/sites/default/files/2024-02/AA24-060B-Threat-Actors-Exploit-Multiple-Vulnerabilities-in-Ivanti-Connect-Secure-and-Policy-Secure-Gateways_0.pdf>\n- Web Shells: Types, Mitigation & Removal | <https://blog.sucuri.net/2024/04/web-shells.html>\n- Ghost in the Shell: Investigating Web Shell Attacks | <https://www.microsoft.com/en-us/security/blog/2020/02/04/ghost-in-the-shell-investigating-web-shell-attacks/>\n- How to use Windiff.exe | <https://learn.microsoft.com/en-us/troubleshoot/windows-client/shell-experience/how-to-use-windiff-utility>\n- dirChecker.ps1 | <https://github.com/nsacyber/Mitigating-Web-Shells/blob/master/dirChecker.ps1>\n- YARA | <https://github.com/virustotal/yara/>\n- YARA rules for detecting common web shells | <https://github.com/nsacyber/Mitigating-Web-Shells/blob/master/core.webshell_detection.yara>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0024",
                "CM0030",
                "CM0067",
                "CM0093"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "github.com",
                    "description": "Mitigating Web Shells",
                    "url": "https://github.com/nsacyber/Mitigating-Web-Shells"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "Threat Actors Exploit Multiple Vulnerabilities in Ivanti Connect Secure and Policy Secure Gateways",
                    "url": "https://www.cisa.gov/sites/default/files/2024-02/AA24-060B-Threat-Actors-Exploit-Multiple-Vulnerabilities-in-Ivanti-Connect-Secure-and-Policy-Secure-Gateways_0.pdf"
                },
                {
                    "source_name": "blog.sucuri.net",
                    "description": "Web Shells: Types, Mitigation & Removal",
                    "url": "https://blog.sucuri.net/2024/04/web-shells.html"
                },
                {
                    "source_name": "www.microsoft.com",
                    "description": "Ghost in the Shell: Investigating Web Shell Attacks",
                    "url": "https://www.microsoft.com/en-us/security/blog/2020/02/04/ghost-in-the-shell-investigating-web-shell-attacks/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How to use Windiff.exe",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-client/shell-experience/how-to-use-windiff-utility"
                },
                {
                    "source_name": "github.com",
                    "description": "dirChecker.ps1",
                    "url": "https://github.com/nsacyber/Mitigating-Web-Shells/blob/master/dirChecker.ps1"
                },
                {
                    "source_name": "github.com",
                    "description": "YARA",
                    "url": "https://github.com/virustotal/yara/"
                },
                {
                    "source_name": "github.com",
                    "description": "YARA rules for detecting common web shells",
                    "url": "https://github.com/nsacyber/Mitigating-Web-Shells/blob/master/core.webshell_detection.yara"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1021",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1190",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1505.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0107",
            "name": "Restore SYSVOL Content in AD Domains",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0107\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRestoring SYSVOL content terminates adversary defense evasion, persistence, privilege escalation, lateral movement, and impact via malicious GPOs and malware staged in the SYSVOL directory.\n\n## Introduction\n\nActive directory environments are a prime target for organized threat groups. When executing containment efforts that aim to rebuild and recover on-premise Active Directory environments, a critical step is to perform a clean restoration of System Volume (SYSVOL) and/or Netlogon shares. SYSVOL is a shared folder that exists on the hard disk of a each domain controller within an Active Directory forest, containing functional components such as Group Policy Objects (GPOs) and logon/logoff scripts. For this reason, restoring SYSVOL content in AD environments is necessary for a victim to regain authentication capabilities linked to SYSVOL, as well as restored functionality and synchronization of a corrupted File Replication Service (FRS). In more modern implementations of active directory forests, FRS is expected to be replaced by the Distributed File System Replication (DFSR) service. DFSR provides more efficient and reliable file replication that deprecates FRS; organizations should migrate from FRS to DFSR to ensure better performance and support. Neglecting to restore SYSVOL after compromise invites an attacker to continuously harvest credentials and obscure malicious scripts that enable their persistence within a network.\n\n## Preparation\n\n- Determine whether SYSVOL requires an authoritative recovery or a non-authoritative recovery. If the AD forest is compromised, proceed with a full rebuild via authoritative restore.\n- Identify content with the SYSVOL and Netlogon shared folders of each domain controller. Note any incongruencies across the AD environment.\n- Examine and document the status of the FRS/DFSR service within the AD environment, noting inconsistencies and signs of corruption.\n- If present, identify existing SYSVOL backups that can be used in authoritative recovery of SYSVOL.\n- Conduct system backups before making changes to the SYSVOL tree.\n\n## Risks\n\n- Interacting with a domain's SYSVOL tree and its contents will cause domain controllers to stop service of authentication requests until the SYSVOL folder is shared again.\n- Incorrect registry modification performed by following the included guidance may cause malfunction of system startup functions.\n- Improper application of this countermeasure can disrupt the synchronization of files/content within the SYSVOL and Netlogon folders.\n\n## Guidance\n\n### Rebuild SYSVOL Domain Replica Set Across Domain Controllers\n\n1. Stop the FRS/DFSR for all domain controllers in the domain. Set the service startup type value for the FRS/DFSR to **Disabled.**\n2. Move all files and folders that are required to reside in the SYSVOL tree to a temporary folder on a staged domain controller. Place the temporary folder on the same partition that the SYSVOL tree is located. This domain controller will serve as the *reference domain controller*, containing the authoritative copy of the SYSVOL tree that will be replicated across all other domain controllers.\n\t- Configure the *reference domain controller* to be authoritative. \n3. Verify that all domain controllers share the following folders and reparse points:\n\t- `SYSVOL`\n\t- `SYSVOL\\domain`\n\t- `\\SYSVOL\\staging\\domain`\n\t- `SYSVOL\\staging areas`\n\t- `SYSVOL\\domain\\Policies`\n\t- `\\SYSVOL\\domain\\scripts`\n\t- `\\SYSVOL\\SYSVOL`\n\t- `SYSVOL\\SYSVOL\\DNS Domain Name` (linked to `\\SYSVOL\\domain`)\n\t- `\\SYSVOL\\staging areas\\DNS Domain Name` (linked to `\\SYSVOL\\staging\\domain`)\n- Recreate the aforementioned folders/reparse points if they are missing. NOTE: avoid using Windows Explorer to move or copy contents of the SYSVOL tree to prevent breaking reparse points.\n4. Start File Replication Service (FRS) on each domain controller to link reparse points:\n\t- Go to Start -> Run -> type `cmd` -> OK\n\t- Type `net start ntfrs` to start FRS\n\t- Type `ntfrsutl ds |findstr /i \"root stage\"` -> press Enter to verify service status\n\t- Type `Linkd %systemroot%\\SYSVOL\\SYSVOL\\DNS Domain name` -> press Enter to link folder to domain junction point\n\t- Type `linkd \"%systemroot%\\SYSVOL\\staging areas\\DNS Domain Name\"` -> press Enter to link folder to domain junction point\n5. Verify that there is enough space for the staging across all domain controllers. Staging folder size may need to be adjusted.\n6. Build and validate policies and scripts in a temporary folder on the *reference domain controller*. Map GPOs to SYSVOL folders.\n7. Prepare the *reference domain controller* by moving validated policies and scripts from the temporary folder to `C:\\WINNT\\SYSVOL\\domain`.\n8. For all domain controllers other than the *reference domain controller*:\n\t- set `BurFlags` to `D2` in `regedit` under `HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\NtFrs\\Parameters\\Cumulative Replica Sets\\GUID`\n9. Rebuild the SYSVOL tree in a staggered manner in order to avoid overloading a single domain controller. Ensure that the `Replica Set Parent` registry entry specifies a source domain controller.\n10. Clean up *non-reference domain controllers*, deleting files and folders under `C:\\WINNT\\SYSVOL\\domain` and `C:\\WINNT\\SYSVOL\\staging\\domain`. Ensure the these two folders are not deleted themselves.\n11. Restart FRS on all domain controllers EXCEPT the *reference domain controller*, verifying that SYSVOL and NETLOGON are shared. Ensure that the FRS service startup type is set to `Automatic`.\n\tNOTE: A step-by-step version of this guidance that includes detailed explanation of commands and configurations can be obtained from the following Microsoft documentation:\n\t  https://learn.microsoft.com/en-us/troubleshoot/windows-server/group-policy/rebuild-sysvol-tree-and-content-in-a-domain#detailed-list-of-the-steps\n\n### Perform FRS to DFSR SYSVOL Migration\n\n- FRS is a legacy SYSVOL replication service that spans Windows Server operating systems from 2000-2008. DFSR has become the default replication engine for systems running Windows 2008 and newer. Due to the increased efficiency, performance, and security of DFSR, it is recommended to perform the migration procedures on Windows Server systems that rely on the deprecated FRS service.\n    - In order to proceed with an FRS to DFSR SYSVOL migration, one must verify that the system uses FRS using the `dfsrmig /getglobalstate` command:\n\t    1. Log in to the domain controller as Domain admin or Enterprise admin\n\t    2. Launch the PowerShell console and type `dfsrmig /getglobalstate`. Executing this command produces expected console output \"DFSR migration has not yet initialized...\"\n    - The migration process occurs in four phases that assigned a unique state. The four states are as follows:\n\t    - State 0 - Start\n\t    - State 1 - Prepared\n\t    - State 2 - Redirected\n\t    - Stage 3 - Eliminated\n1. Ensure a current copy of the SYSVOL folder is created before beginning the migration process. The migration process will automatically start at State 0 where FRS will replicate the SYSVOL folder amongst the domain controllers. \n2. Log in to the domain controller as Domain/Enterprise admin to initiate *State 1 - Prepared*. \n\t1. Launch the PowerShell console and execute the `dfsrmig /setglobalstate 1` command. With this completed, the DFSR state will be updated to 'Prepared.' \n\t2. Confirm all domain controllers have reached the 'prepared' state by executing command `dfsrmig /getmigrationstate`.\n3. Log in to the domain controller as Domain/Enterprise admin to initiate *State 2 - Redirected*.\n\t1. Launch the PowerShell console and execute the `dfsrmig /setglobalstate2` command. With this completed, the DFSR state will be updated to 'Redirected.'\n\t2. Confirm all domain controllers have reached the 'redirected' state by executing command `dfsrmig /getmigrationstate`.\n4. Log in to the domain controller as Domain/Enterprise admin to initiate *State 3 - Eliminated*.\n\t1. Launch the PowerShell console and execute the `dfsrmig /setglobalstate3` command. With this completed, the DFSR state will be updated to 'Eliminated'.\n\t2. Confirm all domain controllers have reached the 'Eliminated' state by executing command `dfsrmig /getmigrationstate`.\n5. Confirm the presence of the SYSVOL share by executing the `net share` command. The console output is expected to highlight the `\\SYSVOL_DFSR\\` share.\n6. Ensure the FRS service (servicename *NtFrs*) is stopped and disabled across each domain controller.\n\t\n\n### Perform an Authoritative Synchronization of DFSR-replicated SYSVOL\n\n- In active directory environments that contain the modern DFSR file replication service, synchronization of the SYSVOL folder must be performed:\n 1. Open Active Directory Users and Computers\n 2. Select **View > Users, Contacts, Groups, and Computers as containers > Advanced Features**\n 3. In the folder tree-view, select **Domain Controllers**, the name of the domain controller that has been restored, **DFSR-LocalSettings,** and then **Domain System Volume.**\n 4. In the Details pane, right-click **SYSVOL Subscription**, select **Properties**, and select **Attribute Editor**.\n 5. Select **msDFSR-Options**, select **Edit**, type **1**, and select **OK**.\n 6. Select **OK** to close the Attribute Editor.\n\n- In order to verify if the authoritative restore was successful, use powershell to execute the `Restart-Service DFSR -PassThru` command.\n- Verify the presence of Event ID 4602 within Windows Event Logs:\n\t  `Get-WinEvent -LogName 'DFS Replication' | Where-Object ID -EQ 4602 | Format-Table -AutoSize -Wrap`\n\n## References\n\n- How to Rebuild the SYSVOL Tree and its Content in a Domain | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/group-policy/rebuild-sysvol-tree-and-content-in-a-domain>\n\n- Securing SYSVOL: Threats, Protection, and Recovery | <https://www.cayosoft.com/sysvol/>\n\n- A Queen's Ransom: Varonis Uncovers Fast-Spreading \"SaveTheQueen\" Ransomware | <https://www.varonis.com/blog/save-the-queen-ransomware>\n\n- Active Directory Forest Recovery - Perform an authoritative synchronization of DFSR-replicated SYSVOL | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-authoritative-recovery-sysvol>\n\n- The Procedure for FRS to DFSR SYSVOL Migration | <https://noynim.com/frs-to-dfsr-sysvol-migration-step-by-step/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0018",
                "CM0069",
                "CM0111",
                "CM0122",
                "CM0139",
                "CM0144",
                "CM0148",
                "CM0149"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How to Rebuild the SYSVOL Tree and its Content in a Domain",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/group-policy/rebuild-sysvol-tree-and-content-in-a-domain"
                },
                {
                    "source_name": "www.cayosoft.com",
                    "description": "Securing SYSVOL: Threats, Protection, and Recovery",
                    "url": "https://www.cayosoft.com/sysvol/"
                },
                {
                    "source_name": "www.varonis.com",
                    "description": "A Queen's Ransom: Varonis Uncovers Fast-Spreading \"SaveTheQueen\" Ransomware",
                    "url": "https://www.varonis.com/blog/save-the-queen-ransomware"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Active Directory Forest Recovery - Perform an authoritative synchronization of DFSR-replicated SYSVOL",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-authoritative-recovery-sysvol"
                },
                {
                    "source_name": "noynim.com",
                    "description": "The Procedure for FRS to DFSR SYSVOL Migration",
                    "url": "https://noynim.com/frs-to-dfsr-sysvol-migration-step-by-step/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1080",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1484.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1552.006",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0108",
            "name": "Detect Rogue Virtual Machines",
            "subtype": "Examine, Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0108\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nDetecting rogue virtual machines (VMs) identifies a common initial access and persistence technique employed in virtualized environments.\n\n## Introduction\n\nA rogue VM is a virtual machine that is created and deployed by an adversary to evade defenses, persist within and environment, and enable the adversary to expand access. Rogue VMs are created on the hypervisor to closely resemble legitimate virtual machines. Rogue VMs typically operate outside of the standard management process and do not adhere to security policies. As such, they cannot be identified in the vCenter inventory.\n\n## Preparation\n\n- Patch vulnerabilities that may have afforded the adversary access to the environment. \n- Preserve artifacts to enable further analysis.\n\n## Risks\n\n- Identifying and removing a legitimate VM may be disruptive. Responders should take care not to eliminate a legitimate VM.\n\n## Guidance\n\n### Detect\n\n- Continuously monitor SSH activity. Pay close attention to unexpected SSH enablement and SSH activation that do not coincide with administrative cycles. Anomalous SSH sessions can also indicate the presence of an adversary.\n\n#### Detect Rogue VMs via ESXi Hypervisor Command-Line\n\n- List all VMs: `vim-cmd vmsvc/getallvms`\n- List all running VMs: `esxcli vm process list | grep Display`\n- Compare the output of the two commands.  Discrepancies between the output of these two commands can indicate an issue. A VM that is not identifiable via the API-based VM check (vm-cmd vmsvc/getallvms) may indicate a potentially rogue VM.  \n\nAlternatively, [Rogue VM Detection Script](https://github.com/center-for-threat-informed-defense/public-resources/tree/master/nerve-incident#rogue-vm-detection-script) and [VirtualGHOST](https://github.com/CrowdStrike/VirtualGHOST) are tools developed by MITRE's Center for Threat Informed Defense (CTID) and CrowdStrike to identify Rogue VMs.\n\n#### Detect VMware Persistence Mechanisms\n\nContinuously monitor for modification to the following:\n-\t`/etc/rc.local.d/local.sh`\n-\t`/bin/vmx -x/vmfs/volumes/<VOLUME>/<VM_NAME>/<VM_NAME>.vmx 2>/dev/null 0>/dev/null &`\n-\tInvocations of /bin/vmx binary in `/etc/rc.local.d/` or the `local.sh` startup script\n-\t`grep -r \\/bin\\/vmx /etc/rc.local.d/`\n-\tCat /etc/rc.local.d/local.sh\n\n### Eliminate\n\nIf a rogue virtual machine is detected, immediately preserve the VM, its memory, and all of its associated files for analysis. Isolate the VM and monitor network traffic. Destroying the VM should only be considered after an exhaustive analysis.  \n\n- Create a snapshot to preserve the VM and memory: `vim-cmd vmsvc/snapshot.create <VMID> <SNAPSHOT_NAME> <SNAPSHOT DESCRIPTION> 1`.\n- Destroy the rouge VM via the Hypervisor command-line: `vim-cmd vmsvc/destroy <VMID>`.\n\n## References\n\n- MITRE: NERVE Incident | <https://github.com/center-for-threat-informed-defense/public-resources/tree/master/nerve-incident>\n- Infiltrating Defenses: Abusing VMware in MITRE's Cyber Intrusion | <https://medium.com/mitre-engenuity/infiltrating-defenses-abusing-vmware-in-mitres-cyber-intrusion-4ea647b83f5b>\n- Memory Forensics for Virtualized Hosts | <https://blogs.vmware.com/security/2021/03/memory-forensics-for-virtualized-hosts.html>\n- CTID Rogue VM Detection Script | <https://github.com/center-for-threat-informed-defense/public-resources/tree/master/nerve-incident#rogue-vm-detection-script>\n- CrowdStrike VirtualGHOST | <https://github.com/CrowdStrike/VirtualGHOST>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0067"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "github.com",
                    "description": "MITRE: NERVE Incident",
                    "url": "https://github.com/center-for-threat-informed-defense/public-resources/tree/master/nerve-incident"
                },
                {
                    "source_name": "medium.com",
                    "description": "Infiltrating Defenses: Abusing VMware in MITRE's Cyber Intrusion",
                    "url": "https://medium.com/mitre-engenuity/infiltrating-defenses-abusing-vmware-in-mitres-cyber-intrusion-4ea647b83f5b"
                },
                {
                    "source_name": "blogs.vmware.com",
                    "description": "Memory Forensics for Virtualized Hosts",
                    "url": "https://blogs.vmware.com/security/2021/03/memory-forensics-for-virtualized-hosts.html"
                },
                {
                    "source_name": "github.com",
                    "description": "CTID Rogue VM Detection Script",
                    "url": "https://github.com/center-for-threat-informed-defense/public-resources/tree/master/nerve-incident#rogue-vm-detection-script"
                },
                {
                    "source_name": "github.com",
                    "description": "CrowdStrike VirtualGHOST",
                    "url": "https://github.com/CrowdStrike/VirtualGHOST"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1564.006",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0109",
            "name": "Audit and Restrict Cron Daemon",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0109\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing and restricting the use of the Linux Cron daemon prevents adversary persistence and privilege escalation capabilities.\n\n## Introduction\n\nThe cron daemon is a time-based job scheduler in Unix-like operating systems, including Linux. It is commonly used for automating system maintenance, running scripts, and executing commands at scheduled intervals. However, adversaries can abuse the cron service to establish persistence, escalate privileges, and execute malicious payloads. This countermeasure aims to provide comprehensive guidance on auditing and restricting the use of the cron daemon to mitigate these risks.\n\n## Preparation\n\n- Take inventory of all Linux systems and note the presence of the cron utility.\n- Document all cron jobs currently scheduled on enterprise systems. Identify the user accounts associated with existing cron jobs and the scripts or commands being executed.\n- Ensure that the cron job configurations are backed up before making any changes.\n\n## Risks\n\n- Modifying cron job configurations may disrupt scheduled tasks and impact previously automated system operations. \n- Failure to restrict cron jobs by following the principle of least privilege creates system vulnerabilities that enable potential execution and persistence objectives by an adversary.\n\n## Guidance\n\n### Auditing Cron Jobs\n\n- Utilize the following commands to list cron jobs for all users:\n\t- `crontab -l`\n\t- `sudo cat /etc/crontab `\n\t- `sudo ls -la /etc/cron.d/`\n- Review the output of these commands, examining each entry for validity and legitimacy of scheduled tasks.\n- Analyze the scripts and commands executed by cron jobs. Ensure they do not contain malicious or unnecessary instructions. The behavior of the cron jobs should be cross referenced with the ownership and permissions of the scripts executed by them.\n- Implement file integrity monitoring (FIM) tools to track changes to common cron-related files such as `/etc/crontab`, `/etc/cron.d/`, and `/var/spool/cron/`).\n- Set up alerts for unauthorized changes to cron job configurations.\n- It is important to note that adversaries will often delete compromised or malicious cronjobs after they have fulfilled their purpose- monitor the system logs (`/var/log/syslog and/or /var/log/cron`) for cases of cronjob deletion.\n- Implementing organized logging of crontabs and their related jobs. First, ensure that cron job executions are being properly logged under the syslog utility.\n\t- Example - Capture Cron Job Execution Logs:\n\t\t `sudo echo \"cron.* /var/log/cron.log\" | sudo tee -a /etc/rsyslog.d/50-default.conf` \n\t     `sudo systemctl restart rsyslog`\n- Instead of defaulting logged output of cronjobs to `/var/log/syslog`, best practices suggest that the output of jobs be logged in separate files based on levels of criticality.\n\n### Restricting Cron Jobs\n\n- Restrict the use of cron jobs to essential services and administrative tasks.\n- Disable cron job scheduling for regular users unless absolutely necessary.\n- Ensure that only authorized users have the necessary permissions to edit and create cron jobs. The following commands exemplify configuration of cron permissions using the `chmod` command:\n  `sudo chown root:root /etc/crontab` \n  `sudo chmod 600 /etc/crontab` \n  `sudo chown root:root /etc/cron.d/` \n  `sudo chmod 700 /etc/cron.d/`\n- Additionally, the `cron.allow` and `cron.deny` files should be properly configured so as to limit cron execution under the principle of least privilege.    \n    -Create `/etc/cron.allow` to specify users allowed to use cron.\n    -Create `/etc/cron.deny` to specify users denied from using cron.\n    Example:\n        `echo \"admin_user\" | sudo tee -a /etc/cron.allow` \n        `echo \"untrusted_user\" | sudo tee -a /etc/cron.deny`\n- Restrict access to the crontab directory to prevent unauthorized users from scheduling cron jobs, ensuring regular review of the contents of the `/var/spool/cron/` directory for unauthorized entries.\n\n## References\n\n- 15 Restricting cron and at | <https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-sec-cron-at.html>\n\n- How to Effectively Monitor and Manage Cron Jobs | <https://collabnix.com/how-to-effectively-monitor-and-manage-cron-jobs/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0036",
                "CM0049",
                "CM0068",
                "CM0103",
                "CM0120",
                "CM0138",
                "CM0147"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "documentation.suse.com",
                    "description": "15 Restricting cron and at",
                    "url": "https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-sec-cron-at.html"
                },
                {
                    "source_name": "collabnix.com",
                    "description": "How to Effectively Monitor and Manage Cron Jobs",
                    "url": "https://collabnix.com/how-to-effectively-monitor-and-manage-cron-jobs/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1053.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0110",
            "name": "Detect Anti-Malware Scan Interface (AMSI) Bypass Attempts",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0110\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDetecting adversary attempts to bypass or disable the Anti-Malware Scan Interface (AMSI) blocks or restricts the adversary from defense evasion and actions on objectives using malicious scripts or macros.\n\n## Introduction\n\nThe Anti-Malware Scan Interface pairs with Windows Defender and provides detection for in-memory malware that uses obfuscation or evasion techniques via built-in scripting hosts. AMSI analyzes the contents of scripts after they are loaded into memory but before they are executed and serves as protection against fileless malware. Applications that send data to AMSI for content scanning include: PowerShell, VBScript, Visual Basic Application (VBA) macros in Office documents, .NET scripts, and Windows Management Interface (WMI). AMSI additionally logs its own bypass attempts. \n\nAdversaries that bypass AMSI can run malicious scripts or macros and further perform other techniques to accomplish their objectives. A common follow-up to AMSI bypasses is reflective loading of malicious code, so that no scripts are written to disk. By detecting bypass attempts, responders can contain the incident by preventing further actions of malicious macros or scripts, which may aid the adversary in lateral movement, defense evasion, exfiltration, or privilige escalation. Newly discovered bypass attempts may be undetected.\n\n## Preparation\n\n- Determine whether AMSI is enabled in the environment via the registry key `HKCU\\Software\\Microsoft\\Windows Script\\Settings\\AmsiEnable`; a value of 0 means AMSI is disabled. Determine what effects enabling it places on business operations. \n- Determine which applications and services using AMSI are present in the environment.\n- Perform a backup of the registry before making any changes.\n\n## Risks\n\nProcess creation and process commandline logging produce large quantities of logs and can be difficult to automate filtering or alert on. Sufficient storage for logs is recommended. Continuous monitoring may help refine captured logs and increase actionable data.\n\n## Guidance\n\nAdversaries may use several ways to bypass AMSI, many of which happen during runtime of the service and may be difficult to detect and contain once running. Adversaries do not need administrator or admin privileges to run these bypasses. Monitor script execution via PowerShell and VBA macros.\n\n### Detect AMSI Bypass via Registry Keys\n\n- Check if the registry key `HKCU\\Software\\Microsoft\\Windows Script\\Settings\\AmsiEnable` is set to 0. If it is, then AMSI is disabled. Reset the registry key to 1.\n- Monitor changes to the `HKCU\\Software\\Microsoft\\Windows Script\\Settings\\AmsiEnable` registry key setting values to '0' to detect future bypasses using this method. \n\n### Detect AMSI Bypass via Scripting or Macros\n\n- Monitor PowerShell scriptblocks containing calls to CreateThread, DllImport, Bypass, or VirtualAlloc. More suspicious words are listed in \"Better Know a Data Source\" in the **References** section. Some of these logs may be triggered by legitimate system administration duties. \n- Monitor for commands encoded in Base64.\n- Monitor for commands containing a lot of special symbols such as (+, =, $). \n- Monitor the process commandline for commands to downgrade to a version of PowerShell before the implementation of AMSI with commands containing `powershell.exe -v 2` or `powershell.exe -version 2`, where PowerShell may be referred to as `powershell.exe` or `powershell`, and for all PowerShell event logs with ID 400. Remove or disable the Powershell 2.0 engine from the operating system if it is not necessary for critical business functions.  \n- On execution of AMSI, monitor function memory addresses in Amsi.dll for tampering: check that the instructions have not changed from their initial expected values. \n- Monitor hash integrity of the Amsi.dll code section for unauthorized patches. \n- Monitor process calls to `amsiutils`. \n- Terminate or quarantine suspicious PowerShell sessions where one or more of the above behaviors were observed.\n\n## References\n\n- Antimalware Scan Interface (AMSI) - Win32 apps | <https://learn.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal>\n- Anti-Anti-malware Scan Interface (AMSI) integration with Microsoft Defender Antivirus | <https://learn.microsoft.com/en-us/defender-endpoint/amsi-on-mdav>\n- PowerShell - Red Canary Threat Detection Report | <https://redcanary.com/threat-detection-report/techniques/powershell/>\n- Better know a data source: Antimalware Scan Interface | <https://redcanary.com/blog/threat-detection/better-know-a-data-source/amsi/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0022",
                "CM0031",
                "CM0095",
                "CM0101"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Antimalware Scan Interface (AMSI) - Win32 apps",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Anti-Anti-malware Scan Interface (AMSI) integration with Microsoft Defender Antivirus",
                    "url": "https://learn.microsoft.com/en-us/defender-endpoint/amsi-on-mdav"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "PowerShell - Red Canary Threat Detection Report",
                    "url": "https://redcanary.com/threat-detection-report/techniques/powershell/"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Better know a data source: Antimalware Scan Interface",
                    "url": "https://redcanary.com/blog/threat-detection/better-know-a-data-source/amsi/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1562.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562.010",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0111",
            "name": "Enable Multiple Administrative Approval (MAA) for Access Policies",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0111\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling multiple administrative approval (MAA) across Microsoft access policies restricts an adversary from compromising a domain/administrative account to achieve privilege escalation and persistence.\n\n## Introduction\n\nIt is important to apply secure access policies to standalone or active directory Microsoft accounts. Multiple administrative approval (MAA) is a best practice relevant to Microsoft Intune that requires a second administrative account to be used in approving a configuration change against a specific account. When MAA is properly implemented, a configuration change to a tenant resource that is protected by MAA won't be applied until a different account explicitly approves the change. In the context of Intune tenants, access policies support resources such as apps, scripts, and other MAA policies.\n\n## Preparation\n\n- Take inventory of all account types and administrative accounts that exist within the environment/tenant.\n- Ensure that at least two administrator accounts are present in order to allow operation of MAA access policies.\n- Accounts used in the creation of access policies must be assigned the appropriate \"Intune Service Administrator\" or \"Azure Global Administrator\" role.\n- Ensure that the account(s) that will approve access policies are delegated to the approver group assigned to the access policy for a specific resource (app, script, or access policy).\n\n## Risks\n\n- Modification of access policies to implement MAA may lead to misconfigured resources or improperly defined access policies.\n- Introducing MAA to access policies requires approving entities for any attempted changes against resources or other access policies. This introduces delay to the processing of configuration changes.\n- Improper delegation of admin accounts to the approval group/role may cause unwarranted changes such as unauthorized script or app deployments.\n\n## Guidance\n\n### Create an MAA Access Policy\n\n*Per Microsoft Documentation*\n\n1. To create an access policy, in the Microsoft Intune admin center (<https://go.microsoft.com/fwlink/?linkid=2109431>), go to **Tenant administration** -> **Multi Admin Administration** -> **Access policies** and select **Create**.\n    \n2. On the _Basics_ page, provide a _Name_, and optional _Description_, and for _Profile type_ select from available options. Each policy supports a single profile type.\n    \n3. On the _Approvers page_, select **Add groups** and then select a group as the group of approvers for this policy. More complex configurations that exclude groups aren't supported.\n    \n4. On the _Review + Create_ page, review, and then save your changes. After Intune applies this policy, configurations for the protected profile type will require multiple admin approvals.\n\n- When creating and implementing an MAA access policy, it is important to define clear approval processes to minimize delays in the processing of configuration changes. Establishment of Role-Based Access Control (RBAC) is recommended to mitigate the potential for damage caused by improper delegation of admin accounts to the approval group.\n\n### Submit a Resource Configuration Request under MAA\n\n- Once MAA is enabled, requests must be submitted and approved before a resource can be created or edited.\n\n- When submitting a request, standard procedure for creation/editing of a resource within Microsoft Intune should be followed, up until the final page before changes are saved.\n\n- Add details to the *Business justification* field before submitting a request.\n\n- The status of pending requests can be monitored in the Microsoft Intune admin center by going to **Tenant administration > Multi Admin Approval > My requests**.\n\n- Requests will remain here, pending approval by anyone within the known list of approvers. Requests can be cancelled before approval by selecting it from **My requests > click Cancel request**.\n\n### Approve a Resource Configuration Request under MAA\n\n1. To find requests to approve, in the Microsoft Intune admin center (<https://go.microsoft.com/fwlink/?linkid=2109431>) go to **Tenant administration** > **Multi Admin Administration** > **Received requests**.\n    \n2. Select the _Business justification_ link for a request to open the review page where you can learn more about the request, and manage approval or rejection.\n    \n3. After reviewing the details, enter relevant details in the Approver notes field, and then select **Approve request** or **Reject request**.\n    \n4. After you approve a request, the requestor needs select **Complete**. Intune will process the change, and changes the status to _Completed._ Verify the approval succeeded (or failed) by reviewing the console notification upon completion.\n    \n    To verify if the approval succeeded (or failed), look at the notifications in the Intune admin center. A message shows if the approval succeeded or failed.\n\n## References\n\n- Use Access Policies to require multiple administrative approvals | <https://learn.microsoft.com/en-us/mem/intune/fundamentals/multi-admin-approval>\n\n- Avenues to Compromise - Microsoft | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/avenues-to-compromise>\n\n- Microsoft Intune securely manages identities, manages apps, and manages devices | <https://learn.microsoft.com/en-us/mem/intune/fundamentals/what-is-intune>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0084",
                "CM0107",
                "CM0114",
                "CM0118",
                "CM0121",
                "CM0142"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Use Access Policies to require multiple administrative approvals",
                    "url": "https://learn.microsoft.com/en-us/mem/intune/fundamentals/multi-admin-approval"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Avenues to Compromise - Microsoft",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/avenues-to-compromise"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Intune securely manages identities, manages apps, and manages devices",
                    "url": "https://learn.microsoft.com/en-us/mem/intune/fundamentals/what-is-intune"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0112",
            "name": "Remove Extraneous and Stale Accounts",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0112\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving extraneous and stale accounts blocks or restricts adversary initial access, persistence, defense evasion, and lateral movement using said accounts.\n\n## Introduction\n\nExtraneous or stale accounts are accounts that are considered no longer active in an environment and may be unmonitored or have expired credentials, making them targets for attackers. They can also be used by former employees whose accounts are still active, posing additional security risks.\n\n## Preparation\n\n- Identify organization's standard procedures regarding inactive user accounts and how long after last logon or password reset an account is considered \"inactive\".\n- Identify de-provisioning procedures for user accounts.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\nThis countermeasure addresses only extraneous user accounts for employees and other contractors; auditing and removing service accounts for legacy applications may require more nuance than is presented here. \n\n- Audit all Active Directory (AD) users where the password age is over the company's policy for inactivity. The following PowerShell command locates all users where password hasn't changed for 180 days (6 months): `Get-ADUser -Filter '(PasswordLastSet -lt $d) -or (LastLogonTimestamp -lt $d)' -Properties PasswordLastSet,LastLogonTimestamp | ft Name,PasswordLastSet,@{N=\"LastLogonTimestamp\";E={[datetime]::FromFileTime($_.LastLogonTimestamp)}}`, where `$d = [DateTime]::Today.AddDays(-180)`.\n- Disable all found accounts and move them to a separate organizational unit (OU).\n- After de-provisioning, certain circumstances may warrant deleting the inactive account. While deleting accounts reduces the attack surface, it may lead to complications with services linked to the AD or cause issues should the account be needed again in the future. Defer to the organization's standard account de-provisioning procedures.\n\n## References\n\n- Regularly check for and remove inactive user accounts in the Active Directory | <https://learn.microsoft.com/en-us/services-hub/unified/health/remediation-steps-ad/regularly-check-for-and-remove-inactive-user-accounts-in-active-directory>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0033",
                "CM0043",
                "CM0044",
                "CM0063",
                "CM0064",
                "CM0071",
                "CM0118"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Regularly check for and remove inactive user accounts in the Active Directory",
                    "url": "https://learn.microsoft.com/en-us/services-hub/unified/health/remediation-steps-ad/regularly-check-for-and-remove-inactive-user-accounts-in-active-directory"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0113",
            "name": "Disable Microsoft Office Add-ins",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0113\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling Microsoft (MS) Office add-ins blocks an adversary from maintaining persistence using MS Office Add-ins.\n\n## Introduction\n\nAdversaries can use malicious add-ins to inject code payloads into Office documents. Adversaries may use malicious Office Ad-ins as a means of avoiding detection by anti-malware solutions that are better at detecting macros or Visual Basic (VBA) scripts. Malicious Office Add-ins can run on application start-up and allow adversaries to maintain persistent access to systems.\n\n## Preparation\n\n- Identify what Office Add-ins (if any) are necessary to business operations.\n- Consider enabling Attack Surface Reduction (ASR) rules blocking Office Add-ins from creating child processes: \n\t- Navigate to `Computer Configuration > Policies > Administative Templates > Windows Components > Microsoft Defender Antivirus > Microsoft Defender Exploit Guard > Attack Surface Reduction`\n    - Set `Configure Attack Surface Reduction Rules` to Enabled and set the `D4F940AB-401B-4EFC-AADC-AD5F3C50688A` key to value 1. There are other ASR rules for Office applications, including blocking API calls by macros or blocking executable content that can also be enabled.\n\n## Risks\n\n- Some departments may use Office Add-ins for legitimate purposes and disabling them can affect effectiveness of operations.\n- Disabling all Add-ins via the Group Policy Objects (GPOs) may disable all COM add-ins as well if no allowed/managed add-ins are specified.\n\n## Guidance\n\n### Disabling Add-ins via Group Policy\n\nUpdate Group Policy for Add-ins.\n- Create a GPO object.\n- In the editor, navigate to `User Configuration > Policies > Administrative Templates > Microsoft Office`.\n- To block all add-ins, enable the `Block all unmanaged add-ins` policy setting.\n- If any add-ins are mandatory to business operations, enable the `List of managed add-ins` policy setting. Follow provided GPO instructions to manage any allowed add-ins by adding their ProgIDs (found in the registry under the `HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Office\\<application>\\Addin` or `HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Office\\<application>\\Addins` keys) into the policy. All add-ins not in the list will be blocked by the previous policy. \n\nAdditional GPO settings and their recommended settings for Office 2016 applications:\n- Under `User Configuration > Policies > Administrative Templates > Microsoft <application> 2016 > <application> Options > Security > Trust Center` set `Disable all application add-ins` to enabled. This setting is available for Excel 2016, PowerPoint 2016, Project 2016, Visio 2016, and Word 2016. \n\nUpdate group policies on all machines by either using the Group Policy Management Console (GPMC) or the `Invoke-GPUpdate` cmdlet in PowerShell. Firewall settings may need to be altered to allow the following traffic:\n\n| Server Port           | Service                       | Type of network traffic                     |\n|-----------------------|-------------------------------|---------------------------------------------|\n| TCP RPC dynamic ports | Task Scheduler service        | Remote Scheduled Tasks Management           |\n| TCP port 135          | Remote Procedure Call service | RPC Endpoint Mapper (RPC-EPMAP)             |\n| all TCP ports         | Winmgmt                       | Windows Management Instrumentation (WMI-in) |\n\nWindows Server offers a starter GPO for configuring all the necessary ports, titled `Group Policy Remote Update Firewall Ports`. Microsoft recommends using that policy as a starting point and editing as needed based on organizational and business needs. After ports are configured, the following steps push GPO updates:\n- Via the GPMC, navigate to the organizational unit.\n- Click `Group Policy Update...` and select \"yes\" when the `Force Group Policy update` dialog box pops up.\n\nMonitor changes.\n- Monitor changes to the GPO policy for adversary behavior such as disabling policy settings or adding add-ins to the managed list.\n- Monitor the `HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Office\\<application>\\Addin` and `HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Office\\<application>\\Addins` registry keys for any changes.\n\nAdd-ins can also be disabled manually on hosts via the application using them. Navigate to `File > Get Add-ins > My Add-ins` and select the Remove option for all Add-ins you wish to remove. \n\n### Deleting Add-ins\n\nIf an Add-in is no longer needed, delete it instead of disabling.\n- Navigate to `Integrated Apps` in the admin center.\n- In the configuration pane of the selected add-in, go to `Advanced Settings > Add-ins`. \n- Select the correct add-in from the list and remove it.\n\n## References\n\nWhile some of the references are focused on keeping add-ins enabled, they provide information on disabling or removing them as well. \n\n- Disable Add-ins | <https://support.microsoft.com/en-us/office/disable-add-ins-71d7505d-1349-4741-980a-8cb65e0097bd>\n- Enable Or Disable Microsoft Office Add-ins Via Group Policy | <https://www.kapilarya.com/enable-or-disable-microsoft-office-add-ins-via-group-policy>\n- View, manage, and install add-ins for Excel, PowerPoint, and Word | <https://support.microsoft.com/en-us/office/view-manage-and-install-add-ins-for-excel-powerpoint-and-word-16278816-1948-4028-91e5-76dca5380f8d>\n- Support for keeping add-ins enabled | <https://learn.microsoft.com/en-us/office/vba/outlook/Concepts/Getting-Started/support-for-keeping-add-ins-enabled#system-administrator-control-over-add-ins>\n- Hardening Microsoft 365, Office 2021, Office 2019 and Office 2016 | <https://www.cyber.gov.au/sites/default/files/2023-03/PROTECT%20-%20Hardening%20Microsoft%20365%2C%20Office%202021%2C%20Office%202019%20and%20Office%202016%20%28January%202022%29.pdf>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0002",
                "CM0004",
                "CM0056",
                "CM0085",
                "CM0116"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "support.microsoft.com",
                    "description": "Disable Add-ins",
                    "url": "https://support.microsoft.com/en-us/office/disable-add-ins-71d7505d-1349-4741-980a-8cb65e0097bd"
                },
                {
                    "source_name": "www.kapilarya.com",
                    "description": "Enable Or Disable Microsoft Office Add-ins Via Group Policy",
                    "url": "https://www.kapilarya.com/enable-or-disable-microsoft-office-add-ins-via-group-policy"
                },
                {
                    "source_name": "support.microsoft.com",
                    "description": "View, manage, and install add-ins for Excel, PowerPoint, and Word",
                    "url": "https://support.microsoft.com/en-us/office/view-manage-and-install-add-ins-for-excel-powerpoint-and-word-16278816-1948-4028-91e5-76dca5380f8d"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Support for keeping add-ins enabled",
                    "url": "https://learn.microsoft.com/en-us/office/vba/outlook/Concepts/Getting-Started/support-for-keeping-add-ins-enabled#system-administrator-control-over-add-ins"
                },
                {
                    "source_name": "www.cyber.gov.au",
                    "description": "Hardening Microsoft 365, Office 2021, Office 2019 and Office 2016",
                    "url": "https://www.cyber.gov.au/sites/default/files/2023-03/PROTECT%20-%20Hardening%20Microsoft%20365%2C%20Office%202021%2C%20Office%202019%20and%20Office%202016%20%28January%202022%29.pdf"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1137.006",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0114",
            "name": "Enable Microsoft Conditional Access Policy Templates",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0114\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling Microsoft Conditional Access Policy templates blocks or restricts an adversary from lateral movement and privilege escalation using legitimate credentials.\n\n## Introduction\n\nMicrosoft Conditional Access is a zero-trust security parameter to help manage user and device identity, taking signals from multiple sources; if users want to access resources, they have to perform some action (the condition). Administrators can use conditional access policies to implement access controls for their organization.\n\nCommonly applied policies include requiring multifactor authentication (MFA) for users with administrator roles and privileges, requiring MFA for Microsoft Azure management, blocking users and accounts using legacy authentication protocols, and blocking access attempts from specific geographic locations. Multiple policies may apply to a single user, and in that case both policies must be fulfilled before access is granted. Conditional access makes it harder for adversaries to use legitimate credentials to access a network remotely, since policies may require MFA or a trusted device before granting access.\n\n## Preparation\n\n- Add and configure appropriate licenses. Conditional Access Policies require the Microsoft Entra ID P1 or Microsoft 365 Business Premium license. Any risk-based policies require an Entra ID P2 license and access to Microsoft Entra ID Protection.  \n- Identify appropriate access policies for users, devices, services, and roles.\n- Identify which templates or policies within the templates fit organizational and business needs.\n\n## Risks\n\nChanging access control policies and methods can be disruptive to operations, as users may lose access to their accounts or need to set up additional authentication methods.\n\n## Guidance\n\nTo minimize disruption caused by changing access control, consider rolling out policies in phases so help desk support is not overwhelmed and alerting users of changes.\n\nMicrosoft provides templates in the following categories:\n- Secure Foundation\n- Zero Trust\n- Remote Work\n- Protect Administrator\n- Emerging Threats\n\nSome policies may require additional licences. \n\nNavigate to the templates in the Microsoft Entra admin center under `Protection > Conditional Access > Create new policy from templates`.\n- Select the appropriate policies and templates. \n- Add users and groups the policies will apply to. The creators of the policies will be excluded; to exclude other users, modify the policy after creation. Delete the account used to create the policy if exclusions are not required.  \n\n### Develop New Policies for Future Incidents (Optional)\n\nMicrosoft allows policy creation without using templates. Configure conditional access policies aligning with organizational business needs to aid in future incident response. \n- In Microsoft Entra admin center, navigate to `Protection > Conditional Access`.\n- Select `Create new policy`, and enter the name for the policy.\n- Set Assignments to `Users or workload identities` and ensure that under `What does this policy apply to?` and `Include`, `Users and groups` is selected.\n- Add users or groups to the policy.\n- Configure conditions for the policy. \n\nFor more detailed walkthrough steps, see \"Tutorial: Secure user sign-in events with Microsoft Entra multifactor authentication\" in the **References** section.\n\n## References\n\n- What is Conditional Access? | <https://learn.microsoft.com/en-us/entra/identity/conditional-access/overview>\n- Conditional Access policy templates | <https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-conditional-access-policy-common?tabs=secure-foundation>\n- Configuring Azure Active Directory Conditional Access | <https://learn.microsoft.com/en-us/appcenter/general/configuring-aad-conditional-access>\n- Tutorial: Secure user sign-in events with Microsoft Entra multifactor authentication | <https://learn.microsoft.com/en-us/entra/identity/authentication/tutorial-enable-azure-mfa?bc=%2Fazure%2Factive-directory%2Fconditional-access%2Fbreadcrumb%2Ftoc.json&toc=%2Fazure%2Factive-directory%2Fconditional-access%2Ftoc.json#create-a-conditional-access-policy>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0003",
                "CM0037",
                "CM0043",
                "CM0044",
                "CM0063",
                "CM0084",
                "CM0111",
                "CM0115",
                "CM0136",
                "CM0139"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "What is Conditional Access?",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/overview"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Conditional Access policy templates",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-conditional-access-policy-common?tabs=secure-foundation"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Configuring Azure Active Directory Conditional Access",
                    "url": "https://learn.microsoft.com/en-us/appcenter/general/configuring-aad-conditional-access"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Tutorial: Secure user sign-in events with Microsoft Entra multifactor authentication",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/authentication/tutorial-enable-azure-mfa?bc=%2Fazure%2Factive-directory%2Fconditional-access%2Fbreadcrumb%2Ftoc.json&toc=%2Fazure%2Factive-directory%2Fconditional-access%2Ftoc.json#create-a-conditional-access-policy"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0115",
            "name": "Block Untrusted and Unsigned Processes that Run from USB",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0115\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nBlocking untrusted and unsigned processes that run from USB blocks lateral movement via malicious execution on hosts via USB.\n\n## Introduction\n\nUSB drives are commonly abused by adversaries to achieve initial access or lateral movement. Adversaries copy malware to USB drives and employ social engineering techniques to trick users into executing the malware.  \n\nWindows Defender Exploit Guard (WDEG) Attack Surface Reduction (ASR) provides an option to prevent unsigned and untrusted executable files (.exe, .dll, .scr) from running from USB drives and SD cards. The intent of this countermeasure not to prevent initial access but to prevent the replication of malware via USB.\n\n## Preparation\n\n-\tMicrosoft Defender for Endpoint with real-time and cloud-delivery protection is enabled.\n-\tMicrosoft Defender is the primary anti-virus solution.\n-\tNo Microsoft Defender component is more than two versions old.\n\n## Risks\n\n-\tASR rules should be initially configured in \"Audit Mode\" to minimize the likelihood of operational disruption. If time permits, gather and assess telemetry data to ensure the rule will not impact operations.\n-\tConsider and specify exclusions to minimize operational impact.\n\n## Guidance\n\n### Block via Group Policy\n\n-\tOpen the Group Policy Management Console.\n-\tCreate or edit a group policy object.\n-\tSelect `Group Policy Management Editor` browse to `Computer Configuration` and select `Administrative Templates`.\n-\tExpand `Windows Components>Microsoft Defender Antivirus>Microsoft Defender Exploit Guard>Attack Surface Reduction`.\n-\tSelect and enable `Configure Attack Surface Reduction Rules`.\n-\t`Show` and enter the rule ID (GUID) in the `Value Name` and specify the value as follows:\n    - 1: Block (Enable)\n    - 2: Audit (Evaluate)\n-\tConsider enabling `Audit` mode and monitoring to reduce the likelihood of operational disruption.\n-\tApply the policy.\n\n### Block via Intune\n\n-\tSign into the Microsoft Intune Admin Center.\n-\tSelect `Endpoint Security`.\n-\tNavigate to `Attack Surface Reduction>Create Policy`.\n-\tNavigate to `Create a Profile`.\n-\tUnder `Platform`, select `Windows 10 and later`. Under `Profile`, select `Attack Surface Reduction Rules`.\n-\tSelect `Create`.\n-\tOn the `Basics` tab, name the policy and enter a description.\n-\tSelect `Configuration Settings`.\n-\tConfigure the `Block Untrusted and Unsigned Processes that Run from USB` policy to `Block`, `Audit`. \n-\tSelect `Next`.\n-\tAdd scope tags (optional).\n-\tUnder `Assignments`, select `All Devices` or select a specific group. Consider testing the policy on a limited basis prior to applying to all devices. \n-\t`Create` the policy.\n\n## References\n\n- Using Caution with USB Drives | <https://www.cisa.gov/news-events/news/using-caution-usb-drives>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0114",
                "CM0119"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisa.gov",
                    "description": "Using Caution with USB Drives",
                    "url": "https://www.cisa.gov/news-events/news/using-caution-usb-drives"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1052.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1091",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1092",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0116",
            "name": "Restrict Visual Basic for Applications (VBA) Macros",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0116\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nRestricting macros blocks adversary persistence and lateral movement using malicious Visual Basic for Applications (VBA) macros.\n\n## Introduction\n\nMacros are embedded code written in Visual Basic for Applications (VBA) that enable users to automate repetitive tasks in Microsoft Office applications. Macros are abused by adversaries to achieve user execution in pursuit of initial access, execution, lateral movement, and persistence. \n\nThough macros are often employed in pursuit of initial access, the intent of this countermeasure is to contain a threat that is leveraging macros to achieve lateral movement or persistence, and thereby slow the pace and extent of adversarial advance.\n\n## Preparation\n\n-\tAttempt to determine the extent to which macros are used within the organization.\n-\tAssess options for restricting macros.\n-\tInform stakeholders of the potential for operational disruption.\n\n## Risks\n\nRestricting macros can disrupt operations. Pursue restrictions from this frame of reference.  Restrictions should be tested thoroughly and enabled with caution.\n\n## Guidance\n\nBy default, macros from the internet are disabled by Microsoft Office via Mark of The Web (MOTW). This is a decent first line of defense against malicious macros. However, adversaries are capable of bypassing MOTW to get macros to run as intended.\n\n### Restrict via Group Policy Object (GPO)\n\n-\tIf you are not already managing Microsoft Office settings using Group Policy, [import](https://learn.microsoft.com/en-us/troubleshoot/windows-client/group-policy/create-and-manage-central-store) the [Office administrative templates (ADMX)](https://www.microsoft.com/en-us/download/details.aspx?id=49030) for the correct version of Office.\n-\tVia the Group Policy Management Console, create or edit a Group Policy Object. \n-\tSelect `Administrative templates>Microsoft Word 20xx>Word options>Security Trust Center` and consider the following restrictions:\n    - Enable `Block macros from running in Office files from the Internet`.\n    - `Disable all macros except digitally signed macros`.\n    - Disable `Allow mix of policy and user locations`.\n    - Enable `Automation Security`.\n-\tYou may also consider only permitting the execution of macros to certain groups that require the need to do so to support an operational requirement.  \n\n\n### Restrict via Intune Policy\n\n-\tYou may use Intune cloud policy or Group Policy ADMX templates to restrict macros.\n-\tSign into the Intune Endpoint Manager portal.\n-\tSelect `Devices>Windows>Configuration Profiles>Create Profile`.\n-\tSelect `Platform>Windows xx>Profile>Profile Type>Settings Catalog' Create.` \n-\tOn the `Basics` tab, Name the policy and enter a description.\n-\t`Configuration Settings` select `Add Settings`.\n-\tSearch for macro related policies e.g. `macros from running in Office files from the internet`.\n-\tSelect and enable the appropriate policies.\n\n### Restrict Macros via Microsoft Attack Surface Reduction (ASR) Rules in Intune\n\n-\tSign into the Microsoft Intune Endpoint Management portal.\n-\tSet platform to `Windows 10, Windows 11, and Windows Server`.\n-\tSet profile to `Attack Surface Reduction Rules`.\n-\tSet the name and enter a description.\n-\tConsider the following rules:\n    - `Block Win32 API calls from Office`\n    - `Block execution of potentially obfuscated scripts`\n    - `Block JavaScript or VBScript from launching downloaded executable content`\n-\tAdd inclusions and exclusions.\n-\tCreate the policy.\n\n### Additional Considerations\n\n-\tEnsure the continual logging and monitoring of macro execution.\n-\tImplement an application control solution and configure it to scrutinize macros.\n-\tImplement email and web content filtering to inspect Microsoft Office files for macros.\n-\tEnd user security training.\n-\tPrevent users from being able to modify security settings.\n\n## References\n\n- Macro Security for Microsoft Office | <https://www.ncsc.gov.uk/guidance/macro-security-for-microsoft-office>\n- Essential Eight Configure Microsoft Office Macro Settings | <https://learn.microsoft.com/en-us/compliance/essential-eight/e8-macro>\n- Restricting Microsoft Office Macros | <https://www.cyber.gov.au/sites/default/files/2023-11/PROTECT%20-%20Restricting%20Microsoft%20Office%20Macros%20%28November%202023%29.pdf>\n- Macros from the internet are blocked by default in Office | <https://learn.microsoft.com/en-us/deployoffice/security/internet-macros-blocked>\n- Mark Of The Web Bypass | <https://redcanary.com/threat-detection-report/techniques/mark-of-the-web-bypass/>\n- Managing the Central Store for Group Policy Administrative Templates | <https://learn.microsoft.com/en-us/troubleshoot/windows-client/group-policy/create-and-manage-central-store>\n- Administrative Templates (ADMX/ADML) for Microsoft Office | <https://www.microsoft.com/en-us/download/details.aspx?id=49030>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0004",
                "CM0047",
                "CM0056",
                "CM0113"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.ncsc.gov.uk",
                    "description": "Macro Security for Microsoft Office",
                    "url": "https://www.ncsc.gov.uk/guidance/macro-security-for-microsoft-office"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Essential Eight Configure Microsoft Office Macro Settings",
                    "url": "https://learn.microsoft.com/en-us/compliance/essential-eight/e8-macro"
                },
                {
                    "source_name": "www.cyber.gov.au",
                    "description": "Restricting Microsoft Office Macros",
                    "url": "https://www.cyber.gov.au/sites/default/files/2023-11/PROTECT%20-%20Restricting%20Microsoft%20Office%20Macros%20%28November%202023%29.pdf"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Macros from the internet are blocked by default in Office",
                    "url": "https://learn.microsoft.com/en-us/deployoffice/security/internet-macros-blocked"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Mark Of The Web Bypass",
                    "url": "https://redcanary.com/threat-detection-report/techniques/mark-of-the-web-bypass/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Managing the Central Store for Group Policy Administrative Templates",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-client/group-policy/create-and-manage-central-store"
                },
                {
                    "source_name": "www.microsoft.com",
                    "description": "Administrative Templates (ADMX/ADML) for Microsoft Office",
                    "url": "https://www.microsoft.com/en-us/download/details.aspx?id=49030"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1137.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1204.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0117",
            "name": "Disable or Monitor Connection Manager Profile Installer (CMSTP.exe)",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0117\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling the Connection Manager Profile Installer (CMSTP.exe) prevents an adversary's attempts to evade defenses and achieve proxy execution using CMSTP.\n\n## Introduction\n\nThe Connection Manager Profile Installer (CMSTP.exe) is a command-line program for installing Connection Manager service profiles from installation information files (INF). System administrators use this service to connect to remote networks via configured profiles. This software is installed on Windows endpoints by default and is signed by Microsoft. \n\nAdversaries can use the service to execute arbitrary code by providing INF files containing malicious commands, bypassing existing user account control.\n\n## Preparation\n\n- Determine impacts that disabling the service will have on business operations. Identify connections that need to be installed using this service, such as virtual private networks (VPNs). \n- Identify any existing Group Policy Objects (GPOs) for software or executable restrictions. \n- If creating policies using the Windows Defender Application Control (WDAC) on versions of Windows Server 2022 or above, Windows 10 version 1903 and above, or Windows 11 versions 22H2 or below, ensure the WDAC policy refresh tool is available on all managed endpoints.\n\n## Risks\n\n- Removing or disabling connection manager may be disruptive to business operations if the organization uses CMSTP.exe for remote network connections, for example over VPN.\n- Creating and pushing application policy updates may be disruptive to business operations. Consider updating policies during slower hours. \n- Renaming, changing, or moving CMSTP.exe may evade Applocker or WDAC policies. Having several types of rules active simultaneously (e.g. a hash rule and a path rule) can mitigate some risk, since the rules protect against different behaviors.\n\n## Guidance\n\nIf CMSTP is not required for business operations of the organization, it should be disabled to lessen the attack surface and reduce the logging load on systems and analysts.\n\nAppLocker is the recommended tool for disabling software alongside Windows Defender Application Control (WDAC) after Microsoft ended support for Software Restriction Policies via GPOs. Both AppLocker and WDAC are \"deny by default, allow by exception\" applications. \n\n### Restriction via AppLocker\n\n- Implement Applocker's default allow rules regarding executables.\n\t- In the Group Policy Management Console (GPMC) navigate to `Security Settings > Application Control Policies > AppLocker > Executable Rules`.\n\t- Select `Executable Rules` and enable `Create Default Rules`.\n- Define a deny rule for `cmstp.exe`. \n- Alternatively, block locations of the CMSTP.exe executable (all locations must be blocked). Take care not to block any legitimate applications during this process. \n\n### Restriction via Windows Defender Application Control\n\nWDAC can be configured for both allow and deny policies based on organizational needs. When creating deny policies, Microsoft requires the inclusion of \"Allow All\" rules in both kernel and user mode sections to avoid blocking all software (some explicitly and some implicitly, since there are no rules to allow it). Microsoft provides an AllowAll policy template. This template will not affect any explicit allow rules already in place.  \n\nPolicies can be created using PowerShell or via the WDAC wizard.\n\n| Rule Type | PowerShell Command |\n|-----------|--------------------|\n| Software Publisher-based | `$DenyRules += New-CIPolicyRule -Level FilePublisher -DriverFilePath cmstp.exe -Fallback SignedVersion,Publisher,Hash -Deny` |\n| Software attribute-based | `$DenyRules += New-CIPolicyRule -Level FileName -DriverFilePath cmstp.exe -Fallback Hash -Deny` |\n| Hash-based | `$DenyRules += New-CIPolicyRule -Level Hash -DriverFilePath cmstp.exe -Deny` | \n\nMerge the deny rules with the AllowAll template policy:\n```\n$DenyPolicy = <path_to_deny_policy_destination>\n$AllowAllPolicy = $Env:windir + \"\\schemas\\CodeIntegrity\\ExamplePolicies\\AllowAll.xml\"\nMerge-CIPolicy -PolicyPaths $AllowAllPolicy -OutputFilePath $DenyPolicy -Rules $DenyRules\nSet-CiPolicyIdInfo -FilePath $DenyPolicy -PolicyName \"Deny CMSTP\" -ResetPolicyID\n```\n\nDeploy WDAC policies:\n- Convert XML policy into binary. An example PowerShell command to do so is listed below. Ensure that the `$WDACPolicyXMLFile` variable points to the location of the XML policy file. \n\n    ```\n    ## Update the path to your WDAC policy XML\n     $WDACPolicyXMLFile = $env:USERPROFILE + \"\\Desktop\\MyWDACPolicy.xml\"\n     [xml]$WDACPolicy = Get-Content -Path $WDACPolicyXMLFile\n     if (($WDACPolicy.SiPolicy.PolicyID) -ne $null) ## Multiple policy format (For Windows builds 1903+ only, including Server 2022)\n     {\n         $PolicyID = $WDACPolicy.SiPolicy.PolicyID\n         $PolicyBinary = $PolicyID+\".cip\"\n     }\n     else ## Single policy format (Windows Server 2016 and 2019, and Windows 10 1809 LTSC)\n     {\n         $PolicyBinary = \"SiPolicy.p7b\"\n     }\n    ## Binary file will be written to your desktop\n     ConvertFrom-CIPolicy -XmlFilePath $WDACPolicyXMLFile -BinaryFilePath $env:USERPROFILE\\Desktop\\$PolicyBinary\n     ```\n \n- Deployment can vary depending on the version of Windows a client is running and whether it is a server or workstation. More detailed steps, including commands, are included in the tutorial in the **References** section. \n- For Windows 11 22H2 and above:\n\t- Use the CiTool to apply policies\n\n- For Windows 11, Windows 10 version 1903 and above, Windows Server 2022 and above:\n\t- Initialize variables.\n\t- Copy the policy binary to the destination folder with the `Copy-Item -Path $PolicyBinary -Destination $DestinationFolder -Force` command.\n\t- Run RefreshPolicy.exe to activate and refresh policies on a managed endpoint.\n\n- All other versions of Windows and Windows Server:\n\t- Initialize variables.\n\t- Copy policy binary to destination folder with `Copy-Item  -Path $PolicyBinary -Destination $DestinationBinary -Force` command. \n\t- Activate and refresh policies using Windows Management interface (WMI). \n\n### Monitoring CMSTP\n\nIf disabling the service is unfeasible in the environment, monitor any processes that call the executable.\n- Monitor process commandlines containing `cmstp.exe`.\n- Monitor changes to directory where cmstp.exe is located, such as renaming or moving files.\n\n## References\n\n- AppLocker | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/applocker-overview>\n- Application Control for Windows | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/design/select-types-of-rules-to-create#windows-defender-application-control-file-rule-levels>\n- Guidance on Creating WDAC Deny Policies | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/design/create-wdac-deny-policy#creating-a-deny-policy-tutorial>\n- Delpoying Windows Defender Application Control (WDAC) policies | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/deployment/wdac-deployment-guide>\n- How Connection Manager Works | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc786431(v=ws.10)>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0005",
                "CM0006",
                "CM0007",
                "CM0008",
                "CM0101",
                "CM0127",
                "CM0130",
                "CM0131",
                "CM0132"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "AppLocker",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/applocker-overview"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Application Control for Windows",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/design/select-types-of-rules-to-create#windows-defender-application-control-file-rule-levels"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Guidance on Creating WDAC Deny Policies",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/design/create-wdac-deny-policy#creating-a-deny-policy-tutorial"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Delpoying Windows Defender Application Control (WDAC) policies",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/deployment/wdac-deployment-guide"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How Connection Manager Works",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc786431(v=ws.10)"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1218.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0118",
            "name": "Revoke Existing Administrator Permissions and Deploy New Administrator Accounts",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0118\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRevoking existing administrator accounts and permissions and deploying new ones blocks an adversary from persistence, lateral movement, and privilege escalation using existing administrator credentials.\n\n## Introduction\n\nAdministrator and other privileged accounts are high priority targets for adversaries for lateral movement and privilege escalation. To evict adversaries out of an environment where they hold privileged access, all privileged accounts need completely new credentials, tokens, and access control.\n\n## Preparation\n\n- Identify all administrator and privileged accounts in the environment.\n- Determine what time interval for changing credentials would cause the least disruption to business operations. \n- Locate the administrator account provisioning policy, if one exists for the organization.\n\n## Risks\n\n- Mass credential resets are disruptive to business operations. Administrators will lose access to their accounts and files for some time before new accounts are set up and configured. Consider deprovisioning and re-provisioning accounts during times during slower times of the workday.\n- Improper configuration or provisioning of accounts may cause all administrators to be locked out of the system and unable to revert changes. Peer review all configurations before rolling out changes.\n\n## Guidance\n\nCredential revocation and assignment can be done through Group Policy Objects (GPOs) for all users or machines in organizational units, or permissions can be revoked manually on each machine. In Active Directory (AD) environments, managing permissions through GPOs is recommended. \n\n### Revoke existing permissions\n\nLocate the administrator account deprovisioning policy. If one does not exist, create a new GPO policy, then edit it:\n- In the policy, navigate to `Computer Configuration > Preferences > Control Panel Settings > Local Users and Groups`.\n- Add a new rule for the local group.\n- Select the `Update` option in the Action field.\n- Select the privilege level from the Group Name dropdown.\n- Add all administrators to the group.\n- Select the `Remove from this group` action. \n- Link the new policy with the Computer organizational unit (OU).\n- If the account was only used for privileged access and can safely be removed from the environment once disabled, delete the account.  \n- Force the GPO update using the `gpupdate /force` command. \n\n### Create and deploy new accounts\n\nTo fully remove an adversary's foothold in a network, it may be necessary to create new accounts for all users whose administrative privileges got revoked in the previous step, so that their accounts are no longer under adversary control but they have all the roles necessary to do their jobs. To create new users, the User Administrator role is required.\n- In Microsoft Entra admin center, navigate to `Identity > Users > All users`.\n- Select `New user > Create new user`.\n- Create the new user by filling out appropriate remaining fields. Repeat as necessary.\n- Assign necessary roles to the user.\n\n## References\n\n- Effective strategies for conducting Mass Password Resets during cybersecurity incidents | <https://techcommunity.microsoft.com/t5/microsoft-security-experts-blog/effective-strategies-for-conducting-mass-password-resets-during/ba-p/4159408>\n- How to create, invite, and delete users | <https://learn.microsoft.com/en-us/entra/fundamentals/how-to-create-delete-users>\n- Adding Domain Users to the Local Administrators Group in Windows | <https://woshub.com/add-domain-users-local-admin-group-gpo/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0033",
                "CM0043",
                "CM0044",
                "CM0063",
                "CM0064",
                "CM0071",
                "CM0111",
                "CM0112"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "techcommunity.microsoft.com",
                    "description": "Effective strategies for conducting Mass Password Resets during cybersecurity incidents",
                    "url": "https://techcommunity.microsoft.com/t5/microsoft-security-experts-blog/effective-strategies-for-conducting-mass-password-resets-during/ba-p/4159408"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How to create, invite, and delete users",
                    "url": "https://learn.microsoft.com/en-us/entra/fundamentals/how-to-create-delete-users"
                },
                {
                    "source_name": "woshub.com",
                    "description": "Adding Domain Users to the Local Administrators Group in Windows",
                    "url": "https://woshub.com/add-domain-users-local-admin-group-gpo/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0119",
            "name": "Disable Autoplay",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0119\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling Autoplay prevents the spread of malware via removable media.\n\n## Introduction\n\nWindows Autoplay enables files to be executed automatically upon the insertion of removable media into a host. This presents an opportunity for malware to be introduced to, or proliferated on, a network. It is important to note that disabling AutoPlay will prevent the the automatic execution of files from removable media but will not prevent users from manually executing said files.\n\n## Preparation\n\n-\tConsider advising users of the change in policy.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\nGPO\n-\tVia the Group Policy Management Console, create or edit a Group Policy Object.\n-\tBrowse to `Computer Configuration>Policies>Administrative Templates>Windows Components>AutoPlay Policies.\n-\tUnder `AutoPlayPolicies`, disable `AutoPlay` and set options to `All Drives`. \n-\tEnable `Set the Default Behavior for AutoRun` and set default behavior to `Do Not Execute Any AutoRun Commands`.  \n-\tApply the policy.\n\nIntune\n-\tSelect `Device Configuration>Profiles` and choose an endpoint protection profile or create a new one.\n-\tFor the profile type, select `Templates` then `Administrative Templates`.  Name and describe the policy in the policy wizard.\n-\tSearch for `AutoPlay` in the search bar and select `Turn off autoplay`. \n-\tSelect `Enable` and specify application to `All Drives`. \n-\tApply the policy.\n\n## References\n\n-\tUsing Caution with USB Drives | <https://www.cisa.gov/news-events/news/using-caution-usb-drives>\n-   Quickly Turn Off AutoPlay Using Intune | <https://www.anoopcnair.com/turn-off-autoplay-using-intune-mem/>\n-   How to Turn Off AutoPlay via Windows Group Policy | <https://www.manageengine.com/vulnerability-management/misconfiguration/os-security-hardening/how-to-turn-off-autoplay-in-windows-via-group-policy.html>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0115"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisa.gov",
                    "description": "Using Caution with USB Drives",
                    "url": "https://www.cisa.gov/news-events/news/using-caution-usb-drives"
                },
                {
                    "source_name": "www.anoopcnair.com",
                    "description": "Quickly Turn Off AutoPlay Using Intune",
                    "url": "https://www.anoopcnair.com/turn-off-autoplay-using-intune-mem/"
                },
                {
                    "source_name": "www.manageengine.com",
                    "description": "How to Turn Off AutoPlay via Windows Group Policy",
                    "url": "https://www.manageengine.com/vulnerability-management/misconfiguration/os-security-hardening/how-to-turn-off-autoplay-in-windows-via-group-policy.html"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1091",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0120",
            "name": "Remove Cron Job",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0120\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving a malicious or manipulated Cron job prevents adversarial objectives of execution, persistence, and privilege escalation.\n\n## Introduction\n\nThe cron daemon is a time-based job scheduler in Unix-like operating systems, including Linux. It is commonly used for automating system maintenance, running scripts, and executing commands at scheduled intervals. However, adversaries can abuse the cron service to establish persistence, escalate privileges, and execute malicious payloads. This countermeasure aims to inform the process of removing a cron job that has been created or manipulated to fulfill an adversary's campaign.\n\n## Preparation\n\n- Take inventory of all Linux systems and note the presence of the Cron utility.\n- Document all Cron jobs currently scheduled on enterprise systems. Identify the user accounts associated with existing Cron jobs and the scripts or commands being executed.\n- Ensure that the Cron job configurations are backed up before making any changes.\n\n## Risks\n\n- Modifying Cron job configurations may disrupt scheduled tasks and impact previously automated system operations. \n- Failure to restrict Cron jobs by following the principle of least privilege creates system vulnerabilities that enable potential execution and persistence objectives by an adversary.\n\n## Guidance\n\n### Removing Malicious Cron Jobs\n\n- Identify suspicious or unauthorized cron jobs by cross-referencing with documented and approved Cron jobs.\n- Remove the Cron jobs that are identified to be malicious or manipulated using the following commands:\n\t- To remove Cron jobs that run at a user level `crontab -r -u <username>`\n\t- To remove system-wide/universal Cron jobs:\n\t\t- `sudo rm /etc/cron.d/<malicious_cron_jobs>`\n\t\t- `sudo sed -i '/<malicious_cron_job>/d' /etc/crontab`\n- Verify Cron jobs have been removed by listing Cron jobs and reviewing crontabs:\n\t- `ls /var/spool/cron/crontabs`\n\t- List Cron jobs for all users:\n\t\t- `crontab -l`\n\t\t- `sudo cat /etc/crontab`\n\t\t- `sudo ls -la /etc/cron.d/`\n\n## References\n\n- Removing crontab Files | <https://docs.oracle.com/cd/E18752_01/html/817-0403/sysrescron-17.html>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0016",
                "CM0030",
                "CM0038",
                "CM0103",
                "CM0109",
                "CM0138",
                "CM0147"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "docs.oracle.com",
                    "description": "Removing crontab Files",
                    "url": "https://docs.oracle.com/cd/E18752_01/html/817-0403/sysrescron-17.html"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1053.003",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0121",
            "name": "Enable Managed Domain Authentication",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0121\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling managed domain authentication blocks or prevents abuse of legacy authentication methods or misconfigured domain infrastructure to achieve initial access or persistence.\n\n## Introduction\n\nMicrosoft provides managed domains via Entra Domain Services, providing services such as Lightweight Directory Access Protocol (LDAP) and Kerberos authentication and manages domain controllers in the cloud. This takes strain off of an organizations system administrators because Microsoft takes over managing and creating required resources. It also allows organizations to move legacy applications to a cloud domain from an on-premises active directory (AD) without having to manage their own cloud-based domain controllers. Domain services integrates with an existing Microsoft Entra tenant (previously Azure AD) and allows users to sign into applications and services with those credentials; authentication is handled via Azure AD, or Entra. \n\nDomain Services does not store credentials in plaintext or hashes in a format compatible with authentication protocols like Kerberos or NT LAN Manager (NTLM) by default. For users to authenticate using their existing credentials, Domain Services need to be enabled with the tenant.\n\nAttackers can abuse legacy applications that don't support modern authentication methods to gain access to resources or user accounts. Self-managed domains may also be misconfigured or resources may not be properly managed, allowing attackers to gain access and potentially escalate their priviliges.\n\n## Preparation\n\n- Ensure proper licensing and certificates are present in the environment. An active Azure subscription and associated Entra tenant are needed to use Microsoft Entra Domain Services. \n- Ensure that account used to enable and synchronize authentication has Application Administrator, Groups Administrator, and Domain Services Contributor roles in the tenant.\n\n## Risks\n\n- Users must reset their passwords for the proper hashes to be stored by Entra Domain Services. Consider alerting users to the password changes to avoid help desk calls. \n- When associating an Azure subscription to a tenant, users who were assigned roles using Azure Role-Based Access Control (RBAC), service administrators and co-administrators will lose access. \n- This process is elaborate and resource-intensive, which may introduce additional risks or downtime during remediation of an incident. Moving to a managed domain may be a task for after adversary eviction.\n\n## Guidance\n\n### Set up Domain Services (if not already set up)\n\n- Associate Azure subscription with Microsoft Entra tenant.\n- In the Microsoft Entra admin center, navigate to `Domain Services > Microsoft Entra Domain Services > Create Microsoft Entra Domain Services`.\n- Select Azure subscription and resource group to be associated with the domain. Specify a Domain Name Server (DNS) name. \n- Choose Azure region for the managed domain and an appropriate SKU (can be changed later; if unsure, default to \"Standard\").\n- Select \"Review + create\". All users in Microsoft Entra ID (formerly called Azure AD) will be synchronized into the managed domain. \n\n### Set up credential synchronization with Microsoft Entra ID\n\nThe process for synchronizing credentials is different for users in the cloud versus users in the on-premises directory. Ensure that synchronization is set up for all user groups.\n\n- For cloud users, expire all passwords to force resets on log-in.\n- For on-premises users, enable synchronization using the Synchronization Service in Microsoft Entra Connect. Repeat for each AD forest in the environment.\n\n## References\n\n- What is Microsoft Entra Domain Services? | <https://learn.microsoft.com/en-us/entra/identity/domain-services/overview>\n- Tutorial: Create and configure a Microsoft Entra Domain Services managed domain | <https://learn.microsoft.com/en-us/entra/identity/domain-services/tutorial-create-instance>\n- How objects and credentials are synchronized in a Microsoft Entra Domain Services managed domain | <https://learn.microsoft.com/en-us/entra/identity/domain-services/synchronization>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0003",
                "CM0018",
                "CM0033",
                "CM0063",
                "CM0071",
                "CM0079",
                "CM0111",
                "CM0142",
                "CM0145"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "What is Microsoft Entra Domain Services?",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/domain-services/overview"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Tutorial: Create and configure a Microsoft Entra Domain Services managed domain",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/domain-services/tutorial-create-instance"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How objects and credentials are synchronized in a Microsoft Entra Domain Services managed domain",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/domain-services/synchronization"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1199",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0122",
            "name": "Restrict SYSVOL Credential Theft",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0122\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nRestricting access to credentials stored in SYSVOL folders prevents adversaries from stealing or misusing sensitive data embedded in Group Policy Preferences (GPP) thereby limiting their ability to escalate privileges, maintain persistence, and/or perform lateral movement using the acquired credentials.\n\n## Introduction\n\nActive directory environments are a prime target for organized threat groups, as compromising SYSVOL can grant attackers access to sensitive credentials and configurations. The SYSVOL shared folder contains important components such as Group Policy Objects (GPOs), Group Policy Preference (GPP) files, and logon/logoff scripts, which are critical for domain authentication.\n\n## Preparation\n\n* **Backup SYSVOL:** Ensure a reliable backup of SYSVOL exists before making any changes to prevent unintended disruptions.\n\n## Risks\n\n- Incorrect modification of SYSVOL contents or permissions can lead to disruptions in Group Policy Object (GPO) functionality.\n- Failure to audit and remove unsecured credentials can lead to the compromise of privileged accounts.\n- Altering SYSVOL or Netlogon folder permissions without proper preparation can lead to disruptions in domain controller services.\n\n## Guidance\n\n### Restrict Credential Exposure in SYSVOL\n\n1. **Identify and Remove Embedded Credentials:**\n    \n    - Search for `.XML` files in SYSVOL that may contain embedded credentials used in Group Policy Preferences (GPPs).\n    - Delete any credentials found in these files, particularly those that use `cpassword` attributes, which store password data in an insecure format.\n    - Ensure that administrative accounts and sensitive services do not rely on embedded credentials in GPPs.\n2. **Secure SYSVOL Access Permissions:**\n    \n    - Audit access control lists (ACLs) on SYSVOL and Netlogon shared folders.\n    - Restrict access to SYSVOL to only necessary accounts and services, such as domain admins and system services.\n    - Review and minimize the number of users with the ability to edit GPOs that affect SYSVOL content.\n3. **Utilize Protected Users Security Group:**\n    \n    - Add privileged accounts to the **Protected Users** security group to prevent these accounts from being cached in memory or stored in SYSVOL with embedded credentials.\n    - This group prevents members from using legacy authentication mechanisms, reducing exposure to attacks on SYSVOL or GPP-stored credentials.\n4. **Monitor and Audit SYSVOL Changes:**\n    \n    - Enable logging of changes to SYSVOL directories and monitor for unauthorized modifications.\n    - Regularly audit SYSVOL for new GPPs or other policies that might store credentials or introduce other vulnerabilities. Pay particular attention to GPP .xml files.\n5. **Implement Privileged Access Management (PAM):**\n    \n    - Use a Privileged Access Management (PAM) solution to better control access to privileged accounts and sensitive data within SYSVOL.\n    - Ensure all privileged access is granted for limited timeframes and with proper monitoring, reducing the chance of credentials being misused.\n\n### Audit SYSVOL Content\n\n* **Continuous Auditing:** Establish a regular cadence for auditing SYSVOL content, focusing on GPP files and any potentially exposed credentials.\n* **Remove Obsolete Files:** Delete any unused or obsolete files and GPOs within SYSVOL that could serve as attack vectors.\n\n## References\n\n- How to Rebuild the SYSVOL Tree and its Content in a Domain | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/group-policy/rebuild-sysvol-tree-and-content-in-a-domain>\n\n- Securing SYSVOL: Threats, Protection, and Recovery | <https://www.cayosoft.com/sysvol/>\n\n- Privilege Escalation via Group Policy Preferences (GPP) | <https://www.mindpointgroup.com/blog/privilege-escalation-via-group-policy-preferences-gpp>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0018",
                "CM0069",
                "CM0102",
                "CM0107",
                "CM0144"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How to Rebuild the SYSVOL Tree and its Content in a Domain",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/group-policy/rebuild-sysvol-tree-and-content-in-a-domain"
                },
                {
                    "source_name": "www.cayosoft.com",
                    "description": "Securing SYSVOL: Threats, Protection, and Recovery",
                    "url": "https://www.cayosoft.com/sysvol/"
                },
                {
                    "source_name": "www.mindpointgroup.com",
                    "description": "Privilege Escalation via Group Policy Preferences (GPP)",
                    "url": "https://www.mindpointgroup.com/blog/privilege-escalation-via-group-policy-preferences-gpp"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1484.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1552.006",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1615",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0123",
            "name": "Remove Malicious Domain Trust from Tenant",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0123\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving malicious domain trusts from the tenant prevents an adversary from achieving initial access or performing discovery by abusing trusted domains.\n\n## Introduction\n\nA domain trust is a bridge between two separate domains or forests that allows users from the two domains to access shared resources by allowing authentication traffic to flow between them. Trust relationships between domains allow the requested domain to see the requestor as a service, and not validate the user asking for access as vigorously (it trusts the domain that issued the referral). \n\nMany organizations still maintain trusts established years ago, which opens them up to adversaries who may compromise external trusted domains. Adversaries often leave implants and malicious code in the often less-secure trusted domains for future re-compromise instead of leaving traces in the main target domain. Domain trusts also allow adversaries to move laterally between domains via compromised accounts, escalating their priviliges until they reach their target.\n\n## Preparation\n\n- Enumerate all trusts in the current domain, including trusts that the trusted domains have; create a map of domain trusts.\n- Audit resources provided by domain trusts. \n- Ensure the account performing domain trust operations has at least Domain Administrator permissions.\n\n## Risks\n\n- Removing domain trusts may cause users to lose access to shared resources. Consider auditing resources provided by a shared trust and weighing risk of continued trust versus recompromise.\n\n## Guidance\n\n### Remove Domain Trust from On-Premises Domains\n\n- On a management workstation for the domain, navigate to `Start > Administrative Tools > Active Directory Domains and Trusts`.\n- Select the domain name, then navigate to `Properties > Trusts`.\n\t- To remove incoming trusts, select `Domains that trust this domain (incoming trusts)`, select the trust, and select `Remove`.\n\t- To remove outgoing trusts, select `Domains trusted by this domain (outgoing trusts)` select the trust, and select `Remove`.\n\n### Remove Domain Trust from Domain Services\n\n- In the Microsoft Entra admin center, navigate to `Microsoft Entra Domain Services` and select the domain.\n- Select `Trusts`, select the approproate trust to remove, and select `Remove`. A password may be required. \n\n### Monitor for Domain Trust Enumeration Techniques\n\n- Process calls to BloodHound or SharpHound.\n- .NET scripts containing `([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).GetAllTrustRelationships()` or `([System.DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest()).GetAllTrustRelationships()`.\n- Win32 API calls containing `DsEnumerateDomainTrusts()`.\n- Process commandlines containing `objectClass=trustedDomain` or `Get-DomainTrust`.\n\n## References\n\n- A Guide to Attacking Domain Trusts | <https://harmj0y.medium.com/a-guide-to-attacking-domain-trusts-ef5f8992bb9d>\n- How Domain and Forest Trusts Work | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc773178(v=ws.10)>\n- How trust relationships work for forests in Active Directory | <https://learn.microsoft.com/en-us/entra/identity/domain-services/concepts-forest-trust>\n- Trust Technologies | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc759554(v=ws.10)>\n- Remove a Trust | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc771137(v=ws.11)>\n- Tutorial: Create a two-way forest trust in Microsoft Entra Domain Services with an on-premises domain | <https://learn.microsoft.com/en-us/entra/identity/domain-services/tutorial-create-forest-trust>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0023",
                "CM0031",
                "CM0063",
                "CM0134",
                "CM0145"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "harmj0y.medium.com",
                    "description": "A Guide to Attacking Domain Trusts",
                    "url": "https://harmj0y.medium.com/a-guide-to-attacking-domain-trusts-ef5f8992bb9d"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How Domain and Forest Trusts Work",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc773178(v=ws.10)"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How trust relationships work for forests in Active Directory",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/domain-services/concepts-forest-trust"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Trust Technologies",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc759554(v=ws.10)"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Remove a Trust",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc771137(v=ws.11)"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Tutorial: Create a two-way forest trust in Microsoft Entra Domain Services with an on-premises domain",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/domain-services/tutorial-create-forest-trust"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1199",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1482",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0124",
            "name": "Disable On-Premise Active Directory (AD) Accounts with Privileged Roles in Entra ID",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0124\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling privileged on-premises Active Directory (AD) accounts in Entra ID prevents an adversary's attempts to achieve persistence or privilege escalation by abusing administrator or domain accounts.\n\n## Introduction\n\nAn on-premises domain is managed by the organization, as opposed to a managed domain via Microsoft Entra Domain Services, which is managed by Microsoft. On-premises domains are often integrated with Entra ID for reliability, security, and cost optimization. Due to integration, users on-premises use their same credentials to authenticate with Entra ID and the managed domain. \n\nAdversaries may use compromised on-premises administrator accoutns to authenticate with Entra ID and exploit resources available in the managed domain.\n\n## Preparation\n\n- Identify all on-premises AD accounts with privileged roles in Entra ID to be disabled.\n- Identify organization's standard account de-provisioning procedure for administrator and other privileged accounts. \n- Identify any emergency access accounts.\n\n## Risks\n\n- Administrators in the on-premises domain will not be able to access their accounts. In the case that all administrators are locked out, consider using emergency access accounts to restore access. The default *support* and *cyberx* accounts may be used.\n- Accounts removed from on-premises domains do not automatically get removed from Entra ID. If an account needs to be removed from both locations, remove it from Entra ID as well.\n\n## Guidance\n\nUsers can be removed or disabled manually through PowerShell or removed from the administrator groups using Group Policy Objects (GPOs). This section provides guidance on disabling administrator accounts in both an on-premises domain and in Entra ID. \n\nTo find all users with an administrator (or other privileged) role, navigate to `Identity > Roles & admins > Roles & admins` in the Microsoft Entra admin center and select the desired role. The `Assignments` page will list all the users with that role. \n\n### Manually disable on-premises users \n\nThese commands require administrator permissions. \n\n- Run `Disable-ADAccount -Identity <account_to_disable>`.\n- Reset that user's password twice in the AD. \n\n### Manually disable Entra ID users\n\nEntra ID provides steps both to remove roles from a user account to revoke their administrator privileges, or to delete the account entirely. Defer to the organazation's account de-provisioning procedures. \n\n- To remove an administrator role:\n\t- Open Microsoft Entra admin center, navigate to `Identity > Users > All users`.\n\t- Select the user to remove the role from and select `Assigned Roles`.\n\t- Select the role to remove and click `Remove assignment`.\n\t\n- To delete a user account:\n\t- Open Microsoft Entra admin center, navigate to `Identity > Users > All users`.\n\t- Select the user to delete, select `Delete`. \n\n### Remove users from privileged accounts using Group Policy\n\nLocate the administrator account deprovisioning policy. If one does not exist, create a new GPO policy, then edit it:\n- In the policy, navigate to `Computer Configuration > Preferences > Control Panel Settings > Local Users and Groups`.\n- Add a new rule for the local group.\n- Select the `Update` option in the Action field.\n- Select the privilege level from the Group Name dropdown.\n- Add all administrators to the group.\n- Select the `Remove from this group` action. \n- Link the new policy with the Computer organizational unit (OU).\n- If the account was only used for privileged access and can safely be removed from the environment once disabled, delete the account.  \n- Force the GPO update using the `gpupdate /force` command.\n\n## References\n\n- Manage emergency access accounts in Microsoft Entra ID | <https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/security-emergency-access>\n- What is Microsoft Entra Domain Services? | <https://learn.microsoft.com/en-us/entra/identity/domain-services/overview>\n- Revoke user access in Microsoft Entra ID | <https://learn.microsoft.com/en-us/entra/identity/users/users-revoke-access#revoke-access-for-a-user-in-the-hybrid-environment>\n- Add and manage admin accounts | <https://learn.microsoft.com/en-us/entra/external-id/customers/how-to-manage-admin-accounts>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0033",
                "CM0043",
                "CM0060",
                "CM0063",
                "CM0071",
                "CM0084"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Manage emergency access accounts in Microsoft Entra ID",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/security-emergency-access"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "What is Microsoft Entra Domain Services?",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/domain-services/overview"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Revoke user access in Microsoft Entra ID",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/users/users-revoke-access#revoke-access-for-a-user-in-the-hybrid-environment"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Add and manage admin accounts",
                    "url": "https://learn.microsoft.com/en-us/entra/external-id/customers/how-to-manage-admin-accounts"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0125",
            "name": "Reset and Monitor adminCount Attribute",
            "subtype": "Refresh, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0125\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nResetting and monitoring the adminCount attribute blocks or prevents an adversary's attempts to achieve persistence or privilege escalation by abusing properties of adminCount.\n\n## Introduction\n\nThe adminCount attribute indicates that an object's access control lists (ACLs) have been changed by the system to a more secure setting since it is (or was) a member of a priviliged or administrative group. On privileged user accounts, this attribute is set to 1. That disables inheritance on that object or account, and sets the security to be governed by the AdminSDHolder object. AdminSDHolder runs the SDProp process every hour to reset permissions to the configured set. If an adversary edits those permissions, they may get reverted back to a compromised state even after attempted remediation.\n\nAn adversary can modify the value of the adminCount attribute on any account to prevent password resets using default means, making it more difficult to remove their access to that account. They may also modify the attribute for legitimate administrator accounts to prevent system administrators from performing their tasks successfully.\n\n## Preparation\n\n- Review access control policies and determine which accounts or objects should have adminCount set to 1.\n\n## Risks\n\n- Changing the adminCount attribute to 1 may affect inheritance of accounts. Be aware of what accounts may need to inherit permissions from organizational methods, as implementation of the inheritance may be difficult.\n\n## Guidance\n\nFind all user accounts with adminCount set to 1 with the following command: `Get-aduser -Filter *  -prop admincount, Canonicalname | where admincount -eq 1 | select Name, SamAccountName, AdminCount, Canonicalname`.\n\n- For all accounts that should not have this attribute set, reset it to 0.\n- For any accounts that should have the attribute set but are not in the list, reset it to 1.\n\n### Monitor for attempts to reset the adminCount attribute from PowerShell\n\n- Monitor all process commandlines containing `admincount`.\n- Monitor all process commandlines containing `set-aduser`.\n\n## References\n\n- Admin-Count attribute | <https://learn.microsoft.com/en-us/windows/win32/adschema/a-admincount>\n- Learn to adjust the AdminCount attribute in protected accounts | <https://www.techtarget.com/searchwindowsserver/tutorial/Learn-to-adjust-the-AdminCount-attribute-in-protected-accounts>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0018",
                "CM0031",
                "CM0033",
                "CM0063",
                "CM0085",
                "CM0139"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Admin-Count attribute",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/adschema/a-admincount"
                },
                {
                    "source_name": "www.techtarget.com",
                    "description": "Learn to adjust the AdminCount attribute in protected accounts",
                    "url": "https://www.techtarget.com/searchwindowsserver/tutorial/Learn-to-adjust-the-AdminCount-attribute-in-protected-accounts"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1212",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0126",
            "name": "Reset Credentials for Local Administrator Accounts Twice",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0126\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting credentials for local administrator accounts twice blocks or prevents an adversary's initial access and persistence via local administrator accounts.\n\n## Introduction\n\nChanging credentials of privileged accounts can remove adversary footholds in the network, but some operating systems store hashes of both the current and previous passwords. To flush all compromised credentials, two resets are required. \n\nAdversaries may use pass-the-hash or ticket attacks to grab hashes and continue authenticating even through a password reset.\n\n## Preparation\n\n- Identify all local administrator accounts. \n- Identify the organization's password policy.\n\n## Risks\n\n- Lockout of local adminstrative accounts is likely if proper documentation of password resets is not conducted or policy is not followed.\n\n## Guidance\n\nThe password does not need time to replicate through the network and resets can be done right after the other. \n\n- Reset the password manually for all local administrator accounts. This can be done via PowerShell:\n\t- The `net user <username> *` command prompts a reset for the provided account. The command must be run on the machine that has the account.\n\t- If Local Administrator Password Solution (LAPS) is enabled, the `Reset-LapsPassword []` cmdlet will immediately reset the password of the account.  \n- Via the Microsoft Entra administrator center:\n\t- Navigate to `Identity > Users > All users` and select the account of the local administrator.\n\t- Select `Reset Password`.\n\n## References\n\n- Reset a user's password | <https://learn.microsoft.com/en-us/entra/fundamentals/users-reset-password-azure-portal>\n- Reset-LapsPassword | <https://learn.microsoft.com/en-us/powershell/module/laps/reset-lapspassword?view=windowsserver2022-ps>\n- Get started with Windows LAPS and Microsoft Entra ID | <https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-scenarios-azure-active-directory#update-a-password-in-microsoft-entra-id>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0050",
                "CM0060",
                "CM0061",
                "CM0063",
                "CM0071",
                "CM0084",
                "CM0128",
                "CM0145"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Reset a user's password",
                    "url": "https://learn.microsoft.com/en-us/entra/fundamentals/users-reset-password-azure-portal"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Reset-LapsPassword",
                    "url": "https://learn.microsoft.com/en-us/powershell/module/laps/reset-lapspassword?view=windowsserver2022-ps"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Get started with Windows LAPS and Microsoft Entra ID",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-scenarios-azure-active-directory#update-a-password-in-microsoft-entra-id"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0127",
            "name": "Disable Microsoft XML Core Services (MSXSL.exe)",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0127\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling Microsoft XML Core Services (MSXSL.exe) prevents an adversary's attempts at defense evasion and arbitrary code execution by abusing the MSXSL.exe utility.\n\n## Introduction\n\nThe MSXSL utility is an older Windows utility for converting files (usually XML spreadsheets) into other formats such as plaintext or HyperText Markup Language (HTML). An extensible stylesheet language transformation (XSLT) file provides the transformation specifications to the utility. MSXSL takes two arguments: a file to transform and a file with transformation instructions. \n\nAdversaries can abuse the utility to execute code containing an `ms:script` element, such as Visual Basic scripts, JScript, and Component Object Model (COM) objects. The file arguments can be URL links to adversary-owned infrastructure and are not required to be stored on disk. This may be used as a technique to bypass application controls, since adversaries only need to get a very small utility signed by Microsoft onto disk, and can then use that to load additional tools or establish persistence.\n\n## Preparation\n\n- Identify if MSXSL is necessary for business operations.\n- Identify any existing Group Policy Objects (GPOs) for software or executable restrictions. \n- If creating policies using the Windows Defender Application Control (WDAC) on versions of Windows Server 2022 or above, Windows 10 version 1903 and above, or Windows 11 versions 22H2 or below, ensure the WDAC policy refresh tool is available on all managed endpoints.\n\n## Risks\n\n- Logging process commandlines may be logging-intensive. Consider scope and filters for logging and ensure that proper space is alloted to logs. \n- Renaming, changing, or moving MSXSL.exe may evade detection,  Applocker, or WDAC policies. Having several types of rules active simultaneously (e.g. a hash rule and a path rule) can mitigate some risk, since the rules protect against different behaviors.\n\n## Guidance\n\nIf disabling msxls.exe is not feasible in the environment, instead restrict and monitor all calls to the executable. An adversary may install or bring msxsl.exe with them to achieve proxy execution even if the binary wasn't originally in the environment. Keeping detection rules active even after removing the binary can help alert on future recompromises via MSXSL. If msxsl.exe is not used by the organization or not critical to business operations, disable and remove it. \n\n### Remove the utility\n\nIf feasible for the organization, MSXSL can be uninstalled from endpoints via control panel. \n\n### Disable using Applocker\n\n- Implement Applocker's default allow rules regarding executables.\n\t- In the Group Policy Management Console (GPMC) navigate to `Security Settings > Application Control Policies > AppLocker > Executable Rules`.\n\t- Select `Executable Rules` and enable `Create Default Rules`.\n- Define a deny rule for `msxls.exe`. \n- Alternatively, block locations of the MSXSL.exe executable (all locations must be blocked). Take care not to block any legitimate applications during this process. \n\n### Disable using Windows Defender Application Control\n\nWDAC can be configured for both allow and deny policies based on organizational needs. When creating deny policies, Microsoft requires the inclusion of \"Allow All\" rules in both kernel and user mode sections to avoid blocking all software (some explicitly and some implicitly, since there are no rules to allow it). Microsoft provides an AllowAll policy template. This template will not affect any explicit allow rules already in place.  \n\nPolicies can be created using PowerShell or via the WDAC wizard.\n\n| Rule Type | PowerShell Command |\n|-----------|--------------------|\n| Software Publisher-based | `$DenyRules += New-CIPolicyRule -Level FilePublisher -DriverFilePath msxls.exe -Fallback SignedVersion,Publisher,Hash -Deny` |\n| Software attribute-based | `$DenyRules += New-CIPolicyRule -Level FileName -DriverFilePath msxls.exe -Fallback Hash -Deny` |\n| Hash-based | `$DenyRules += New-CIPolicyRule -Level Hash -DriverFilePath msxls.exe -Deny` | \n\nMerge the deny rules with the AllowAll template policy:\n```\n$DenyPolicy = <path_to_deny_policy_destination>\n$AllowAllPolicy = $Env:windir + \"\\schemas\\CodeIntegrity\\ExamplePolicies\\AllowAll.xml\"\nMerge-CIPolicy -PolicyPaths $AllowAllPolicy -OutputFilePath $DenyPolicy -Rules $DenyRules\nSet-CiPolicyIdInfo -FilePath $DenyPolicy -PolicyName \"Deny MSXSL\" -ResetPolicyID\n```\n\nDeploy WDAC policies:\n\n- Convert XML policy into binary. An example PowerShell command to do so is listed below. Ensure that the `$WDACPolicyXMLFile` variable points to the location of the XML policy file. \n    ```\n    ## Update the path to your WDAC policy XML\n     $WDACPolicyXMLFile = $env:USERPROFILE + \"\\Desktop\\MyWDACPolicy.xml\"\n     [xml]$WDACPolicy = Get-Content -Path $WDACPolicyXMLFile\n     if (($WDACPolicy.SiPolicy.PolicyID) -ne $null) ## Multiple policy format (For Windows builds 1903+ only, including Server 2022)\n     {\n         $PolicyID = $WDACPolicy.SiPolicy.PolicyID\n         $PolicyBinary = $PolicyID+\".cip\"\n     }\n     else ## Single policy format (Windows Server 2016 and 2019, and Windows 10 1809 LTSC)\n     {\n         $PolicyBinary = \"SiPolicy.p7b\"\n     }\n    ## Binary file will be written to your desktop\n     ConvertFrom-CIPolicy -XmlFilePath $WDACPolicyXMLFile -BinaryFilePath $env:USERPROFILE\\Desktop\\$PolicyBinary\n     ```\n \nDeployment can vary depending on the version of Windows a client is running and whether it is a server or workstation. \n\n- For Windows 11 22H2 and above:\n\t- Use the CiTool to apply policies.\n- For Windows 11, Windows 10 version 1903 and above, Windows Server 2022 and above:\n\t- Initialize variables.\n\t- Copy the policy binary to the destination folder.\n\t- Run RefreshPolicy.exe to activate and refresh policies on a managed endpoint.\n- All other versions of Windows and Windows Server:\n\t- Initialize variables.\n\t- Copy policy binary to destination folder. \n\t- Activate and refresh policies using Windows Management Interface (WMI).  \n\n### Monitor MSXSL.exe\n\nIf MSXSL is commonly used in the environment, examine common precursor or following commands to `msxsl.exe` to create exclusion rules or lower priority alerts for legitimate behavior.\n\n- Monitor all calls to msxsl.exe not containing the `-o` flag.\n- Monitor execution of msxsl.exe where a valid URL or IP address is in the commandline instead of a local file name.\n\n## References\n\n- Detecting MSXSL Abuse in the Wild | <https://redcanary.com/blog/threat-detection/detecting-msxsl-attacks/>\n- MSXSL Security Overview | <https://learn.microsoft.com/en-us/previous-versions/windows/desktop/ms754611(v=vs.85)>\n- MSXSL.EXE AND WMIC.EXE -- A Way to Proxy Code Execution | <https://medium.com/@threathuntingteam/msxsl-exe-and-wmic-exe-a-way-to-proxy-code-execution-8d524f642b75>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0005",
                "CM0006",
                "CM0007",
                "CM0008",
                "CM0101",
                "CM0117",
                "CM0130",
                "CM0131",
                "CM0132"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "redcanary.com",
                    "description": "Detecting MSXSL Abuse in the Wild",
                    "url": "https://redcanary.com/blog/threat-detection/detecting-msxsl-attacks/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "MSXSL Security Overview",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/desktop/ms754611(v=vs.85)"
                },
                {
                    "source_name": "medium.com",
                    "description": "MSXSL.EXE AND WMIC.EXE -- A Way to Proxy Code Execution",
                    "url": "https://medium.com/@threathuntingteam/msxsl-exe-and-wmic-exe-a-way-to-proxy-code-execution-8d524f642b75"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1059",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1220",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0128",
            "name": "Reset Credentials for Global and Domain Administrator Accounts Twice",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0128\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting credentials for global and domain administrators twice prevents an adversary's persistence using compromised global or domain administrator accounts.\n\n## Introduction\n\nGlobal and domain administrators have elevated privileges in a business environment, making them valuable targets for attackers. Changing credentials of privileged accounts can remove adversary footholds in the network, but some operating systems store hashes of both the current and previous passwords. To flush all compromised credentials, two resets are required. \n\nAdversaries may use pass-the-hash or ticket attacks to grab hashes and continue authenticating even through a password reset.\n\n## Preparation\n\n- Identify all global and domain administrator accounts. Microsoft recommends not having more than 5 global administrators; this list should not be long. \n- Identify the organization's password policy.\n\n## Risks\n\n- Only Global Administrators or Privileged Authentication Administrators can change passwords for Global Administrators. Ensure that the account used for password resets has at least those permissions. \n- Lockouts from administrative accounts is possible if the organization's password reset policies are not followed or in cases that proper documentation of password resets is not conducted.\n\n## Guidance\n\nThe password does not need time to replicate through the network and resets can be done right after the other. \n\n- Reset the password manually for all global and domain administrator accounts. \n- Via the Microsoft Entra administrator center, navigate to `Identity > Users > All users` and select the account of the global or domain administrator.\n- Select `Reset Password`.\n\n## References\n\n- Global Administrator | <https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference#global-administrator>\n- Privileged roles and permissions in Microsoft Entra ID (preview) | <https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/privileged-roles-permissions>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0061",
                "CM0063",
                "CM0071",
                "CM0084",
                "CM0126",
                "CM0145"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Global Administrator",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference#global-administrator"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Privileged roles and permissions in Microsoft Entra ID (preview)",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/privileged-roles-permissions"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0129",
            "name": "Eliminate Hidden Registry Keys",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0129\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nEliminating hidden registry keys will eliminate adversarial attempts to evade defenses and achieve persistence by hiding malicious code in the registry.\n\n## Introduction\n\nAdversaries commonly attempt to persist in the Windows registry by creating or modifying registry keys. Persistence via registry keys enables an adversary to execute code and persist through system reboots. These persistence techniques typically attempt to masquerade as legitimate registry keys. \n\nThis countermeasure is specifically intended to address persistence via hidden registry keys. Hidden keys are prepended with a NULL byte (\\x00) to impede detection and response. Neither regedit.exe nor reg.exe can view registry keys containing NULL bytes.\n\n## Preparation\n\n-\tEnsure an effective backup strategy.\n\n## Risks\n\nThe Windows registry is a critical database that stores configuration settings for the operating system. Eliminating registry keys can introduce risk and in some instances, render a system unusable. Take care to analyze the registry key in question to minimize the risk of operational disruption. To further offset this risk, ensure a recent backup is available before eliminating registry keys.\n\n## Guidance\n\n-\tConsider implementing detection logic and continually monitor attempts to modify the registry. At a minimum, consider the following registry paths:\n\n    - `HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run`\n    - `HKU\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run`\n    - `HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run`\n    - `HKLM\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run`\n    - `HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run`\n    - `HKU\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run`\n    - `\\REGISTRY\\MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Run`\n    - `\\REGISTRY\\USER\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run`\n    - `\\REGISTRY\\MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Run`\n    - `\\REGISTRY\\MACHINE\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run`\n    - `\\REGISTRY\\MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run`\n    - `\\REGISTRY\\MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run`\n\n-\tIf malicious activity in the registry is suspected, attempt to assess the run keys. Attempts to hide a registry key with a preceding NULL byte will result in the following error: \"Cannot display: Error reading the value's contents.\"\n-\tIdentify and remove the registry key:\n    - Microsoft provides a command-line [utility](https://learn.microsoft.com/en-us/sysinternals/downloads/regdelnull) called 'RegDelNull' in the Sysinternals suite that enables defender to search for and delete registry keys that contain embedded NULL characters. \n        - Utilize RegDelNull to delete null-embedded keys: `regdelnull <Registry_Key> [-s]`.\n    -   Huntress Labs provides two [utilities](https://support.huntress.io/hc/article_attachments/4404012538515) for identifying and removing hidden registry keys.\n        - GetRegKey displays all values in a registry key: `GetRegKey.exe <Registry_Key>`.\n        - DelRegValue deletes a single registry value: `DelRegValue <Registry_Key>`.\n\n## References\n\n-\tHiding Registry Keys with PSReflect | <https://posts.specterops.io/hiding-registry-keys-with-psreflect-b18ec5ac8353>\n-\tHow to Evade Detection: Hiding in the Registry | <https://tripwire.com/state-of-security/evade-detection-hiding-registry>\n-\tManually Remediate Kovter Hidden Registry Values | <https://support.huntress.io/hc/en-us/articles/4404012536979-Manually-Remediate-Kovter-Hidden-Registry-Values>\n- RegDelNullv1.11 | <https://learn.microsoft.com/en-us/sysinternals/downloads/regdelnull>\n- Manually Remediate Kovter Hidden Registry Values | <https://support.huntress.io/hc/en-us/articles/440401-Manually-Remediate-Kovter-Hidden-Registry-Values>\n- Huntress Labs Utilities | <https://support.huntress.io/hc/article_attachments/4404012538515>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "posts.specterops.io",
                    "description": "Hiding Registry Keys with PSReflect",
                    "url": "https://posts.specterops.io/hiding-registry-keys-with-psreflect-b18ec5ac8353"
                },
                {
                    "source_name": "tripwire.com",
                    "description": "How to Evade Detection: Hiding in the Registry",
                    "url": "https://tripwire.com/state-of-security/evade-detection-hiding-registry"
                },
                {
                    "source_name": "support.huntress.io",
                    "description": "Manually Remediate Kovter Hidden Registry Values",
                    "url": "https://support.huntress.io/hc/en-us/articles/4404012536979-Manually-Remediate-Kovter-Hidden-Registry-Values"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "RegDelNullv1.11",
                    "url": "https://learn.microsoft.com/en-us/sysinternals/downloads/regdelnull"
                },
                {
                    "source_name": "support.huntress.io",
                    "description": "Manually Remediate Kovter Hidden Registry Values",
                    "url": "https://support.huntress.io/hc/en-us/articles/440401-Manually-Remediate-Kovter-Hidden-Registry-Values"
                },
                {
                    "source_name": "support.huntress.io",
                    "description": "Huntress Labs Utilities",
                    "url": "https://support.huntress.io/hc/article_attachments/4404012538515"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1112",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1547.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0130",
            "name": "Disable or Restrict Microsoft Build Engine (MSBuild.exe)",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0130\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling Microsoft Build Engine (MSBuild) prevents an adversary's attempts to evade defenses and deliver malware using MSBuild.\n\n## Introduction\n\nThe Microsoft Build Engine (MSBuild.exe) is used to compile .NET code and other programs in the absence of the Visual Studio integrated development environment (IDE), as well as under the hood of Visual Studio itself. Beginning with Visual Studio 2019, some versions MSBuild Tools are considered obsolete if the IDE is present in the environment. \n\nAdversaries can use MSBuild to load fileless malware onto systems and evade detection. Since MSBuild is signed by Microsoft, attackers are using legitimate system applications to load and execute their malware, leaving no traces of initial compromise. Adversaries have used MSBuild for installation of remote access trojans (RATs), credential stealers, and Cobalt Strike beacons.\n\n## Preparation\n\n- Identify how MSBuild is used in the organization. \n- Determine the expected use case of .NET code within the organization.\n- Identify if and how Visual Studio is used in the environment. Identify roles that need to use Visual Studio to perform their job. \n- Ensure that the system is configured to properly log 'process creation' events. Enable the **Audit Process Creation** policy in the Group Policy Management Console.\n\n## Risks\n\n- MSBuild functionality is required for business operations in organizations where Visual Studio is used or .NET code needs to be built from source. Disabling MSBuild in these cases is detrimental. Consider restricting and monitoring MSBuild instead. \n- Renaming, changing, or moving MSBuild.exe may evade detection,  Applocker, or WDAC policies. Having several types of rules active simultaneously (e.g. a hash rule and a path rule) can mitigate some risk, since the rules protect against different behaviors.\n\n## Guidance\n\n### Restricting MSBuild\n\n- Restrict running MSBuild only to users and roles that need it to perform their jobs. \n\t- Navigate to `Identity > Applications > Enterprise Applications > All applications` in the Microsoft Entra admin center.\n\t- Select Visual Studio. \n\t- On the application's Overview page, navigate to `Manage > Properties` and enable the `Assignment required?` setting.\n\t- under `Manage`, navigate to `Users and groups > Add user/group > Users`. \n\t- Select `None selected` and add users from the selector pane that opens. Select `Assign` to complete assignment. \n\n### Monitoring MSBuild\n\n- Monitor all calls to `MSBuild.exe` via commandline or PowerShell. The `Get-WinEvent` cmdlet can be leveraged to query the Windows Event Log for events related to the execution of MSBuild.exe.\n- Monitor for .NET utility `dotnet build` which is a wrapper for MSBuild.  \n\nIf disabling is feasible, then MSBuild can be removed from the system or disabled via Applocker or Windows Defender Application Control (WDAC). Microsoft recommends this approach. \n\n### Disable via Applocker\n\n- Implement Applocker's default allow rules regarding executables.\n\t- In the Group Policy Management Console (GPMC) navigate to `Security Settings > Application Control Policies > AppLocker > Executable Rules`.\n\t- Select `Executable Rules` and enable `Create Default Rules`.\n- Define a deny rule for `MSBuild.exe`. \n- Alternatively, block all file paths where the MSBuild.exe executable is located.\n\n### Disable via Windows Defender Application Control\n\nWDAC can be configured for both allow and deny policies based on organizational needs. When creating deny policies, Microsoft requires the inclusion of \"Allow All\" rules in both kernel and user mode sections to avoid blocking all software (some explicitly and some implicitly, since there are no rules to allow it). Microsoft provides an AllowAll policy template. This template will not affect any explicit allow rules already in place.  \n\nPolicies can be created using PowerShell or via the WDAC wizard.\n\n| Rule Type | PowerShell Command |\n|-----------|--------------------|\n| Software Publisher-based | `$DenyRules += New-CIPolicyRule -Level FilePublisher -DriverFilePath MSBuild.exe -Fallback SignedVersion,Publisher,Hash -Deny` |\n| Software attribute-based | `$DenyRules += New-CIPolicyRule -Level FileName -DriverFilePath MSBuild.exe -Fallback Hash -Deny` |\n| Hash-based | `$DenyRules += New-CIPolicyRule -Level Hash -DriverFilePath MSBuild.exe -Deny` | \n\nMerge the deny rules with the AllowAll template policy:\n```\n$DenyPolicy = <path_to_deny_policy_destination>\n$AllowAllPolicy = $Env:windir + \"\\schemas\\CodeIntegrity\\ExamplePolicies\\AllowAll.xml\"\nMerge-CIPolicy -PolicyPaths $AllowAllPolicy -OutputFilePath $DenyPolicy -Rules $DenyRules\nSet-CiPolicyIdInfo -FilePath $DenyPolicy -PolicyName \"Deny MSBuild\" -ResetPolicyID\n```\n\nDeploy WDAC policies:\n\n- Convert XML policy into binary. An example PowerShell command to do so is listed below. Ensure that the `$WDACPolicyXMLFile` variable points to the location of the XML policy file. \n    ```\n    ## Update the path to your WDAC policy XML\n     $WDACPolicyXMLFile = $env:USERPROFILE + \"\\Desktop\\MyWDACPolicy.xml\"\n     [xml]$WDACPolicy = Get-Content -Path $WDACPolicyXMLFile\n     if (($WDACPolicy.SiPolicy.PolicyID) -ne $null) ## Multiple policy format (For Windows builds 1903+ only, including Server 2022)\n     {\n         $PolicyID = $WDACPolicy.SiPolicy.PolicyID\n         $PolicyBinary = $PolicyID+\".cip\"\n     }\n     else ## Single policy format (Windows Server 2016 and 2019, and Windows 10 1809 LTSC)\n     {\n         $PolicyBinary = \"SiPolicy.p7b\"\n     }\n    ## Binary file will be written to your desktop\n     ConvertFrom-CIPolicy -XmlFilePath $WDACPolicyXMLFile -BinaryFilePath $env:USERPROFILE\\Desktop\\$PolicyBinary\n     ```\n \nDeployment can vary depending on the version of Windows a client is running and whether it is a server or workstation. \n\n- For Windows 11 22H2 and above:\n\t- Use the CiTool to apply policies.\n- For Windows 11, Windows 10 version 1903 and above, Windows Server 2022 and above:\n\t- Initialize variables.\n\t- Copy the policy binary to the destination folder.\n\t- Run RefreshPolicy.exe to activate and refresh policies on a managed endpoint.\n- All other versions of Windows and Windows Server:\n\t- Initialize variables.\n\t- Copy policy binary to destination folder. \n\t- Activate and refresh policies using Windows Management Interface (WMI).\n\n## References\n\n- Hackers Using Microsoft Build Engine to Deliver Malware Filelessly |  <https://thehackernews.com/2021/05/hackers-using-microsoft-build-engine-to.html>\n- MSBuild | <https://learn.microsoft.com/en-us/visualstudio/msbuild/msbuild?view=vs-2022>\n- Applications that can bypass WDAC and how to block them | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/design/applications-that-can-bypass-appcontrol>\n- Restrict a Microsoft Entra app to a set of users | <https://learn.microsoft.com/en-us/entra/identity-platform/howto-restrict-your-app-to-a-set-of-users>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0005",
                "CM0006",
                "CM0007",
                "CM0008",
                "CM0101",
                "CM0117",
                "CM0127",
                "CM0131",
                "CM0132"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "thehackernews.com",
                    "description": "Hackers Using Microsoft Build Engine to Deliver Malware Filelessly",
                    "url": "https://thehackernews.com/2021/05/hackers-using-microsoft-build-engine-to.html"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "MSBuild",
                    "url": "https://learn.microsoft.com/en-us/visualstudio/msbuild/msbuild?view=vs-2022"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Applications that can bypass WDAC and how to block them",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/design/applications-that-can-bypass-appcontrol"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Restrict a Microsoft Entra app to a set of users",
                    "url": "https://learn.microsoft.com/en-us/entra/identity-platform/howto-restrict-your-app-to-a-set-of-users"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1127.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0131",
            "name": "Disable or Restrict Microsoft Management Console (MMC.exe)",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0131\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling the Microsoft Management Console prevents an adversary's attempts at remote code execution and defense evasion using malicious management saved console files.\n\n## Introduction\n\nThe Microsoft Management Console (MMC) creates, saves, and opens administrative tools in the environment to manage the hardware, software, and network components of a Windows operating system. System administrators can use it to create custom tools and distribute them to users, alongside managing the OS. \n\nAdversaries can abuse the MMC by crafting malicious management saved console (MSC) files that allow them to execute arbitrary code, including malware payloads. Adversaries can use this technique to compromise systems and evade security defenses. Similar techniques have become popular after Microsoft restricted macros and add-ins by default.\n\n## Preparation\n\n- Identify if MMC is used in the environment and the ramifications of disabling it. \n- Identify Windows Defender rules regarding MSC files.\n\n## Risks\n\n- If the management console is required for organizational needs, disabling it will be disruptive. Consider instead auditing any Windows Defender policies and detection rules regarding MSC files. \n- Renaming, changing, or moving MMC.exe may evade detection,  Applocker, or Windows Defender Application Control (WDAC) policies. Having several types of rules active simultaneously (e.g. a hash rule and a path rule) can mitigate some risk, since the rules protect against different behaviors.\n\n## Guidance\n\n### Restricting Microsoft Management Console and MMC snap-ins\n\n- Create a new Group Policy Object (GPO) or locate an existing GPO regarding MMC.\n- In the Group Policy Management Console, navigate to `User configuration > Administrative Templates > Windows Components > Microsoft Management Console` and enable the `Restrict users to the explicitly permitted list of snap-ins` setting.\n- In a separate GPO, navigate to `User configuration > Administrative Templates > Windows Components > Microsoft Management Console > Restricted/Permitted snap-ins`.\n- Allow any necessary snap-ins. All others will be restricted and inaccessible to users.\n- Update group policy in the domain using `gpupdate --force`. \n\n### Monitoring Microsoft Management Console\n\n- Monitor for calls to `mmc.exe` or `mmc`.\n- Monitor for processes that take arguments with the .msc file extension.\n- Monitor changes to the GPO policy list of allowed snap-ins. \n\nIf not necessary in the environment, MMC can be uninstalled via the Installation Manager or disabled. One option is to disable MMC via GPOs by not specifying any allowed snap-ins. Other options include Applocker or Windows Defender Application Control. \n\n### Disabling via Applocker\n\n- Implement Applocker's default allow rules regarding executables.\n\t- In the Group Policy Management Console (GPMC) navigate to `Security Settings > Application Control Policies > AppLocker > Executable Rules`.\n\t- Select `Executable Rules` and enable `Create Default Rules`.\n- Define a deny rule for `MMC.exe`. \n- Alternatively, block locations of the MSBuild.exe executable.\n\n### Disabling via Windows Defender Application Control (WDAC)\n\nWDAC can be configured for both allow and deny policies based on organizational needs. When creating deny policies, Microsoft requires the inclusion of \"Allow All\" rules in both kernel and user mode sections to avoid blocking all software (some explicitly and some implicitly, since there are no rules to allow it). Microsoft provides an AllowAll policy template. This template will not affect any explicit allow rules already in place.  \n\nPolicies can be created using PowerShell or via the WDAC wizard.\n\n| Rule Type | PowerShell Command |\n|-----------|--------------------|\n| Software Publisher-based | `$DenyRules += New-CIPolicyRule -Level FilePublisher -DriverFilePath MMC.exe -Fallback SignedVersion,Publisher,Hash -Deny` |\n| Software attribute-based | `$DenyRules += New-CIPolicyRule -Level FileName -DriverFilePath MMC.exe -Fallback Hash -Deny` |\n| Hash-based | `$DenyRules += New-CIPolicyRule -Level Hash -DriverFilePath MMC.exe -Deny` | \n\nMerge the deny rules with the AllowAll template policy:\n```\n$DenyPolicy = <path_to_deny_policy_destination>\n$AllowAllPolicy = $Env:windir + \"\\schemas\\CodeIntegrity\\ExamplePolicies\\AllowAll.xml\"\nMerge-CIPolicy -PolicyPaths $AllowAllPolicy -OutputFilePath $DenyPolicy -Rules $DenyRules\nSet-CiPolicyIdInfo -FilePath $DenyPolicy -PolicyName \"Deny MMC\" -ResetPolicyID\n```\n\nDeploy WDAC policies:\n\n- Convert XML policy into binary. An example PowerShell command to do so is listed below. Ensure that the `$WDACPolicyXMLFile` variable points to the location of the XML policy file. \n    ```\n    ## Update the path to your WDAC policy XML\n     $WDACPolicyXMLFile = $env:USERPROFILE + \"\\Desktop\\MyWDACPolicy.xml\"\n     [xml]$WDACPolicy = Get-Content -Path $WDACPolicyXMLFile\n     if (($WDACPolicy.SiPolicy.PolicyID) -ne $null) ## Multiple policy format (For Windows builds 1903+ only, including Server 2022)\n     {\n         $PolicyID = $WDACPolicy.SiPolicy.PolicyID\n         $PolicyBinary = $PolicyID+\".cip\"\n     }\n     else ## Single policy format (Windows Server 2016 and 2019, and Windows 10 1809 LTSC)\n     {\n         $PolicyBinary = \"SiPolicy.p7b\"\n     }\n    ## Binary file will be written to your desktop\n     ConvertFrom-CIPolicy -XmlFilePath $WDACPolicyXMLFile -BinaryFilePath $env:USERPROFILE\\Desktop\\$PolicyBinary\n     ```\n \nDeployment can vary depending on the version of Windows a client is running and whether it is a server or workstation. \n\n- For Windows 11 22H2 and above:\n\t- Use the CiTool to apply policies.\n- For Windows 11, Windows 10 version 1903 and above, Windows Server 2022 and above:\n\t- Initialize variables.\n\t- Copy the policy binary to the destination folder.\n\t- Run RefreshPolicy.exe to activate and refresh policies on a managed endpoint.\n- All other versions of Windows and Windows Server:\n\t- Initialize variables.\n\t- Copy policy binary to destination folder. \n\t- Activate and refresh policies using Windows Management Interface (WMI).\n\n## References\n\n- New Attack Technique Exploits Microsoft Management Console Files | <https://thehackernews.com/2024/06/new-attack-technique-exploits-microsoft.html>\n- What is Microsoft Management Console? | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/system-management-components/what-is-microsoft-management-console>\n- AppLocker | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/applocker-overview>\n- Application Control for Windows | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/design/select-types-of-rules-to-create#windows-defender-application-control-file-rule-levels>\n- Guidance on Creating WDAC Deny Policies | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/design/create-wdac-deny-policy#creating-a-deny-policy-tutorial>\n- Delpoying Windows Defender Application Control (WDAC) policies | <https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/deployment/wdac-deployment-guide>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0005",
                "CM0006",
                "CM0007",
                "CM0008",
                "CM0101",
                "CM0117",
                "CM0127",
                "CM0130",
                "CM0132"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "thehackernews.com",
                    "description": "New Attack Technique Exploits Microsoft Management Console Files",
                    "url": "https://thehackernews.com/2024/06/new-attack-technique-exploits-microsoft.html"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "What is Microsoft Management Console?",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/system-management-components/what-is-microsoft-management-console"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "AppLocker",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/applocker-overview"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Application Control for Windows",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/design/select-types-of-rules-to-create#windows-defender-application-control-file-rule-levels"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Guidance on Creating WDAC Deny Policies",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/design/create-wdac-deny-policy#creating-a-deny-policy-tutorial"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Delpoying Windows Defender Application Control (WDAC) policies",
                    "url": "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/deployment/wdac-deployment-guide"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1218.014",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0132",
            "name": "Disable or Restrict InstallUtil",
            "subtype": "Disable, Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0132\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable, Examine\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling or restricting InstallUtil prevents an adversary's attempts at defense evasion and application control evasion using InstallUtil.\n\n## Introduction\n\nInstallUtil is a commandline tool that allows administrators to install or uninstall server resources via installer components of various assemblies. The tool is automatically installed with Visual Studio, but can be used independently from the commandline. \n\nAdversaries can use the utility to bypass application control and evade defenses: since InstallUtil is a Microsoft-signed binary, it can be used to install executables that would otherwise get blocked by Applocker policies. The Metasploit framework also has specific modules for Applocker bypass by abusing the InstallUtil binary.\n\n## Preparation\n\n- Identify if and how InstallUtil is used in the environment and what impacts restricting or disabling it would have on business operations. \n- Identify if Visual Studio is used in the environment.\n\n## Risks\n\n- InstallUtil may be used for business operations, in which case disabling it would be detrimental. Consider restricting and monitoring the tool instead. \n- Disabling or restricting InstallUtil may limit Visual Studio functionality. \n- Moving or renaming InstallUtil may evade detection or Applocker and Windows Defender Application Control (WDAC) policies. Consider creating several kinds of rules (e.g. hash and path) to mitigate this risk.\n\n## Guidance\n\n### Restrict InstallUtil\n\n- Restrict use of InstallUtil (or Visual Studio as well) to users or groups that require it for their jobs. \n\t- If the binary is registered in the Microsoft Entra tenant, navigate to `Identity > Applications > Enterprise Applications > All applications` in the Microsoft Entra admin center.\n\t- Select InstallUtil or Visual Studio. \n\t- On the application's Overview page, navigate to `Manage > Properties` and enable the `Assignment required?` setting.\n\t- under `Manage`, navigate to `Users and groups > Add user/group > Users`. \n\t- Select `None selected` and add users from the selector pane that opens. Select `Assign` to complete assignment. \n\n### Monitor InstallUtil\n\n- Monitor for process calls to `installutil` by reviewing 'process creation' event logs that are generated by Windows Event Log (ID 4688).\n- Monitor for creation of files with InstallLog and InstallState extensions, since they show that an assembly was installed with InstallUtil.\n- Monitor changes or calls to the `C:\\Windows\\Microsoft.NET\\Framework\\v\\InstallUtil.exe` and `C:\\Windows\\Microsoft.NET\\Framework64\\v\\InstallUtil.exe` files. \n- Monitor any network connections made by the InstallUtil process.\n\n### Remove via Applocker\n\n- Implement Applocker's default allow rules regarding executables.\n\t- In the Group Policy Management Console (GPMC) navigate to `Security Settings > Application Control Policies > AppLocker > Executable Rules`.\n\t- Select `Executable Rules` and enable `Create Default Rules`.\n- Define a deny rule for `InstallUtil.exe`. \n- Alternatively, block file path locations of the InstallUtil.exe executable.\n\n### Remove via Windows Defender Application Control\n\nWDAC can be configured for both allow and deny policies based on organizational needs. When creating deny policies, Microsoft requires the inclusion of \"Allow All\" rules in both kernel and user mode sections to avoid blocking all software (some explicitly and some implicitly, since there are no rules to allow it). Microsoft provides an AllowAll policy template. This template will not affect any explicit allow rules already in place.  \n\nPolicies can be created using PowerShell or via the WDAC wizard.\n\n| Rule Type | PowerShell Command |\n|-----------|--------------------|\n| Software Publisher-based | `$DenyRules += New-CIPolicyRule -Level FilePublisher -DriverFilePath InstallUtil.exe -Fallback SignedVersion,Publisher,Hash -Deny` |\n| Software attribute-based | `$DenyRules += New-CIPolicyRule -Level FileName -DriverFilePath InstallUtil.exe -Fallback Hash -Deny` |\n| Hash-based | `$DenyRules += New-CIPolicyRule -Level Hash -DriverFilePath InstallUtil.exe -Deny` | \n\nMerge the deny rules with the AllowAll template policy:\n```\n$DenyPolicy = <path_to_deny_policy_destination>\n$AllowAllPolicy = $Env:windir + \"\\schemas\\CodeIntegrity\\ExamplePolicies\\AllowAll.xml\"\nMerge-CIPolicy -PolicyPaths $AllowAllPolicy -OutputFilePath $DenyPolicy -Rules $DenyRules\nSet-CiPolicyIdInfo -FilePath $DenyPolicy -PolicyName \"Deny InstallUtil\" -ResetPolicyID\n```\n\nDeploy WDAC policies:\n\n- Convert XML policy into binary. An example PowerShell command to do so is listed below. Ensure that the `$WDACPolicyXMLFile` variable points to the location of the XML policy file. \n    ```\n    ## Update the path to your WDAC policy XML\n     $WDACPolicyXMLFile = $env:USERPROFILE + \"\\Desktop\\MyWDACPolicy.xml\"\n     [xml]$WDACPolicy = Get-Content -Path $WDACPolicyXMLFile\n     if (($WDACPolicy.SiPolicy.PolicyID) -ne $null) ## Multiple policy format (For Windows builds 1903+ only, including Server 2022)\n     {\n         $PolicyID = $WDACPolicy.SiPolicy.PolicyID\n         $PolicyBinary = $PolicyID+\".cip\"\n     }\n     else ## Single policy format (Windows Server 2016 and 2019, and Windows 10 1809 LTSC)\n     {\n         $PolicyBinary = \"SiPolicy.p7b\"\n     }\n    ## Binary file will be written to your desktop\n     ConvertFrom-CIPolicy -XmlFilePath $WDACPolicyXMLFile -BinaryFilePath $env:USERPROFILE\\Desktop\\$PolicyBinary\n     ```\n \nDeployment can vary depending on the version of Windows a client is running and whether it is a server or workstation. \n\n- For Windows 11 22H2 and above:\n\t- Use the CiTool to apply policies.\n- For Windows 11, Windows 10 version 1903 and above, Windows Server 2022 and above:\n\t- Initialize variables.\n\t- Copy the policy binary to the destination folder.\n\t- Run RefreshPolicy.exe to activate and refresh policies on a managed endpoint.\n- All other versions of Windows and Windows Server:\n\t- Initialize variables.\n\t- Copy policy binary to destination folder. \n\t- Activate and refresh policies using Windows Management Interface (WMI).\n\n## References\n\n- Installutil.exe (Installer tool) | <https://learn.microsoft.com/en-us/dotnet/framework/tools/installutil-exe-installer-tool>\n- InstallUtil Process Making Network Connections | <https://www.elastic.co/guide/en/security/current/installutil-process-making-network-connections.html>\n- Restrict a Microsoft Entra app to a set of users | <https://learn.microsoft.com/en-us/entra/identity-platform/howto-restrict-your-app-to-a-set-of-users>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0005",
                "CM0006",
                "CM0007",
                "CM0008",
                "CM0101",
                "CM0117",
                "CM0127",
                "CM0130",
                "CM0131"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Installutil.exe (Installer tool)",
                    "url": "https://learn.microsoft.com/en-us/dotnet/framework/tools/installutil-exe-installer-tool"
                },
                {
                    "source_name": "www.elastic.co",
                    "description": "InstallUtil Process Making Network Connections",
                    "url": "https://www.elastic.co/guide/en/security/current/installutil-process-making-network-connections.html"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Restrict a Microsoft Entra app to a set of users",
                    "url": "https://learn.microsoft.com/en-us/entra/identity-platform/howto-restrict-your-app-to-a-set-of-users"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1218.004",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0133",
            "name": "Reset Access Control Lists to Default Values",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0133\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting Access Control Lists (ACLs) to default values blocks or restricts an adversary's attempts at persistence, privilege escalation, and defense evasion using created accounts or modified permissions.\n\n## Introduction\n\nACLs dictate what users or roles can access what resources, and adversaries may modify them to gain further unauthorized access. For example, an adversary can modify an ACL to add an adversary-owned account to a privileged group, facilitating persistent privileged access to the environment that a password reset may not eliminate.\n\n## Preparation\n\n- Audit access control policies for the organization.\n- Identify default access control settings for roles, users, and services in the environment or locate Microsoft's default access permission list.\n- Ensure event logging is enabled.\n\n## Risks\n\n- Organizations that had not updated their ACL policies may have to revert to a prior, documented default and some users may lose access to resources needed for their work. Reset ACLs during off hours and update resulting roles and permissions as necessary.\n\n## Guidance\n\nMicrosoft provides a list of default access permissions for different user groups and roles. \n\n- Audit role permissions to ensure expected values.\n- Audit user and group assignments to ensure expected values.\n- If necessary, delete existing groups, create new groups with appropriate roles and permissions, and re-assign users.\n\t- In the Microsoft Entra admin center, navigate to `Identity > Groups > All groups` and select `New group`.\n\t- Select or fill in appropriate settings such as group name and description. \n\t- Switch `Microsoft Entra roles can be assigned to the group` setting to `yes` and add appropriate roles. \n\t- Add users to the group. \n- Monitor for access control permission changes: configure central access policy monitoring for files and directories.\n\t- In the Group Policy management console, navigate to `Computer Configuration > Security Settings > Advanced Audit Policy > Policy Change > Audit Authorization Policy Change`.\n\t- In the `Configure the following audit options`, select all desired options (\"Success\" or \"Failure\" or both). \n\t- Watch for event logs with ID 4913. \n- To monitor for changes to specific files or directories:\n\t- Sign in as an administrator on machine containing the file or directory. \n\t- Select file/directory's `Properties > Security > Advanced > Auditing` tab, then select `Continue`. \n\t- Add the appropriate service principal, then select permissions to audit in the `Auditing Entry for` dialog box. \n\t- Update policy with the `gpupdate /force` command.\n\n## References\n\n- How Access Control Works in Active Directory Domain Services | <https://learn.microsoft.com/en-us/windows/win32/ad/how-access-control-works-in-active-directory-domain-services>\n- What are the default user permissions in Microsoft Entra ID? | <https://learn.microsoft.com/en-us/entra/fundamentals/users-default-permissions>\n- Manage Microsoft Entra groups and group membership | <https://learn.microsoft.com/en-us/entra/fundamentals/how-to-manage-groups>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0003",
                "CM0075",
                "CM0085"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How Access Control Works in Active Directory Domain Services",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/ad/how-access-control-works-in-active-directory-domain-services"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "What are the default user permissions in Microsoft Entra ID?",
                    "url": "https://learn.microsoft.com/en-us/entra/fundamentals/users-default-permissions"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Manage Microsoft Entra groups and group membership",
                    "url": "https://learn.microsoft.com/en-us/entra/fundamentals/how-to-manage-groups"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1136",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1190",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1222",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0134",
            "name": "Audit Federated Systems Trust Settings",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0134\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing federated systems trust settings prevents an adversary's attempts at initial access, lateral movement, and persistence by abusing permissions or misconfigurations of federated trusts.\n\n## Introduction\n\nA federated trust between two or more entities allows them to accept credentials from each other and grant users in both entities access to specific resources (can be calendars, files, etc.), or to enable single sign-on (SSO) for web services. \n\nAdversaries may edit trust settings to gain access to systems within the trust network, and then further abuse native Microsoft functionality to remain undetected in an environment. Additionally, they can move laterally from a compromised tenant to any other tenants within the trust network.\n\n## Preparation\n\n- Identify all federated systems and services in the environment. \n- Identify policies for access permissions and expected trust settings for each trust. \n- Ensure there is enough storage for audit logs.\n\n## Risks\n\n- Removing trusts or decreasing access permissions between trusted entities may cause some users to lose access to resources they need to perform their jobs. Consider what recourses a trust grants and what users may need to access those resources, and weigh the risks of compromise against costs to business operations.\n\n## Guidance\n\nIn most environments, federated trust settings will be updated infrequently and should not cause a large amount of logs. Mandiant provides an auditing script to enumerate all domains, including unverified domains and those configured for federation. The script is available on their GitHub at <https://github.com/mandiant/Mandiant-Azure-AD-Investigator>.\n\n### Check Trust Settings\n\n- Audit all federated domains and ensure that permissions and settings are set to expected values. \n\t- Enumerate all domains.\n\t- Remove suspicious or unexpected entries.\n\n### Monitor Changes to Settings\n\n- Configure Microsoft Entra audit logs for an Azure Log Analytics Workspace.\n- Create alerts to trigger based on the log query. An example query is provided below:\n\n\t```\n\tAuditLogs \n\t| extend TargetResource = parse_json(TargetResources) \n\t| where ActivityDisplayName contains \"Set federation settings on domain\" or ActivityDisplayName contains \"Set domain authentication\" \n\t| project TimeGenerated, SourceSystem, TargetResource[0].displayName, AADTenantId, OperationName, InitiatedBy, Result, ActivityDisplayName, ActivityDateTime, Type\n\t```\n    \n- Add action group to ensure notification when alerting conditions are met. \n- Monitor any changes to the `signingCertificate` attribute. Changing the attribute may temporarily disable authentication, making the attack visible to defenders. \n- Monitor for secondary or additional token-signing certificates added into the federation configuration. \n- Monitor for changes to Security Assertion Markup Language (SAML) tokens such as extended lifetime.\n\n## References\n\n- Federated Trust | <https://csrc.nist.gov/glossary/term/federated_trust>\n- What is federation with Microsoft Entra ID? | <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/whatis-fed>\n- Monitor changes to federation configuration in your Microsoft Entra ID | <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-monitor-federation-changes>\n- Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452 | <https://www.mandiant.com/sites/default/files/2021-11/wp-m-unc2452-000343.pdf#page=23>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0073",
                "CM0076",
                "CM0123",
                "CM0145"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "csrc.nist.gov",
                    "description": "Federated Trust",
                    "url": "https://csrc.nist.gov/glossary/term/federated_trust"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "What is federation with Microsoft Entra ID?",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/whatis-fed"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Monitor changes to federation configuration in your Microsoft Entra ID",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-monitor-federation-changes"
                },
                {
                    "source_name": "www.mandiant.com",
                    "description": "Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452",
                    "url": "https://www.mandiant.com/sites/default/files/2021-11/wp-m-unc2452-000343.pdf#page=23"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1199",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1484.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1606.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0135",
            "name": "Rebuild Group Managed Service Accounts (gMSA)",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0135\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRebuilding group managed service accounts (gMSA) prevents an adversary's attempts at initial compromise and privilege escalation by abusing gMSA.\n\n## Introduction\n\nGroup Managed Service Accounts (gMSA) are accounts used by services and often require elevated privileges in an environment. They are managed by the Active Directory (AD) itself, rather than by users. Passwords for gMSA are randomly generated every 30 days (by default; may be configured) by the key distribution service (KDS) from a set root key within the AD.\n\nAdversaries can compromise managed accounts with pass-the-hash attacks or other exploits targetting the Lightweight Directory Access Protocol (LDAP) and use gMSA permissions to perform privileged actions. Resetting the password on the account is not always an effective mitigation, as attackers can launch a \"Golden gMSA Attack\" and calculate future as well as current gMSA passwords, as long as they have seen the root key once. To prevent this, rebuilding the accounts completely and generating a new root key is recommended.\n\n## Preparation\n\n- Identify which machines need service accounts.\n- Identify which services need accounts. \n- Ensure the Active Directory PowerShell module is installed on all machines that the service account needs access to. \n- Ensure process logging is enabled in the environment.\n\n## Risks\n\n- Service accounts will be unavailable in the window of time between disabling them and rebuilding; consider performing the operation outside of active business hours or during slower hours. \n- After creating a root key, a domain controller will need at least 10 hours to allow all other domain controllers to synchronize replication before new gMSA can be created.\n- Rebuilding the root key may cause issues where the old key continues to be used after deletion due to caching. Consider restarting the Key Distribution Service (KDS) on all domain controllers after recreation.\n\n## Guidance\n\n### Remove old gMSA\n\n- Identify all gMSA with the `Get-ADServiceAccount -Filter *` command.\n- Remove gMSA accounts with the `Remove-ADServiceAccount` cmdlet. \n- Remove old KDS root key. \n\n### Build new gMSA\n\n- Create new KDS root key with the `Add-KdsRootKey -EffectiveImmediately` cmdlet. \n- Restart all domain controllers to avoid caching and replication issues. \n- Create new security group for the accounts.\n- Add all users and computers the managed accounts should have access to into the group. Computers may need to be rebooted before this change is applied. \n- Create accounts with the `New-ADServiceAccount` cmdlet; specify the newly created security group for password retrieval.\n- Install the account with the `Install-ADServiceAccount` cmdlet.\n- Optionally, give the accounts a Service Principal Name with the `setspn -a <SPN> <USER>` command; this will allow the account to authenticate using Kerberos. \n\n### Monitor for gMSA enumeration techniques\n\n- Monitor for process calls to BloodHound or Mimikatz.\n- Monitor for the `Get-ADServiceAccount -Filter * -Properties * ` command.\n- Monitor for suspicious PSExec or LDAP activity in the environment. \n- Monitor for access to LSA secrets or modification to the `HKLM\\SECURITY\\Policy\\Secrets` registry key.\n\n## References\n\n- Attacking Group Managed Service Accounts (gMSA) | <https://medium.com/@offsecdeer/attacking-group-managed-service-accounts-gmsa-5e9c54c56e49>\n- Secure group managed service accounts | <https://learn.microsoft.com/en-us/entra/architecture/service-accounts-group-managed>\n- Create the Key Distribution Services KDS Root Key | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/group-managed-service-accounts/group-managed-service-accounts/create-the-key-distribution-services-kds-root-key>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0023",
                "CM0028",
                "CM0050",
                "CM0105"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "medium.com",
                    "description": "Attacking Group Managed Service Accounts (gMSA)",
                    "url": "https://medium.com/@offsecdeer/attacking-group-managed-service-accounts-gmsa-5e9c54c56e49"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Secure group managed service accounts",
                    "url": "https://learn.microsoft.com/en-us/entra/architecture/service-accounts-group-managed"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Create the Key Distribution Services KDS Root Key",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/group-managed-service-accounts/group-managed-service-accounts/create-the-key-distribution-services-kds-root-key"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1003.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1555",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0136",
            "name": "Configure and Invalidate Relative ID (RID) Pools",
            "subtype": "Examine, Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0136\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Disable\n* **Status:** Active\n\n## Intended Outcome\n\nConfiguring and invalidating relative ID (RID) pools blocks or restricts an adversary's attempts to escalate privileges and achieve persistence by hijacking RID.\n\n## Introduction\n\nA relative ID (RID) is a unique number assigned to an object in a domain, which is essential to distinguishing between different objects (such as user accounts or groups) within the same domain. Errors or misconfigurations of RID can cause misauthentication or integrity problems in the environment, such as errors during group or user creation, inability to move objects, or users being unable to authenticate.\n\nAdversaries can change an account's RID to grant themselves administrative permissions by modifying the registry. Through this method, an adversary can maintain higher privileges and persistence in an environment using valid accounts. Changing a Guest account's RID (500) to an Administrator account's RID (501) is a common attack against RID, and grants adversaries escalated privileges.\n\n## Preparation\n\n- Identify all domain controllers in the environment.\n\n## Risks\n\n- After invalidating RID pools, subsequent attempts to create new objects or security principals may initially fail. Retry the operation: the second time should succeed due to reallocation of RID pools.\n\n## Guidance\n\n### Invalidate current RID pools\n\nAdministrator privileges are required to invalidate RID pools via PowerShell. \n\n- On each domain controller, use PowerShell to run the following script:\n\t```\n\t$Domain = New-Object System.DirectoryServices.DirectoryEntry\n\t$DomainSid = $Domain.objectSid\n\t$RootDSE = New-Object System.DirectoryServices.DirectoryEntry(\"LDAP://RootDSE\")\n\t$RootDSE.UsePropertyCache = $false\n\t$RootDSE.Put(\"invalidateRidPool\", $DomainSid.Value)\n\t$RootDSE.SetInfo()\n\t```\n- Check event logs for event ID 16654 to ensure the command was successful. \n\n### Configure RID pools\n\n- Raise the value of available RID pools via adsedit and a calculator:\n\t- In the Server Manager, navigate to `Tools > ADSI Edit > Connect to` and select the Default Naming Context. \n\t- Navigate to `CN=RID Manager$,CN=System,DC=<domain name>`. \n\t- Select properties of `CN=RID Manager$`, select edit on the `rIDAvailablePool` attribute and copy the integer value into your clipboard. \n\t- Add desired value to the copied integer (make sure to use scientific mode). \n\t- Copy the new value back into the `rIDAvailablePool` attribute, click `Save` then click `Apply`. \n\n- Raise the value of available RID pools via LDP: \n\t- In the command prompt, type `ldp` and hit Enter. In the dialog that pops up, navigate to `Connection > Connect type` and type the name of the RID manager.\n\t- Select `Connection > Bind > Bind with credentials` and enter administrative credentials. \n\t- Navigate to `View > Tree > CN=RID Manager$,CN=System,DC=domain name > Browse > Modify`, and add the desired value to the current `rIDAvailablePool` value. Type the sum into the `Values` field. \n\t- In the DN field, enter `cn=RID Manager$,cn=System,dc=<domain name>` and in the Edit Entry Attribute field, enter `rIDAvailablePool`.\n\t- Select `Run`, then `Close`.\n\n## References\n\n- Security identifiers | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-identifiers#relative-identifier-allocation>\n- Active Directory Forest Recovery - Invalidate the current RID pool | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-invaildate-rid-pool>\n- Active Directory Forest Recovery - Raise the value of available RID pools | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-raise-rid-pool>\n- Persistence - RID Hijacking | <https://pentestlab.blog/2020/02/12/persistence-rid-hijacking/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0043",
                "CM0044",
                "CM0064",
                "CM0114",
                "CM0146"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Security identifiers",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-identifiers#relative-identifier-allocation"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Active Directory Forest Recovery - Invalidate the current RID pool",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-invaildate-rid-pool"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Active Directory Forest Recovery - Raise the value of available RID pools",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-raise-rid-pool"
                },
                {
                    "source_name": "pentestlab.blog",
                    "description": "Persistence - RID Hijacking",
                    "url": "https://pentestlab.blog/2020/02/12/persistence-rid-hijacking/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1548",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0137",
            "name": "Remove Global Catalog from Domain Controller",
            "subtype": "Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0137\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nRemoving the global catalog from domain controllers prevents an adversary's attempts at discovery via the global catalog.\n\n## Introduction\n\nThe global catalog is a lightweight directory access protocol (LDAP) compliant server in a domain that allows users and applications to find objects within the domain tree. A global catalog contains partial replicas of all naming contexts within the domain, including schema and configuration naming contexts. Users can use the global catalog to quickly locate correct objects based on the most frequently-used attributes. LDAP traffic on ports 3268 and 3269 query the global catalog. \n\nWhen recovering or restoring a domain controller or active directory, the recovered catalog may hold newer information about a domain that no longer exists; the newer data may replicate throughout the rest of the domains. Therefore the global catalog must be removed from the environment, as that removes the partial replicas as well. \n\nAdversaries can abuse the global catalog for domain enumeration, aiding in their discovery of the environment.\n\n## Preparation\n\n- Identify which domain controller(s) have a global catalog.\n\n## Risks\n\n- Domain access may take longer since requests would have to resolve via the root domain controller instead of a partial replica as stored in the global catalog.\n\n## Guidance\n\n- In the Active Directory server manager (or the Microsoft Entra admin center?) navigate to the `Active Directory Sites and Services`. \n- Select appropriate target server and navigate to `NTDS Settings > Properties`.\n- Deselect the `Global Catalog` checkbox and select apply. \n\n- If Repadmin is present and used in the environment, the following command can be used to remove the global catalog: `repadmin.exe /options DC_NAME -IS_GC`.\n\n### Monitor for enumeration techniques via the global catalog\n\n- Monitor process calls to BloodHound.\n\t- The SharpHound component looks like SMB scanning techniques over ports 137 and 445; keep an eye on all instances of SMB scans. This may cause a lot of noise in larger organizations. \n\t- Monitor commands including `-collectionMethod`,  `invoke-bloodhound`, `azurehound` or `get-bloodHounddata` in the commandline. \n- Monitor use of other Active Directory discovery and enumeration tools such as AD Hunt, PowerView, or Adalanche.\n\t- Events with ID 4799 may show ennumeration attempts on local group membership. \n    - Monitor for process creation of processes with names containing `adhunt.py` or `adalanche`.\n    - Monitor for commandlines containing PowerView modules, a detailed list of which is provided at <https://powersploit.readthedocs.io/en/latest/Recon/>. \n- Check for event ID 5156(S), or the Windows Filtering Platform allowing a connection. Check if the origins of the connection are from the system directory or other expected location. This may be very noisy and cause many false positives.\n\n## References\n\n- Global Catalog | <https://learn.microsoft.com/en-us/windows/win32/ad/global-catalog>\n- Active Directory Forest Recovery - Remove the global catalog | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-remove-gc>\n- BloodHound | <https://redcanary.com/threat-detection-report/threats/bloodhound/>\n- 5156(S): The Windows Filtering Platform has permitted a connection. | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-5156>\n- ADHunt | <https://github.com/asmtlab/ADHunt>\n- Adalanche | <https://github.com/lkarlslund/Adalanche>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0030",
                "CM0063",
                "CM0065"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Global Catalog",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/ad/global-catalog"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Active Directory Forest Recovery - Remove the global catalog",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-remove-gc"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "BloodHound",
                    "url": "https://redcanary.com/threat-detection-report/threats/bloodhound/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "5156(S): The Windows Filtering Platform has permitted a connection.",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-5156"
                },
                {
                    "source_name": "github.com",
                    "description": "ADHunt",
                    "url": "https://github.com/asmtlab/ADHunt"
                },
                {
                    "source_name": "github.com",
                    "description": "Adalanche",
                    "url": "https://github.com/lkarlslund/Adalanche"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1087.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1590.001",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0138",
            "name": "Audit and Remove Malicious Udev Rules",
            "subtype": "Examine, Eliminate",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0138\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Eliminate\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing and removing malicious Udev rules detects and eliminates an adversary's attempts to achieve execution and persistence via malicious udev rules.\n\n## Introduction\n\nUdev replaced the Device File System (devfs) in Linux kernel versions 2.6 and above, allowing the kernel or users to identify devices based on properties, such as vendor and device ID. Udev runs in the userspace, as opposed to the kernel space like devfs. The system is comprised of the udevd daemon and kernel services: the kernel alerts the daemon of certain events happening in the userspace and the daemon responds to the events with configured actions, called rules. Notably, Udev offers the system mechanisms to identify change in device state, such as when it is plugged in or removed. Administrators can create rules to rename network interfaces or modify user rights when a hard disk is plugged in.\n\nUdev is a sandbox environment by default, so long-running processes, daemons, or network connections are not allowed within Udev rules. However, a skilled adversary can bypass the sandbox restrictions via `at` or process injection. \n\nAdversaries can create malicious rules to execute scripts whenever certain conditions are met. For example, by configuring a script to run every time `/dev/random/` (corresponds to device minor number 8 ) is loaded, adversaries get their code to run on a system after every restart, as `/dev/random/` loads upon reboot.\n\n## Preparation\n\n- Take inventory of all Linux systems that may have the Udev utility. \n- Ensure appropriate permissions to view and edit udev rules. \n- Ensure that Udev rule configurations are backed up or saved before making changes in case they need to be reverted. \n- Ensure process logging is enabled in the environment.\n\n## Risks\n\n- Removing a legitimate Udev rule that is used in the environment may break functionality or impact operations. Ensure that rules are not in use or not legitimate before removing.\n\n## Guidance\n\n### Audit Udev Rules\n\n- Review udev rules located in `/etc/udev/rules.d/`, `/run/udev/rules.d/`, or `/usr/lib/udev/rules.d/`. \n- Note any rules that contain suspiciously named scripts in the `RUN` attribute, or scripts with known malicious names. The rule may contain an absolute or relative path to the scripts: ensure that the script is benign or remove both the file and rule.\n- Note any rules that run \"on restart\" such as rules regarding `/dev/random/`, any USB attachment, or non-loopback network connections, since adversaries may be using these rules to maintain persistence in the environment. Some of the identified rules may be legitimate.\n- Note any rules containing `at` or other task schedulers in their `RUN` attribute, or other attempts to escape the sandbox environment to maintain persistence. \n\n### Remove Unnecessary Rules\n\n- Delete the identified .rules file via `rm`. Ensure the file is not needed before deleting. \n- Reload Udev with the `udevtrigger` command.\n\n### Monitor Udev Rule Creation\n\n- Monitor creation or modification of files in the `/etc/udev/rules.d/`, `/run/udev/rules.d/`, or `/usr/lib/udev/rules.d/` directories. Take specific note of rules containing the `at` utility or other signs of process injection. \n- Monitor process creation for children of the `system-udevd.service` process.\n\n## References\n\n- udev | <https://wiki.debian.org/udev>\n- New Linux Malware 'sedexp' Hides Credit Card Skimmers Using Udev Rules | <https://thehackernews.com/2024/08/new-linux-malware-sedexp-hides-credit.html>\n- Leveraging Linux udev for persistence | <https://ch4ik0.github.io/en/posts/leveraging-Linux-udev-for-persistence/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0015",
                "CM0038",
                "CM0045",
                "CM0067",
                "CM0109",
                "CM0120"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "wiki.debian.org",
                    "description": "udev",
                    "url": "https://wiki.debian.org/udev"
                },
                {
                    "source_name": "thehackernews.com",
                    "description": "New Linux Malware 'sedexp' Hides Credit Card Skimmers Using Udev Rules",
                    "url": "https://thehackernews.com/2024/08/new-linux-malware-sedexp-hides-credit.html"
                },
                {
                    "source_name": "ch4ik0.github.io",
                    "description": "Leveraging Linux udev for persistence",
                    "url": "https://ch4ik0.github.io/en/posts/leveraging-Linux-udev-for-persistence/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1546",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0139",
            "name": "Rebuild Active Directory (AD) Connect Server",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0139\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nRebuilding the Active Directory (AD) Connect Server prevents an adversary's attempts to move laterally, escalate privileges, or cause destruction by abusing the AD Connect servers.\n\n## Introduction\n\nAD Connect servers (also may be referred to as Azure AD Connect or Entra Connect) provide synchronization services between on-premises and cloud identities in an organization. They allow for users in on-premises domains to use their already established credentials to access resources in the cloud and Microsoft Entra ID. AD Connect servers set up for older solutions such as DirSync may be valuable targets to attackers, as the accounts would have Global Administrator permissions. \n\nAdversaries can abuse AD Connect synchronization services to control the domain's services and perform destructive actions such as deleting resources. Adversaries can also gain access to email services via the compromised accounts and perform email impersonation to further their actions on objectives. Additionally, misconfigured or compromised AD Connect servers may allow attackers to use man-in-the-middle and pass-the-hash attacks to intercept and abuse legitimate user credentials.\n\n## Preparation\n\n- Identify any backup synchronization options to use during downtime. \n- Ensure the account from which the server is being rebuilt has at least Global Administrator privileges for the domain.\n\n## Risks\n\n- Removing synchronization from an environment can take up to 72 hours. Consider rebuilding the server during weekends or other long periods of low traffic hours. \n- Rebuilding a sync server takes several hours and synchronization services will be unavailable during that time. Though backup synchronization may be set up on other servers, consider rebuilding the server during lower traffic hours.\n\n## Guidance\n\n### Remove current AD Connect Server\n\n- Disable directory synchronization\n\t- If the Microsoft Azure Active Directory PowerShell module is not installed, install it with the `Install-Module MSOnline` command. Ensure PowerShell is run with administrator privileges. \n\t- Run `Set-MsolDirSyncEnabled -EnableDirSync $false` to disable synchronization services. This may take upwards of 72 hours. \n\t- Periodically run `(Get-MSOLCompanyInformation).DirectorySynchronizationEnabled` to check if the service has been disabled; when it is, the command will return `False`. \n- Uninstall AD Connect from the on-premises server. \n\n### Reinstall AD Connect Server\n\nAD Connect can be installed two ways: express, or custom. Express installation can be used if the organization has a singe on-premises AD forest, an enterprise administrator account for the installation, and less than 100,000 objects. If any of those criteria is not met, a custom install must be done. \n\n#### Express Install\n\n- Select `Use express settings` in the installation wizard and enter administrator and hybrid credentials as prompted.\n- Select sign-in configuration as required by the organization. \n- The installation will automatically:\n\t- Install synchronization engine.\n\t- Configure AD Connector.\n\t- Configure ad.local Connector. \n\t- Enable Password hash synchronization.\n\t- Enable Auto Upgrade.\n\t- Configure synchronization settings on the machine it is installing onto. \n- In the Azure management portal, update the user principal name (UPN) by selecting all the users, navigating to `Properties` and changing the UPN. \n- Run `Start-ADSyncSyncCycle -PolicyType Delta -Verbose` in PowerShell to start synchronization. \n\n#### Custom Install\n\n- On the Express Settings page, select `Customize`.\n- Entra Connect will automatically install synchronization services and assign approproate groups and permissions, but allows for customization of installation location, using an existing SQL server, using an existing service account, specifying sync groups, or importing synchronization settings. These checkboxes may remain empty if the default values are sufficent. \n- Click `Install`. \n- Select the user sign-in method the organization plans on using. \n- Connect to Microsoft Entra ID with Hybrid Identity Administrator credentials when prompted. \n- Synchronize users with Entra ID. \n\t- Connect directories by providing AD Connect with the appropriate forest name and credentials of a privileged account. Select `Add Directory`. \n\t- In the dialog window, select the account option (create new AD account or use an existing one). Enter administrator credentials when prompted. \n\t- Follow remaining dialog instructions regarding user configuration, domain exclusion, and optional features.\n\n## References\n\n- Microsoft Entra Connect: Staging server and disaster recovery | <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-sync-staging-server>\n- Can't manage or remove objects that were synchronized through the Azure Active Directory Sync tool | <https://learn.microsoft.com/en-us/troubleshoot/entra/entra-id/user-prov-sync/cannot-manage-objects>\n- Select which installation type to use for Microsoft Entra Connect | <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-install-select-installation>\n- Custom Installation of Microsoft Entra Connect | <https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-install-custom>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0043",
                "CM0107",
                "CM0114",
                "CM0125"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Microsoft Entra Connect: Staging server and disaster recovery",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-sync-staging-server"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Can't manage or remove objects that were synchronized through the Azure Active Directory Sync tool",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/entra/entra-id/user-prov-sync/cannot-manage-objects"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Select which installation type to use for Microsoft Entra Connect",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-install-select-installation"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Custom Installation of Microsoft Entra Connect",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-install-custom"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1485",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1534",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0140",
            "name": "Configure Windows Audit Policy",
            "subtype": "Examine, Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0140\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Enable\n* **Status:** Active\n\n## Intended Outcome\n\nConfiguring the Windows Audit policy blocks or prevents an adversary from remaining undetected on a network.\n\n## Introduction\n\nWindows Audit Policy describes which events to log in the event viewer, and which criteria must be met for the event to be logged. For example, policy can state that all logon events must be logged, regardless of outcome, or that only failed attempts must be logged. Event logs help administrators and defenders understand what happened on a system before, during, and after an incident. \n\nAdversaries may edit or change audit policies so that their actions on the system don't cause event logs or alert defenders of unusual system activity. Additionally, event logs may provide defenders with logs about process creation or script execution that antivirus solutions and Security Information and Event Management (SIEM) systems may miss or exclude due to sheer volume.\n\n## Preparation\n\n- Ensure event logging is enabled in the environment. \n- Ensure appropriate space is allocated for all expected logs. \n- Define collection requirements of events. \n- Decide how audit logs are collected, stored, and analyzed.\n\n## Risks\n\n- If there is not appropriate space allocated for event logs, additional events may not get logged. Ensure there is enough space for all expected logs. \n- Continuous auditing may affect machine performance. Consider testing policies before applying them to the production environment. \n- More audit logs increases the strain on analysts. Continuously monitor and refine audit policies to ensure maximum efficiency. \n- When advanced audit policy settings are enabled via Group Policy, current or default audit policy settings are cleared. Ensure that all necessary events are still logged and audited after making changes to the policy. \n- Using both basic and advanced policies may cause unexpected results in reporting (advanced policies may override all basic policies). Ensure that only one of the above is enabled. \n- If using advanced policies, Microsoft recommends enabling the `Audit: Force audit policy subcategory settings (Windows Vista or later) to override audit policy category settings` setting to ensure policies are not overriden.\n\n## Guidance\n\n### Audit and Configure Audit Policies\n\nEvents that get logged by Windows Audit Policies include logons, account management actions, directory service access, object access, policy changes, privilege use, process tracting, and system events. \n\n- In Group Policy Management Console, enable either basic audit policies under `Local Policies > Audit Policy` or advanced policies under `Security Settings > Advanced Audit Policy Configuration`. Using both may cause unexpected results in reporting (advanced policies may override all basic policies). \n- If using advanced policies, enable the `Audit: Force audit policy subcategory settings (Windows Vista or later) to override audit policy category settings` setting.\n- Push Group Policy updates to all machines in the environment with `gpupdate /force`. Check the resulting policy with `auditpol /get /category:*`. \n\n- Ensure that audit policies at least meet Microsoft's baseline recommendations for event logging, found at <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/audit-policy-recommendations>. \n- Ensure audit policies are enabled on all machines.\n- Check that all monitored events have all (or most) of the following attributes to minimize false positives:\n\t- High liklihood that occurence means unauthorized or malicious activity.\n\t- Low number of false positives.\n\t- Event's occurence results in an investigation. \n\t- A single occurence of the even indicates unauthorized activity OR an accumulation of events above an expected baseline. \n- Ensure that antivirus disabling or removal is logged.\n- Ensure that privileged account actions are logged. \n\n### Monitor changes to audit policies\n\nAdversaries may change policies to avoid detection or evade defenses.\n\n- Audit and monitor events with the following IDs:\n\t- 4719 - System audit policy was changed \n\t- 4817 - Auditing settings on an object were changed \n\t- 4907 - Auditing settings on an object were changed \n\t- 4912 - Per User Audit Policy was changed \n\t- 4715 - The audit policy, SACL, on an object was changed\n\n## References\n\n- Audit Policy Recommendations | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/audit-policy-recommendations>\n- Audit Policy | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/security-policy-settings/audit-policy>\n- 4719(S): System audit policy was changed | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4719>\n- Advanced security auditing FAQ | <https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/advanced-security-auditing-faq>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0044",
                "CM0060",
                "CM0063",
                "CM0064",
                "CM0085"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Audit Policy Recommendations",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/audit-policy-recommendations"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Audit Policy",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/security-policy-settings/audit-policy"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "4719(S): System audit policy was changed",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4719"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Advanced security auditing FAQ",
                    "url": "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/advanced-security-auditing-faq"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1070.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1222.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1484.001",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1562.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0141",
            "name": "Audit and Restrict PsExec",
            "subtype": "Examine, Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0141\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Disable\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing and restricting PsExec blocks or prevents an adversary's attempts at persistence, lateral movement, exploitation, and defense evasion by abusing PsExec.\n\n## Introduction\n\nPsExec is a legitimate Windows utility included as part of Sysinternals. It allows It allows users to achieve execution on remote systems without installing software on the client machine and is a lightweight replacement for Telnet. Administrators use PsExec to access remote systems via the Server Message Block (SMB) protocol. The process establishes an SMB connection, pushes a copy of PSEXECSVC.exe to the client, and launces the process, creating a named pipe (typically named `\\\\.\\pipe\\psexesvc`). \n\nAdversaries commonly use PsExec to move laterally in an environment, either by launching an interactive terminal or command prompt interface, or by providing PsExec with commands to execute remotely and then terminate. They may also use PsExec to transfer malicious files and further compromise the environment. To cover their tracks, adversaries may rename the dropped PsExecSVC.exe binary with the `-r` flag, but the internal binary name and the default named pipe remain.\n\n## Preparation\n\n- Ensure process and event logging is configured. \n- Identify if and how PsExec is used in the environment.\n\n## Risks\n\n- If PsExec is used in the environment, disabling it may be disruptive. Consider restricting and monitoring PsExec, or moving to PowerShell Remoting for similar but more secure functionality. \n- Renaming PsExec or using one of its copies or variants may avoid some of the detection. Consider restricting all similar binaries or setting up alerts for well-known PsExec replacements (such as PAExec).\n\n## Guidance\n\nIf PsExec is not necessary in the environment, disable and remove it. Otherwise, restrict execution to only necessary users and set up monitoring.\n\n### Restrict PsExec\n\n- Implement Attack Surface Reduction (ASR) rules to block execution of PsExec.\n\t- In Microsoft Defender Security Portal, navigate to `Device Control > Attack Surface Reduction`. \n\t- Select `Edit` and navigate to the `Block process creations originating from PSExec and WMI commands` rule.\n\t- Enable the rule. Save and exit. \n- Restrict access to only specific users that may need PsExec for their roles, if other otions (such as PowerShell Remoting) are unavailable. \n- Edit firewall rules to block PsExec to and from remote devices. \n\n### Monitor for PsExec\n\n- Check any anti-virus alerts regarding PsTools and PsExec in particular.\n- Monitor all calls to `psexec` from the commandline. \n- Monitor named pipes such as `\\\\.\\pipe\\psexesvc` or similar. Other lateral movement tools such as MetaSploit also use named pipes, but so do legitimate services. \n- Monitor for binaries with internal names `PsExec` and `PsExec Service Host`. \n- If PsExec is not typically used in the environment, the registry key at `HKEY_CURRENT_USER\\software\\sysinternals\\psexec\\eulaaccepted` can indicate if it was run recently. In environments where PsExec is used legitimately, this may not be helpful. \n- Monitor for clones of PsExec such as RemCom (named pipes `\\\\.\\pipe\\remcom_comunication` and binary internal name `remcom`), PAExec (binary internal name containing `paexec`) or CSExec (named pipe `\\\\.\\pipe\\csexecsvc` and a binary internal name containing `csexec`).\n- Monitor for unique PsExec naming conventions: `<psexecsvc_name><machine_name><5_random_digits><stdin|stdout|stderr>`.\n\n## References\n\n- PsExec v2.43 | <https://learn.microsoft.com/en-us/sysinternals/downloads/psexec>\n- Threat Hunting for PsExec, Open-Source Clones, and Other Lateral Movement Tools | <https://redcanary.com/blog/threat-detection/threat-hunting-psexec-lateral-movement/>\n- Attack surface reduction rules reference | <https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-reference>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0001",
                "CM0004",
                "CM0017",
                "CM0036",
                "CM0060",
                "CM0062"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "PsExec v2.43",
                    "url": "https://learn.microsoft.com/en-us/sysinternals/downloads/psexec"
                },
                {
                    "source_name": "redcanary.com",
                    "description": "Threat Hunting for PsExec, Open-Source Clones, and Other Lateral Movement Tools",
                    "url": "https://redcanary.com/blog/threat-detection/threat-hunting-psexec-lateral-movement/"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Attack surface reduction rules reference",
                    "url": "https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-reference"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1036.004",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1569.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0142",
            "name": "Enable LDAP Signing and Channel Binding ",
            "subtype": "Enable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0142\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nEnabling Lightweight Directory Access Protocol (LDAP) signing, and channel binding prevents attempts at privilege escalation via LDAP relay attacks.\n\n## Introduction\n\nLDAP is a protocol that is used by Active Directory (AD) for communication and authentication with directory services and applications. LDAP relay attacks abuse NTLM authentication by intercepting NTLM authentication requests and relaying the captured credentials to a domain controller's LDAP interface. These adversary-in-the-middle attacks can result in privilege escalation.  \n\nLDAP signing and channel binding provide a means of improving the security of communications between LDAP clients and Active Directory domain controllers. LDAP signing requires clients to sign LDAP requests with the client's digital signature to ensure the integrity of the exchange. LDAP channel binding binds the TLS tunnel with the application layer, thereby preventing stolen LDAP tickets from being used to authenticate elsewhere.\n\n## Preparation\n\n-\tLDAP signing and channel binding is only supported on more recent versions of the Windows operating system (Windows 7 and higher). \n-\tIdentify systems that do not support LDAP signing and channel binding. Implement a comprehensive audit plan to identify non-compliant systems.\n-   Update Windows systems and Group Policy administrative templates on Domain Controllers (DCs). \n-\tEnsure robust logging and continual monitoring throughout implementation to identify issues, should they occur.\n\n## Risks\n\nEnabling LDAP signing and channel binding introduces the risk of operational interruption. To minimize this risk, it is critical that these countermeasures be scaled into operations and audited to ensure all systems can comply. Consult the \"Guidance\" section for the process of scaling the countermeasures to reduce the risk of operational interruption.\n\n## Guidance\n\n### LDAP Audit Plan\n\nBefore enabling LDAP features of signing and channel binding, it is important to verify systems support said functionalities through an audit plan that verifies all necessary configurations are in place to enforce secure LDAP communication.\n-\tGroup Policy Assessment:\n    - Verify that Group Policies are configured to \"Require Signing\" for LDAP connections on all domain controllers.\n    - Check if policies are set to enable LDAP channel binding where applicable.\n    - Review the \"Network security: LDAP client signing requirements\" policy setting on domain controllers\n-   Registry Settings:\n\t- Examine relevant registry keys to confirm the desired LDAP signing and channel binding configurations on specific servers.\n-\tEvent ID Review:\n\t- Monitor for specific event IDs related to LDAP signing and channel binding on domain controllers, such as Event IDs 2886, 2887, 2888, 2889 (for LDAP signing) and 3039, 3040 (for channel binding).\n-\tLog Analysis:\n\t- Identify any instances of failed LDAP signing attempts or channel binding issues within the event logs\n    - Analyze the source of these events to determine which clients or applications are making insecure LDAP connections.\n-   Client Review:\n\t- Create an inventory of all devices that interact with the domain, such as workstations, servers, and applications.\n    - Assess whether each client supports LDAP signing and channel binding based on their operating system and application versions.\n    - Verify that client-side configurations are set to utilize LDAP signing and channel binding when possible.\n\n### LDAP Signing\n\nLDAP signing must be configured on both DCs and clients. \n-\tConfigure clients via GPO settings:\n    - Create a group policy object\n    - Navigate to `Computer Configuration>Policies>Windows Settings>Local Policies>Security Options`.\n    - Change the \"Network Security: LDAP Client Signing Requirement\" setting from \"None\" to \"Negotiate Signing.\"\n    - Apply the policy to all clients.\n\n-\tConfigure DC via Group Policy\n    - Elevate LDAP events diagnostic logging on all DCs:\n        - `Reg Add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\NTDS\\Diagnostics /v \"16 LDAP Interface Events\" /t REG_DWORD /d 2`.\n    - Create a group policy object\n    - Navigate to `Computer Configuration>Policies>Windows Settings>Local Policies>Security Options`.\n    - Modify the \"Domain Controller: LDAP Server Signing Requirements\" from \"None\" to \"Require Signing.\"\n\n-\tConfigure SIEM to alert on Directory Service Event IDs 2889 (signing requests that do not conform).\n-\tAudit and continually monitor for non-compliant clients. Ideally non-compliant clients should be remediated with the ultimate intent of requiring LDAP signing.\n-\tIf all clients are compliant and there are no indications of operational interruption, edit the group policy object used to initially configure clients for LDAP signing and modify the \"Network Security: LDAP Client Signing Requirements\" from \"Negotiate Signing\" to \"Require Signing.\" \n\n### LDAP Channel Binding\n\n-\tConfigure Group Policy settings on DCs:\n    - Ensure LDAP event diagnostic logging is elevated on all DCs:\n       - `Reg Add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\NTDS\\Diagnostics /v \"16 LDAP Interface Events\" /t REG_DWORD /d 2`.\n    - Create a group policy object.\n    - Navigate to `Default Domain Controller Policy>Computer Configuration>Policies>Windows Settings>Security Settings>Local Policies` and select \"Security Options.\"\n    - Right-click on \"Domain Controller: LDAP Server Signing Requirements\" and select \"Properties.\"\n    - In the \"Domain Controller: LDAP Server Signing Requirements Properties\" box, enable \"Define this Policy Setting.\"\n    - Select \"When Supported\" and confirm the setting change. \n    - Configure this group policy to log all bind failures on DCs. \n    - Configure SIEM to alert on Directory Service Event IDs 3039, 3074, 3075 (channel binding failure). \n    - Review logs to identify (source IP address) and then remediate non-compliant systems with the intent of ultimately requiring channel binding.\n    - Once all systems are compliant, edit the group policy object used to initially configure LDAP channel binding by modifying the \"LDAP Server Binding Token Requirements\" setting to \"Always.\"\n\n## References\n\n-\tHow to Enable LDAP Signing in Windows Server | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/active-directory/enable-ldap-signing-in-windows-server>\n-\tWhat is LDAP Authentication | <https://fortinet.com/resources/cyberglossary/ldap-authentication>\n-\tLDAP Channel Binding and Signing | <https://hub.trimarcsecurity.com/post/ldap-channel-binding-and-signing>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0098",
                "CM0101",
                "CM0111",
                "CM0121"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How to Enable LDAP Signing in Windows Server",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/active-directory/enable-ldap-signing-in-windows-server"
                },
                {
                    "source_name": "fortinet.com",
                    "description": "What is LDAP Authentication",
                    "url": "https://fortinet.com/resources/cyberglossary/ldap-authentication"
                },
                {
                    "source_name": "hub.trimarcsecurity.com",
                    "description": "LDAP Channel Binding and Signing",
                    "url": "https://hub.trimarcsecurity.com/post/ldap-channel-binding-and-signing"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1557",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0143",
            "name": "Audit and Configure PI Web API",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0143\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing and configuring the Plant Information (PI) Web Application Programming Interface (API) prevents an adversary's attempts to perform discovery and achieve remote code execution via the API.\n\n## Introduction\n\nThe PI Web API is a REpresentational State Transfer (RESTful) API allowing client applications access to PI and Asset Framework (AF) data over the secure HyperText Transfer Protocol (HTTPS). The API is used in critical manufacturing sectors to monitor and manage infrastructure and industrial systems. \n\nAdversaries may use malicious XML imports to execute remote code in the API environment with the privileges of an interactive user. Additionally, if an adversary gains access to the PI Web API, they may access the plant information and change settings to cause damage to the infrastructure the API manages.\n\n## Preparation\n\n- Identify organization's desired configuration settings. \n- Ensure user account performing configuration changes has appropriate permissions. May need to be a PI Web API administrator.\n\n## Risks\n\n- Consider configuring settings outside of active business hours to reduce the risk of operational disruption.\n\n## Guidance\n\nThe PI Web API can be configured both during installation and during runtime. Ensure that the currently configured settings are the desired ones for the organization. \n\n### Configure installation settings\n\n- To start configuration, select `Yes, I would like to participate` in the PI System Customer Experience Improvement Program pane. \n- Select server on which to store configuration data. By default, this is the last-configured server. To change the server, navigate to `... > PI AF Servers` and select the desired server. \n- Select the authentication methods for the API. Bearer and Kerberos are mutually exclusive and Anonymous authentication disables all other types. Other methods may be combined. \n\t- OpenID Connect/Bearer\n\t- Kerberos\n\t- Basic\n\t- None/Anonymous (Aveva recommends against allowing the Anonymous authentication type.)\n- Select the communication port for PI Web API. The default is port 443 for HTTPS traffic; it is largely recommended to use default ports. \n- If remote clients need to access the service, configure a firewall exception by keeping the `Yes, please create a Firewall Exception for PI Web API` checked. Otherwise uncheck the box. \n- Select an SSL certificare for the communication port. \n- Select the account under which the service will operate. \n- Select where the service will store Open Message Format (OMF) data; the default value is the currently-connected PI AF server.\n- Review the settings, apply if correct. \n\n### Configuration with Admin Utility\n\nThe Admin Utility allows users to change any of the settings configured during installation. It is located under `Start menu > PI System`. The following settings should only be edited via Admin Utility, as other methods may result in errors or cause the service to stop working:\n\n- Telemetry\n- Configuration Store\n- Authentication Option\n- AIM Registration\n- Listen Port\n- Certificate\n- API Service\n- OMF Servers\nAveva recommends not using anonymous authentication and keeping communication ports as the default 443, but other configuration settings are up to the organization. \n\n### Configuration at runtime\n\n- Within the RESTful interface, configuration settings are located under `/piwebapi/system/configuration`. Settings can be edited, added, or removed there. \n- In the PI System Explorer, configuration values can be modified under `Elements > OSIsoft > PI Web API > Configuration Instance Name`, where the configuration instance name is the hostname of the server on which PI Web API is installed.\n\n## References\n\n- PI Web API Reference | <https://docs.aveva.com/bundle/pi-web-api-reference/page/help.html>\n- AVEVA PI Web API | <https://www.cisa.gov/news-events/ics-advisories/icsa-24-163-02>\n- Configure installation settings | <https://docs.aveva.com/bundle/pi-web-api/page/1023088.html>\n- Configuration with PI Web API Admin Utility | <https://docs.aveva.com/bundle/pi-web-api/page/1023087.html>\n- Configuration at runtime | <https://docs.aveva.com/bundle/pi-web-api/page/1023022.html>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0017",
                "CM0047",
                "CM0083"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "docs.aveva.com",
                    "description": "PI Web API Reference",
                    "url": "https://docs.aveva.com/bundle/pi-web-api-reference/page/help.html"
                },
                {
                    "source_name": "www.cisa.gov",
                    "description": "AVEVA PI Web API",
                    "url": "https://www.cisa.gov/news-events/ics-advisories/icsa-24-163-02"
                },
                {
                    "source_name": "docs.aveva.com",
                    "description": "Configure installation settings",
                    "url": "https://docs.aveva.com/bundle/pi-web-api/page/1023088.html"
                },
                {
                    "source_name": "docs.aveva.com",
                    "description": "Configuration with PI Web API Admin Utility",
                    "url": "https://docs.aveva.com/bundle/pi-web-api/page/1023087.html"
                },
                {
                    "source_name": "docs.aveva.com",
                    "description": "Configuration at runtime",
                    "url": "https://docs.aveva.com/bundle/pi-web-api/page/1023022.html"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T0846",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T0871",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T0888",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0144",
            "name": "Audit SYSVOL for Vulnerable Group Policy Preferences",
            "subtype": "Examine",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0144\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing vulnerable Group Policy Preferences (GPP) in Active Directory (AD) environments prevents the adversary from achieving defense evasion and persistence via harvesting GPP passwords.\n\n## Introduction\n\nActive directory environments are a prime target for organized threat groups. SYSVOL is a shared folder that exists on the hard disk of a each domain controller within an Active Directory forest, containing functional components such as Group Policy Objects (GPOs) and logon/logoff scripts. For this reason, restoring SYSVOL in AD environments is necessary for a victim to regain authentication, restore functionality, and reestablish synchronization of a corrupted File Replication Service (FRS). Neglecting to restore SYSVOL after compromise invites an attacker to continuously harvest credentials and obscure malicious scripts that enable their persistence within a network.\n\n## Preparation\n\n- Identify content within the SYSVOL and Netlogon shared folders of each domain controller. Note any incongruencies between SYSVOL and Netlogon folders across each domain controller within the AD environment.\n- Examine and document the status of the File Replication Service (FRS) within the AD environment, noting inconsistencies and signs of corruption.\n- If present, identify existing SYSVOL backups that can be used in authoritative recovery of SYSVOL.\n- Conduct system backups before making changes to the SYSVOL tree.\n\n## Risks\n\n- Interacting with a domain's SYSVOL tree and its contents will cause domain controllers to stop service of authentication requests until the SYSVOL folder is shared again.\n- Incorrect registry modification performed by following the included guidance may cause malfunction of system startup functions.\n- Improper application of this countermeasure can disrupt the synchronization of files/content within the SYSVOL and Netlogon folders.\n\n## Guidance\n\n### Audit SYSVOL Content\n\nAdministrators often utilize Group Policy Preferences (GPP) to create domain policies with embedded credentials.\n- Search SYSVOL content and delete any GPPs (saved as .XML files) that contain credentials. These will be exposed to an adversary in the event of AD compromise.\n\nTo address the aforementioned risks:\n- Conduct auditing of the SYSVOL tree outside of common work hours. Schedule maintenance windows to minimize the impact on users and the servicing of authentication requests.\n- Backup the registry and maintain detailed records of modifications made to the registry for future reference and troubleshooting.\n- The risk of disrupted synchronization can be effectively mitigated by performing regular health checks on the SYSVOL and Netlogon folders to ensure proper functioning. Tools such as the Repadmin command allow regular monitoring and verification of replication status.\n\n## References\n\n- How to Rebuild the SYSVOL Tree and its Content in a Domain | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/group-policy/rebuild-sysvol-tree-and-content-in-a-domain>\n\n- Securing SYSVOL: Threats, Protection, and Recovery | <https://www.cayosoft.com/sysvol/>\n\n- Repadmin: How to Check Active Directory Replication | <https://activedirectorypro.com/repadmin-how-to-check-active-directory-replication/>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0085",
                "CM0107",
                "CM0122"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "How to Rebuild the SYSVOL Tree and its Content in a Domain",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/group-policy/rebuild-sysvol-tree-and-content-in-a-domain"
                },
                {
                    "source_name": "www.cayosoft.com",
                    "description": "Securing SYSVOL: Threats, Protection, and Recovery",
                    "url": "https://www.cayosoft.com/sysvol/"
                },
                {
                    "source_name": "activedirectorypro.com",
                    "description": "Repadmin: How to Check Active Directory Replication",
                    "url": "https://activedirectorypro.com/repadmin-how-to-check-active-directory-replication/"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1552.006",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0145",
            "name": "Reset Interdomain Trust Account (ITA) Credentials",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0145\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nResetting interdomain trust accounts (ITA) credentials prevents an adversary's attempts at initial access and lateral movement via compromised ITA credentials.\n\n## Introduction\n\nITA are objects stored in an authenticating domain containing all the information regarding trust relationships between that domain and a trusted domain. These accounts contain trust secrets of the domains, maintained by the domain controller with the primary domain controller (PDC) Emulator Flexible Single Master Operations (FSMO) role.  \n\nAdversaries can compromise the interdomain trust account in the trusting domain and use its password hash to authenticate in the trusted domain, even if the trust relationship does not allow such access. This process can be abused to gain access to resources on different domains in the environment.\n\n## Preparation\n\n- Identify trust relationships between domains, including trust direction. \n- Identify which relationships have interdomain trust accounts, and which domains those accounts are on.\n\n## Risks\n\nNo Risks content identified.\n\n## Guidance\n\n### Reset ITA credentials\n\n- In the commandline interface, use the `netdom experthelp trust` command to get appropriate syntax for the NetDom tool. \n- Use provided syntax to reset the password based on domain configuration. Two examples are provided below. \n\t- On parent domain: `netdom trust parent domain name /domain:child domain name /resetOneSide /passwordT:password /userO:administrator /passwordO:*`.\n\t- On child domain: `netdom trust child domain name /domain:parent domain name /resetOneSide /passwordT:password /userO:administrator /passwordO:*`. \n- Only run the command once; it automatically resets the password twice. \n\n### Monitor for ITA hash compromise techniques\n\n- Monitor processes and command-line parameters for evidence of mimikatz.\n- Monitor for process execution of Rubeus.\n- Monitor for Kerberos ticket-granting ticket (TGT) requests regarding the interdomain trust accounts.\n\n## References\n\n- 6.1.6.8 Essential Attributes of Interdomain Trust Accounts | <https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/ac527b5b-0e88-48a1-8c73-497d40388d04>\n- Abusing Trust Account$: Accessing Resources on a Trusted Domain from a Trusting Domain | <https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-trust-accountusd-accessing-resources-on-a-trusted-domain-from-a-trusting-domain>\n- SID filter as security boundary between domains? (Part 7) - Trust account attack - from trusting to trusted | <https://blog.improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-7-trust-account-attack-from-trusting-to-trusted>\n- Active Directory Forest Recovery - Reset a trust password on one side of the trust | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-reset-trust>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0043",
                "CM0050",
                "CM0121",
                "CM0123",
                "CM0126",
                "CM0128",
                "CM0134",
                "CM0146"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "6.1.6.8 Essential Attributes of Interdomain Trust Accounts",
                    "url": "https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/ac527b5b-0e88-48a1-8c73-497d40388d04"
                },
                {
                    "source_name": "www.ired.team",
                    "description": "Abusing Trust Account$: Accessing Resources on a Trusted Domain from a Trusting Domain",
                    "url": "https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-trust-accountusd-accessing-resources-on-a-trusted-domain-from-a-trusting-domain"
                },
                {
                    "source_name": "blog.improsec.com",
                    "description": "SID filter as security boundary between domains? (Part 7) - Trust account attack - from trusting to trusted",
                    "url": "https://blog.improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-7-trust-account-attack-from-trusting-to-trusted"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Active Directory Forest Recovery - Reset a trust password on one side of the trust",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/forest-recovery-guide/ad-forest-recovery-reset-trust"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1199",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1550.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0146",
            "name": "Configure Flexible Single Master Operations (FSMO) Roles",
            "subtype": "Refresh",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0146\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Refresh\n* **Status:** Active\n\n## Intended Outcome\n\nConfiguring flexible single master operations (FSMO) roles slows down an adversary's exploitation of the domain via compromised domain controllers.\n\n## Introduction\n\nFlexible single master operations (FSMO) roles are assigned to domain controllers (DCs) and perform domain and forest management tasks to keep a directory functioning properly. Instead of one DC performing every task in a domain, they got split up into 5 roles at the domain and forest levels. Domain controllers hosting these roles should always be available, and operation masters should be in areas with reliable networks. \n\nWhile it is possible to configure all roles onto the same domain controller, if an organization has multiple controllers or forests, splitting up the FSMO roles may make it more difficult for attackers to compromise all the domain functionality from one controller. They would need to compromise several DCs to achieve full control, giving defenders more time to notice the compromise and take action. Post-incident, splitting up the roles may remove some FSMO privileges from attackers who had gained access to a DC. Reconfiguring roles helps recover domain functionality if any DCs have been taken offline or compromised and quarantined.\n\n## Preparation\n\n- Identify domain controllers suitable for FMSO roles. \n- Ensure process logging is active in the environment.\n\n## Risks\n\n- Configuring roles on unavailable domain controllers or controllers that may go down will cause the DC to be unable to perform that role. This may be detrimental to the domain and forest, and therefore the organization. Ensure all DCs with FSMO roles are available and meet network reliability requirements.\n\n## Guidance\n\nUnder normal conditions, all five FSMO roles must be assigned to a domain controller in the environment. \n\n### Placement of roles\n\n- Configure a separate domain controller as a stand-by operations master for forest roles.\n- Configure a separate domain controller as a stand-by operations master for domain roles. \n- Place domain-level roles on a high performace domain controller.\n- Place forest-level roles on a domain controller in the root of the forest. \n\nRoles can be transferred via the Ntdsutil.exe or Microsoft Management Console (MMC) snap-ins. Ensure the machine has AD RSAT tool installed or is a domain controller in the forest where roles are being transferred. \n\nIn some situations roles have to be seized instead of being transfered, for example if the domain controller possessing the role is no longer operational or gets demoted.\n\n### Transferring or Seizing Roles via Ntdsutil\n\n- Run the ntdsutil utility, type `roles` and hit Enter.\n- Type `connections` and hit Enter.\n- Type `connect to server <servername>`, where `<servername>` is the name of the domain controller to receive the roles, and hit Enter. \n- To transfer the role, type `transfer <role>`.\n- To seize the role, type `seize <role>`. \n\n### Monitoring for FSMO role enumeration techniques\n\n- Monitor for the `netdom query fsmo` command.\n- Monitor for the `Get-ADForest <domain-name> | Format-Table SchemaMaster,DomainNamingMaster` and `Get-ADDomain <domain-name> | format-table ` cmdlets or commandlines.\n\n## References\n\n- Flexible Single Master Operations roles in Active Directory Domain Services | <https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-fsmo-roles>\n- Active Directory FSMO roles in Windows | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/active-directory/fsmo-roles>\n- Transfer or seize Operation Master roles in Active Directory Domain Services | <https://learn.microsoft.com/en-us/troubleshoot/windows-server/active-directory/transfer-or-seize-operation-master-roles-in-ad-ds>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0136",
                "CM0145"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Flexible Single Master Operations roles in Active Directory Domain Services",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-fsmo-roles"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Active Directory FSMO roles in Windows",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/active-directory/fsmo-roles"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Transfer or seize Operation Master roles in Active Directory Domain Services",
                    "url": "https://learn.microsoft.com/en-us/troubleshoot/windows-server/active-directory/transfer-or-seize-operation-master-roles-in-ad-ds"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1569",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0147",
            "name": "Remove Suspicious Scheduled Tasks",
            "subtype": "Examine, Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0147\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Examine, Disable\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing Windows Task Scheduler prevents adversary attempts at persistence, execution, or priviledge escalation via malicious tasks.\n\n## Introduction\n\nWindows Task Scheduler is a Microsoft Windows service that allows you to automate tasks by scheduling programs or scripts to run at specifc times and/or intervals. Adversaries leverage this functionality to automate the execution of their own malicious code. This has been used to persist via execution on startup, escalate privilege by running the task under the context of a specific account, to mask code execution under the trusted Windows Task Scheduler process, or to achieve a variety of many other malicious goals an adversary may carry out via task execution. This countermeasure aims to provide guidance on auditing and removing of tasks that have been created or manipulated to fufill adversary objectives.\n\n## Preparation\n\n- Identify valid baseline for tasks in the environment, including what each valid task does specifically.\n- Ensure that task configurations are backed up before making any changes.\n\n## Risks\n\n- Modifying scheduled tasks may disrupt and impact previously automated system operations.\n\n## Guidance\n\n### Viewing currently scheduled tasks\n\n#### Audit Windows Tasks via Task Scheduler GUI\n\n- Windows natively has the Task Scheduler system application. This can be used to view, add, delete, edit, or forcibly run scheduled tasks. \n- Use this application to audit currently set tasks and determine any abnormalities or malicious tasks. \n\n#### Audit Windows Tasks via command line\n\n- The Schtasks command can be used to view, edit, or schedule tasks on windows. Similar to the Task Scheduler application, use this to audit for any abnormal or malicious tasks that may be present.\n- In powershell, the Get-ScheduledTask module can also be used to query Scheduled Tasks\n\n#### Audit Window Tasks via Autoruns\n\n- Autoruns is a Windows utility apart of the Sysinternals package that shows which programs or tasks are scheduled to run on startup, login, or when you start other applications. \n- It is not natively installed, so it must be downloaded via Microsoft's website. \n- Autoruns requires no setup and can be used to audit programs scheduled to run on the device.\n\n#### Detecting Hidden Tasks\n\n- Adversaries can create tasks hidden from Schtasks and Task Scheduler by removing security descriptors from the tasks. Querying security descriptors of existing tasks and filtering for empty or unusable descriptors can detect adversaries using this method.\n\n### Removing malicious tasks\n\n#### Malicious task identification\n\n- Review the output of Task Scheduler and examine each entry for legitmacy and validity .\n- Analyze the commands, scripts, or applications executed by the tasks. Verify that there are no malicious or unrecognizable instructions within the tasks.\n- Compare the tasks to a valid baseline configuration, look for any that do not belong or that have been modified from what is typical.\n\n#### Removing tasks\n\n- Tasks can be removed in the context menu of task scheduler, through the /delete of Schtasks, or also within Autoruns.\n- Grab any important artifacts that could be useful for further Threat Hunting before deletion.\n\n### Auditing changes to Task Scheduler\n\n#### Enabling Logging of Task creation via Group Policy\n\nMany attackers will sometimes have processes re-add Scheduled Tasks as a form of persistance. Windows logging can be enabled to log these task creations in order to stop adversaries. This can be enabled via group policy at 'Computer Configuration -> Windows Settings -> Security Settings -> Object Access -> Audit Other Object Access Events'. This will create event ID 4698 which will include some default traffic as well as malicious task creation.\n\n## References\n\n-   Task Scheduler Microsoft Docs | <https://learn.microsoft.com/en-us/windows/win32/taskschd/task-scheduler-start-page>\n-   Schtasks Microsoft Docs | <https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks>\n-   Sysinternals Autoruns | <https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns>\n-   Using ScheduledTasks Module to audit tasks in powershell | <https://mcpmag.com/Articles/2017/04/27/ScheduledTasks-Module-to-Audit-Tasks-in-PowerShell.aspx?>\n-   Diving into hidden scheduled tasks | <https://www.binarydefense.com/resources/blog/diving-into-hidden-scheduled-tasks/#:~:text=In%20the%20Microsoft%20post%20one%20of%20the%20pieces,tasks%20which%20do%20not%20have%20a%20SD%20value.>\n-   Windows task auditing/logging | <https://www.csoonline.com/article/567041/how-to-audit-windows-task-scheduler-for-cyber-attack-activity.html>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0023",
                "CM0030",
                "CM0038",
                "CM0103",
                "CM0109",
                "CM0120"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Task Scheduler Microsoft Docs",
                    "url": "https://learn.microsoft.com/en-us/windows/win32/taskschd/task-scheduler-start-page"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Schtasks Microsoft Docs",
                    "url": "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks"
                },
                {
                    "source_name": "learn.microsoft.com",
                    "description": "Sysinternals Autoruns",
                    "url": "https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns"
                },
                {
                    "source_name": "mcpmag.com",
                    "description": "Using ScheduledTasks Module to audit tasks in powershell",
                    "url": "https://mcpmag.com/Articles/2017/04/27/ScheduledTasks-Module-to-Audit-Tasks-in-PowerShell.aspx?"
                },
                {
                    "source_name": "www.binarydefense.com",
                    "description": "Diving into hidden scheduled tasks",
                    "url": "https://www.binarydefense.com/resources/blog/diving-into-hidden-scheduled-tasks/#:~:text=In%20the%20Microsoft%20post%20one%20of%20the%20pieces,tasks%20which%20do%20not%20have%20a%20SD%20value."
                },
                {
                    "source_name": "www.csoonline.com",
                    "description": "Windows task auditing/logging",
                    "url": "https://www.csoonline.com/article/567041/how-to-audit-windows-task-scheduler-for-cyber-attack-activity.html"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1053.005",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0148",
            "name": "Disable Cisco Open NX-OS Guest Shell",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0148\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling the Cisco NX-OS Guest Shell prevents adversaries from abusing the guest shell to maintain persistent access to a compromised environment.\n\n## Introduction\n\nThe Cisco NX-OS Guest Shell is a Linux-based container that is pre-installed on Cisco switches. The Guest Shell enables network admins to access the network over Linux network interfaces, the switch's boot flash, volatile tmpfs, CLI, host file system, and NX-API REST. Network admins can use the NX-OS Guest Shell to install and run python scripts and 32/64-bit Linux applications.\n\nAdversaries have abused the NX-OS guest shell to achieve initial access and persist in compromised environments. The intent of this countermeasure is to present options for disabling the NX-OS guest shell and revoke persistent access enabled by its abuse.\n\n## Preparation\n\n- Guest shell is supported on Cisco Nexus Series 3000 and 9000 (starting with the 7.0(3)F3(1) release).\n- The guest shell is enabled by default on this series of switches.\n- Only Network Administrators can access the guest shell by default. As such, you will require Network Administrator privileges to implement this countermeasure.\n- If an adversary has accessed the guest shell, identify the account and/or credentials used to authenticate. To contain the adversary, identify where these credentials have been used and revoke them.\n- Backup the running configuration before making changes or reloading a new image.\n- Ensure the new NX-OS image is compatible with the switch.\n\n## Risks\n\n- Guest shell can be used to build applications, automate tasks, troubleshoot, and conduct logging and tracing. If the organization is depended on the functionality afforded by the guest shell, disabling it can result in operational disruption. To minimize the likelihood of this risk, consider the extent to which the organization employs the guest shell and identify alternative options for accomplishing the same tasks.\n\n## Guidance\n\nReload a Cisco NX-OS image that does not provide guest shell support\n- Log in to the switch (SSH or console).\n- Issue the `run guestshell` command to access the guest shell.\n- Remove the guest shell: `guestshell destroy`.\n- Check the current configuration: `show running-config`.\n- Copy the new NX-OS image to the switch's boot flash memory: `copy tftp://[server-ip]/[image-filename] flash:`.\n- Verify the image: `show file bootflash:`.\n- Reload the new NX-OS image: `fast-reload [save-config] [nx-bootflash:[image-filename]]`.\n- Monitor the reload for issues with the process.\n\n## References\n\n- Cisco Nexus 9000 Series NX-OS Programmability Guide, Release 7.x | <https://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus9000/sw/7-x/programmability/guide/b_Cisco_Nexus_9000_Series_NX-OS_Programmability_Guide_7x/Guest_Shell.html>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0107",
                "CM0149"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisco.com",
                    "description": "Cisco Nexus 9000 Series NX-OS Programmability Guide, Release 7.x",
                    "url": "https://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus9000/sw/7-x/programmability/guide/b_Cisco_Nexus_9000_Series_NX-OS_Programmability_Guide_7x/Guest_Shell.html"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1133",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1190",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1610",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0149",
            "name": "Temporarily Disable Cisco Open NX-OS Guest Shell",
            "subtype": "Disable",
            "url": null,
            "content": "## Details\n\n* **ID:** CM0149\n* **Version:** 1.0\n* **Created:** 14 March 2025\n* **Modified:** 14 March 2025\n* **Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nRestricting the Cisco NX-OS Guest Shell prevents adversaries from abusing the guest shell to maintain persistent access to a compromised environment\n\n## Introduction\n\nThe Cisco NX-OS Guest Shell is a Linux-based container that is pre-installed on Cisco switches. The Guest Shell enables network admins to access the network over Linux network interfaces, the switch's boot flash, volatile tmpfs, CLI, host file system, and NX-API REST. Network admins can use the NX-OS Guest Shell to install and run python scripts and 32/64-bit Linux applications.\n\nAdversaries have abused the NX-OS guest shell to achieve initial access and persist in compromised environments. The intent of this countermeasure is to present options for temporarily restricting the NX-OS guest shell to revoke persistent access enabled by its abuse.\n\n## Preparation\n\n- Guest shell is supported on Cisco Nexus Series 3000 and 9000 (starting with the 7.0(3)F3(1) release).\n- The guest shell is enabled by default on this series of switches.\n- Only Network Administrators can access the guest shell by default. As such, you will require Network Administrator privileges to implement this countermeasure.\n- If an adversary has accessed the guest shell, identify the account and/or credentials used to authenticate. To contain the adversary, identify where these credentials have been used and revoke them.\n- Backup the running configuration before making changes or reloading a new image.\n- Ensure the new NX-OS image is compatible with the switch.\n\n## Risks\n\n- Guest shell can be used to build applications, automate tasks, troubleshoot, and conduct logging and tracing. If the organization is depended on the functionality afforded by the guest shell, restricting it can result in operational disruption. To minimize the likelihood of this risk, consider the extent to which the organization employs the guest shell and identify alternative options for accomplishing the same tasks.\n\n## Guidance\n\n### Temporarily Disable\n\nThe `guestshell disable` command disables and shuts down the guest shell. The guest shell will remain disabled until it is re-enabled.\n- Log in to the switch (SSH or console).\n- Issue the `run guestshell` command to access the guest shell.\n- Disable the guest shell: `guestshell disable`.\n\n### Destroy\n\nThe `guestshell destroy` command deactivates and uninstalls the guest shell. The guest shell will remain destroyed until it is re-enabled.\n- Log in to the switch (SSH or console).\n- Issue the `run guestshell` command to access the guest shell.\n- Destroy the guest shell: `guestshell destroy`.\n\n## References\n\n- Cisco Nexus 9000 Series NX-OS Programmability Guide, Release 7.x | <https://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus9000/sw/7-x/programmability/guide/b_Cisco_Nexus_9000_Series_NX-OS_Programmability_Guide_7x/Guest_Shell.html>",
            "version": "1.0",
            "created": "2025-03-14T00:00:00.000Z",
            "modified": "2025-03-14T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0107",
                "CM0148"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.cisco.com",
                    "description": "Cisco Nexus 9000 Series NX-OS Programmability Guide, Release 7.x",
                    "url": "https://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus9000/sw/7-x/programmability/guide/b_Cisco_Nexus_9000_Series_NX-OS_Programmability_Guide_7x/Guest_Shell.html"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078.002",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1133",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1190",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1610",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0153",
            "name": "Implement Complex Password Policy for Cisco Devices",
            "subtype": null,
            "url": null,
            "content": "## Details\n\n* **ID:** CM0153\n* **Version:** 0.1\n* **Created:** 11 February 2025\n* **Modified:** 18 March 2025\n* **Countermeasure Type:** Enable\n* **Status:** Active\n\n## Intended Outcome\n\nAuditing passwords under robust password complexity requirements prevents adversary privilege escalation and persistence via abuse of privileged EXEC mode across Cisco devices.\n\n## Introduction\n\nIt is not uncommon for modern adversaries to obtain hashed passwords and sensitive authentication information from configuration files across Cisco network devices. The presence of passwords across network devices increases the risk of device exploitation. The National Security Agency informs that compromise of network devices is correlated with poor password choice, improper hashing of configuration files, and password reuse. By default, Cisco networking devices contain a plaintext configuration file that is loaded after the Cisco operating system boots. This configuration file contains sensitive data that controls the behavior of the Cisco device, the direction of traffic within a network, as well as user authentication information.\n\n## Preparation\n\n- Determine the potential attack surface across the network by examining the quantity and complexity of passwords across network devices.\n- Following NSA recommendation, break down all existent passwords into their respective Type classification (0, 4, 5, 6, 7, 8, 9).\n- Document and retire all passwords that fit password type 0, 4, and 7 classification. Upgrade the passwords to Type 6, 8, or 9 classification if software and hardware permits.\n\n## Risks\n\n- Improperly configuring passwords under faulty password policy can result in the usage of various passwords that fall into insecure Type 0, 4, and 7 categories.\n- Weak password policy can incite network compromise if an adversary is able to brute force or break the password assigned to Cisco's privilege EXEC mode.\n\n## Guidance\n\n### Configure Password Policy in Privileged EXEC Mode\n\n- In general, strong passwords are those that require considerable effort to be cracked and converted to plaintext. Complex password policy underlines the following features:\n\t- Passwords contain a combination of lowercase and uppercase letters, symbols, and numbers.\n\t- Passwords are at least 15 alphanumeric characters.\n\t- Passwords are NOT:\n\t\t- A keyboard walk\n\t\t- Equivalent to a user name\n\t\t- The default password\n\t\t- Redundant- the same as a password used anywhere else\n\t\t- Related to the network, organization, location, or other function identifiers\n\t\t- Derived from a dictionary or common acronym.\n- The NSA specifically recommends that passwords are established under the following constraints:\n    - Use Multi-factor authentication when feasible \n    - Apply Password Type 8 for passwords\n    - Apply Password Type 6 for VPN keys \n    - Standardize creation of strong, unique passwords\n    - Implement Privilege levels for least privilege \n- Password policy should be edited through the Cisco CLI to account for the aforementioned specifications:\n\t- `Router (config) #aaa new-model`\n\t- `Router (config) #aaa common-criteria policy policy_name`\n\t- `Router (config-cc-policy) #char changes <number>`\n\t- `Router (config-cc-policy) #max-length <number>`\n\t- `Router (config-cc-policy) #min-length <number>`\n\t- `Router (config-cc-policy) #numeric-count <number>`\n\t- `Router (config-cc-policy) #special-case <number>`\n\t- `Router (config-cc-policy) #exit`\n\t- `Router (config) #username user common-criteria-policy <policy_name> password <password_name>`\n\t- `Router (config) #exit`\n\n- Executing the command lines above will edit password policy to require complex passwords for each user within the environment. The complexity of the password is adapted by the specifications made to the aforementioned attributes such as `max-length,` `numeric-count,` and `special-case.`\n\n## References\n\n- Cisco Password Types: Best Practices | <https://media.defense.gov/2022/Feb/17/2002940795/-1/-1/1/CSI_CISCO_PASSWORD_TYPES_BEST_PRACTICES_20220217.PDF>",
            "version": "0.1",
            "created": "2025-02-11T00:00:00.000Z",
            "modified": "2025-03-18T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0328",
                "CM0330",
                "CM0495"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "media.defense.gov",
                    "description": "Cisco Password Types: Best Practices",
                    "url": "https://media.defense.gov/2022/Feb/17/2002940795/-1/-1/1/CSI_CISCO_PASSWORD_TYPES_BEST_PRACTICES_20220217.PDF"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1078",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1552",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0156",
            "name": "Audit and Restrict Cisco CLI Privileges",
            "subtype": null,
            "url": null,
            "content": "## Details\n\n* **ID:** CM0156\n* **Version:** 0.1\n* **Created:** 11 February 2025\n* **Modified:** 18 March 2025\n* **Countermeasure Type:** Examine, Enable\n* **Status:** Active\n\n## Intended Outcome\n\nRestricting command line execution across Cisco devices to privileged levels prevents adversary objectives in privilege escalation and discovery by accessing running device configurations.\n\n## Introduction\n\nCisco devices have 16 privilege levels (0-15) that vary permissioned usage of the command line from only five commands (Level 0), all the way up to complete administrative control of the Cisco device (Level 15). Restricting access to specific commands through privileged EXEC mode can prevent certain users from accessing the running configuration file which contains sensitive information such as settings for interfaces, routing protocol information, along with network security features. If an adversary is able to access the running configuration file(s) of the network device, modifications and querying of the file(s) is likely to occur which can lead to unwarranted export of data and credentials. To provide an example of an attacker's malicious modification actions: an attacker may use the `copy` command to transfer a network configuration file between memory locations or network servers that are unauthorized to receive another device's configuration file(s) such as `running-config` or `startup-config.` Privileged EXEC mode exists to prevent this potential for abuse, by requiring a user to supply a password for entry and access to higher-level configuration commands.\n\n## Preparation\n\n- Determine the potential attack surface across the network by examining the quantity and complexity of passwords across network devices.\n- Following NSA recommendation, break down all existent passwords into their respective Type classification (0, 4, 5, 6, 7, 8, 9).\n\n## Risks\n\n- Adjusting permissions surrounding privileged modes through the Cisco CLI can introduce access and configuration limitations to Cisco network devices.\n\n## Guidance\n\n### Enforce Privilege Levels to Restrict Access\n\n- Network administrators should customize privilege levels to restrict the execution of specific commands.\n- Privilege levels can be created at a command-specific level. \n\t- Example:\n\t  - `Router (config) # privilege_mode level [0-15] command_string`\n\t  - `Router (config) # enable secret level [0-15] password_string`\n\t  - `Router (config) # exit`\n\n- Executing these commands will allow the user to specify a privilege level (0-15) to assign to the desired command (`command_string`). An encrypted password can then be applied for the assigned privilege level, such that the user must supply the assigned `password_string` when attempting to execute the `command_string`.\n\n## References\n\n- Cisco Password Types: Best Practices | <https://media.defense.gov/2022/Feb/17/2002940795/-1/-1/1/CSI_CISCO_PASSWORD_TYPES_BEST_PRACTICES_20220217.PDF>",
            "version": "0.1",
            "created": "2025-02-11T00:00:00.000Z",
            "modified": "2025-03-18T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0328",
                "CM0329",
                "CM0332"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "media.defense.gov",
                    "description": "Cisco Password Types: Best Practices",
                    "url": "https://media.defense.gov/2022/Feb/17/2002940795/-1/-1/1/CSI_CISCO_PASSWORD_TYPES_BEST_PRACTICES_20220217.PDF"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1016",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1059.008",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1098",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1602.002",
                    "content": null,
                    "details": null
                }
            ]
        },
        {
            "id": "CM0157",
            "name": "Disable Unauthorized Open Ports",
            "subtype": null,
            "url": null,
            "content": "## Details\n\n* **ID:** CM0157\n* **Version:** 0.1\n* **Created:** 21 January 2025\n* **Modified:** 04 March 2025\n* **Countermeasure Type:** Disable\n* **Status:** Active\n\n## Intended Outcome\n\nDisabling unauthorized open ports prevents adversaries from establishing persistence, lateral movement, and command and control foothold via the setup of unauthorized services, backdoors, or exfiltration channels on unused or high-numbered ports.\n\n## Introduction\n\nIn order to evade detection by modern network monitoring solutions, adversaries may establish unauthorized services on high and uncommonly used ports. Adversaries may engage services such as HTTPS over an uncommon port to facilitate command and control (C2) communication and data exfiltration. For this reason, organizations must regularly audit open ports. Attackers often exploit misconfigurations or weak firewall policies to run services on non-standard ports.\n\n## Preparation\n\n- Maintain and frequently reference an inventory of authorized services and ports required for business operations.\n- Enable logging and monitoring of open ports across all endpoints, servers, and perimeter firewalls.\n- Define anomalous port activity thresholds from what is expected within business operations.\n- Identify open ports by conducting regular network scans using tools `nmap`, `Netstat`, or automated SIEM functions.\n\n## Risks\n\n- Enforcing restrictive port-blocking policies may inadvertently block legitimate business applications.\n- Disabling open ports outright may interrupt administrative activity that temporarily utilizes high ports to perform network diagnosis processes. For example, a non-malicious service or program such as Splunk can stop functioning as a result of disabling ports used as part of an update sequence.\n\n## Guidance\n\n### Identify Unauthorized Open Ports\n\n- Conduct regular network scans using tools such as `nmap` and `netstat.` \n\t- `netstat -ano` and `lsof -i` are two commands that can be executed to determine which applications or users are opening unexpected ports.\n- Compare discovered open ports against an authorized services list to detect deviations in port usage that spans normal business operations.\n- Ensure investigation of the high port range (49152 - 65535). While this range is used for dynamic and private ports, it is often culprit for hidden adversarial services.\n- Immediately disable or isolate systems found running unauthorized services to prevent proliferation of adversary activity within the network.\n\n### Disable Ports in Windows Firewall \n\n- Port management is governed by Windows Firewall rules for Windows systems. The following guidance is relevant to Windows 10 and Windows Server 2016 operating systems:\n\t1. Navigate to 'System and Security' from the Windows Control Panel.\n\t2. Navigate 'Windows Defender Firewall' > 'Advanced Settings' > Select Outbound/Inbound Rules > Right-click 'New Rule'\n\t3. `Rule Type:` Choose 'Port' when selecting a rule type to be created.\n\t4. `Protocol and Ports:` Choose 'TCP' or 'UDP' to define the connection to control > Enter a singular port number, or range to be affected.\n\t5. `Action:` Select 'Block the connection' radio button.\n\t6. `Profile:` Select 'Domain,' 'Private,' and 'Public' checkboxes to disable port activity across all connections made by the computer.\n\n- High-numbered ports (existing within a range above 49152) require special investigation to determine if they are involved with hidden service usage.\n\t- If high-numbered, dynamic ports are not utilized as part of business operations, implement firewall rules to block traffic to and from the high port range (Port 49152 to Port 65535).\n\n- When determining specific ports to disable with Firewall rules, pay careful attention to commonly abused ports:\n\t- FTP (Port 20 and 21): Insecure and outdated-lacks encryption for data transfer or authentication.\n\t- SSH (Port 22): TCP port exploited by threat actors to gain unauthorized access to a system.\n\t- Telnet (Port 23): Vulnerable to spoofing, malware, credential brute-forcing, and credential sniffing.\n\t- NetBIOS (Port 139): Legacy printer/file sharing mechanism abused by attackers to discover IP addresses and session information.\n\t- Remote Desktop (Port 3389): RDP is a common target of session hijacking attempts.\n\n### Disable Ports in Linux/Unix Systems\n\n- In Linux/Unix Operating systems, port management is commonly performed using firewall services such as 'UFW' or 'iptables' in order to block incoming connections to a specific port number:\n    1. Identify the serice currently running on a port using commands such as `netstat -tulpn,` `ss -tln,` `ss -uln,` and `lsof -i -P -n`.\n    2. Once a port number and its corresponding service is identified, the UFW (Uncomplicated Firewall) service can be utilized to supply a command `sudo ufw deny <port_number>` to block the port.\n        - Ex: Executing `sudo ufw deny 80` will block all incoming traffic to port 80, which is commonly associated with the HTTP service.\n    3. In an instance where a service is actively using a port as opposed to listening, the service can be stopped using `sudo systemctl stop <service_name>` to consequently close the port the service was running on.\n    4. If more granular control over firewall rules is desired, the 'iptables' service can be utilized in the following fashion to block connections to a port number:\n          - `sudo iptables -A INPUT -p tcp --dport 22 -m state --state NEW, ESTABLISHED -j DROP` \n       - Executing this command will assign a new rule to the INPUT chain handled by iptables, specifying that incoming TCP traffic matching packets of the NEW or ESTABLISHED connection states should be dropped. This effectively blocks both new and outgoing SSH connections.\n\n## References\n\n- How to Open and Block Ports in Windows Firewall | <https://www.hostwinds.com/tutorials/how-to-open-or-block-ports-using-windows-firewall>\n\n- Identifying Open Ports in Your Network Perimeter | <https://bluegoatcyber.com/blog/identifying-open-ports-in-your-network-perimeter/>\n\n- Handling Open Ports Secure and Finding Vulnerabilities | <https://blog.netwrix.com/2022/08/16/open-network-ports/>\n\n- ss Command in Linux with Examples | <https://linuxblog.io/ss-command-in-linux-with-examples/#:~:text=The%20ss%20command%20stands%20for,connections%2C%20and%20monitoring%20network%20traffic>\n\n- Determining if a port is in use by an application or process on a virtual machine | <https://knowledge.broadcom.com/external/article?articleNumber=308682>",
            "version": "0.1",
            "created": "2025-01-21T00:00:00.000Z",
            "modified": "2025-03-04T00:00:00.000Z",
            "contributors": [],
            "technologies": [],
            "platforms": [],
            "revoked": null,
            "deprecated": null,
            "ids_before_this": [],
            "ids_after_this": [],
            "is_baseline": false,
            "related_ids": [
                "CM0057",
                "CM0072",
                "CM0109"
            ],
            "automatable": "unspecified",
            "references": [
                {
                    "source_name": "www.hostwinds.com",
                    "description": "How to Open and Block Ports in Windows Firewall",
                    "url": "https://www.hostwinds.com/tutorials/how-to-open-or-block-ports-using-windows-firewall"
                },
                {
                    "source_name": "bluegoatcyber.com",
                    "description": "Identifying Open Ports in Your Network Perimeter",
                    "url": "https://bluegoatcyber.com/blog/identifying-open-ports-in-your-network-perimeter/"
                },
                {
                    "source_name": "blog.netwrix.com",
                    "description": "Handling Open Ports Secure and Finding Vulnerabilities",
                    "url": "https://blog.netwrix.com/2022/08/16/open-network-ports/"
                },
                {
                    "source_name": "linuxblog.io",
                    "description": "ss Command in Linux with Examples",
                    "url": "https://linuxblog.io/ss-command-in-linux-with-examples/#:~:text=The%20ss%20command%20stands%20for,connections%2C%20and%20monitoring%20network%20traffic"
                },
                {
                    "source_name": "knowledge.broadcom.com",
                    "description": "Determining if a port is in use by an application or process on a virtual machine",
                    "url": "https://knowledge.broadcom.com/external/article?articleNumber=308682"
                }
            ],
            "techniques": [
                {
                    "tech_id": "T1205",
                    "content": null,
                    "details": null
                },
                {
                    "tech_id": "T1571",
                    "content": null,
                    "details": null
                }
            ]
        }
    ],
    "templates": [
        {
            "id": "TMPL0001",
            "name": "Volt Typhoon",
            "featured": false,
            "iconSrc": null,
            "link": {
                "url": "https://attack.mitre.org/groups/G1017/",
                "text": "Volt Typhoon on MITRE ATT&CK (group G1017)"
            },
            "description": "Countermeasures for Techniques used by Volt Typhoon.\n\n> Volt Typhoon is a People's Republic of China (PRC) state-sponsored actor that has been active since at least 2021. Volt Typhoon typically focuses on espionage and information gathering and has targeted critical infrastructure organizations in the US including Guam. Volt Typhoon has emphasized stealth in operations using web shells, living-off-the-land (LOTL) binaries, hands on keyboard activities, and stolen credentials.\n>\n> \\- <https://attack.mitre.org/groups/G1017/>\n",
            "tech_to_items": {
                "unmapped": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1003.001": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0087",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0088",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0090",
                            "version": "1.0"
                        }
                    ]
                },
                "T1003.003": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0096",
                            "version": "1.0"
                        }
                    ]
                },
                "T1005": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1012": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1016": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1018": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0036",
                            "version": "1.0"
                        }
                    ]
                },
                "T1033": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1036.005": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0003",
                            "version": "1.0"
                        }
                    ]
                },
                "T1036.008": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1047": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0045",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0036",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0038",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0039",
                            "version": "1.0"
                        }
                    ]
                },
                "T1049": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0025",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0042",
                            "version": "1.0"
                        }
                    ]
                },
                "T1057": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1059.001": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0019",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0031",
                            "version": "1.0"
                        }
                    ]
                },
                "T1059.003": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1069.001": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1069.002": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1070.004": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1070.007": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1074": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1074.001": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1078.002": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0059",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0060",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0028",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0070",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0084",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0041",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0102",
                            "version": "1.0"
                        }
                    ]
                },
                "T1082": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0081",
                            "version": "1.0"
                        }
                    ]
                },
                "T1087.002": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0137",
                            "version": "1.0"
                        }
                    ]
                },
                "T1090": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        }
                    ]
                },
                "T1090.001": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0093",
                            "version": "1.0"
                        }
                    ]
                },
                "T1190": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0067",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0037",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0093",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0106",
                            "version": "1.0"
                        }
                    ]
                },
                "T1497.001": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1505.003": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0106",
                            "version": "1.0"
                        }
                    ]
                },
                "T1518": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1555": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0061",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0067",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0029",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0033",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0135",
                            "version": "1.0"
                        }
                    ]
                },
                "T1560.001": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1570": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0101",
                            "version": "1.0"
                        }
                    ]
                },
                "T1573.001": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1584.004": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1584.005": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1588.002": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1654": {
                    "confidence": "suspected",
                    "items": []
                }
            },
            "ignored_items": []
        },
        {
            "id": "TMPL0002",
            "name": "SolarWinds Compromise",
            "featured": false,
            "iconSrc": null,
            "link": {
                "url": "https://www.cisa.gov/news-events/news/remediating-networks-affected-solarwinds-and-active-directorym365-compromise",
                "text": "Remediating Networks Affected by the SolarWinds and Active Directory/M365 Compromise"
            },
            "description": "Countermeasures aiding in recovery from the SolarWinds Orion Platform supply chain compromise.\n\n> The SolarWinds Compromise was a sophisticated supply chain cyber operation conducted by APT29 that was discovered in mid-December 2020. APT29 used customized malware to inject malicious code into the SolarWinds Orion software build process that was later distributed through a normal software update; they also used password spraying, token theft, API abuse, spear phishing, and other supply chain attacks to compromise user accounts and leverage their associated access. Victims of this campaign included government, consulting, technology, telecom, and other organizations in North America, Europe, Asia, and the Middle East. Industry reporting initially referred to the actors involved in this campaign as UNC2452, NOBELIUM, StellarParticle, Dark Halo, and SolarStorm.\n>\n> In April 2021, the US and UK governments attributed the SolarWinds Compromise to Russia's Foreign Intelligence Service (SVR); public statements included citations to APT29, Cozy Bear, and The Dukes. The US government assessed that of the approximately 18,000 affected public and private sector customers of Solar Winds\u2019 Orion product, a much smaller number were compromised by follow-on APT29 activity on their systems.\n>\n> \\- <https://attack.mitre.org/campaigns/C0024/>\n",
            "tech_to_items": {
                "unmapped": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1003.006": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0079",
                            "version": "1.0"
                        }
                    ]
                },
                "T1018": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0036",
                            "version": "1.0"
                        }
                    ]
                },
                "T1021.006": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0045",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0019",
                            "version": "1.0"
                        }
                    ]
                },
                "T1027": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1036": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0003",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0022",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0024",
                            "version": "1.0"
                        }
                    ]
                },
                "T1036.004": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0141",
                            "version": "1.0"
                        }
                    ]
                },
                "T1036.005": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0003",
                            "version": "1.0"
                        }
                    ]
                },
                "T1041": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0093",
                            "version": "1.0"
                        }
                    ]
                },
                "T1047": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0045",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0036",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0038",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0039",
                            "version": "1.0"
                        }
                    ]
                },
                "T1053.005": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0103",
                            "version": "1.0"
                        }
                    ]
                },
                "T1057": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1059.001": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0019",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0031",
                            "version": "1.0"
                        }
                    ]
                },
                "T1059.003": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1069": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1070": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0003",
                            "version": "1.0"
                        }
                    ]
                },
                "T1070.004": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1070.006": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1074.002": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1082": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0081",
                            "version": "1.0"
                        }
                    ]
                },
                "T1083": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1087": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1090.001": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0093",
                            "version": "1.0"
                        }
                    ]
                },
                "T1098.001": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0076",
                            "version": "1.0"
                        }
                    ]
                },
                "T1098.002": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0068",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0074",
                            "version": "1.0"
                        }
                    ]
                },
                "T1105": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0093",
                            "version": "1.0"
                        }
                    ]
                },
                "T1114.002": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0074",
                            "version": "1.0"
                        }
                    ]
                },
                "T1140": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1195.002": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0067",
                            "version": "1.0"
                        }
                    ]
                },
                "T1218.011": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1482": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0123",
                            "version": "1.0"
                        }
                    ]
                },
                "T1484.002": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0085",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0134",
                            "version": "1.0"
                        }
                    ]
                },
                "T1546.003": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        }
                    ]
                },
                "T1550": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0077",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0102",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0114",
                            "version": "1.0"
                        }
                    ]
                },
                "T1552.004": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0003",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0032",
                            "version": "1.0"
                        }
                    ]
                },
                "T1553.002": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0058",
                            "version": "1.0"
                        }
                    ]
                },
                "T1553.004": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1555": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0061",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0067",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0029",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0033",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0135",
                            "version": "1.0"
                        }
                    ]
                },
                "T1558.003": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        }
                    ]
                },
                "T1560.001": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1562.001": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0003",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0058",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0095",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0110",
                            "version": "1.0"
                        }
                    ]
                },
                "T1562.002": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0003",
                            "version": "1.0"
                        }
                    ]
                },
                "T1562.004": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0003",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0017",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0095",
                            "version": "1.0"
                        }
                    ]
                },
                "T1568.002": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1606": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0059",
                            "version": "1.0"
                        }
                    ]
                },
                "T1606.001": {
                    "confidence": "suspected",
                    "items": []
                },
                "T1606.002": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0059",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0073",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0134",
                            "version": "1.0"
                        }
                    ]
                }
            },
            "ignored_items": []
        },
        {
            "id": "TMPL0004",
            "name": "Active Directory Identity Remediation",
            "featured": false,
            "iconSrc": null,
            "link": null,
            "description": "Countermeasures aiding in the recovery of an Active Directory Compromise, specifically for the identity aspect of Active Directory and other highly important countermeasures. This is intended to be edited to more accurately suit your environment and specifically target Threat Actor TTPs relevant to your compromise.",
            "tech_to_items": {
                "unmapped": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0135",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0145",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0084",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0018",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0112",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0041",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0124",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0060",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0094",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0118",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0121",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0146",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0076",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0061",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0087",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0050",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0088",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0070",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0092",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0028",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0069",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0126",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0029",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0083",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0073",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0102",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0128",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0089",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0033",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0114",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0105",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0080",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0032",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0099",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0079",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0122",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0123",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0139",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0074",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0040",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0026",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0059",
                            "version": "1.0"
                        }
                    ]
                }
            },
            "ignored_items": []
        },
        {
            "id": "TMPL0005",
            "name": "Active Directory General Remediation",
            "featured": false,
            "iconSrc": null,
            "link": null,
            "description": "The intended role of this template is to provide additional general guidance for Active Directory recovery. This includes a broad number of countermeasures to be used in addition after the execution of the Active Directory Identity template. This template is also intended to be edited to only include countermeasures that are relevant to your environment and what TTPs an Adversary has carried out within the environment.",
            "tech_to_items": {
                "unmapped": {
                    "confidence": "suspected",
                    "items": [
                        {
                            "id": "CM0135",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0145",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0084",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0018",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0112",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0041",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0124",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0060",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0094",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0118",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0121",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0146",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0076",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0061",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0087",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0050",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0088",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0070",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0092",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0028",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0069",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0126",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0029",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0083",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0073",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0102",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0128",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0089",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0033",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0114",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0105",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0080",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0032",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0099",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0079",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0122",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0123",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0139",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0074",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0040",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0026",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0065",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0063",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0067",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0082",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0071",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0030",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0103",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0059",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0024",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0027",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0085",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0086",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0107",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0133",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0134",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0136",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0147",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0009",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0010",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0011",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0077",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0075",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0004",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0017",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0038",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0101",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0111",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0137",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0141",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0144",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0022",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0023",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0013",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0039",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0019",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0001",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0131",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0012",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0129",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0045",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0003",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0127",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0130",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0058",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0044",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0142",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0072",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0062",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0100",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0052",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0025",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0042",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0031",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0036",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0043",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0095",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0090",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0125",
                            "version": "1.0"
                        },
                        {
                            "id": "CM0096",
                            "version": "1.0"
                        }
                    ]
                }
            },
            "ignored_items": []
        }
    ]
}